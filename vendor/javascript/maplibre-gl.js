var u=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var F={};
/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.3.2/LICENSE.txt
 */(function(u,Vt){F=Vt()})(0,(function(){var F={};var Vt={};function define(u,Wt,Kt){Vt[u]=Kt;if(u==="index"){var Qi="var sharedModule = {}; ("+Vt.shared+")(sharedModule); ("+Vt.worker+")(sharedModule);";var fr={};Vt.shared(fr);Vt.index(F,fr);typeof window!=="undefined"&&F.setWorkerUrl(window.URL.createObjectURL(new Blob([Qi],{type:"text/javascript"})));return F}}define("shared",["exports"],(function(F){function e(u,F,Vt,Wt){return new(Vt||(Vt=Promise))((function(Kt,Qi){function a(u){try{l(Wt.next(u))}catch(u){Qi(u)}}function o(u){try{l(Wt.throw(u))}catch(u){Qi(u)}}function l(u){var F;u.done?Kt(u.value):(F=u.value,F instanceof Vt?F:new Vt((function(u){u(F)}))).then(a,o)}l((Wt=Wt.apply(u,F||[])).next())}))}function r(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}"function"==typeof SuppressedError&&SuppressedError;var Vt=i;function i(F,Vt){(this||u).x=F,(this||u).y=Vt}i.prototype={clone:function(){return new i((this||u).x,(this||u).y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,F){return this.clone()._rotateAround(u,F)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt((this||u).x*(this||u).x+(this||u).y*(this||u).y)},equals:function(F){return(this||u).x===F.x&&(this||u).y===F.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(F){var Vt=F.x-(this||u).x,Wt=F.y-(this||u).y;return Vt*Vt+Wt*Wt},angle:function(){return Math.atan2((this||u).y,(this||u).x)},angleTo:function(F){return Math.atan2((this||u).y-F.y,(this||u).x-F.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(F,Vt){return Math.atan2((this||u).x*Vt-(this||u).y*F,(this||u).x*F+(this||u).y*Vt)},_matMult:function(F){var Vt=F[2]*(this||u).x+F[3]*(this||u).y;return(this||u).x=F[0]*(this||u).x+F[1]*(this||u).y,(this||u).y=Vt,this||u},_add:function(F){return(this||u).x+=F.x,(this||u).y+=F.y,this||u},_sub:function(F){return(this||u).x-=F.x,(this||u).y-=F.y,this||u},_mult:function(F){return(this||u).x*=F,(this||u).y*=F,this||u},_div:function(F){return(this||u).x/=F,(this||u).y/=F,this||u},_multByPoint:function(F){return(this||u).x*=F.x,(this||u).y*=F.y,this||u},_divByPoint:function(F){return(this||u).x/=F.x,(this||u).y/=F.y,this||u},_unit:function(){return this._div(this.mag()),this||u},_perp:function(){var F=(this||u).y;return(this||u).y=(this||u).x,(this||u).x=-F,this||u},_rotate:function(F){var Vt=Math.cos(F),Wt=Math.sin(F),Kt=Wt*(this||u).x+Vt*(this||u).y;return(this||u).x=Vt*(this||u).x-Wt*(this||u).y,(this||u).y=Kt,this||u},_rotateAround:function(F,Vt){var Wt=Math.cos(F),Kt=Math.sin(F),Qi=Vt.y+Kt*((this||u).x-Vt.x)+Wt*((this||u).y-Vt.y);return(this||u).x=Vt.x+Wt*((this||u).x-Vt.x)-Kt*((this||u).y-Vt.y),(this||u).y=Qi,this||u},_round:function(){return(this||u).x=Math.round((this||u).x),(this||u).y=Math.round((this||u).y),this||u}},i.convert=function(u){return u instanceof i?u:Array.isArray(u)?new i(u[0],u[1]):u};var Wt=r(Vt),Kt=o;function o(F,Vt,Wt,Kt){(this||u).cx=3*F,(this||u).bx=3*(Wt-F)-(this||u).cx,(this||u).ax=1-(this||u).cx-(this||u).bx,(this||u).cy=3*Vt,(this||u).by=3*(Kt-Vt)-(this||u).cy,(this||u).ay=1-(this||u).cy-(this||u).by,(this||u).p1x=F,(this||u).p1y=Vt,(this||u).p2x=Wt,(this||u).p2y=Kt}o.prototype={sampleCurveX:function(F){return(((this||u).ax*F+(this||u).bx)*F+(this||u).cx)*F},sampleCurveY:function(F){return(((this||u).ay*F+(this||u).by)*F+(this||u).cy)*F},sampleCurveDerivativeX:function(F){return(3*(this||u).ax*F+2*(this||u).bx)*F+(this||u).cx},solveCurveX:function(u,F){if(void 0===F&&(F=1e-6),u<0)return 0;if(u>1)return 1;for(var Vt=u,Wt=0;Wt<8;Wt++){var Kt=this.sampleCurveX(Vt)-u;if(Math.abs(Kt)<F)return Vt;var Qi=this.sampleCurveDerivativeX(Vt);if(Math.abs(Qi)<1e-6)break;Vt-=Kt/Qi}var fr=0,_r=1;for(Vt=u,Wt=0;Wt<20&&(Kt=this.sampleCurveX(Vt),!(Math.abs(Kt-u)<F));Wt++)u>Kt?fr=Vt:_r=Vt,Vt=.5*(_r-fr)+fr;return Vt},solve:function(u,F){return this.sampleCurveY(this.solveCurveX(u,F))}};var Qi=r(Kt);let fr,_r;function h(){return null==fr&&(fr="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),fr}function p(){if(null==_r&&(_r=!1,h())){const u=5,F=new OffscreenCanvas(u,u).getContext("2d",{willReadFrequently:!0});if(F){for(let Vt=0;Vt<u*u;Vt++){const Wt=4*Vt;F.fillStyle=`rgb(${Wt},${Wt+1},${Wt+2})`,F.fillRect(Vt%u,Math.floor(Vt/u),1,1)}const Vt=F.getImageData(0,0,u,u).data;for(let F=0;F<u*u*4;F++)if(F%4!=3&&Vt[F]!==F){_r=!0;break}}}return _r||!1}function f(u,F,Vt,Wt){const Kt=new Qi(u,F,Vt,Wt);return u=>Kt.solve(u)}const Sr=f(.25,.1,.25,1);function y(u,F,Vt){return Math.min(Vt,Math.max(F,u))}function m(u,F,Vt){const Wt=Vt-F,Kt=((u-F)%Wt+Wt)%Wt+F;return Kt===F?Vt:Kt}function g(u,...F){for(const Vt of F)for(const F in Vt)u[F]=Vt[F];return u}let Ar=1;function v(F,Vt,Wt){const Kt={};for(const Wt in F)Kt[Wt]=Vt.call(this||u,F[Wt],Wt,F);return Kt}function b(F,Vt,Wt){const Kt={};for(const Wt in F)Vt.call(this||u,F[Wt],Wt,F)&&(Kt[Wt]=F[Wt]);return Kt}function w(u){return Array.isArray(u)?u.map(w):"object"==typeof u&&u?v(u,w):u}const Jr={};function A(u){Jr[u]||("undefined"!=typeof console&&console.warn(u),Jr[u]=!0)}function S(u,F,Vt){return(Vt.y-u.y)*(F.x-u.x)>(F.y-u.y)*(Vt.x-u.x)}function k(u){return"undefined"!=typeof WorkerGlobalScope&&void 0!==u&&u instanceof WorkerGlobalScope}let zn=null;function I(u){return"undefined"!=typeof ImageBitmap&&u instanceof ImageBitmap}const Qs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function P(F,Vt,Wt,Kt,Qi){return e(this||u,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const u=new VideoFrame(F,{timestamp:0});try{const fr=null==u?void 0:u.format;if(!fr||!fr.startsWith("BGR")&&!fr.startsWith("RGB"))throw new Error(`Unrecognized format ${fr}`);const _r=fr.startsWith("BGR"),Sr=new Uint8ClampedArray(Kt*Qi*4);if(yield u.copyTo(Sr,function(u,F,Vt,Wt,Kt){const Qi=4*Math.max(-F,0),fr=(Math.max(0,Vt)-Vt)*Wt*4+Qi,_r=4*Wt,Sr=Math.max(0,F),Ar=Math.max(0,Vt);return{rect:{x:Sr,y:Ar,width:Math.min(u.width,F+Wt)-Sr,height:Math.min(u.height,Vt+Kt)-Ar},layout:[{offset:fr,stride:_r}]}}(F,Vt,Wt,Kt,Qi)),_r)for(let u=0;u<Sr.length;u+=4){const F=Sr[u];Sr[u]=Sr[u+2],Sr[u+2]=F}return Sr}finally{u.close()}}))}let ta,ia;const aa="AbortError";function E(){return new Error(aa)}const va={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function T(u){return va.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Ba="global-dispatcher";class L extends Error{constructor(u,F,Vt,Wt){super(`AJAXError: ${F} (${u}): ${Vt}`),this.status=u,this.statusText=F,this.url=Vt,this.body=Wt}}const D=()=>k(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,O=function(F,Vt){if(/:\/\//.test(F.url)&&!/^https?:|^file:/.test(F.url)){const u=T(F.url);if(u)return u(F,Vt);if(k(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:F,targetMapId:Ba},Vt)}if(!(/^file:/.test(Wt=F.url)||/^file:/.test(D())&&!/^\w+:/.test(Wt))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(F,Vt){return e(this||u,void 0,void 0,(function*(){const u=new Request(F.url,{method:F.method||"GET",body:F.body,credentials:F.credentials,headers:F.headers,cache:F.cache,referrer:D(),signal:Vt.signal});"json"===F.type&&u.headers.set("Accept","application/json");const Wt=yield fetch(u);if(!Wt.ok){const u=yield Wt.blob();throw new L(Wt.status,Wt.statusText,F.url,u)}let Kt;Kt="arrayBuffer"===F.type||"image"===F.type?Wt.arrayBuffer():"json"===F.type?Wt.json():Wt.text();const Qi=yield Kt;if(Vt.signal.aborted)throw E();return{data:Qi,cacheControl:Wt.headers.get("Cache-Control"),expires:Wt.headers.get("Expires")}}))}(F,Vt);if(k(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:F,mustQueue:!0,targetMapId:Ba},Vt)}var Wt;return function(u,F){return new Promise(((Vt,Wt)=>{const Kt=new XMLHttpRequest;Kt.open(u.method||"GET",u.url,!0),"arrayBuffer"!==u.type&&"image"!==u.type||(Kt.responseType="arraybuffer");for(const F in u.headers)Kt.setRequestHeader(F,u.headers[F]);"json"===u.type&&(Kt.responseType="text",Kt.setRequestHeader("Accept","application/json")),Kt.withCredentials="include"===u.credentials,Kt.onerror=()=>{Wt(new Error(Kt.statusText))},Kt.onload=()=>{if(!F.signal.aborted)if((Kt.status>=200&&Kt.status<300||0===Kt.status)&&null!==Kt.response){let F=Kt.response;if("json"===u.type)try{F=JSON.parse(Kt.response)}catch(u){return void Wt(u)}Vt({data:F,cacheControl:Kt.getResponseHeader("Cache-Control"),expires:Kt.getResponseHeader("Expires")})}else{const F=new Blob([Kt.response],{type:Kt.getResponseHeader("Content-Type")});Wt(new L(Kt.status,Kt.statusText,u.url,F))}},F.signal.addEventListener("abort",(()=>{Kt.abort(),Wt(E())})),Kt.send(u.body)}))}(F,Vt)};function R(u){if(!u||u.indexOf("://")<=0||0===u.indexOf("data:image/")||0===u.indexOf("blob:"))return!0;const F=new URL(u),Vt=window.location;return F.protocol===Vt.protocol&&F.host===Vt.host}function U(u,F,Vt){Vt[u]&&-1!==Vt[u].indexOf(F)||(Vt[u]=Vt[u]||[],Vt[u].push(F))}function j(u,F,Vt){if(Vt&&Vt[u]){const Wt=Vt[u].indexOf(F);-1!==Wt&&Vt[u].splice(Wt,1)}}class q{constructor(u,F={}){g(this,F),this.type=u}}class N extends q{constructor(u,F={}){super("error",g({error:u},F))}}class Z{on(u,F){return this._listeners=this._listeners||{},U(u,F,this._listeners),this}off(u,F){return j(u,F,this._listeners),j(u,F,this._oneTimeListeners),this}once(u,F){return F?(this._oneTimeListeners=this._oneTimeListeners||{},U(u,F,this._oneTimeListeners),this):new Promise((F=>this.once(u,F)))}fire(u,F){"string"==typeof u&&(u=new q(u,F||{}));const Vt=u.type;if(this.listens(Vt)){u.target=this;const F=this._listeners&&this._listeners[Vt]?this._listeners[Vt].slice():[];for(const Vt of F)Vt.call(this,u);const Wt=this._oneTimeListeners&&this._oneTimeListeners[Vt]?this._oneTimeListeners[Vt].slice():[];for(const F of Wt)j(Vt,F,this._oneTimeListeners),F.call(this,u);const Kt=this._eventedParent;Kt&&(g(u,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),Kt.fire(u))}else u instanceof N&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,F){return this._eventedParent=u,this._eventedParentData=F,this}}var Ya={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const to=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function J(u,F){const Vt={};for(const F in u)"ref"!==F&&(Vt[F]=u[F]);return to.forEach((u=>{u in F&&(Vt[u]=F[u])})),Vt}function X(u,F){if(Array.isArray(u)){if(!Array.isArray(F)||u.length!==F.length)return!1;for(let Vt=0;Vt<u.length;Vt++)if(!X(u[Vt],F[Vt]))return!1;return!0}if("object"==typeof u&&null!==u&&null!==F){if("object"!=typeof F)return!1;if(Object.keys(u).length!==Object.keys(F).length)return!1;for(const Vt in u)if(!X(u[Vt],F[Vt]))return!1;return!0}return u===F}function H(u,F){u.push(F)}function Y(u,F,Vt){H(Vt,{command:"addSource",args:[u,F[u]]})}function W(u,F,Vt){H(F,{command:"removeSource",args:[u]}),Vt[u]=!0}function Q(u,F,Vt,Wt){W(u,Vt,Wt),Y(u,F,Vt)}function tt(u,F,Vt){let Wt;for(Wt in u[Vt])if(Object.prototype.hasOwnProperty.call(u[Vt],Wt)&&"data"!==Wt&&!X(u[Vt][Wt],F[Vt][Wt]))return!1;for(Wt in F[Vt])if(Object.prototype.hasOwnProperty.call(F[Vt],Wt)&&"data"!==Wt&&!X(u[Vt][Wt],F[Vt][Wt]))return!1;return!0}function et(u,F,Vt,Wt,Kt,Qi){u=u||{},F=F||{};for(const fr in u)Object.prototype.hasOwnProperty.call(u,fr)&&(X(u[fr],F[fr])||Vt.push({command:Qi,args:[Wt,fr,F[fr],Kt]}));for(const fr in F)Object.prototype.hasOwnProperty.call(F,fr)&&!Object.prototype.hasOwnProperty.call(u,fr)&&(X(u[fr],F[fr])||Vt.push({command:Qi,args:[Wt,fr,F[fr],Kt]}))}function rt(u){return u.id}function nt(u,F){return u[F.id]=F,u}class it{constructor(u,F,Vt,Wt){this.message=(u?`${u}: `:"")+Vt,Wt&&(this.identifier=Wt),null!=F&&F.__line__&&(this.line=F.__line__)}}function st(u,...F){for(const Vt of F)for(const F in Vt)u[F]=Vt[F];return u}class at extends Error{constructor(u,F){super(F),this.message=F,this.key=u}}class ot{constructor(u,F=[]){this.parent=u,this.bindings={};for(const[u,Vt]of F)this.bindings[u]=Vt}concat(u){return new ot(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const eo={kind:"null"},io={kind:"number"},so={kind:"string"},co={kind:"boolean"},ho={kind:"color"},bo={kind:"object"},wo={kind:"value"},So={kind:"collator"},Ao={kind:"formatted"},ko={kind:"padding"},Wo={kind:"resolvedImage"},il={kind:"variableAnchorOffsetCollection"};function bt(u,F){return{kind:"array",itemType:u,N:F}}function wt(u){if("array"===u.kind){const F=wt(u.itemType);return"number"==typeof u.N?`array<${F}, ${u.N}>`:"value"===u.itemType.kind?"array":`array<${F}>`}return u.kind}const rl=[eo,io,so,co,ho,Ao,bo,bt(wo),ko,Wo,il];function At(u,F){if("error"===F.kind)return null;if("array"===u.kind){if("array"===F.kind&&(0===F.N&&"value"===F.itemType.kind||!At(u.itemType,F.itemType))&&("number"!=typeof u.N||u.N===F.N))return null}else{if(u.kind===F.kind)return null;if("value"===u.kind)for(const u of rl)if(!At(u,F))return null}return`Expected ${wt(u)} but found ${wt(F)} instead.`}function St(u,F){return F.some((F=>F.kind===u.kind))}function kt(u,F){return F.some((F=>"null"===F?null===u:"array"===F?Array.isArray(u):"object"===F?u&&!Array.isArray(u)&&"object"==typeof u:F===typeof u))}function Mt(u,F){return"array"===u.kind&&"array"===F.kind?u.itemType.kind===F.itemType.kind&&"number"==typeof u.N:u.kind===F.kind}const nl=.96422,al=.82521,ol=4/29,ll=6/29,cl=3*ll*ll,hl=ll*ll*ll,ul=Math.PI/180,ml=180/Math.PI;function Tt(u){return(u%=360)<0&&(u+=360),u}function $t([u,F,Vt,Wt]){let Kt,Qi;const fr=Dt((.2225045*(u=Lt(u))+.7168786*(F=Lt(F))+.0606169*(Vt=Lt(Vt)))/1);u===F&&F===Vt?Kt=Qi=fr:(Kt=Dt((.4360747*u+.3850649*F+.1430804*Vt)/nl),Qi=Dt((.0139322*u+.0971045*F+.7141733*Vt)/al));const _r=116*fr-16;return[_r<0?0:_r,500*(Kt-fr),200*(fr-Qi),Wt]}function Lt(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Dt(u){return u>hl?Math.pow(u,1/3):u/cl+ol}function Ot([u,F,Vt,Wt]){let Kt=(u+16)/116,Qi=isNaN(F)?Kt:Kt+F/500,fr=isNaN(Vt)?Kt:Kt-Vt/200;return Kt=1*Ut(Kt),Qi=nl*Ut(Qi),fr=al*Ut(fr),[Rt(3.1338561*Qi-1.6168667*Kt-.4906146*fr),Rt(-.9787684*Qi+1.9161415*Kt+.033454*fr),Rt(.0719453*Qi-.2289914*Kt+1.4052427*fr),Wt]}function Rt(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Ut(u){return u>ll?u*u*u:cl*(u-ol)}function jt(u){return parseInt(u.padEnd(2,u),16)/255}function qt(u,F){return Nt(F?u/100:u,0,1)}function Nt(u,F,Vt){return Math.min(Math.max(F,u),Vt)}function Zt(u){return!u.some(Number.isNaN)}const _l={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Gt{constructor(u,F,Vt,Wt=1,Kt=!0){this.r=u,this.g=F,this.b=Vt,this.a=Wt,Kt||(this.r*=Wt,this.g*=Wt,this.b*=Wt,Wt||this.overwriteGetter("rgb",[u,F,Vt,Wt]))}static parse(u){if(u instanceof Gt)return u;if("string"!=typeof u)return;const F=function(u){if("transparent"===(u=u.toLowerCase().trim()))return[0,0,0,0];const F=_l[u];if(F){const[u,Vt,Wt]=F;return[u/255,Vt/255,Wt/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const F=u.length<6?1:2;let Vt=1;return[jt(u.slice(Vt,Vt+=F)),jt(u.slice(Vt,Vt+=F)),jt(u.slice(Vt,Vt+=F)),jt(u.slice(Vt,Vt+F)||"ff")]}if(u.startsWith("rgb")){const F=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(F){const[u,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs]=F,ta=[Kt||" ",_r||" ",Jr].join("");if("  "===ta||"  /"===ta||",,"===ta||",,,"===ta){const u=[Wt,fr,Ar].join(""),F="%%%"===u?100:""===u?255:0;if(F){const u=[Nt(+Vt/F,0,1),Nt(+Qi/F,0,1),Nt(+Sr/F,0,1),zn?qt(+zn,Qs):1];if(Zt(u))return u}}return}}const Vt=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Vt){const[u,F,Wt,Kt,Qi,fr,_r,Sr,Ar]=Vt,Jr=[Wt||" ",Qi||" ",_r].join("");if("  "===Jr||"  /"===Jr||",,"===Jr||",,,"===Jr){const u=[+F,Nt(+Kt,0,100),Nt(+fr,0,100),Sr?qt(+Sr,Ar):1];if(Zt(u))return function([u,F,Vt,Wt]){function i(Wt){const Kt=(Wt+u/30)%12,Qi=F*Math.min(Vt,1-Vt);return Vt-Qi*Math.max(-1,Math.min(Kt-3,9-Kt,1))}return u=Tt(u),F/=100,Vt/=100,[i(0),i(8),i(4),Wt]}(u)}}}(u);return F?new Gt(...F,!1):void 0}get rgb(){const{r:u,g:F,b:Vt,a:Wt}=this,Kt=Wt||1/0;return this.overwriteGetter("rgb",[u/Kt,F/Kt,Vt/Kt,Wt])}get hcl(){return this.overwriteGetter("hcl",function(u){const[F,Vt,Wt,Kt]=$t(u),Qi=Math.sqrt(Vt*Vt+Wt*Wt);return[Math.round(1e4*Qi)?Tt(Math.atan2(Wt,Vt)*ml):NaN,Qi,F,Kt]}(this.rgb))}get lab(){return this.overwriteGetter("lab",$t(this.rgb))}overwriteGetter(u,F){return Object.defineProperty(this,u,{value:F}),F}toString(){const[u,F,Vt,Wt]=this.rgb;return`rgba(${[u,F,Vt].map((u=>Math.round(255*u))).join(",")},${Wt})`}}Gt.black=new Gt(0,0,0,1),Gt.white=new Gt(1,1,1,1),Gt.transparent=new Gt(0,0,0,0),Gt.red=new Gt(1,0,0,1);class Jt{constructor(u,F,Vt){this.sensitivity=u?F?"variant":"case":F?"accent":"base",this.locale=Vt,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,F){return this.collator.compare(u,F)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xt{constructor(u,F,Vt,Wt,Kt){this.text=u,this.image=F,this.scale=Vt,this.fontStack=Wt,this.textColor=Kt}}class Ht{constructor(u){this.sections=u}static fromString(u){return new Ht([new Xt(u,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((u=>0!==u.text.length||u.image&&0!==u.image.name.length))}static factory(u){return u instanceof Ht?u:Ht.fromString(u)}toString(){return 0===this.sections.length?"":this.sections.map((u=>u.text)).join("")}}class Yt{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Yt)return u;if("number"==typeof u)return new Yt([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const F of u)if("number"!=typeof F)return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new Yt(u)}}toString(){return JSON.stringify(this.values)}}const yl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qt{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Qt)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let F=0;F<u.length;F+=2){const Vt=u[F],Wt=u[F+1];if("string"!=typeof Vt||!yl.has(Vt))return;if(!Array.isArray(Wt)||2!==Wt.length||"number"!=typeof Wt[0]||"number"!=typeof Wt[1])return}return new Qt(u)}}toString(){return JSON.stringify(this.values)}}class te{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new te({name:u,available:!1}):null}}function ee(u,F,Vt,Wt){return"number"==typeof u&&u>=0&&u<=255&&"number"==typeof F&&F>=0&&F<=255&&"number"==typeof Vt&&Vt>=0&&Vt<=255?void 0===Wt||"number"==typeof Wt&&Wt>=0&&Wt<=1?null:`Invalid rgba value [${[u,F,Vt,Wt].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof Wt?[u,F,Vt,Wt]:[u,F,Vt]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function re(u){if(null===u||"string"==typeof u||"boolean"==typeof u||"number"==typeof u||u instanceof Gt||u instanceof Jt||u instanceof Ht||u instanceof Yt||u instanceof Qt||u instanceof te)return!0;if(Array.isArray(u)){for(const F of u)if(!re(F))return!1;return!0}if("object"==typeof u){for(const F in u)if(!re(u[F]))return!1;return!0}return!1}function ne(u){if(null===u)return eo;if("string"==typeof u)return so;if("boolean"==typeof u)return co;if("number"==typeof u)return io;if(u instanceof Gt)return ho;if(u instanceof Jt)return So;if(u instanceof Ht)return Ao;if(u instanceof Yt)return ko;if(u instanceof Qt)return il;if(u instanceof te)return Wo;if(Array.isArray(u)){const F=u.length;let Vt;for(const F of u){const u=ne(F);if(Vt){if(Vt===u)continue;Vt=wo;break}Vt=u}return bt(Vt||wo,F)}return bo}function ie(u){const F=typeof u;return null===u?"":"string"===F||"number"===F||"boolean"===F?String(u):u instanceof Gt||u instanceof Ht||u instanceof Yt||u instanceof Qt||u instanceof te?u.toString():JSON.stringify(u)}class se{constructor(u,F){this.type=u,this.value=F}static parse(u,F){if(2!==u.length)return F.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!re(u[1]))return F.error("invalid value");const Vt=u[1];let Wt=ne(Vt);const Kt=F.expectedType;return"array"!==Wt.kind||0!==Wt.N||!Kt||"array"!==Kt.kind||"number"==typeof Kt.N&&0!==Kt.N||(Wt=Kt),new se(Wt,Vt)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ae{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const vl={string:so,number:io,boolean:co,object:bo};class le{constructor(u,F){this.type=u,this.args=F}static parse(u,F){if(u.length<2)return F.error("Expected at least one argument.");let Vt,Wt=1;const Kt=u[0];if("array"===Kt){let Kt,Qi;if(u.length>2){const Vt=u[1];if("string"!=typeof Vt||!(Vt in vl)||"object"===Vt)return F.error('The item type argument of "array" must be one of string, number, boolean',1);Kt=vl[Vt],Wt++}else Kt=wo;if(u.length>3){if(null!==u[2]&&("number"!=typeof u[2]||u[2]<0||u[2]!==Math.floor(u[2])))return F.error('The length argument to "array" must be a positive integer literal',2);Qi=u[2],Wt++}Vt=bt(Kt,Qi)}else{if(!vl[Kt])throw new Error(`Types doesn't contain name = ${Kt}`);Vt=vl[Kt]}const Qi=[];for(;Wt<u.length;Wt++){const Vt=F.parse(u[Wt],Wt,wo);if(!Vt)return null;Qi.push(Vt)}return new le(Vt,Qi)}evaluate(u){for(let F=0;F<this.args.length;F++){const Vt=this.args[F].evaluate(u);if(!At(this.type,ne(Vt)))return Vt;if(F===this.args.length-1)throw new ae(`Expected value to be of type ${wt(this.type)}, but found ${wt(ne(Vt))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every((u=>u.outputDefined()))}}const wl={"to-boolean":co,"to-color":ho,"to-number":io,"to-string":so};class ce{constructor(u,F){this.type=u,this.args=F}static parse(u,F){if(u.length<2)return F.error("Expected at least one argument.");const Vt=u[0];if(!wl[Vt])throw new Error(`Can't parse ${Vt} as it is not part of the known types`);if(("to-boolean"===Vt||"to-string"===Vt)&&2!==u.length)return F.error("Expected one argument.");const Wt=wl[Vt],Kt=[];for(let Vt=1;Vt<u.length;Vt++){const Wt=F.parse(u[Vt],Vt,wo);if(!Wt)return null;Kt.push(Wt)}return new ce(Wt,Kt)}evaluate(u){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(u));case"color":{let F,Vt;for(const Wt of this.args){if(F=Wt.evaluate(u),Vt=null,F instanceof Gt)return F;if("string"==typeof F){const Vt=u.parseColor(F);if(Vt)return Vt}else if(Array.isArray(F)&&(Vt=F.length<3||F.length>4?`Invalid rbga value ${JSON.stringify(F)}: expected an array containing either three or four numeric values.`:ee(F[0],F[1],F[2],F[3]),!Vt))return new Gt(F[0]/255,F[1]/255,F[2]/255,F[3])}throw new ae(Vt||`Could not parse color from value '${"string"==typeof F?F:JSON.stringify(F)}'`)}case"padding":{let F;for(const Vt of this.args){F=Vt.evaluate(u);const Wt=Yt.parse(F);if(Wt)return Wt}throw new ae(`Could not parse padding from value '${"string"==typeof F?F:JSON.stringify(F)}'`)}case"variableAnchorOffsetCollection":{let F;for(const Vt of this.args){F=Vt.evaluate(u);const Wt=Qt.parse(F);if(Wt)return Wt}throw new ae(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof F?F:JSON.stringify(F)}'`)}case"number":{let F=null;for(const Vt of this.args){if(F=Vt.evaluate(u),null===F)return 0;const Wt=Number(F);if(!isNaN(Wt))return Wt}throw new ae(`Could not convert ${JSON.stringify(F)} to number.`)}case"formatted":return Ht.fromString(ie(this.args[0].evaluate(u)));case"resolvedImage":return te.fromString(ie(this.args[0].evaluate(u)));default:return ie(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every((u=>u.outputDefined()))}}const Tl=["Unknown","Point","LineString","Polygon"];class pe{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Tl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let F=this._parseColorCache[u];return F||(F=this._parseColorCache[u]=Gt.parse(u)),F}}class fe{constructor(u,F,Vt=[],Wt,Kt=new ot,Qi=[]){this.registry=u,this.path=Vt,this.key=Vt.map((u=>`[${u}]`)).join(""),this.scope=Kt,this.errors=Qi,this.expectedType=Wt,this._isConstant=F}parse(u,F,Vt,Wt,Kt={}){return F?this.concat(F,Vt,Wt)._parse(u,Kt):this._parse(u,Kt)}_parse(u,F){function r(u,F,Vt){return"assert"===Vt?new le(F,[u]):"coerce"===Vt?new ce(F,[u]):u}if(null!==u&&"string"!=typeof u&&"boolean"!=typeof u&&"number"!=typeof u||(u=["literal",u]),Array.isArray(u)){if(0===u.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const Vt=u[0];if("string"!=typeof Vt)return this.error(`Expression name must be a string, but found ${typeof Vt} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Wt=this.registry[Vt];if(Wt){let Vt=Wt.parse(u,this);if(!Vt)return null;if(this.expectedType){const u=this.expectedType,Wt=Vt.type;if("string"!==u.kind&&"number"!==u.kind&&"boolean"!==u.kind&&"object"!==u.kind&&"array"!==u.kind||"value"!==Wt.kind)if("color"!==u.kind&&"formatted"!==u.kind&&"resolvedImage"!==u.kind||"value"!==Wt.kind&&"string"!==Wt.kind)if("padding"!==u.kind||"value"!==Wt.kind&&"number"!==Wt.kind&&"array"!==Wt.kind)if("variableAnchorOffsetCollection"!==u.kind||"value"!==Wt.kind&&"array"!==Wt.kind){if(this.checkSubtype(u,Wt))return null}else Vt=r(Vt,u,F.typeAnnotation||"coerce");else Vt=r(Vt,u,F.typeAnnotation||"coerce");else Vt=r(Vt,u,F.typeAnnotation||"coerce");else Vt=r(Vt,u,F.typeAnnotation||"assert")}if(!(Vt instanceof se)&&"resolvedImage"!==Vt.type.kind&&this._isConstant(Vt)){const F=new pe;try{Vt=new se(Vt.type,Vt.evaluate(F))}catch(u){return this.error(u.message),null}}return Vt}return this.error(`Unknown expression "${Vt}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===u?"'undefined' value invalid. Use null instead.":"object"==typeof u?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,F,Vt){const Wt="number"==typeof u?this.path.concat(u):this.path,Kt=Vt?this.scope.concat(Vt):this.scope;return new fe(this.registry,this._isConstant,Wt,F||null,Kt,this.errors)}error(u,...F){const Vt=`${this.key}${F.map((u=>`[${u}]`)).join("")}`;this.errors.push(new at(Vt,u))}checkSubtype(u,F){const Vt=At(u,F);return Vt&&this.error(Vt),Vt}}class de{constructor(u,F){this.type=F.type,this.bindings=[].concat(u),this.result=F}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const F of this.bindings)u(F[1]);u(this.result)}static parse(u,F){if(u.length<4)return F.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const Vt=[];for(let Wt=1;Wt<u.length-1;Wt+=2){const Kt=u[Wt];if("string"!=typeof Kt)return F.error(`Expected string, but found ${typeof Kt} instead.`,Wt);if(/[^a-zA-Z0-9_]/.test(Kt))return F.error("Variable names must contain only alphanumeric characters or '_'.",Wt);const Qi=F.parse(u[Wt+1],Wt+1);if(!Qi)return null;Vt.push([Kt,Qi])}const Wt=F.parse(u[u.length-1],u.length-1,F.expectedType,Vt);return Wt?new de(Vt,Wt):null}outputDefined(){return this.result.outputDefined()}}class ye{constructor(u,F){this.type=F.type,this.name=u,this.boundExpression=F}static parse(u,F){if(2!==u.length||"string"!=typeof u[1])return F.error("'var' expression requires exactly one string literal argument.");const Vt=u[1];return F.scope.has(Vt)?new ye(Vt,F.scope.get(Vt)):F.error(`Unknown variable "${Vt}". Make sure "${Vt}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class me{constructor(u,F,Vt){this.type=u,this.index=F,this.input=Vt}static parse(u,F){if(3!==u.length)return F.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const Vt=F.parse(u[1],1,io),Wt=F.parse(u[2],2,bt(F.expectedType||wo));return Vt&&Wt?new me(Wt.type.itemType,Vt,Wt):null}evaluate(u){const F=this.index.evaluate(u),Vt=this.input.evaluate(u);if(F<0)throw new ae(`Array index out of bounds: ${F} < 0.`);if(F>=Vt.length)throw new ae(`Array index out of bounds: ${F} > ${Vt.length-1}.`);if(F!==Math.floor(F))throw new ae(`Array index must be an integer, but found ${F} instead.`);return Vt[F]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class ge{constructor(u,F){this.type=co,this.needle=u,this.haystack=F}static parse(u,F){if(3!==u.length)return F.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const Vt=F.parse(u[1],1,wo),Wt=F.parse(u[2],2,wo);return Vt&&Wt?St(Vt.type,[co,so,io,eo,wo])?new ge(Vt,Wt):F.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Vt.type)} instead`):null}evaluate(u){const F=this.needle.evaluate(u),Vt=this.haystack.evaluate(u);if(!Vt)return!1;if(!kt(F,["boolean","string","number","null"]))throw new ae(`Expected first argument to be of type boolean, string, number or null, but found ${wt(ne(F))} instead.`);if(!kt(Vt,["string","array"]))throw new ae(`Expected second argument to be of type array or string, but found ${wt(ne(Vt))} instead.`);return Vt.indexOf(F)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class xe{constructor(u,F,Vt){this.type=io,this.needle=u,this.haystack=F,this.fromIndex=Vt}static parse(u,F){if(u.length<=2||u.length>=5)return F.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const Vt=F.parse(u[1],1,wo),Wt=F.parse(u[2],2,wo);if(!Vt||!Wt)return null;if(!St(Vt.type,[co,so,io,eo,wo]))return F.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Vt.type)} instead`);if(4===u.length){const Kt=F.parse(u[3],3,io);return Kt?new xe(Vt,Wt,Kt):null}return new xe(Vt,Wt)}evaluate(u){const F=this.needle.evaluate(u),Vt=this.haystack.evaluate(u);if(!kt(F,["boolean","string","number","null"]))throw new ae(`Expected first argument to be of type boolean, string, number or null, but found ${wt(ne(F))} instead.`);if(!kt(Vt,["string","array"]))throw new ae(`Expected second argument to be of type array or string, but found ${wt(ne(Vt))} instead.`);if(this.fromIndex){const Wt=this.fromIndex.evaluate(u);return Vt.indexOf(F,Wt)}return Vt.indexOf(F)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class ve{constructor(u,F,Vt,Wt,Kt,Qi){this.inputType=u,this.type=F,this.input=Vt,this.cases=Wt,this.outputs=Kt,this.otherwise=Qi}static parse(u,F){if(u.length<5)return F.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return F.error("Expected an even number of arguments.");let Vt,Wt;F.expectedType&&"value"!==F.expectedType.kind&&(Wt=F.expectedType);const Kt={},Qi=[];for(let fr=2;fr<u.length-1;fr+=2){let _r=u[fr];const Sr=u[fr+1];Array.isArray(_r)||(_r=[_r]);const Ar=F.concat(fr);if(0===_r.length)return Ar.error("Expected at least one branch label.");for(const u of _r){if("number"!=typeof u&&"string"!=typeof u)return Ar.error("Branch labels must be numbers or strings.");if("number"==typeof u&&Math.abs(u)>Number.MAX_SAFE_INTEGER)return Ar.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof u&&Math.floor(u)!==u)return Ar.error("Numeric branch labels must be integer values.");if(Vt){if(Ar.checkSubtype(Vt,ne(u)))return null}else Vt=ne(u);if(void 0!==Kt[String(u)])return Ar.error("Branch labels must be unique.");Kt[String(u)]=Qi.length}const Jr=F.parse(Sr,fr,Wt);if(!Jr)return null;Wt=Wt||Jr.type,Qi.push(Jr)}const fr=F.parse(u[1],1,wo);if(!fr)return null;const _r=F.parse(u[u.length-1],u.length-1,Wt);return _r?"value"!==fr.type.kind&&F.concat(1).checkSubtype(Vt,fr.type)?null:new ve(Vt,Wt,fr,Kt,Qi,_r):null}evaluate(u){const F=this.input.evaluate(u);return(ne(F)===this.inputType&&this.outputs[this.cases[F]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every((u=>u.outputDefined()))&&this.otherwise.outputDefined()}}class be{constructor(u,F,Vt){this.type=u,this.branches=F,this.otherwise=Vt}static parse(u,F){if(u.length<4)return F.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return F.error("Expected an odd number of arguments.");let Vt;F.expectedType&&"value"!==F.expectedType.kind&&(Vt=F.expectedType);const Wt=[];for(let Kt=1;Kt<u.length-1;Kt+=2){const Qi=F.parse(u[Kt],Kt,co);if(!Qi)return null;const fr=F.parse(u[Kt+1],Kt+1,Vt);if(!fr)return null;Wt.push([Qi,fr]),Vt=Vt||fr.type}const Kt=F.parse(u[u.length-1],u.length-1,Vt);if(!Kt)return null;if(!Vt)throw new Error("Can't infer output type");return new be(Vt,Wt,Kt)}evaluate(u){for(const[F,Vt]of this.branches)if(F.evaluate(u))return Vt.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[F,Vt]of this.branches)u(F),u(Vt);u(this.otherwise)}outputDefined(){return this.branches.every((([u,F])=>F.outputDefined()))&&this.otherwise.outputDefined()}}class we{constructor(u,F,Vt,Wt){this.type=u,this.input=F,this.beginIndex=Vt,this.endIndex=Wt}static parse(u,F){if(u.length<=2||u.length>=5)return F.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const Vt=F.parse(u[1],1,wo),Wt=F.parse(u[2],2,io);if(!Vt||!Wt)return null;if(!St(Vt.type,[bt(wo),so,wo]))return F.error(`Expected first argument to be of type array or string, but found ${wt(Vt.type)} instead`);if(4===u.length){const Kt=F.parse(u[3],3,io);return Kt?new we(Vt.type,Vt,Wt,Kt):null}return new we(Vt.type,Vt,Wt)}evaluate(u){const F=this.input.evaluate(u),Vt=this.beginIndex.evaluate(u);if(!kt(F,["string","array"]))throw new ae(`Expected first argument to be of type array or string, but found ${wt(ne(F))} instead.`);if(this.endIndex){const Wt=this.endIndex.evaluate(u);return F.slice(Vt,Wt)}return F.slice(Vt)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function _e(u,F){const Vt=u.length-1;let Wt,Kt,Qi=0,fr=Vt,_r=0;for(;Qi<=fr;)if(_r=Math.floor((Qi+fr)/2),Wt=u[_r],Kt=u[_r+1],Wt<=F){if(_r===Vt||F<Kt)return _r;Qi=_r+1}else{if(!(Wt>F))throw new ae("Input is not a number.");fr=_r-1}return 0}class Ae{constructor(u,F,Vt){this.type=u,this.input=F,this.labels=[],this.outputs=[];for(const[u,F]of Vt)this.labels.push(u),this.outputs.push(F)}static parse(u,F){if(u.length-1<4)return F.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return F.error("Expected an even number of arguments.");const Vt=F.parse(u[1],1,io);if(!Vt)return null;const Wt=[];let Kt=null;F.expectedType&&"value"!==F.expectedType.kind&&(Kt=F.expectedType);for(let Vt=1;Vt<u.length;Vt+=2){const Qi=1===Vt?-1/0:u[Vt],fr=u[Vt+1],_r=Vt,Sr=Vt+1;if("number"!=typeof Qi)return F.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_r);if(Wt.length&&Wt[Wt.length-1][0]>=Qi)return F.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',_r);const Ar=F.parse(fr,Sr,Kt);if(!Ar)return null;Kt=Kt||Ar.type,Wt.push([Qi,Ar])}return new Ae(Kt,Vt,Wt)}evaluate(u){const F=this.labels,Vt=this.outputs;if(1===F.length)return Vt[0].evaluate(u);const Wt=this.input.evaluate(u);if(Wt<=F[0])return Vt[0].evaluate(u);const Kt=F.length;return Wt>=F[Kt-1]?Vt[Kt-1].evaluate(u):Vt[_e(F,Wt)].evaluate(u)}eachChild(u){u(this.input);for(const F of this.outputs)u(F)}outputDefined(){return this.outputs.every((u=>u.outputDefined()))}}function Se(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Il=Me;function Me(F,Vt,Wt,Kt){(this||u).cx=3*F,(this||u).bx=3*(Wt-F)-(this||u).cx,(this||u).ax=1-(this||u).cx-(this||u).bx,(this||u).cy=3*Vt,(this||u).by=3*(Kt-Vt)-(this||u).cy,(this||u).ay=1-(this||u).cy-(this||u).by,(this||u).p1x=F,(this||u).p1y=Vt,(this||u).p2x=Wt,(this||u).p2y=Kt}Me.prototype={sampleCurveX:function(F){return(((this||u).ax*F+(this||u).bx)*F+(this||u).cx)*F},sampleCurveY:function(F){return(((this||u).ay*F+(this||u).by)*F+(this||u).cy)*F},sampleCurveDerivativeX:function(F){return(3*(this||u).ax*F+2*(this||u).bx)*F+(this||u).cx},solveCurveX:function(u,F){if(void 0===F&&(F=1e-6),u<0)return 0;if(u>1)return 1;for(var Vt=u,Wt=0;Wt<8;Wt++){var Kt=this.sampleCurveX(Vt)-u;if(Math.abs(Kt)<F)return Vt;var Qi=this.sampleCurveDerivativeX(Vt);if(Math.abs(Qi)<1e-6)break;Vt-=Kt/Qi}var fr=0,_r=1;for(Vt=u,Wt=0;Wt<20&&(Kt=this.sampleCurveX(Vt),!(Math.abs(Kt-u)<F));Wt++)u>Kt?fr=Vt:_r=Vt,Vt=.5*(_r-fr)+fr;return Vt},solve:function(u,F){return this.sampleCurveY(this.solveCurveX(u,F))}};var El=Se(Il);function ze(u,F,Vt){return u+Vt*(F-u)}function Pe(u,F,Vt){return u.map(((u,Wt)=>ze(u,F[Wt],Vt)))}const zl={number:ze,color:function(u,F,Vt,Wt="rgb"){switch(Wt){case"rgb":{const[Wt,Kt,Qi,fr]=Pe(u.rgb,F.rgb,Vt);return new Gt(Wt,Kt,Qi,fr,!1)}case"hcl":{const[Wt,Kt,Qi,fr]=u.hcl,[_r,Sr,Ar,Jr]=F.hcl;let zn,Qs;if(isNaN(Wt)||isNaN(_r))isNaN(Wt)?isNaN(_r)?zn=NaN:(zn=_r,1!==Qi&&0!==Qi||(Qs=Sr)):(zn=Wt,1!==Ar&&0!==Ar||(Qs=Kt));else{let u=_r-Wt;_r>Wt&&u>180?u-=360:_r<Wt&&Wt-_r>180&&(u+=360),zn=Wt+Vt*u}const[ta,ia,aa,va]=function([u,F,Vt,Wt]){return u=isNaN(u)?0:u*ul,Ot([Vt,Math.cos(u)*F,Math.sin(u)*F,Wt])}([zn,null!=Qs?Qs:ze(Kt,Sr,Vt),ze(Qi,Ar,Vt),ze(fr,Jr,Vt)]);return new Gt(ta,ia,aa,va,!1)}case"lab":{const[Wt,Kt,Qi,fr]=Ot(Pe(u.lab,F.lab,Vt));return new Gt(Wt,Kt,Qi,fr,!1)}}},array:Pe,padding:function(u,F,Vt){return new Yt(Pe(u.values,F.values,Vt))},variableAnchorOffsetCollection:function(u,F,Vt){const Wt=u.values,Kt=F.values;if(Wt.length!==Kt.length)throw new ae(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${F.toString()}`);const Qi=[];for(let u=0;u<Wt.length;u+=2){if(Wt[u]!==Kt[u])throw new ae(`Cannot interpolate values containing mismatched anchors. from[${u}]: ${Wt[u]}, to[${u}]: ${Kt[u]}`);Qi.push(Wt[u]);const[F,fr]=Wt[u+1],[_r,Sr]=Kt[u+1];Qi.push([ze(F,_r,Vt),ze(fr,Sr,Vt)])}return new Qt(Qi)}};class Ce{constructor(u,F,Vt,Wt,Kt){this.type=u,this.operator=F,this.interpolation=Vt,this.input=Wt,this.labels=[],this.outputs=[];for(const[u,F]of Kt)this.labels.push(u),this.outputs.push(F)}static interpolationFactor(u,F,Vt,Wt){let Kt=0;if("exponential"===u.name)Kt=Ve(F,u.base,Vt,Wt);else if("linear"===u.name)Kt=Ve(F,1,Vt,Wt);else if("cubic-bezier"===u.name){const Qi=u.controlPoints;Kt=new El(Qi[0],Qi[1],Qi[2],Qi[3]).solve(Ve(F,1,Vt,Wt))}return Kt}static parse(u,F){let[Vt,Wt,Kt,...Qi]=u;if(!Array.isArray(Wt)||0===Wt.length)return F.error("Expected an interpolation type expression.",1);if("linear"===Wt[0])Wt={name:"linear"};else if("exponential"===Wt[0]){const u=Wt[1];if("number"!=typeof u)return F.error("Exponential interpolation requires a numeric base.",1,1);Wt={name:"exponential",base:u}}else{if("cubic-bezier"!==Wt[0])return F.error(`Unknown interpolation type ${String(Wt[0])}`,1,0);{const u=Wt.slice(1);if(4!==u.length||u.some((u=>"number"!=typeof u||u<0||u>1)))return F.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);Wt={name:"cubic-bezier",controlPoints:u}}}if(u.length-1<4)return F.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return F.error("Expected an even number of arguments.");if(Kt=F.parse(Kt,2,io),!Kt)return null;const fr=[];let _r=null;"interpolate-hcl"===Vt||"interpolate-lab"===Vt?_r=ho:F.expectedType&&"value"!==F.expectedType.kind&&(_r=F.expectedType);for(let u=0;u<Qi.length;u+=2){const Vt=Qi[u],Wt=Qi[u+1],Kt=u+3,Sr=u+4;if("number"!=typeof Vt)return F.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Kt);if(fr.length&&fr[fr.length-1][0]>=Vt)return F.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Kt);const Ar=F.parse(Wt,Sr,_r);if(!Ar)return null;_r=_r||Ar.type,fr.push([Vt,Ar])}return Mt(_r,io)||Mt(_r,ho)||Mt(_r,ko)||Mt(_r,il)||Mt(_r,bt(io))?new Ce(_r,Vt,Wt,Kt,fr):F.error(`Type ${wt(_r)} is not interpolatable.`)}evaluate(u){const F=this.labels,Vt=this.outputs;if(1===F.length)return Vt[0].evaluate(u);const Wt=this.input.evaluate(u);if(Wt<=F[0])return Vt[0].evaluate(u);const Kt=F.length;if(Wt>=F[Kt-1])return Vt[Kt-1].evaluate(u);const Qi=_e(F,Wt),fr=Ce.interpolationFactor(this.interpolation,Wt,F[Qi],F[Qi+1]),_r=Vt[Qi].evaluate(u),Sr=Vt[Qi+1].evaluate(u);switch(this.operator){case"interpolate":return zl[this.type.kind](_r,Sr,fr);case"interpolate-hcl":return zl.color(_r,Sr,fr,"hcl");case"interpolate-lab":return zl.color(_r,Sr,fr,"lab")}}eachChild(u){u(this.input);for(const F of this.outputs)u(F)}outputDefined(){return this.outputs.every((u=>u.outputDefined()))}}function Ve(u,F,Vt,Wt){const Kt=Wt-Vt,Qi=u-Vt;return 0===Kt?0:1===F?Qi/Kt:(Math.pow(F,Qi)-1)/(Math.pow(F,Kt)-1)}class Ee{constructor(u,F){this.type=u,this.args=F}static parse(u,F){if(u.length<2)return F.error("Expectected at least one argument.");let Vt=null;const Wt=F.expectedType;Wt&&"value"!==Wt.kind&&(Vt=Wt);const Kt=[];for(const Wt of u.slice(1)){const u=F.parse(Wt,1+Kt.length,Vt,void 0,{typeAnnotation:"omit"});if(!u)return null;Vt=Vt||u.type,Kt.push(u)}if(!Vt)throw new Error("No output type");const Qi=Wt&&Kt.some((u=>At(Wt,u.type)));return new Ee(Qi?wo:Vt,Kt)}evaluate(u){let F,Vt=null,Wt=0;for(const Kt of this.args)if(Wt++,Vt=Kt.evaluate(u),Vt&&Vt instanceof te&&!Vt.available&&(F||(F=Vt.name),Vt=null,Wt===this.args.length&&(Vt=F)),null!==Vt)break;return Vt}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every((u=>u.outputDefined()))}}function Fe(u,F){return"=="===u||"!="===u?"boolean"===F.kind||"string"===F.kind||"number"===F.kind||"null"===F.kind||"value"===F.kind:"string"===F.kind||"number"===F.kind||"value"===F.kind}function Te(u,F,Vt,Wt){return 0===Wt.compare(F,Vt)}function $e(u,F,Vt){const Wt="=="!==u&&"!="!==u;return class i{constructor(u,F,Vt){this.type=co,this.lhs=u,this.rhs=F,this.collator=Vt,this.hasUntypedArgument="value"===u.type.kind||"value"===F.type.kind}static parse(u,F){if(3!==u.length&&4!==u.length)return F.error("Expected two or three arguments.");const Vt=u[0];let Kt=F.parse(u[1],1,wo);if(!Kt)return null;if(!Fe(Vt,Kt.type))return F.concat(1).error(`"${Vt}" comparisons are not supported for type '${wt(Kt.type)}'.`);let Qi=F.parse(u[2],2,wo);if(!Qi)return null;if(!Fe(Vt,Qi.type))return F.concat(2).error(`"${Vt}" comparisons are not supported for type '${wt(Qi.type)}'.`);if(Kt.type.kind!==Qi.type.kind&&"value"!==Kt.type.kind&&"value"!==Qi.type.kind)return F.error(`Cannot compare types '${wt(Kt.type)}' and '${wt(Qi.type)}'.`);Wt&&("value"===Kt.type.kind&&"value"!==Qi.type.kind?Kt=new le(Qi.type,[Kt]):"value"!==Kt.type.kind&&"value"===Qi.type.kind&&(Qi=new le(Kt.type,[Qi])));let fr=null;if(4===u.length){if("string"!==Kt.type.kind&&"string"!==Qi.type.kind&&"value"!==Kt.type.kind&&"value"!==Qi.type.kind)return F.error("Cannot use collator to compare non-string types.");if(fr=F.parse(u[3],3,So),!fr)return null}return new i(Kt,Qi,fr)}evaluate(Kt){const Qi=this.lhs.evaluate(Kt),fr=this.rhs.evaluate(Kt);if(Wt&&this.hasUntypedArgument){const F=ne(Qi),Vt=ne(fr);if(F.kind!==Vt.kind||"string"!==F.kind&&"number"!==F.kind)throw new ae(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${F.kind}, ${Vt.kind}) instead.`)}if(this.collator&&!Wt&&this.hasUntypedArgument){const u=ne(Qi),Vt=ne(fr);if("string"!==u.kind||"string"!==Vt.kind)return F(Kt,Qi,fr)}return this.collator?Vt(Kt,Qi,fr,this.collator.evaluate(Kt)):F(Kt,Qi,fr)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}const Dl=$e("==",(function(u,F,Vt){return F===Vt}),Te),Ll=$e("!=",(function(u,F,Vt){return F!==Vt}),(function(u,F,Vt,Wt){return!Te(0,F,Vt,Wt)})),Rl=$e("<",(function(u,F,Vt){return F<Vt}),(function(u,F,Vt,Wt){return Wt.compare(F,Vt)<0})),Fl=$e(">",(function(u,F,Vt){return F>Vt}),(function(u,F,Vt,Wt){return Wt.compare(F,Vt)>0})),Vl=$e("<=",(function(u,F,Vt){return F<=Vt}),(function(u,F,Vt,Wt){return Wt.compare(F,Vt)<=0})),Ul=$e(">=",(function(u,F,Vt){return F>=Vt}),(function(u,F,Vt,Wt){return Wt.compare(F,Vt)>=0}));class qe{constructor(u,F,Vt){this.type=So,this.locale=Vt,this.caseSensitive=u,this.diacriticSensitive=F}static parse(u,F){if(2!==u.length)return F.error("Expected one argument.");const Vt=u[1];if("object"!=typeof Vt||Array.isArray(Vt))return F.error("Collator options argument must be an object.");const Wt=F.parse(void 0!==Vt["case-sensitive"]&&Vt["case-sensitive"],1,co);if(!Wt)return null;const Kt=F.parse(void 0!==Vt["diacritic-sensitive"]&&Vt["diacritic-sensitive"],1,co);if(!Kt)return null;let Qi=null;return Vt.locale&&(Qi=F.parse(Vt.locale,1,so),!Qi)?null:new qe(Wt,Kt,Qi)}evaluate(u){return new Jt(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}class Ne{constructor(u,F,Vt,Wt,Kt){this.type=so,this.number=u,this.locale=F,this.currency=Vt,this.minFractionDigits=Wt,this.maxFractionDigits=Kt}static parse(u,F){if(3!==u.length)return F.error("Expected two arguments.");const Vt=F.parse(u[1],1,io);if(!Vt)return null;const Wt=u[2];if("object"!=typeof Wt||Array.isArray(Wt))return F.error("NumberFormat options argument must be an object.");let Kt=null;if(Wt.locale&&(Kt=F.parse(Wt.locale,1,so),!Kt))return null;let Qi=null;if(Wt.currency&&(Qi=F.parse(Wt.currency,1,so),!Qi))return null;let fr=null;if(Wt["min-fraction-digits"]&&(fr=F.parse(Wt["min-fraction-digits"],1,io),!fr))return null;let _r=null;return Wt["max-fraction-digits"]&&(_r=F.parse(Wt["max-fraction-digits"],1,io),!_r)?null:new Ne(Vt,Kt,Qi,fr,_r)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class Ze{constructor(u){this.type=Ao,this.sections=u}static parse(u,F){if(u.length<2)return F.error("Expected at least one argument.");const Vt=u[1];if(!Array.isArray(Vt)&&"object"==typeof Vt)return F.error("First argument must be an image or text section.");const Wt=[];let Kt=!1;for(let Vt=1;Vt<=u.length-1;++Vt){const Qi=u[Vt];if(Kt&&"object"==typeof Qi&&!Array.isArray(Qi)){Kt=!1;let u=null;if(Qi["font-scale"]&&(u=F.parse(Qi["font-scale"],1,io),!u))return null;let Vt=null;if(Qi["text-font"]&&(Vt=F.parse(Qi["text-font"],1,bt(so)),!Vt))return null;let fr=null;if(Qi["text-color"]&&(fr=F.parse(Qi["text-color"],1,ho),!fr))return null;const _r=Wt[Wt.length-1];_r.scale=u,_r.font=Vt,_r.textColor=fr}else{const Qi=F.parse(u[Vt],1,wo);if(!Qi)return null;const fr=Qi.type.kind;if("string"!==fr&&"value"!==fr&&"null"!==fr&&"resolvedImage"!==fr)return F.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Kt=!0,Wt.push({content:Qi,scale:null,font:null,textColor:null})}}return new Ze(Wt)}evaluate(u){return new Ht(this.sections.map((F=>{const Vt=F.content.evaluate(u);return ne(Vt)===Wo?new Xt("",Vt,null,null,null):new Xt(ie(Vt),null,F.scale?F.scale.evaluate(u):null,F.font?F.font.evaluate(u).join(","):null,F.textColor?F.textColor.evaluate(u):null)})))}eachChild(u){for(const F of this.sections)u(F.content),F.scale&&u(F.scale),F.font&&u(F.font),F.textColor&&u(F.textColor)}outputDefined(){return!1}}class Ke{constructor(u){this.type=Wo,this.input=u}static parse(u,F){if(2!==u.length)return F.error("Expected two arguments.");const Vt=F.parse(u[1],1,so);return Vt?new Ke(Vt):F.error("No image name provided.")}evaluate(u){const F=this.input.evaluate(u),Vt=te.fromString(F);return Vt&&u.availableImages&&(Vt.available=u.availableImages.indexOf(F)>-1),Vt}eachChild(u){u(this.input)}outputDefined(){return!1}}class Ge{constructor(u){this.type=io,this.input=u}static parse(u,F){if(2!==u.length)return F.error(`Expected 1 argument, but found ${u.length-1} instead.`);const Vt=F.parse(u[1],1);return Vt?"array"!==Vt.type.kind&&"string"!==Vt.type.kind&&"value"!==Vt.type.kind?F.error(`Expected argument of type string or array, but found ${wt(Vt.type)} instead.`):new Ge(Vt):null}evaluate(u){const F=this.input.evaluate(u);if("string"==typeof F)return F.length;if(Array.isArray(F))return F.length;throw new ae(`Expected value to be of type string or array, but found ${wt(ne(F))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const Nl=8192;function Xe(u,F){const Vt=(180+u[0])/360,Wt=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,Kt=Math.pow(2,F.z);return[Math.round(Vt*Kt*Nl),Math.round(Wt*Kt*Nl)]}function He(u,F){const Vt=Math.pow(2,F.z);return[(Kt=(u[0]/Nl+F.x)/Vt,360*Kt-180),(Wt=(u[1]/Nl+F.y)/Vt,360/Math.PI*Math.atan(Math.exp((180-360*Wt)*Math.PI/180))-90)];var Wt,Kt}function Ye(u,F){u[0]=Math.min(u[0],F[0]),u[1]=Math.min(u[1],F[1]),u[2]=Math.max(u[2],F[0]),u[3]=Math.max(u[3],F[1])}function We(u,F){return!(u[0]<=F[0]||u[2]>=F[2]||u[1]<=F[1]||u[3]>=F[3])}function Qe(u,F,Vt){const Wt=u[0]-F[0],Kt=u[1]-F[1],Qi=u[0]-Vt[0],fr=u[1]-Vt[1];return Wt*fr-Qi*Kt==0&&Wt*Qi<=0&&Kt*fr<=0}function tr(u,F,Vt,Wt){return 0!=(Kt=[Wt[0]-Vt[0],Wt[1]-Vt[1]])[0]*(Qi=[F[0]-u[0],F[1]-u[1]])[1]-Kt[1]*Qi[0]&&!(!ar(u,F,Vt,Wt)||!ar(Vt,Wt,u,F));var Kt,Qi}function er(u,F,Vt){for(const Wt of Vt)for(let Vt=0;Vt<Wt.length-1;++Vt)if(tr(u,F,Wt[Vt],Wt[Vt+1]))return!0;return!1}function rr(u,F,Vt=!1){let Wt=!1;for(const _r of F)for(let F=0;F<_r.length-1;F++){if(Qe(u,_r[F],_r[F+1]))return Vt;(Qi=_r[F])[1]>(Kt=u)[1]!=(fr=_r[F+1])[1]>Kt[1]&&Kt[0]<(fr[0]-Qi[0])*(Kt[1]-Qi[1])/(fr[1]-Qi[1])+Qi[0]&&(Wt=!Wt)}var Kt,Qi,fr;return Wt}function nr(u,F){for(const Vt of F)if(rr(u,Vt))return!0;return!1}function ir(u,F){for(const Vt of u)if(!rr(Vt,F))return!1;for(let Vt=0;Vt<u.length-1;++Vt)if(er(u[Vt],u[Vt+1],F))return!1;return!0}function sr(u,F){for(const Vt of F)if(ir(u,Vt))return!0;return!1}function ar(u,F,Vt,Wt){const Kt=Wt[0]-Vt[0],Qi=Wt[1]-Vt[1],fr=(u[0]-Vt[0])*Qi-Kt*(u[1]-Vt[1]),_r=(F[0]-Vt[0])*Qi-Kt*(F[1]-Vt[1]);return fr>0&&_r<0||fr<0&&_r>0}function or(u,F,Vt){const Wt=[];for(let Kt=0;Kt<u.length;Kt++){const Qi=[];for(let Wt=0;Wt<u[Kt].length;Wt++){const fr=Xe(u[Kt][Wt],Vt);Ye(F,fr),Qi.push(fr)}Wt.push(Qi)}return Wt}function lr(u,F,Vt){const Wt=[];for(let Kt=0;Kt<u.length;Kt++){const Qi=or(u[Kt],F,Vt);Wt.push(Qi)}return Wt}function ur(u,F,Vt,Wt){if(u[0]<Vt[0]||u[0]>Vt[2]){const F=.5*Wt;let Kt=u[0]-Vt[0]>F?-Wt:Vt[0]-u[0]>F?Wt:0;0===Kt&&(Kt=u[0]-Vt[2]>F?-Wt:Vt[2]-u[0]>F?Wt:0),u[0]+=Kt}Ye(F,u)}function cr(u,F,Vt,Wt){const Kt=Math.pow(2,Wt.z)*Nl,Qi=[Wt.x*Nl,Wt.y*Nl],fr=[];for(const Wt of u)for(const u of Wt){const Wt=[u.x+Qi[0],u.y+Qi[1]];ur(Wt,F,Vt,Kt),fr.push(Wt)}return fr}function hr(u,F,Vt,Wt){const Kt=Math.pow(2,Wt.z)*Nl,Qi=[Wt.x*Nl,Wt.y*Nl],fr=[];for(const Vt of u){const u=[];for(const Wt of Vt){const Vt=[Wt.x+Qi[0],Wt.y+Qi[1]];Ye(F,Vt),u.push(Vt)}fr.push(u)}if(F[2]-F[0]<=Kt/2){(_r=F)[0]=_r[1]=1/0,_r[2]=_r[3]=-1/0;for(const u of fr)for(const Wt of u)ur(Wt,F,Vt,Kt)}var _r;return fr}class pr{constructor(u,F){this.type=co,this.geojson=u,this.geometries=F}static parse(u,F){if(2!==u.length)return F.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(re(u[1])){const F=u[1];if("FeatureCollection"===F.type){const u=[];for(const Vt of F.features){const{type:F,coordinates:Wt}=Vt.geometry;"Polygon"===F&&u.push(Wt),"MultiPolygon"===F&&u.push(...Wt)}if(u.length)return new pr(F,{type:"MultiPolygon",coordinates:u})}else if("Feature"===F.type){const u=F.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new pr(F,F.geometry)}else if("Polygon"===F.type||"MultiPolygon"===F.type)return new pr(F,F)}return F.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(null!=u.geometry()&&null!=u.canonicalID()){if("Point"===u.geometryType())return function(u,F){const Vt=[1/0,1/0,-1/0,-1/0],Wt=[1/0,1/0,-1/0,-1/0],Kt=u.canonicalID();if("Polygon"===F.type){const Qi=or(F.coordinates,Wt,Kt),fr=cr(u.geometry(),Vt,Wt,Kt);if(!We(Vt,Wt))return!1;for(const u of fr)if(!rr(u,Qi))return!1}if("MultiPolygon"===F.type){const Qi=lr(F.coordinates,Wt,Kt),fr=cr(u.geometry(),Vt,Wt,Kt);if(!We(Vt,Wt))return!1;for(const u of fr)if(!nr(u,Qi))return!1}return!0}(u,this.geometries);if("LineString"===u.geometryType())return function(u,F){const Vt=[1/0,1/0,-1/0,-1/0],Wt=[1/0,1/0,-1/0,-1/0],Kt=u.canonicalID();if("Polygon"===F.type){const Qi=or(F.coordinates,Wt,Kt),fr=hr(u.geometry(),Vt,Wt,Kt);if(!We(Vt,Wt))return!1;for(const u of fr)if(!ir(u,Qi))return!1}if("MultiPolygon"===F.type){const Qi=lr(F.coordinates,Wt,Kt),fr=hr(u.geometry(),Vt,Wt,Kt);if(!We(Vt,Wt))return!1;for(const u of fr)if(!sr(u,Qi))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let jl=class{constructor(u=[],F=dr){if(this.data=u,this.length=this.data.length,this.compare=F,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const u=this.data[0],F=this.data.pop();return this.length--,this.length>0&&(this.data[0]=F,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:F,compare:Vt}=this,Wt=F[u];for(;u>0;){const Kt=u-1>>1,Qi=F[Kt];if(Vt(Wt,Qi)>=0)break;F[u]=Qi,u=Kt}F[u]=Wt}_down(u){const{data:F,compare:Vt}=this,Wt=this.length>>1,Kt=F[u];for(;u<Wt;){let Wt=1+(u<<1),Qi=F[Wt];const fr=Wt+1;if(fr<this.length&&Vt(F[fr],Qi)<0&&(Wt=fr,Qi=F[fr]),Vt(Qi,Kt)>=0)break;F[u]=Qi,u=Wt}F[u]=Kt}};function dr(u,F){return u<F?-1:u>F?1:0}function yr(u,F,Vt,Wt,Kt){mr(u,F,Vt,Wt||u.length-1,Kt||xr)}function mr(u,F,Vt,Wt,Kt){for(;Wt>Vt;){if(Wt-Vt>600){var Qi=Wt-Vt+1,fr=F-Vt+1,_r=Math.log(Qi),Sr=.5*Math.exp(2*_r/3),Ar=.5*Math.sqrt(_r*Sr*(Qi-Sr)/Qi)*(fr-Qi/2<0?-1:1);mr(u,F,Math.max(Vt,Math.floor(F-fr*Sr/Qi+Ar)),Math.min(Wt,Math.floor(F+(Qi-fr)*Sr/Qi+Ar)),Kt)}var Jr=u[F],zn=Vt,Qs=Wt;for(gr(u,Vt,F),Kt(u[Wt],Jr)>0&&gr(u,Vt,Wt);zn<Qs;){for(gr(u,zn,Qs),zn++,Qs--;Kt(u[zn],Jr)<0;)zn++;for(;Kt(u[Qs],Jr)>0;)Qs--}0===Kt(u[Vt],Jr)?gr(u,Vt,Qs):gr(u,++Qs,Wt),Qs<=F&&(Vt=Qs+1),F<=Qs&&(Wt=Qs-1)}}function gr(u,F,Vt){var Wt=u[F];u[F]=u[Vt],u[Vt]=Wt}function xr(u,F){return u<F?-1:u>F?1:0}function vr(u,F){if(u.length<=1)return[u];const Vt=[];let Wt,Kt;for(const F of u){const u=wr(F);0!==u&&(F.area=Math.abs(u),void 0===Kt&&(Kt=u<0),Kt===u<0?(Wt&&Vt.push(Wt),Wt=[F]):Wt.push(F))}if(Wt&&Vt.push(Wt),F>1)for(let u=0;u<Vt.length;u++)Vt[u].length<=F||(yr(Vt[u],F,1,Vt[u].length-1,br),Vt[u]=Vt[u].slice(0,F));return Vt}function br(u,F){return F.area-u.area}function wr(u){let F=0;for(let Vt,Wt,Kt=0,Qi=u.length,fr=Qi-1;Kt<Qi;fr=Kt++)Vt=u[Kt],Wt=u[fr],F+=(Wt.x-Vt.x)*(Vt.y+Wt.y);return F}const $l=1/298.257223563,Gl=$l*(2-$l),Hl=Math.PI/180;class kr{constructor(u){const F=6378.137*Hl*1e3,Vt=Math.cos(u*Hl),Wt=1/(1-Gl*(1-Vt*Vt)),Kt=Math.sqrt(Wt);this.kx=F*Kt*Vt,this.ky=F*Kt*Wt*(1-Gl)}distance(u,F){const Vt=this.wrap(u[0]-F[0])*this.kx,Wt=(u[1]-F[1])*this.ky;return Math.sqrt(Vt*Vt+Wt*Wt)}pointOnLine(u,F){let Vt,Wt,Kt,Qi,fr=1/0;for(let _r=0;_r<u.length-1;_r++){let Sr=u[_r][0],Ar=u[_r][1],Jr=this.wrap(u[_r+1][0]-Sr)*this.kx,zn=(u[_r+1][1]-Ar)*this.ky,Qs=0;0===Jr&&0===zn||(Qs=(this.wrap(F[0]-Sr)*this.kx*Jr+(F[1]-Ar)*this.ky*zn)/(Jr*Jr+zn*zn),Qs>1?(Sr=u[_r+1][0],Ar=u[_r+1][1]):Qs>0&&(Sr+=Jr/this.kx*Qs,Ar+=zn/this.ky*Qs)),Jr=this.wrap(F[0]-Sr)*this.kx,zn=(F[1]-Ar)*this.ky;const ta=Jr*Jr+zn*zn;ta<fr&&(fr=ta,Vt=Sr,Wt=Ar,Kt=_r,Qi=Qs)}return{point:[Vt,Wt],index:Kt,t:Math.max(0,Math.min(1,Qi))}}wrap(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}}function Mr(u,F){return F[0]-u[0]}function Ir(u){return u[1]-u[0]+1}function zr(u,F){return u[1]>=u[0]&&u[1]<F}function Pr(u,F){if(u[0]>u[1])return[null,null];const Vt=Ir(u);if(F){if(2===Vt)return[u,null];const F=Math.floor(Vt/2);return[[u[0],u[0]+F],[u[0]+F,u[1]]]}if(1===Vt)return[u,null];const Wt=Math.floor(Vt/2)-1;return[[u[0],u[0]+Wt],[u[0]+Wt+1,u[1]]]}function Br(u,F){if(!zr(F,u.length))return[1/0,1/0,-1/0,-1/0];const Vt=[1/0,1/0,-1/0,-1/0];for(let Wt=F[0];Wt<=F[1];++Wt)Ye(Vt,u[Wt]);return Vt}function Cr(u){const F=[1/0,1/0,-1/0,-1/0];for(const Vt of u)for(const u of Vt)Ye(F,u);return F}function Vr(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Er(u,F,Vt){if(!Vr(u)||!Vr(F))return NaN;let Wt=0,Kt=0;return u[2]<F[0]&&(Wt=F[0]-u[2]),u[0]>F[2]&&(Wt=u[0]-F[2]),u[1]>F[3]&&(Kt=u[1]-F[3]),u[3]<F[1]&&(Kt=F[1]-u[3]),Vt.distance([0,0],[Wt,Kt])}function Fr(u,F,Vt){const Wt=Vt.pointOnLine(F,u);return Vt.distance(u,Wt.point)}function Tr(u,F,Vt,Wt,Kt){const Qi=Math.min(Fr(u,[Vt,Wt],Kt),Fr(F,[Vt,Wt],Kt)),fr=Math.min(Fr(Vt,[u,F],Kt),Fr(Wt,[u,F],Kt));return Math.min(Qi,fr)}function $r(u,F,Vt,Wt,Kt){if(!zr(F,u.length)||!zr(Wt,Vt.length))return 1/0;let Qi=1/0;for(let fr=F[0];fr<F[1];++fr){const F=u[fr],_r=u[fr+1];for(let u=Wt[0];u<Wt[1];++u){const Wt=Vt[u],fr=Vt[u+1];if(tr(F,_r,Wt,fr))return 0;Qi=Math.min(Qi,Tr(F,_r,Wt,fr,Kt))}}return Qi}function Lr(u,F,Vt,Wt,Kt){if(!zr(F,u.length)||!zr(Wt,Vt.length))return NaN;let Qi=1/0;for(let fr=F[0];fr<=F[1];++fr)for(let F=Wt[0];F<=Wt[1];++F)if(Qi=Math.min(Qi,Kt.distance(u[fr],Vt[F])),0===Qi)return Qi;return Qi}function Dr(u,F,Vt){if(rr(u,F,!0))return 0;let Wt=1/0;for(const Kt of F){const F=Kt[0],Qi=Kt[Kt.length-1];if(F!==Qi&&(Wt=Math.min(Wt,Fr(u,[Qi,F],Vt)),0===Wt))return Wt;const fr=Vt.pointOnLine(Kt,u);if(Wt=Math.min(Wt,Vt.distance(u,fr.point)),0===Wt)return Wt}return Wt}function Or(u,F,Vt,Wt){if(!zr(F,u.length))return NaN;for(let Wt=F[0];Wt<=F[1];++Wt)if(rr(u[Wt],Vt,!0))return 0;let Kt=1/0;for(let Qi=F[0];Qi<F[1];++Qi){const F=u[Qi],fr=u[Qi+1];for(const u of Vt)for(let Vt=0,Qi=u.length,_r=Qi-1;Vt<Qi;_r=Vt++){const Qi=u[_r],Sr=u[Vt];if(tr(F,fr,Qi,Sr))return 0;Kt=Math.min(Kt,Tr(F,fr,Qi,Sr,Wt))}}return Kt}function Rr(u,F){for(const Vt of u)for(const u of Vt)if(rr(u,F,!0))return!0;return!1}function Ur(u,F,Vt,Wt=1/0){const Kt=Cr(u),Qi=Cr(F);if(Wt!==1/0&&Er(Kt,Qi,Vt)>=Wt)return Wt;if(We(Kt,Qi)){if(Rr(u,F))return 0}else if(Rr(F,u))return 0;let fr=1/0;for(const Wt of u)for(let u=0,Kt=Wt.length,Qi=Kt-1;u<Kt;Qi=u++){const Kt=Wt[Qi],_r=Wt[u];for(const u of F)for(let F=0,Wt=u.length,Qi=Wt-1;F<Wt;Qi=F++){const Wt=u[Qi],Sr=u[F];if(tr(Kt,_r,Wt,Sr))return 0;fr=Math.min(fr,Tr(Kt,_r,Wt,Sr,Vt))}}return fr}function jr(u,F,Vt,Wt,Kt,Qi){if(!Qi)return;const fr=Er(Br(Wt,Qi),Kt,Vt);fr<F&&u.push([fr,Qi,[0,0]])}function qr(u,F,Vt,Wt,Kt,Qi,fr){if(!Qi||!fr)return;const _r=Er(Br(Wt,Qi),Br(Kt,fr),Vt);_r<F&&u.push([_r,Qi,fr])}function Nr(u,F,Vt,Wt,Kt=1/0){let Qi=Math.min(Wt.distance(u[0],Vt[0][0]),Kt);if(0===Qi)return Qi;const fr=new jl([[0,[0,u.length-1],[0,0]]],Mr),_r=Cr(Vt);for(;fr.length>0;){const Kt=fr.pop();if(Kt[0]>=Qi)continue;const Sr=Kt[1],Ar=F?50:100;if(Ir(Sr)<=Ar){if(!zr(Sr,u.length))return NaN;if(F){const F=Or(u,Sr,Vt,Wt);if(isNaN(F)||0===F)return F;Qi=Math.min(Qi,F)}else for(let F=Sr[0];F<=Sr[1];++F){const Kt=Dr(u[F],Vt,Wt);if(Qi=Math.min(Qi,Kt),0===Qi)return 0}}else{const Vt=Pr(Sr,F);jr(fr,Qi,Wt,u,_r,Vt[0]),jr(fr,Qi,Wt,u,_r,Vt[1])}}return Qi}function Zr(u,F,Vt,Wt,Kt,Qi=1/0){let fr=Math.min(Qi,Kt.distance(u[0],Vt[0]));if(0===fr)return fr;const _r=new jl([[0,[0,u.length-1],[0,Vt.length-1]]],Mr);for(;_r.length>0;){const Qi=_r.pop();if(Qi[0]>=fr)continue;const Sr=Qi[1],Ar=Qi[2],Jr=F?50:100,zn=Wt?50:100;if(Ir(Sr)<=Jr&&Ir(Ar)<=zn){if(!zr(Sr,u.length)&&zr(Ar,Vt.length))return NaN;let Qi;if(F&&Wt)Qi=$r(u,Sr,Vt,Ar,Kt),fr=Math.min(fr,Qi);else if(F&&!Wt){const F=u.slice(Sr[0],Sr[1]+1);for(let u=Ar[0];u<=Ar[1];++u)if(Qi=Fr(Vt[u],F,Kt),fr=Math.min(fr,Qi),0===fr)return fr}else if(!F&&Wt){const F=Vt.slice(Ar[0],Ar[1]+1);for(let Vt=Sr[0];Vt<=Sr[1];++Vt)if(Qi=Fr(u[Vt],F,Kt),fr=Math.min(fr,Qi),0===fr)return fr}else Qi=Lr(u,Sr,Vt,Ar,Kt),fr=Math.min(fr,Qi)}else{const Qi=Pr(Sr,F),Jr=Pr(Ar,Wt);qr(_r,fr,Kt,u,Vt,Qi[0],Jr[0]),qr(_r,fr,Kt,u,Vt,Qi[0],Jr[1]),qr(_r,fr,Kt,u,Vt,Qi[1],Jr[0]),qr(_r,fr,Kt,u,Vt,Qi[1],Jr[1])}}return fr}function Kr(u){return"MultiPolygon"===u.type?u.coordinates.map((u=>({type:"Polygon",coordinates:u}))):"MultiLineString"===u.type?u.coordinates.map((u=>({type:"LineString",coordinates:u}))):"MultiPoint"===u.type?u.coordinates.map((u=>({type:"Point",coordinates:u}))):[u]}class Gr{constructor(u,F){this.type=io,this.geojson=u,this.geometries=F}static parse(u,F){if(2!==u.length)return F.error(`'distance' expression requires exactly one argument, but found ${u.length-1} instead.`);if(re(u[1])){const F=u[1];if("FeatureCollection"===F.type)return new Gr(F,F.features.map((u=>Kr(u.geometry))).flat());if("Feature"===F.type)return new Gr(F,Kr(F.geometry));if("type"in F&&"coordinates"in F)return new Gr(F,Kr(F))}return F.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(null!=u.geometry()&&null!=u.canonicalID()){if("Point"===u.geometryType())return function(u,F){const Vt=u.geometry(),Wt=Vt.flat().map((F=>He([F.x,F.y],u.canonical)));if(0===Vt.length)return NaN;const Kt=new kr(Wt[0][1]);let Qi=1/0;for(const u of F){switch(u.type){case"Point":Qi=Math.min(Qi,Zr(Wt,!1,[u.coordinates],!1,Kt,Qi));break;case"LineString":Qi=Math.min(Qi,Zr(Wt,!1,u.coordinates,!0,Kt,Qi));break;case"Polygon":Qi=Math.min(Qi,Nr(Wt,!1,u.coordinates,Kt,Qi))}if(0===Qi)return Qi}return Qi}(u,this.geometries);if("LineString"===u.geometryType())return function(u,F){const Vt=u.geometry(),Wt=Vt.flat().map((F=>He([F.x,F.y],u.canonical)));if(0===Vt.length)return NaN;const Kt=new kr(Wt[0][1]);let Qi=1/0;for(const u of F){switch(u.type){case"Point":Qi=Math.min(Qi,Zr(Wt,!0,[u.coordinates],!1,Kt,Qi));break;case"LineString":Qi=Math.min(Qi,Zr(Wt,!0,u.coordinates,!0,Kt,Qi));break;case"Polygon":Qi=Math.min(Qi,Nr(Wt,!0,u.coordinates,Kt,Qi))}if(0===Qi)return Qi}return Qi}(u,this.geometries);if("Polygon"===u.geometryType())return function(u,F){const Vt=u.geometry();if(0===Vt.length||0===Vt[0].length)return NaN;const Wt=vr(Vt,0).map((F=>F.map((F=>F.map((F=>He([F.x,F.y],u.canonical))))))),Kt=new kr(Wt[0][0][0][1]);let Qi=1/0;for(const u of F)for(const F of Wt){switch(u.type){case"Point":Qi=Math.min(Qi,Nr([u.coordinates],!1,F,Kt,Qi));break;case"LineString":Qi=Math.min(Qi,Nr(u.coordinates,!0,F,Kt,Qi));break;case"Polygon":Qi=Math.min(Qi,Ur(F,u.coordinates,Kt,Qi))}if(0===Qi)return Qi}return Qi}(u,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Xl={"==":Dl,"!=":Ll,">":Fl,"<":Rl,">=":Ul,"<=":Vl,array:le,at:me,boolean:le,case:be,coalesce:Ee,collator:qe,format:Ze,image:Ke,in:ge,"index-of":xe,interpolate:Ce,"interpolate-hcl":Ce,"interpolate-lab":Ce,length:Ge,let:de,literal:se,match:ve,number:le,"number-format":Ne,object:le,slice:we,step:Ae,string:le,"to-boolean":ce,"to-color":ce,"to-number":ce,"to-string":ce,var:ye,within:pr,distance:Gr};class Xr{constructor(u,F,Vt,Wt){this.name=u,this.type=F,this._evaluate=Vt,this.args=Wt}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,F){const Vt=u[0],Wt=Xr.definitions[Vt];if(!Wt)return F.error(`Unknown expression "${Vt}". If you wanted a literal array, use ["literal", [...]].`,0);const Kt=Array.isArray(Wt)?Wt[0]:Wt.type,Qi=Array.isArray(Wt)?[[Wt[1],Wt[2]]]:Wt.overloads,fr=Qi.filter((([F])=>!Array.isArray(F)||F.length===u.length-1));let _r=null;for(const[Wt,Qi]of fr){_r=new fe(F.registry,tn,F.path,null,F.scope);const fr=[];let Sr=!1;for(let F=1;F<u.length;F++){const Vt=u[F],Kt=Array.isArray(Wt)?Wt[F-1]:Wt.type,Qi=_r.parse(Vt,1+fr.length,Kt);if(!Qi){Sr=!0;break}fr.push(Qi)}if(!Sr)if(Array.isArray(Wt)&&Wt.length!==fr.length)_r.error(`Expected ${Wt.length} arguments, but found ${fr.length} instead.`);else{for(let u=0;u<fr.length;u++){const F=Array.isArray(Wt)?Wt[u]:Wt.type,Vt=fr[u];_r.concat(u+1).checkSubtype(F,Vt.type)}if(0===_r.errors.length)return new Xr(Vt,Kt,Qi,fr)}}if(1===fr.length)F.errors.push(..._r.errors);else{const Vt=(fr.length?fr:Qi).map((([u])=>{return F=u,Array.isArray(F)?`(${F.map(wt).join(", ")})`:`(${wt(F.type)}...)`;var F})).join(" | "),Wt=[];for(let Vt=1;Vt<u.length;Vt++){const Kt=F.parse(u[Vt],1+Wt.length);if(!Kt)return null;Wt.push(wt(Kt.type))}F.error(`Expected arguments of type ${Vt}, but found (${Wt.join(", ")}) instead.`)}return null}static register(u,F){Xr.definitions=F;for(const Vt in F)u[Vt]=Xr}}function Hr(u,[F,Vt,Wt,Kt]){F=F.evaluate(u),Vt=Vt.evaluate(u),Wt=Wt.evaluate(u);const Qi=Kt?Kt.evaluate(u):1,fr=ee(F,Vt,Wt,Qi);if(fr)throw new ae(fr);return new Gt(F/255,Vt/255,Wt/255,Qi,!1)}function Yr(u,F){return u in F}function Wr(u,F){const Vt=F[u];return void 0===Vt?null:Vt}function Qr(u){return{type:u}}function tn(u){if(u instanceof ye)return tn(u.boundExpression);if(u instanceof Xr&&"error"===u.name)return!1;if(u instanceof qe)return!1;if(u instanceof pr)return!1;if(u instanceof Gr)return!1;const F=u instanceof ce||u instanceof le;let Vt=!0;return u.eachChild((u=>{Vt=F?Vt&&tn(u):Vt&&u instanceof se})),!!Vt&&en(u)&&nn(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function en(u){if(u instanceof Xr){if("get"===u.name&&1===u.args.length)return!1;if("feature-state"===u.name)return!1;if("has"===u.name&&1===u.args.length)return!1;if("properties"===u.name||"geometry-type"===u.name||"id"===u.name)return!1;if(/^filter-/.test(u.name))return!1}if(u instanceof pr)return!1;if(u instanceof Gr)return!1;let F=!0;return u.eachChild((u=>{F&&!en(u)&&(F=!1)})),F}function rn(u){if(u instanceof Xr&&"feature-state"===u.name)return!1;let F=!0;return u.eachChild((u=>{F&&!rn(u)&&(F=!1)})),F}function nn(u,F){if(u instanceof Xr&&F.indexOf(u.name)>=0)return!1;let Vt=!0;return u.eachChild((u=>{Vt&&!nn(u,F)&&(Vt=!1)})),Vt}function sn(u){return{result:"success",value:u}}function an(u){return{result:"error",value:u}}function on(u){return"data-driven"===u["property-type"]||"cross-faded-data-driven"===u["property-type"]}function ln(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function un(u){return!!u.expression&&u.expression.interpolated}function cn(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":null===u?"null":typeof u}function hn(u){return"object"==typeof u&&null!==u&&!Array.isArray(u)}function pn(u){return u}function fn(u,F){const Vt="color"===F.type,Wt=u.stops&&"object"==typeof u.stops[0][0],Kt=Wt||!(Wt||void 0!==u.property),Qi=u.type||(un(F)?"exponential":"interval");if(Vt||"padding"===F.type){const Wt=Vt?Gt.parse:Yt.parse;(u=st({},u)).stops&&(u.stops=u.stops.map((u=>[u[0],Wt(u[1])]))),u.default=Wt(u.default?u.default:F.default)}if(u.colorSpace&&"rgb"!==(fr=u.colorSpace)&&"hcl"!==fr&&"lab"!==fr)throw new Error(`Unknown color space: "${u.colorSpace}"`);var fr;let _r,Sr,Ar;if("exponential"===Qi)_r=gn;else if("interval"===Qi)_r=mn;else if("categorical"===Qi){_r=yn,Sr=Object.create(null);for(const F of u.stops)Sr[F[0]]=F[1];Ar=typeof u.stops[0][0]}else{if("identity"!==Qi)throw new Error(`Unknown function type "${Qi}"`);_r=xn}if(Wt){const Vt={},Wt=[];for(let F=0;F<u.stops.length;F++){const Kt=u.stops[F],Qi=Kt[0].zoom;void 0===Vt[Qi]&&(Vt[Qi]={zoom:Qi,type:u.type,property:u.property,default:u.default,stops:[]},Wt.push(Qi)),Vt[Qi].stops.push([Kt[0].value,Kt[1]])}const Kt=[];for(const u of Wt)Kt.push([Vt[u].zoom,fn(Vt[u],F)]);const Qi={name:"linear"};return{kind:"composite",interpolationType:Qi,interpolationFactor:Ce.interpolationFactor.bind(void 0,Qi),zoomStops:Kt.map((u=>u[0])),evaluate:({zoom:Vt},Wt)=>gn({stops:Kt,base:u.base},F,Vt).evaluate(Vt,Wt)}}if(Kt){const Vt="exponential"===Qi?{name:"exponential",base:void 0!==u.base?u.base:1}:null;return{kind:"camera",interpolationType:Vt,interpolationFactor:Ce.interpolationFactor.bind(void 0,Vt),zoomStops:u.stops.map((u=>u[0])),evaluate:({zoom:Vt})=>_r(u,F,Vt,Sr,Ar)}}return{kind:"source",evaluate(Vt,Wt){const Kt=Wt&&Wt.properties?Wt.properties[u.property]:void 0;return void 0===Kt?dn(u.default,F.default):_r(u,F,Kt,Sr,Ar)}}}function dn(u,F,Vt){return void 0!==u?u:void 0!==F?F:void 0!==Vt?Vt:void 0}function yn(u,F,Vt,Wt,Kt){return dn(typeof Vt===Kt?Wt[Vt]:void 0,u.default,F.default)}function mn(u,F,Vt){if("number"!==cn(Vt))return dn(u.default,F.default);const Wt=u.stops.length;if(1===Wt)return u.stops[0][1];if(Vt<=u.stops[0][0])return u.stops[0][1];if(Vt>=u.stops[Wt-1][0])return u.stops[Wt-1][1];const Kt=_e(u.stops.map((u=>u[0])),Vt);return u.stops[Kt][1]}function gn(u,F,Vt){const Wt=void 0!==u.base?u.base:1;if("number"!==cn(Vt))return dn(u.default,F.default);const Kt=u.stops.length;if(1===Kt)return u.stops[0][1];if(Vt<=u.stops[0][0])return u.stops[0][1];if(Vt>=u.stops[Kt-1][0])return u.stops[Kt-1][1];const Qi=_e(u.stops.map((u=>u[0])),Vt),fr=function(u,F,Vt,Wt){const Kt=Wt-Vt,Qi=u-Vt;return 0===Kt?0:1===F?Qi/Kt:(Math.pow(F,Qi)-1)/(Math.pow(F,Kt)-1)}(Vt,Wt,u.stops[Qi][0],u.stops[Qi+1][0]),_r=u.stops[Qi][1],Sr=u.stops[Qi+1][1],Ar=zl[F.type]||pn;return"function"==typeof _r.evaluate?{evaluate(...F){const Vt=_r.evaluate.apply(void 0,F),Wt=Sr.evaluate.apply(void 0,F);if(void 0!==Vt&&void 0!==Wt)return Ar(Vt,Wt,fr,u.colorSpace)}}:Ar(_r,Sr,fr,u.colorSpace)}function xn(u,F,Vt){switch(F.type){case"color":Vt=Gt.parse(Vt);break;case"formatted":Vt=Ht.fromString(Vt.toString());break;case"resolvedImage":Vt=te.fromString(Vt.toString());break;case"padding":Vt=Yt.parse(Vt);break;default:cn(Vt)===F.type||"enum"===F.type&&F.values[Vt]||(Vt=void 0)}return dn(Vt,u.default,F.default)}Xr.register(Xl,{error:[{kind:"error"},[so],(u,[F])=>{throw new ae(F.evaluate(u))}],typeof:[so,[wo],(u,[F])=>wt(ne(F.evaluate(u)))],"to-rgba":[bt(io,4),[ho],(u,[F])=>{const[Vt,Wt,Kt,Qi]=F.evaluate(u).rgb;return[255*Vt,255*Wt,255*Kt,Qi]}],rgb:[ho,[io,io,io],Hr],rgba:[ho,[io,io,io,io],Hr],has:{type:co,overloads:[[[so],(u,[F])=>Yr(F.evaluate(u),u.properties())],[[so,bo],(u,[F,Vt])=>Yr(F.evaluate(u),Vt.evaluate(u))]]},get:{type:wo,overloads:[[[so],(u,[F])=>Wr(F.evaluate(u),u.properties())],[[so,bo],(u,[F,Vt])=>Wr(F.evaluate(u),Vt.evaluate(u))]]},"feature-state":[wo,[so],(u,[F])=>Wr(F.evaluate(u),u.featureState||{})],properties:[bo,[],u=>u.properties()],"geometry-type":[so,[],u=>u.geometryType()],id:[wo,[],u=>u.id()],zoom:[io,[],u=>u.globals.zoom],"heatmap-density":[io,[],u=>u.globals.heatmapDensity||0],"line-progress":[io,[],u=>u.globals.lineProgress||0],accumulated:[wo,[],u=>void 0===u.globals.accumulated?null:u.globals.accumulated],"+":[io,Qr(io),(u,F)=>{let Vt=0;for(const Wt of F)Vt+=Wt.evaluate(u);return Vt}],"*":[io,Qr(io),(u,F)=>{let Vt=1;for(const Wt of F)Vt*=Wt.evaluate(u);return Vt}],"-":{type:io,overloads:[[[io,io],(u,[F,Vt])=>F.evaluate(u)-Vt.evaluate(u)],[[io],(u,[F])=>-F.evaluate(u)]]},"/":[io,[io,io],(u,[F,Vt])=>F.evaluate(u)/Vt.evaluate(u)],"%":[io,[io,io],(u,[F,Vt])=>F.evaluate(u)%Vt.evaluate(u)],ln2:[io,[],()=>Math.LN2],pi:[io,[],()=>Math.PI],e:[io,[],()=>Math.E],"^":[io,[io,io],(u,[F,Vt])=>Math.pow(F.evaluate(u),Vt.evaluate(u))],sqrt:[io,[io],(u,[F])=>Math.sqrt(F.evaluate(u))],log10:[io,[io],(u,[F])=>Math.log(F.evaluate(u))/Math.LN10],ln:[io,[io],(u,[F])=>Math.log(F.evaluate(u))],log2:[io,[io],(u,[F])=>Math.log(F.evaluate(u))/Math.LN2],sin:[io,[io],(u,[F])=>Math.sin(F.evaluate(u))],cos:[io,[io],(u,[F])=>Math.cos(F.evaluate(u))],tan:[io,[io],(u,[F])=>Math.tan(F.evaluate(u))],asin:[io,[io],(u,[F])=>Math.asin(F.evaluate(u))],acos:[io,[io],(u,[F])=>Math.acos(F.evaluate(u))],atan:[io,[io],(u,[F])=>Math.atan(F.evaluate(u))],min:[io,Qr(io),(u,F)=>Math.min(...F.map((F=>F.evaluate(u))))],max:[io,Qr(io),(u,F)=>Math.max(...F.map((F=>F.evaluate(u))))],abs:[io,[io],(u,[F])=>Math.abs(F.evaluate(u))],round:[io,[io],(u,[F])=>{const Vt=F.evaluate(u);return Vt<0?-Math.round(-Vt):Math.round(Vt)}],floor:[io,[io],(u,[F])=>Math.floor(F.evaluate(u))],ceil:[io,[io],(u,[F])=>Math.ceil(F.evaluate(u))],"filter-==":[co,[so,wo],(u,[F,Vt])=>u.properties()[F.value]===Vt.value],"filter-id-==":[co,[wo],(u,[F])=>u.id()===F.value],"filter-type-==":[co,[so],(u,[F])=>u.geometryType()===F.value],"filter-<":[co,[so,wo],(u,[F,Vt])=>{const Wt=u.properties()[F.value],Kt=Vt.value;return typeof Wt==typeof Kt&&Wt<Kt}],"filter-id-<":[co,[wo],(u,[F])=>{const Vt=u.id(),Wt=F.value;return typeof Vt==typeof Wt&&Vt<Wt}],"filter->":[co,[so,wo],(u,[F,Vt])=>{const Wt=u.properties()[F.value],Kt=Vt.value;return typeof Wt==typeof Kt&&Wt>Kt}],"filter-id->":[co,[wo],(u,[F])=>{const Vt=u.id(),Wt=F.value;return typeof Vt==typeof Wt&&Vt>Wt}],"filter-<=":[co,[so,wo],(u,[F,Vt])=>{const Wt=u.properties()[F.value],Kt=Vt.value;return typeof Wt==typeof Kt&&Wt<=Kt}],"filter-id-<=":[co,[wo],(u,[F])=>{const Vt=u.id(),Wt=F.value;return typeof Vt==typeof Wt&&Vt<=Wt}],"filter->=":[co,[so,wo],(u,[F,Vt])=>{const Wt=u.properties()[F.value],Kt=Vt.value;return typeof Wt==typeof Kt&&Wt>=Kt}],"filter-id->=":[co,[wo],(u,[F])=>{const Vt=u.id(),Wt=F.value;return typeof Vt==typeof Wt&&Vt>=Wt}],"filter-has":[co,[wo],(u,[F])=>F.value in u.properties()],"filter-has-id":[co,[],u=>null!==u.id()&&void 0!==u.id()],"filter-type-in":[co,[bt(so)],(u,[F])=>F.value.indexOf(u.geometryType())>=0],"filter-id-in":[co,[bt(wo)],(u,[F])=>F.value.indexOf(u.id())>=0],"filter-in-small":[co,[so,bt(wo)],(u,[F,Vt])=>Vt.value.indexOf(u.properties()[F.value])>=0],"filter-in-large":[co,[so,bt(wo)],(u,[F,Vt])=>function(u,F,Vt,Wt){for(;Vt<=Wt;){const Kt=Vt+Wt>>1;if(F[Kt]===u)return!0;F[Kt]>u?Wt=Kt-1:Vt=Kt+1}return!1}(u.properties()[F.value],Vt.value,0,Vt.value.length-1)],all:{type:co,overloads:[[[co,co],(u,[F,Vt])=>F.evaluate(u)&&Vt.evaluate(u)],[Qr(co),(u,F)=>{for(const Vt of F)if(!Vt.evaluate(u))return!1;return!0}]]},any:{type:co,overloads:[[[co,co],(u,[F,Vt])=>F.evaluate(u)||Vt.evaluate(u)],[Qr(co),(u,F)=>{for(const Vt of F)if(Vt.evaluate(u))return!0;return!1}]]},"!":[co,[co],(u,[F])=>!F.evaluate(u)],"is-supported-script":[co,[so],(u,[F])=>{const Vt=u.globals&&u.globals.isSupportedScript;return!Vt||Vt(F.evaluate(u))}],upcase:[so,[so],(u,[F])=>F.evaluate(u).toUpperCase()],downcase:[so,[so],(u,[F])=>F.evaluate(u).toLowerCase()],concat:[so,Qr(wo),(u,F)=>F.map((F=>ie(F.evaluate(u)))).join("")],"resolved-locale":[so,[So],(u,[F])=>F.evaluate(u).resolvedLocale()]});class vn{constructor(u,F){var Vt;this.expression=u,this._warningHistory={},this._evaluator=new pe,this._defaultValue=F?"color"===(Vt=F).type&&hn(Vt.default)?new Gt(0,0,0,0):"color"===Vt.type?Gt.parse(Vt.default)||null:"padding"===Vt.type?Yt.parse(Vt.default)||null:"variableAnchorOffsetCollection"===Vt.type?Qt.parse(Vt.default)||null:void 0===Vt.default?null:Vt.default:null,this._enumValues=F&&"enum"===F.type?F.values:null}evaluateWithoutErrorHandling(u,F,Vt,Wt,Kt,Qi){return this._evaluator.globals=u,this._evaluator.feature=F,this._evaluator.featureState=Vt,this._evaluator.canonical=Wt,this._evaluator.availableImages=Kt||null,this._evaluator.formattedSection=Qi,this.expression.evaluate(this._evaluator)}evaluate(u,F,Vt,Wt,Kt,Qi){this._evaluator.globals=u,this._evaluator.feature=F||null,this._evaluator.featureState=Vt||null,this._evaluator.canonical=Wt,this._evaluator.availableImages=Kt||null,this._evaluator.formattedSection=Qi||null;try{const u=this.expression.evaluate(this._evaluator);if(null==u||"number"==typeof u&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new ae(`Expected value to be one of ${Object.keys(this._enumValues).map((u=>JSON.stringify(u))).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,"undefined"!=typeof console&&console.warn(u.message)),this._defaultValue}}}function bn(u){return Array.isArray(u)&&u.length>0&&"string"==typeof u[0]&&u[0]in Xl}function wn(u,F){const Vt=new fe(Xl,tn,[],F?function(u){const F={color:ho,string:so,number:io,enum:so,boolean:co,formatted:Ao,padding:ko,resolvedImage:Wo,variableAnchorOffsetCollection:il};return"array"===u.type?bt(F[u.value]||wo,u.length):F[u.type]}(F):void 0),Wt=Vt.parse(u,void 0,void 0,void 0,F&&"string"===F.type?{typeAnnotation:"coerce"}:void 0);return Wt?sn(new vn(Wt,F)):an(Vt.errors)}class _n{constructor(u,F){this.kind=u,this._styleExpression=F,this.isStateDependent="constant"!==u&&!rn(F.expression)}evaluateWithoutErrorHandling(u,F,Vt,Wt,Kt,Qi){return this._styleExpression.evaluateWithoutErrorHandling(u,F,Vt,Wt,Kt,Qi)}evaluate(u,F,Vt,Wt,Kt,Qi){return this._styleExpression.evaluate(u,F,Vt,Wt,Kt,Qi)}}class An{constructor(u,F,Vt,Wt){this.kind=u,this.zoomStops=Vt,this._styleExpression=F,this.isStateDependent="camera"!==u&&!rn(F.expression),this.interpolationType=Wt}evaluateWithoutErrorHandling(u,F,Vt,Wt,Kt,Qi){return this._styleExpression.evaluateWithoutErrorHandling(u,F,Vt,Wt,Kt,Qi)}evaluate(u,F,Vt,Wt,Kt,Qi){return this._styleExpression.evaluate(u,F,Vt,Wt,Kt,Qi)}interpolationFactor(u,F,Vt){return this.interpolationType?Ce.interpolationFactor(this.interpolationType,u,F,Vt):0}}function Sn(u,F){const Vt=wn(u,F);if("error"===Vt.result)return Vt;const Wt=Vt.value.expression,Kt=en(Wt);if(!Kt&&!on(F))return an([new at("","data expressions not supported")]);const Qi=nn(Wt,["zoom"]);if(!Qi&&!ln(F))return an([new at("","zoom expressions not supported")]);const fr=Mn(Wt);return fr||Qi?fr instanceof at?an([fr]):fr instanceof Ce&&!un(F)?an([new at("",'"interpolate" expressions cannot be used with this property')]):sn(fr?new An(Kt?"camera":"composite",Vt.value,fr.labels,fr instanceof Ce?fr.interpolation:void 0):new _n(Kt?"constant":"source",Vt.value)):an([new at("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class kn{constructor(u,F){this._parameters=u,this._specification=F,st(this,fn(this._parameters,this._specification))}static deserialize(u){return new kn(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function Mn(u){let F=null;if(u instanceof de)F=Mn(u.result);else if(u instanceof Ee){for(const Vt of u.args)if(F=Mn(Vt),F)break}else(u instanceof Ae||u instanceof Ce)&&u.input instanceof Xr&&"zoom"===u.input.name&&(F=u);return F instanceof at||u.eachChild((u=>{const Vt=Mn(u);Vt instanceof at?F=Vt:!F&&Vt?F=new at("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&Vt&&F!==Vt&&(F=new at("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),F}function In(u){if(!0===u||!1===u)return!0;if(!Array.isArray(u)||0===u.length)return!1;switch(u[0]){case"has":return u.length>=2&&"$id"!==u[1]&&"$type"!==u[1];case"in":return u.length>=3&&("string"!=typeof u[1]||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==u.length||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const F of u.slice(1))if(!In(F)&&"boolean"!=typeof F)return!1;return!0;default:return!0}}const Jl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pn(u){if(null==u)return{filter:()=>!0,needGeometry:!1};In(u)||(u=Vn(u));const F=wn(u,Jl);if("error"===F.result)throw new Error(F.value.map((u=>`${u.key}: ${u.message}`)).join(", "));return{filter:(u,Vt,Wt)=>F.value.evaluate(u,Vt,{},Wt),needGeometry:Cn(u)}}function Bn(u,F){return u<F?-1:u>F?1:0}function Cn(u){if(!Array.isArray(u))return!1;if("within"===u[0]||"distance"===u[0])return!0;for(let F=1;F<u.length;F++)if(Cn(u[F]))return!0;return!1}function Vn(u){if(!u)return!0;const F=u[0];return u.length<=1?"any"!==F:"=="===F?En(u[1],u[2],"=="):"!="===F?$n(En(u[1],u[2],"==")):"<"===F||">"===F||"<="===F||">="===F?En(u[1],u[2],F):"any"===F?(Vt=u.slice(1),["any"].concat(Vt.map(Vn))):"all"===F?["all"].concat(u.slice(1).map(Vn)):"none"===F?["all"].concat(u.slice(1).map(Vn).map($n)):"in"===F?Fn(u[1],u.slice(2)):"!in"===F?$n(Fn(u[1],u.slice(2))):"has"===F?Tn(u[1]):"!has"!==F||$n(Tn(u[1]));var Vt}function En(u,F,Vt){switch(u){case"$type":return[`filter-type-${Vt}`,F];case"$id":return[`filter-id-${Vt}`,F];default:return[`filter-${Vt}`,u,F]}}function Fn(u,F){if(0===F.length)return!1;switch(u){case"$type":return["filter-type-in",["literal",F]];case"$id":return["filter-id-in",["literal",F]];default:return F.length>200&&!F.some((u=>typeof u!=typeof F[0]))?["filter-in-large",u,["literal",F.sort(Bn)]]:["filter-in-small",u,["literal",F]]}}function Tn(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function $n(u){return["!",u]}function Ln(u){const F=typeof u;if("number"===F||"boolean"===F||"string"===F||null==u)return JSON.stringify(u);if(Array.isArray(u)){let F="[";for(const Vt of u)F+=`${Ln(Vt)},`;return`${F}]`}const Vt=Object.keys(u).sort();let Wt="{";for(let F=0;F<Vt.length;F++)Wt+=`${JSON.stringify(Vt[F])}:${Ln(u[Vt[F]])},`;return`${Wt}}`}function Dn(u){let F="";for(const Vt of to)F+=`/${Ln(u[Vt])}`;return F}function On(u){const F=u.value;return F?[new it(u.key,F,"constants have been deprecated as of v8")]:[]}function Rn(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Un(u){if(Array.isArray(u))return u.map(Un);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const F={};for(const Vt in u)F[Vt]=Un(u[Vt]);return F}return Rn(u)}function jn(u){const F=u.key,Vt=u.value,Wt=u.valueSpec||{},Kt=u.objectElementValidators||{},Qi=u.style,fr=u.styleSpec,_r=u.validateSpec;let Sr=[];const Ar=cn(Vt);if("object"!==Ar)return[new it(F,Vt,`object expected, ${Ar} found`)];for(const u in Vt){const Ar=u.split(".")[0],Jr=Wt[Ar]||Wt["*"];let zn;if(Kt[Ar])zn=Kt[Ar];else if(Wt[Ar])zn=_r;else if(Kt["*"])zn=Kt["*"];else{if(!Wt["*"]){Sr.push(new it(F,Vt[u],`unknown property "${u}"`));continue}zn=_r}Sr=Sr.concat(zn({key:(F?`${F}.`:F)+u,value:Vt[u],valueSpec:Jr,style:Qi,styleSpec:fr,object:Vt,objectKey:u,validateSpec:_r},Vt))}for(const u in Wt)Kt[u]||Wt[u].required&&void 0===Wt[u].default&&void 0===Vt[u]&&Sr.push(new it(F,Vt,`missing required property "${u}"`));return Sr}function qn(u){const F=u.value,Vt=u.valueSpec,Wt=u.style,Kt=u.styleSpec,Qi=u.key,fr=u.arrayElementValidator||u.validateSpec;if("array"!==cn(F))return[new it(Qi,F,`array expected, ${cn(F)} found`)];if(Vt.length&&F.length!==Vt.length)return[new it(Qi,F,`array length ${Vt.length} expected, length ${F.length} found`)];if(Vt["min-length"]&&F.length<Vt["min-length"])return[new it(Qi,F,`array length at least ${Vt["min-length"]} expected, length ${F.length} found`)];let _r={type:Vt.value,values:Vt.values};Kt.$version<7&&(_r.function=Vt.function),"object"===cn(Vt.value)&&(_r=Vt.value);let Sr=[];for(let Vt=0;Vt<F.length;Vt++)Sr=Sr.concat(fr({array:F,arrayIndex:Vt,value:F[Vt],valueSpec:_r,validateSpec:u.validateSpec,style:Wt,styleSpec:Kt,key:`${Qi}[${Vt}]`}));return Sr}function Nn(u){const F=u.key,Vt=u.value,Wt=u.valueSpec;let Kt=cn(Vt);return"number"===Kt&&Vt!=Vt&&(Kt="NaN"),"number"!==Kt?[new it(F,Vt,`number expected, ${Kt} found`)]:"minimum"in Wt&&Vt<Wt.minimum?[new it(F,Vt,`${Vt} is less than the minimum value ${Wt.minimum}`)]:"maximum"in Wt&&Vt>Wt.maximum?[new it(F,Vt,`${Vt} is greater than the maximum value ${Wt.maximum}`)]:[]}function Zn(u){const F=u.valueSpec,Vt=Rn(u.value.type);let Wt,Kt,Qi,fr={};const _r="categorical"!==Vt&&void 0===u.value.property,Sr=!_r,Ar="array"===cn(u.value.stops)&&"array"===cn(u.value.stops[0])&&"object"===cn(u.value.stops[0][0]),Jr=jn({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(u){if("identity"===Vt)return[new it(u.key,u.value,'identity function may not have a "stops" property')];let F=[];const Wt=u.value;return F=F.concat(qn({key:u.key,value:Wt,valueSpec:u.valueSpec,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,arrayElementValidator:h})),"array"===cn(Wt)&&0===Wt.length&&F.push(new it(u.key,Wt,"array must have at least one stop")),F},default:function(u){return u.validateSpec({key:u.key,value:u.value,valueSpec:F,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec})}}});return"identity"===Vt&&_r&&Jr.push(new it(u.key,u.value,'missing required property "property"')),"identity"===Vt||u.value.stops||Jr.push(new it(u.key,u.value,'missing required property "stops"')),"exponential"===Vt&&u.valueSpec.expression&&!un(u.valueSpec)&&Jr.push(new it(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(Sr&&!on(u.valueSpec)?Jr.push(new it(u.key,u.value,"property functions not supported")):_r&&!ln(u.valueSpec)&&Jr.push(new it(u.key,u.value,"zoom functions not supported"))),"categorical"!==Vt&&!Ar||void 0!==u.value.property||Jr.push(new it(u.key,u.value,'"property" property is required')),Jr;function h(u){let Vt=[];const Wt=u.value,_r=u.key;if("array"!==cn(Wt))return[new it(_r,Wt,`array expected, ${cn(Wt)} found`)];if(2!==Wt.length)return[new it(_r,Wt,`array length 2 expected, length ${Wt.length} found`)];if(Ar){if("object"!==cn(Wt[0]))return[new it(_r,Wt,`object expected, ${cn(Wt[0])} found`)];if(void 0===Wt[0].zoom)return[new it(_r,Wt,"object stop key must have zoom")];if(void 0===Wt[0].value)return[new it(_r,Wt,"object stop key must have value")];if(Qi&&Qi>Rn(Wt[0].zoom))return[new it(_r,Wt[0].zoom,"stop zoom values must appear in ascending order")];Rn(Wt[0].zoom)!==Qi&&(Qi=Rn(Wt[0].zoom),Kt=void 0,fr={}),Vt=Vt.concat(jn({key:`${_r}[0]`,value:Wt[0],valueSpec:{zoom:{}},validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{zoom:Nn,value:p}}))}else Vt=Vt.concat(p({key:`${_r}[0]`,value:Wt[0],valueSpec:{},validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec},Wt));return bn(Un(Wt[1]))?Vt.concat([new it(`${_r}[1]`,Wt[1],"expressions are not allowed in function stops.")]):Vt.concat(u.validateSpec({key:`${_r}[1]`,value:Wt[1],valueSpec:F,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec}))}function p(u,Qi){const _r=cn(u.value),Sr=Rn(u.value),Ar=null!==u.value?u.value:Qi;if(Wt){if(_r!==Wt)return[new it(u.key,Ar,`${_r} stop domain type must match previous stop domain type ${Wt}`)]}else Wt=_r;if("number"!==_r&&"string"!==_r&&"boolean"!==_r)return[new it(u.key,Ar,"stop domain value must be a number, string, or boolean")];if("number"!==_r&&"categorical"!==Vt){let Wt=`number expected, ${_r} found`;return on(F)&&void 0===Vt&&(Wt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(u.key,Ar,Wt)]}return"categorical"!==Vt||"number"!==_r||isFinite(Sr)&&Math.floor(Sr)===Sr?"categorical"!==Vt&&"number"===_r&&void 0!==Kt&&Sr<Kt?[new it(u.key,Ar,"stop domain values must appear in ascending order")]:(Kt=Sr,"categorical"===Vt&&Sr in fr?[new it(u.key,Ar,"stop domain values must be unique")]:(fr[Sr]=!0,[])):[new it(u.key,Ar,`integer expected, found ${Sr}`)]}}function Kn(u){const F=("property"===u.expressionContext?Sn:wn)(Un(u.value),u.valueSpec);if("error"===F.result)return F.value.map((F=>new it(`${u.key}${F.key}`,u.value,F.message)));const Vt=F.value.expression||F.value._styleExpression.expression;if("property"===u.expressionContext&&"text-font"===u.propertyKey&&!Vt.outputDefined())return[new it(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===u.expressionContext&&"layout"===u.propertyType&&!rn(Vt))return[new it(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===u.expressionContext&&!rn(Vt))return[new it(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&0===u.expressionContext.indexOf("cluster")){if(!nn(Vt,["zoom","feature-state"]))return[new it(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===u.expressionContext&&!en(Vt))return[new it(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gn(u){const F=u.key,Vt=u.value,Wt=u.valueSpec,Kt=[];return Array.isArray(Wt.values)?-1===Wt.values.indexOf(Rn(Vt))&&Kt.push(new it(F,Vt,`expected one of [${Wt.values.join(", ")}], ${JSON.stringify(Vt)} found`)):-1===Object.keys(Wt.values).indexOf(Rn(Vt))&&Kt.push(new it(F,Vt,`expected one of [${Object.keys(Wt.values).join(", ")}], ${JSON.stringify(Vt)} found`)),Kt}function Jn(u){return In(Un(u.value))?Kn(st({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xn(u)}function Xn(u){const F=u.value,Vt=u.key;if("array"!==cn(F))return[new it(Vt,F,`array expected, ${cn(F)} found`)];const Wt=u.styleSpec;let Kt,Qi=[];if(F.length<1)return[new it(Vt,F,"filter array must have at least 1 element")];switch(Qi=Qi.concat(Gn({key:`${Vt}[0]`,value:F[0],valueSpec:Wt.filter_operator,style:u.style,styleSpec:u.styleSpec})),Rn(F[0])){case"<":case"<=":case">":case">=":F.length>=2&&"$type"===Rn(F[1])&&Qi.push(new it(Vt,F,`"$type" cannot be use with operator "${F[0]}"`));case"==":case"!=":3!==F.length&&Qi.push(new it(Vt,F,`filter array for operator "${F[0]}" must have 3 elements`));case"in":case"!in":F.length>=2&&(Kt=cn(F[1]),"string"!==Kt&&Qi.push(new it(`${Vt}[1]`,F[1],`string expected, ${Kt} found`)));for(let fr=2;fr<F.length;fr++)Kt=cn(F[fr]),"$type"===Rn(F[1])?Qi=Qi.concat(Gn({key:`${Vt}[${fr}]`,value:F[fr],valueSpec:Wt.geometry_type,style:u.style,styleSpec:u.styleSpec})):"string"!==Kt&&"number"!==Kt&&"boolean"!==Kt&&Qi.push(new it(`${Vt}[${fr}]`,F[fr],`string, number, or boolean expected, ${Kt} found`));break;case"any":case"all":case"none":for(let Wt=1;Wt<F.length;Wt++)Qi=Qi.concat(Xn({key:`${Vt}[${Wt}]`,value:F[Wt],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":Kt=cn(F[1]),2!==F.length?Qi.push(new it(Vt,F,`filter array for "${F[0]}" operator must have 2 elements`)):"string"!==Kt&&Qi.push(new it(`${Vt}[1]`,F[1],`string expected, ${Kt} found`))}return Qi}function Hn(u,F){const Vt=u.key,Wt=u.validateSpec,Kt=u.style,Qi=u.styleSpec,fr=u.value,_r=u.objectKey,Sr=Qi[`${F}_${u.layerType}`];if(!Sr)return[];const Ar=_r.match(/^(.*)-transition$/);if("paint"===F&&Ar&&Sr[Ar[1]]&&Sr[Ar[1]].transition)return Wt({key:Vt,value:fr,valueSpec:Qi.transition,style:Kt,styleSpec:Qi});const Jr=u.valueSpec||Sr[_r];if(!Jr)return[new it(Vt,fr,`unknown property "${_r}"`)];let zn;if("string"===cn(fr)&&on(Jr)&&!Jr.tokens&&(zn=/^{([^}]+)}$/.exec(fr)))return[new it(Vt,fr,`"${_r}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(zn[1])} }\`.`)];const Qs=[];return"symbol"===u.layerType&&("text-field"===_r&&Kt&&!Kt.glyphs&&Qs.push(new it(Vt,fr,'use of "text-field" requires a style "glyphs" property')),"text-font"===_r&&hn(Un(fr))&&"identity"===Rn(fr.type)&&Qs.push(new it(Vt,fr,'"text-font" does not support identity functions'))),Qs.concat(Wt({key:u.key,value:fr,valueSpec:Jr,style:Kt,styleSpec:Qi,expressionContext:"property",propertyType:F,propertyKey:_r}))}function Yn(u){return Hn(u,"paint")}function Wn(u){return Hn(u,"layout")}function Qn(u){let F=[];const Vt=u.value,Wt=u.key,Kt=u.style,Qi=u.styleSpec;Vt.type||Vt.ref||F.push(new it(Wt,Vt,'either "type" or "ref" is required'));let fr=Rn(Vt.type);const _r=Rn(Vt.ref);if(Vt.id){const Qi=Rn(Vt.id);for(let fr=0;fr<u.arrayIndex;fr++){const u=Kt.layers[fr];Rn(u.id)===Qi&&F.push(new it(Wt,Vt.id,`duplicate layer id "${Vt.id}", previously used at line ${u.id.__line__}`))}}if("ref"in Vt){let u;["type","source","source-layer","filter","layout"].forEach((u=>{u in Vt&&F.push(new it(Wt,Vt[u],`"${u}" is prohibited for ref layers`))})),Kt.layers.forEach((F=>{Rn(F.id)===_r&&(u=F)})),u?u.ref?F.push(new it(Wt,Vt.ref,"ref cannot reference another ref layer")):fr=Rn(u.type):F.push(new it(Wt,Vt.ref,`ref layer "${_r}" not found`))}else if("background"!==fr)if(Vt.source){const u=Kt.sources&&Kt.sources[Vt.source],Qi=u&&Rn(u.type);u?"vector"===Qi&&"raster"===fr?F.push(new it(Wt,Vt.source,`layer "${Vt.id}" requires a raster source`)):"raster-dem"!==Qi&&"hillshade"===fr?F.push(new it(Wt,Vt.source,`layer "${Vt.id}" requires a raster-dem source`)):"raster"===Qi&&"raster"!==fr?F.push(new it(Wt,Vt.source,`layer "${Vt.id}" requires a vector source`)):"vector"!==Qi||Vt["source-layer"]?"raster-dem"===Qi&&"hillshade"!==fr?F.push(new it(Wt,Vt.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==fr||!Vt.paint||!Vt.paint["line-gradient"]||"geojson"===Qi&&u.lineMetrics||F.push(new it(Wt,Vt,`layer "${Vt.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):F.push(new it(Wt,Vt,`layer "${Vt.id}" must specify a "source-layer"`)):F.push(new it(Wt,Vt.source,`source "${Vt.source}" not found`))}else F.push(new it(Wt,Vt,'missing required property "source"'));return F=F.concat(jn({key:Wt,value:Vt,valueSpec:Qi.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${Wt}.type`,value:Vt.type,valueSpec:Qi.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:Vt,objectKey:"type"}),filter:Jn,layout:u=>jn({layer:Vt,key:u.key,value:u.value,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":u=>Wn(st({layerType:fr},u))}}),paint:u=>jn({layer:Vt,key:u.key,value:u.value,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":u=>Yn(st({layerType:fr},u))}})}})),F}function ti(u){const F=u.value,Vt=u.key,Wt=cn(F);return"string"!==Wt?[new it(Vt,F,`string expected, ${Wt} found`)]:[]}const Yl={promoteId:function({key:u,value:F}){if("string"===cn(F))return ti({key:u,value:F});{const Vt=[];for(const Wt in F)Vt.push(...ti({key:`${u}.${Wt}`,value:F[Wt]}));return Vt}}};function ri(u){const F=u.value,Vt=u.key,Wt=u.styleSpec,Kt=u.style,Qi=u.validateSpec;if(!F.type)return[new it(Vt,F,'"type" is required')];const fr=Rn(F.type);let _r;switch(fr){case"vector":case"raster":return _r=jn({key:Vt,value:F,valueSpec:Wt[`source_${fr.replace("-","_")}`],style:u.style,styleSpec:Wt,objectElementValidators:Yl,validateSpec:Qi}),_r;case"raster-dem":return _r=function(u){var F;const Vt=null!==(F=u.sourceName)&&void 0!==F?F:"",Wt=u.value,Kt=u.styleSpec,Qi=Kt.source_raster_dem,fr=u.style;let _r=[];const Sr=cn(Wt);if(void 0===Wt)return _r;if("object"!==Sr)return _r.push(new it("source_raster_dem",Wt,`object expected, ${Sr} found`)),_r;const Ar="custom"===Rn(Wt.encoding),Jr=["redFactor","greenFactor","blueFactor","baseShift"],zn=u.value.encoding?`"${u.value.encoding}"`:"Default";for(const F in Wt)!Ar&&Jr.includes(F)?_r.push(new it(F,Wt[F],`In "${Vt}": "${F}" is only valid when "encoding" is set to "custom". ${zn} encoding found`)):Qi[F]?_r=_r.concat(u.validateSpec({key:F,value:Wt[F],valueSpec:Qi[F],validateSpec:u.validateSpec,style:fr,styleSpec:Kt})):_r.push(new it(F,Wt[F],`unknown property "${F}"`));return _r}({sourceName:Vt,value:F,style:u.style,styleSpec:Wt,validateSpec:Qi}),_r;case"geojson":if(_r=jn({key:Vt,value:F,valueSpec:Wt.source_geojson,style:Kt,styleSpec:Wt,validateSpec:Qi,objectElementValidators:Yl}),F.cluster)for(const u in F.clusterProperties){const[Wt,Kt]=F.clusterProperties[u],fr="string"==typeof Wt?[Wt,["accumulated"],["get",u]]:Wt;_r.push(...Kn({key:`${Vt}.${u}.map`,value:Kt,validateSpec:Qi,expressionContext:"cluster-map"})),_r.push(...Kn({key:`${Vt}.${u}.reduce`,value:fr,validateSpec:Qi,expressionContext:"cluster-reduce"}))}return _r;case"video":return jn({key:Vt,value:F,valueSpec:Wt.source_video,style:Kt,validateSpec:Qi,styleSpec:Wt});case"image":return jn({key:Vt,value:F,valueSpec:Wt.source_image,style:Kt,validateSpec:Qi,styleSpec:Wt});case"canvas":return[new it(Vt,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gn({key:`${Vt}.type`,value:F.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:Kt,validateSpec:Qi,styleSpec:Wt})}}function ni(u){const F=u.value,Vt=u.styleSpec,Wt=Vt.light,Kt=u.style;let Qi=[];const fr=cn(F);if(void 0===F)return Qi;if("object"!==fr)return Qi=Qi.concat([new it("light",F,`object expected, ${fr} found`)]),Qi;for(const fr in F){const _r=fr.match(/^(.*)-transition$/);Qi=Qi.concat(_r&&Wt[_r[1]]&&Wt[_r[1]].transition?u.validateSpec({key:fr,value:F[fr],valueSpec:Vt.transition,validateSpec:u.validateSpec,style:Kt,styleSpec:Vt}):Wt[fr]?u.validateSpec({key:fr,value:F[fr],valueSpec:Wt[fr],validateSpec:u.validateSpec,style:Kt,styleSpec:Vt}):[new it(fr,F[fr],`unknown property "${fr}"`)])}return Qi}function ii(u){const F=u.value,Vt=u.styleSpec,Wt=Vt.sky,Kt=u.style,Qi=cn(F);if(void 0===F)return[];if("object"!==Qi)return[new it("sky",F,`object expected, ${Qi} found`)];let fr=[];for(const Qi in F)fr=fr.concat(Wt[Qi]?u.validateSpec({key:Qi,value:F[Qi],valueSpec:Wt[Qi],style:Kt,styleSpec:Vt}):[new it(Qi,F[Qi],`unknown property "${Qi}"`)]);return fr}function si(u){const F=u.value,Vt=u.styleSpec,Wt=Vt.terrain,Kt=u.style;let Qi=[];const fr=cn(F);if(void 0===F)return Qi;if("object"!==fr)return Qi=Qi.concat([new it("terrain",F,`object expected, ${fr} found`)]),Qi;for(const fr in F)Qi=Qi.concat(Wt[fr]?u.validateSpec({key:fr,value:F[fr],valueSpec:Wt[fr],validateSpec:u.validateSpec,style:Kt,styleSpec:Vt}):[new it(fr,F[fr],`unknown property "${fr}"`)]);return Qi}function ai(u){let F=[];const Vt=u.value,Wt=u.key;if(Array.isArray(Vt)){const Kt=[],Qi=[];for(const fr in Vt)Vt[fr].id&&Kt.includes(Vt[fr].id)&&F.push(new it(Wt,Vt,`all the sprites' ids must be unique, but ${Vt[fr].id} is duplicated`)),Kt.push(Vt[fr].id),Vt[fr].url&&Qi.includes(Vt[fr].url)&&F.push(new it(Wt,Vt,`all the sprites' URLs must be unique, but ${Vt[fr].url} is duplicated`)),Qi.push(Vt[fr].url),F=F.concat(jn({key:`${Wt}[${fr}]`,value:Vt[fr],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return F}return ti({key:Wt,value:Vt})}const Ql={"*":()=>[],array:qn,boolean:function(u){const F=u.value,Vt=u.key,Wt=cn(F);return"boolean"!==Wt?[new it(Vt,F,`boolean expected, ${Wt} found`)]:[]},number:Nn,color:function(u){const F=u.key,Vt=u.value,Wt=cn(Vt);return"string"!==Wt?[new it(F,Vt,`color expected, ${Wt} found`)]:Gt.parse(String(Vt))?[]:[new it(F,Vt,`color expected, "${Vt}" found`)]},constants:On,enum:Gn,filter:Jn,function:Zn,layer:Qn,object:jn,source:ri,light:ni,sky:ii,terrain:si,string:ti,formatted:function(u){return 0===ti(u).length?[]:Kn(u)},resolvedImage:function(u){return 0===ti(u).length?[]:Kn(u)},padding:function(u){const F=u.key,Vt=u.value;if("array"===cn(Vt)){if(Vt.length<1||Vt.length>4)return[new it(F,Vt,`padding requires 1 to 4 values; ${Vt.length} values found`)];const Wt={type:"number"};let Kt=[];for(let Qi=0;Qi<Vt.length;Qi++)Kt=Kt.concat(u.validateSpec({key:`${F}[${Qi}]`,value:Vt[Qi],validateSpec:u.validateSpec,valueSpec:Wt}));return Kt}return Nn({key:F,value:Vt,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const F=u.key,Vt=u.value,Wt=cn(Vt),Kt=u.styleSpec;if("array"!==Wt||Vt.length<1||Vt.length%2!=0)return[new it(F,Vt,"variableAnchorOffsetCollection requires a non-empty array of even length")];let Qi=[];for(let Wt=0;Wt<Vt.length;Wt+=2)Qi=Qi.concat(Gn({key:`${F}[${Wt}]`,value:Vt[Wt],valueSpec:Kt.layout_symbol["text-anchor"]})),Qi=Qi.concat(qn({key:`${F}[${Wt+1}]`,value:Vt[Wt+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:Kt}));return Qi},sprite:ai};function li(u){const F=u.value,Vt=u.valueSpec,Wt=u.styleSpec;return u.validateSpec=li,Vt.expression&&hn(Rn(F))?Zn(u):Vt.expression&&bn(Un(F))?Kn(u):Vt.type&&Ql[Vt.type]?Ql[Vt.type](u):jn(st({},u,{valueSpec:Vt.type?Wt[Vt.type]:Vt}))}function ui(u){const F=u.value,Vt=u.key,Wt=ti(u);return Wt.length||(-1===F.indexOf("{fontstack}")&&Wt.push(new it(Vt,F,'"glyphs" url must include a "{fontstack}" token')),-1===F.indexOf("{range}")&&Wt.push(new it(Vt,F,'"glyphs" url must include a "{range}" token'))),Wt}function ci(u,F=Ya){let Vt=[];return Vt=Vt.concat(li({key:"",value:u,valueSpec:F.$root,styleSpec:F,style:u,validateSpec:li,objectElementValidators:{glyphs:ui,"*":()=>[]}})),u.constants&&(Vt=Vt.concat(On({key:"constants",value:u.constants,style:u,styleSpec:F,validateSpec:li}))),pi(Vt)}function hi(u){return function(F){return u({...F,validateSpec:li})}}function pi(u){return[].concat(u).sort(((u,F)=>u.line-F.line))}function fi(F){return function(...Vt){return pi(F.apply(this||u,Vt))}}ci.source=fi(hi(ri)),ci.sprite=fi(hi(ai)),ci.glyphs=fi(hi(ui)),ci.light=fi(hi(ni)),ci.sky=fi(hi(ii)),ci.terrain=fi(hi(si)),ci.layer=fi(hi(Qn)),ci.filter=fi(hi(Jn)),ci.paintProperty=fi(hi(Yn)),ci.layoutProperty=fi(hi(Wn));const rc=ci,nc=rc.light,cc=rc.paintProperty,hc=rc.layoutProperty;function xi(u,F){let Vt=!1;if(F&&F.length)for(const Wt of F)u.fire(new N(new Error(Wt.message))),Vt=!0;return Vt}class vi{constructor(u,F,Vt){const Wt=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const Kt=new Int32Array(this.arrayBuffer);u=Kt[0],this.d=(F=Kt[1])+2*(Vt=Kt[2]);for(let u=0;u<this.d*this.d;u++){const F=Kt[3+u],Vt=Kt[3+u+1];Wt.push(F===Vt?null:Kt.subarray(F,Vt))}const Qi=Kt[3+Wt.length+1];this.keys=Kt.subarray(Kt[3+Wt.length],Qi),this.bboxes=Kt.subarray(Qi),this.insert=this._insertReadonly}else{this.d=F+2*Vt;for(let u=0;u<this.d*this.d;u++)Wt.push([]);this.keys=[],this.bboxes=[]}this.n=F,this.extent=u,this.padding=Vt,this.scale=F/u,this.uid=0;const Kt=Vt/F*u;this.min=-Kt,this.max=u+Kt}insert(u,F,Vt,Wt,Kt){this._forEachCell(F,Vt,Wt,Kt,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(F),this.bboxes.push(Vt),this.bboxes.push(Wt),this.bboxes.push(Kt)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,F,Vt,Wt,Kt,Qi){this.cells[Kt].push(Qi)}query(u,F,Vt,Wt,Kt){const Qi=this.min,fr=this.max;if(u<=Qi&&F<=Qi&&fr<=Vt&&fr<=Wt&&!Kt)return Array.prototype.slice.call(this.keys);{const Qi=[];return this._forEachCell(u,F,Vt,Wt,this._queryCell,Qi,{},Kt),Qi}}_queryCell(u,F,Vt,Wt,Kt,Qi,fr,_r){const Sr=this.cells[Kt];if(null!==Sr){const Kt=this.keys,Ar=this.bboxes;for(let Jr=0;Jr<Sr.length;Jr++){const zn=Sr[Jr];if(void 0===fr[zn]){const Sr=4*zn;(_r?_r(Ar[Sr+0],Ar[Sr+1],Ar[Sr+2],Ar[Sr+3]):u<=Ar[Sr+2]&&F<=Ar[Sr+3]&&Vt>=Ar[Sr+0]&&Wt>=Ar[Sr+1])?(fr[zn]=!0,Qi.push(Kt[zn])):fr[zn]=!1}}}}_forEachCell(u,F,Vt,Wt,Kt,Qi,fr,_r){const Sr=this._convertToCellCoord(u),Ar=this._convertToCellCoord(F),Jr=this._convertToCellCoord(Vt),zn=this._convertToCellCoord(Wt);for(let Qs=Sr;Qs<=Jr;Qs++)for(let Sr=Ar;Sr<=zn;Sr++){const Ar=this.d*Sr+Qs;if((!_r||_r(this._convertFromCellCoord(Qs),this._convertFromCellCoord(Sr),this._convertFromCellCoord(Qs+1),this._convertFromCellCoord(Sr+1)))&&Kt.call(this,u,F,Vt,Wt,Ar,Qi,fr,_r))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,F=3+this.cells.length+1+1;let Vt=0;for(let u=0;u<this.cells.length;u++)Vt+=this.cells[u].length;const Wt=new Int32Array(F+Vt+this.keys.length+this.bboxes.length);Wt[0]=this.extent,Wt[1]=this.n,Wt[2]=this.padding;let Kt=F;for(let F=0;F<u.length;F++){const Vt=u[F];Wt[3+F]=Kt,Wt.set(Vt,Kt),Kt+=Vt.length}return Wt[3+u.length]=Kt,Wt.set(this.keys,Kt),Kt+=this.keys.length,Wt[3+u.length+1]=Kt,Wt.set(this.bboxes,Kt),Kt+=this.bboxes.length,Wt.buffer}static serialize(u,F){const Vt=u.toArrayBuffer();return F&&F.push(Vt),{buffer:Vt}}static deserialize(u){return new vi(u.buffer)}}const pc={};function wi(u,F,Vt={}){if(pc[u])throw new Error(`${u} is already registered.`);Object.defineProperty(F,"_classRegistryKey",{value:u,writeable:!1}),pc[u]={klass:F,omit:Vt.omit||[],shallow:Vt.shallow||[]}}wi("Object",Object),wi("TransferableGridIndex",vi),wi("Color",Gt),wi("Error",Error),wi("AJAXError",L),wi("ResolvedImage",te),wi("StylePropertyFunction",kn),wi("StyleExpression",vn,{omit:["_evaluator"]}),wi("ZoomDependentExpression",An),wi("ZoomConstantExpression",_n),wi("CompoundExpression",Xr,{omit:["_evaluate"]});for(const u in Xl)Xl[u]._classRegistryKey||wi(`Expression_${u}`,Xl[u]);function _i(u){return u&&"undefined"!=typeof ArrayBuffer&&(u instanceof ArrayBuffer||u.constructor&&"ArrayBuffer"===u.constructor.name)}function Ai(u,F){if(null==u||"boolean"==typeof u||"number"==typeof u||"string"==typeof u||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(_i(u))return F&&F.push(u),u;if(I(u))return F&&F.push(u),u;if(ArrayBuffer.isView(u)){const Vt=u;return F&&F.push(Vt.buffer),Vt}if(u instanceof ImageData)return F&&F.push(u.data.buffer),u;if(Array.isArray(u)){const Vt=[];for(const Wt of u)Vt.push(Ai(Wt,F));return Vt}if("object"==typeof u){const Vt=u.constructor,Wt=Vt._classRegistryKey;if(!Wt)throw new Error(`can't serialize object of unregistered class ${Vt.name}`);if(!pc[Wt])throw new Error(`${Wt} is not registered.`);const Kt=Vt.serialize?Vt.serialize(u,F):{};if(Vt.serialize){if(F&&Kt===F[F.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Vt in u){if(!u.hasOwnProperty(Vt))continue;if(pc[Wt].omit.indexOf(Vt)>=0)continue;const Qi=u[Vt];Kt[Vt]=pc[Wt].shallow.indexOf(Vt)>=0?Qi:Ai(Qi,F)}u instanceof Error&&(Kt.message=u.message)}if(Kt.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==Wt&&(Kt.$name=Wt),Kt}throw new Error("can't serialize object of type "+typeof u)}function Si(u){if(null==u||"boolean"==typeof u||"number"==typeof u||"string"==typeof u||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||_i(u)||I(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Si);if("object"==typeof u){const F=u.$name||"Object";if(!pc[F])throw new Error(`can't deserialize unregistered class ${F}`);const{klass:Vt}=pc[F];if(!Vt)throw new Error(`can't deserialize unregistered class ${F}`);if(Vt.deserialize)return Vt.deserialize(u);const Wt=Object.create(Vt.prototype);for(const Vt of Object.keys(u)){if("$name"===Vt)continue;const Kt=u[Vt];Wt[Vt]=pc[F].shallow.indexOf(Vt)>=0?Kt:Si(Kt)}return Wt}throw new Error("can't deserialize object of type "+typeof u)}class ki{constructor(){this.first=!0}update(u,F){const Vt=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=Vt,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=Vt,!0):(this.lastFloorZoom>Vt?(this.lastIntegerZoom=Vt+1,this.lastIntegerZoomTime=F):this.lastFloorZoom<Vt&&(this.lastIntegerZoom=Vt,this.lastIntegerZoomTime=F),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=Vt,!0))}}const mc={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Ii(u){for(const F of u)if(Bi(F.charCodeAt(0)))return!0;return!1}function zi(u){for(const F of u)if(!Pi(F.charCodeAt(0)))return!1;return!0}function Pi(u){return!(mc.Arabic(u)||mc["Arabic Supplement"](u)||mc["Arabic Extended-A"](u)||mc["Arabic Presentation Forms-A"](u)||mc["Arabic Presentation Forms-B"](u))}function Bi(u){return!(746!==u&&747!==u&&(u<4352||!(mc["Bopomofo Extended"](u)||mc.Bopomofo(u)||mc["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||mc["CJK Compatibility Ideographs"](u)||mc["CJK Compatibility"](u)||mc["CJK Radicals Supplement"](u)||mc["CJK Strokes"](u)||!(!mc["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||12336===u)||mc["CJK Unified Ideographs Extension A"](u)||mc["CJK Unified Ideographs"](u)||mc["Enclosed CJK Letters and Months"](u)||mc["Hangul Compatibility Jamo"](u)||mc["Hangul Jamo Extended-A"](u)||mc["Hangul Jamo Extended-B"](u)||mc["Hangul Jamo"](u)||mc["Hangul Syllables"](u)||mc.Hiragana(u)||mc["Ideographic Description Characters"](u)||mc.Kanbun(u)||mc["Kangxi Radicals"](u)||mc["Katakana Phonetic Extensions"](u)||mc.Katakana(u)&&12540!==u||!(!mc["Halfwidth and Fullwidth Forms"](u)||65288===u||65289===u||65293===u||u>=65306&&u<=65310||65339===u||65341===u||65343===u||u>=65371&&u<=65503||65507===u||u>=65512&&u<=65519)||!(!mc["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||mc["Unified Canadian Aboriginal Syllabics"](u)||mc["Unified Canadian Aboriginal Syllabics Extended"](u)||mc["Vertical Forms"](u)||mc["Yijing Hexagram Symbols"](u)||mc["Yi Syllables"](u)||mc["Yi Radicals"](u))))}function Ci(u){return!(Bi(u)||function(u){return!!(mc["Latin-1 Supplement"](u)&&(167===u||169===u||174===u||177===u||188===u||189===u||190===u||215===u||247===u)||mc["General Punctuation"](u)&&(8214===u||8224===u||8225===u||8240===u||8241===u||8251===u||8252===u||8258===u||8263===u||8264===u||8265===u||8273===u)||mc["Letterlike Symbols"](u)||mc["Number Forms"](u)||mc["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||9003===u||u>=9085&&u<=9114||u>=9150&&u<=9165||9167===u||u>=9169&&u<=9179||u>=9186&&u<=9215)||mc["Control Pictures"](u)&&9251!==u||mc["Optical Character Recognition"](u)||mc["Enclosed Alphanumerics"](u)||mc["Geometric Shapes"](u)||mc["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||mc["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||mc["CJK Symbols and Punctuation"](u)||mc.Katakana(u)||mc["Private Use Area"](u)||mc["CJK Compatibility Forms"](u)||mc["Small Form Variants"](u)||mc["Halfwidth and Fullwidth Forms"](u)||8734===u||8756===u||8757===u||u>=9984&&u<=10087||u>=10102&&u<=10131||65532===u||65533===u)}(u))}function Vi(u){return u>=1424&&u<=2303||mc["Arabic Presentation Forms-A"](u)||mc["Arabic Presentation Forms-B"](u)}function Ei(u,F){return!(!F&&Vi(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||mc.Khmer(u))}function Fi(u){for(const F of u)if(Vi(F.charCodeAt(0)))return!0;return!1}const yc=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class $i{constructor(u,F){this.zoom=u,F?(this.now=F.now,this.fadeDuration=F.fadeDuration,this.zoomHistory=F.zoomHistory,this.transition=F.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ki,this.transition={})}isSupportedScript(u){return function(u,F){for(const Vt of u)if(!Ei(Vt.charCodeAt(0),F))return!1;return!0}(u,"loaded"===yc.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,F=u-Math.floor(u),Vt=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:F+(1-F)*Vt}:{fromScale:.5,toScale:1,t:1-(1-Vt)*F}}}class Li{constructor(u,F){this.property=u,this.value=F,this.expression=function(u,F){if(hn(u))return new kn(u,F);if(bn(u)){const Vt=Sn(u,F);if("error"===Vt.result)throw new Error(Vt.value.map((u=>`${u.key}: ${u.message}`)).join(", "));return Vt.value}{let Vt=u;return"color"===F.type&&"string"==typeof u?Vt=Gt.parse(u):"padding"!==F.type||"number"!=typeof u&&!Array.isArray(u)?"variableAnchorOffsetCollection"===F.type&&Array.isArray(u)&&(Vt=Qt.parse(u)):Vt=Yt.parse(u),{kind:"constant",evaluate:()=>Vt}}}(void 0===F?u.specification.default:F,u.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(u,F,Vt){return this.property.possiblyEvaluate(this,u,F,Vt)}}class Di{constructor(u){this.property=u,this.value=new Li(u,void 0)}transitioned(u,F){return new Ri(this.property,this.value,F,g({},u.transition,this.transition),u.now)}untransitioned(){return new Ri(this.property,this.value,null,{},0)}}class Oi{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return w(this._values[u].value.value)}setValue(u,F){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Di(this._values[u].property)),this._values[u].value=new Li(this._values[u].property,null===F?void 0:w(F))}getTransition(u){return w(this._values[u].transition)}setTransition(u,F){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Di(this._values[u].property)),this._values[u].transition=w(F)||void 0}serialize(){const u={};for(const F of Object.keys(this._values)){const Vt=this.getValue(F);void 0!==Vt&&(u[F]=Vt);const Wt=this.getTransition(F);void 0!==Wt&&(u[`${F}-transition`]=Wt)}return u}transitioned(u,F){const Vt=new Ui(this._properties);for(const Wt of Object.keys(this._values))Vt._values[Wt]=this._values[Wt].transitioned(u,F._values[Wt]);return Vt}untransitioned(){const u=new Ui(this._properties);for(const F of Object.keys(this._values))u._values[F]=this._values[F].untransitioned();return u}}class Ri{constructor(u,F,Vt,Wt,Kt){this.property=u,this.value=F,this.begin=Kt+Wt.delay||0,this.end=this.begin+Wt.duration||0,u.specification.transition&&(Wt.delay||Wt.duration)&&(this.prior=Vt)}possiblyEvaluate(u,F,Vt){const Wt=u.now||0,Kt=this.value.possiblyEvaluate(u,F,Vt),Qi=this.prior;if(Qi){if(Wt>this.end)return this.prior=null,Kt;if(this.value.isDataDriven())return this.prior=null,Kt;if(Wt<this.begin)return Qi.possiblyEvaluate(u,F,Vt);{const fr=(Wt-this.begin)/(this.end-this.begin);return this.property.interpolate(Qi.possiblyEvaluate(u,F,Vt),Kt,function(u){if(u<=0)return 0;if(u>=1)return 1;const F=u*u,Vt=F*u;return 4*(u<.5?Vt:3*(u-F)+Vt-.75)}(fr))}}return Kt}}class Ui{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,F,Vt){const Wt=new Ni(this._properties);for(const Kt of Object.keys(this._values))Wt._values[Kt]=this._values[Kt].possiblyEvaluate(u,F,Vt);return Wt}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class ji{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return void 0!==this._values[u].value}getValue(u){return w(this._values[u].value)}setValue(u,F){this._values[u]=new Li(this._values[u].property,null===F?void 0:w(F))}serialize(){const u={};for(const F of Object.keys(this._values)){const Vt=this.getValue(F);void 0!==Vt&&(u[F]=Vt)}return u}possiblyEvaluate(u,F,Vt){const Wt=new Ni(this._properties);for(const Kt of Object.keys(this._values))Wt._values[Kt]=this._values[Kt].possiblyEvaluate(u,F,Vt);return Wt}}class qi{constructor(u,F,Vt){this.property=u,this.value=F,this.parameters=Vt}isConstant(){return"constant"===this.value.kind}constantOr(u){return"constant"===this.value.kind?this.value.value:u}evaluate(u,F,Vt,Wt){return this.property.evaluate(this.value,this.parameters,u,F,Vt,Wt)}}class Ni{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class Zi{constructor(u){this.specification=u}possiblyEvaluate(u,F){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(F)}interpolate(u,F,Vt){const Wt=zl[this.specification.type];return Wt?Wt(u,F,Vt):u}}class Ki{constructor(u,F){this.specification=u,this.overrides=F}possiblyEvaluate(u,F,Vt,Wt){return new qi(this,"constant"===u.expression.kind||"camera"===u.expression.kind?{kind:"constant",value:u.expression.evaluate(F,null,{},Vt,Wt)}:u.expression,F)}interpolate(u,F,Vt){if("constant"!==u.value.kind||"constant"!==F.value.kind)return u;if(void 0===u.value.value||void 0===F.value.value)return new qi(this,{kind:"constant",value:void 0},u.parameters);const Wt=zl[this.specification.type];if(Wt){const Kt=Wt(u.value.value,F.value.value,Vt);return new qi(this,{kind:"constant",value:Kt},u.parameters)}return u}evaluate(u,F,Vt,Wt,Kt,Qi){return"constant"===u.kind?u.value:u.evaluate(F,Vt,Wt,Kt,Qi)}}class Gi extends Ki{possiblyEvaluate(u,F,Vt,Wt){if(void 0===u.value)return new qi(this,{kind:"constant",value:void 0},F);if("constant"===u.expression.kind){const Kt=u.expression.evaluate(F,null,{},Vt,Wt),Qi="resolvedImage"===u.property.specification.type&&"string"!=typeof Kt?Kt.name:Kt,fr=this._calculate(Qi,Qi,Qi,F);return new qi(this,{kind:"constant",value:fr},F)}if("camera"===u.expression.kind){const Vt=this._calculate(u.expression.evaluate({zoom:F.zoom-1}),u.expression.evaluate({zoom:F.zoom}),u.expression.evaluate({zoom:F.zoom+1}),F);return new qi(this,{kind:"constant",value:Vt},F)}return new qi(this,u.expression,F)}evaluate(u,F,Vt,Wt,Kt,Qi){if("source"===u.kind){const fr=u.evaluate(F,Vt,Wt,Kt,Qi);return this._calculate(fr,fr,fr,F)}return"composite"===u.kind?this._calculate(u.evaluate({zoom:Math.floor(F.zoom)-1},Vt,Wt),u.evaluate({zoom:Math.floor(F.zoom)},Vt,Wt),u.evaluate({zoom:Math.floor(F.zoom)+1},Vt,Wt),F):u.value}_calculate(u,F,Vt,Wt){return Wt.zoom>Wt.zoomHistory.lastIntegerZoom?{from:u,to:F}:{from:Vt,to:F}}interpolate(u){return u}}class Ji{constructor(u){this.specification=u}possiblyEvaluate(u,F,Vt,Wt){if(void 0!==u.value){if("constant"===u.expression.kind){const Kt=u.expression.evaluate(F,null,{},Vt,Wt);return this._calculate(Kt,Kt,Kt,F)}return this._calculate(u.expression.evaluate(new $i(Math.floor(F.zoom-1),F)),u.expression.evaluate(new $i(Math.floor(F.zoom),F)),u.expression.evaluate(new $i(Math.floor(F.zoom+1),F)),F)}}_calculate(u,F,Vt,Wt){return Wt.zoom>Wt.zoomHistory.lastIntegerZoom?{from:u,to:F}:{from:Vt,to:F}}interpolate(u){return u}}class Xi{constructor(u){this.specification=u}possiblyEvaluate(u,F,Vt,Wt){return!!u.expression.evaluate(F,null,{},Vt,Wt)}interpolate(){return!1}}class Hi{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const F in u){const Vt=u[F];Vt.specification.overridable&&this.overridableProperties.push(F);const Wt=this.defaultPropertyValues[F]=new Li(Vt,void 0),Kt=this.defaultTransitionablePropertyValues[F]=new Di(Vt);this.defaultTransitioningPropertyValues[F]=Kt.untransitioned(),this.defaultPossiblyEvaluatedValues[F]=Wt.possiblyEvaluate({})}}}wi("DataDrivenProperty",Ki),wi("DataConstantProperty",Zi),wi("CrossFadedDataDrivenProperty",Gi),wi("CrossFadedProperty",Ji),wi("ColorRampProperty",Xi);const xc="-transition";class Wi extends Z{constructor(u,F){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==u.type&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,"background"!==u.type&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),F.layout&&(this._unevaluatedLayout=new ji(F.layout)),F.paint)){this._transitionablePaint=new Oi(F.paint);for(const F in u.paint)this.setPaintProperty(F,u.paint[F],{validate:!1});for(const F in u.layout)this.setLayoutProperty(F,u.layout[F],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ni(F.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return"visibility"===u?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,F,Vt={}){null!=F&&this._validate(hc,`layers.${this.id}.layout.${u}`,u,F,Vt)||("visibility"!==u?this._unevaluatedLayout.setValue(u,F):this.visibility=F)}getPaintProperty(u){return u.endsWith(xc)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,F,Vt={}){if(null!=F&&this._validate(cc,`layers.${this.id}.paint.${u}`,u,F,Vt))return!1;if(u.endsWith(xc))return this._transitionablePaint.setTransition(u.slice(0,-11),F||void 0),!1;{const Vt=this._transitionablePaint._values[u],Wt="cross-faded-data-driven"===Vt.property.specification["property-type"],Kt=Vt.value.isDataDriven(),Qi=Vt.value;this._transitionablePaint.setValue(u,F),this._handleSpecialPaintPropertyUpdate(u);const fr=this._transitionablePaint._values[u].value;return fr.isDataDriven()||Kt||Wt||this._handleOverridablePaintPropertyUpdate(u,Qi,fr)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,F,Vt){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||"none"===this.visibility}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,F){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,F)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,F)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),b(u,((u,F)=>!(void 0===u||"layout"===F&&!Object.keys(u).length||"paint"===F&&!Object.keys(u).length)))}_validate(u,F,Vt,Wt,Kt={}){return(!Kt||!1!==Kt.validate)&&xi(this,u.call(rc,{key:F,layerType:this.type,objectKey:Vt,value:Wt,styleSpec:Ya,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const F=this.paint.get(u);if(F instanceof qi&&on(F.property.specification)&&("source"===F.value.kind||"composite"===F.value.kind)&&F.value.isStateDependent)return!0}return!1}}const vc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ts{constructor(u,F){this._structArray=u,this._pos1=F*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class es{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,F){return u._trim(),F&&(u.isTransferred=!0,F.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const F=Object.create(this.prototype);return F.arrayBuffer=u.arrayBuffer,F.length=u.length,F.capacity=u.arrayBuffer.byteLength/F.bytesPerElement,F._refreshViews(),F}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const F=this.uint8;this._refreshViews(),F&&this.uint8.set(F)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function rs(u,F=1){let Vt=0,Wt=0;return{members:u.map((u=>{const Kt=vc[u.type].BYTES_PER_ELEMENT,Qi=Vt=ns(Vt,Math.max(F,Kt)),fr=u.components||1;return Wt=Math.max(Wt,Kt),Vt+=Kt*fr,{name:u.name,type:u.type,components:fr,offset:Qi}})),size:ns(Vt,Math.max(Wt,F)),alignment:F}}function ns(u,F){return Math.ceil(u/F)*F}class is extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,u,F)}emplace(u,F,Vt){const Wt=2*u;return this.int16[Wt+0]=F,this.int16[Wt+1]=Vt,u}}is.prototype.bytesPerElement=4,wi("StructArrayLayout2i4",is);class ss extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Vt){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F,Vt)}emplace(u,F,Vt,Wt){const Kt=3*u;return this.int16[Kt+0]=F,this.int16[Kt+1]=Vt,this.int16[Kt+2]=Wt,u}}ss.prototype.bytesPerElement=6,wi("StructArrayLayout3i6",ss);class as extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,u,F,Vt,Wt)}emplace(u,F,Vt,Wt,Kt){const Qi=4*u;return this.int16[Qi+0]=F,this.int16[Qi+1]=Vt,this.int16[Qi+2]=Wt,this.int16[Qi+3]=Kt,u}}as.prototype.bytesPerElement=8,wi("StructArrayLayout4i8",as);class os extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi){const fr=this.length;return this.resize(fr+1),this.emplace(fr,u,F,Vt,Wt,Kt,Qi)}emplace(u,F,Vt,Wt,Kt,Qi,fr){const _r=6*u;return this.int16[_r+0]=F,this.int16[_r+1]=Vt,this.int16[_r+2]=Wt,this.int16[_r+3]=Kt,this.int16[_r+4]=Qi,this.int16[_r+5]=fr,u}}os.prototype.bytesPerElement=12,wi("StructArrayLayout2i4i12",os);class ls extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi){const fr=this.length;return this.resize(fr+1),this.emplace(fr,u,F,Vt,Wt,Kt,Qi)}emplace(u,F,Vt,Wt,Kt,Qi,fr){const _r=4*u,Sr=8*u;return this.int16[_r+0]=F,this.int16[_r+1]=Vt,this.uint8[Sr+4]=Wt,this.uint8[Sr+5]=Kt,this.uint8[Sr+6]=Qi,this.uint8[Sr+7]=fr,u}}ls.prototype.bytesPerElement=8,wi("StructArrayLayout2i4ub8",ls);class us extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,u,F)}emplace(u,F,Vt){const Wt=2*u;return this.float32[Wt+0]=F,this.float32[Wt+1]=Vt,u}}us.prototype.bytesPerElement=8,wi("StructArrayLayout2f8",us);class cs extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar){const Jr=this.length;return this.resize(Jr+1),this.emplace(Jr,u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar)}emplace(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr){const zn=10*u;return this.uint16[zn+0]=F,this.uint16[zn+1]=Vt,this.uint16[zn+2]=Wt,this.uint16[zn+3]=Kt,this.uint16[zn+4]=Qi,this.uint16[zn+5]=fr,this.uint16[zn+6]=_r,this.uint16[zn+7]=Sr,this.uint16[zn+8]=Ar,this.uint16[zn+9]=Jr,u}}cs.prototype.bytesPerElement=20,wi("StructArrayLayout10ui20",cs);class hs extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn){const Qs=this.length;return this.resize(Qs+1),this.emplace(Qs,u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn)}emplace(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs){const ta=12*u;return this.int16[ta+0]=F,this.int16[ta+1]=Vt,this.int16[ta+2]=Wt,this.int16[ta+3]=Kt,this.uint16[ta+4]=Qi,this.uint16[ta+5]=fr,this.uint16[ta+6]=_r,this.uint16[ta+7]=Sr,this.int16[ta+8]=Ar,this.int16[ta+9]=Jr,this.int16[ta+10]=zn,this.int16[ta+11]=Qs,u}}hs.prototype.bytesPerElement=24,wi("StructArrayLayout4i4ui4i24",hs);class ps extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Vt){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F,Vt)}emplace(u,F,Vt,Wt){const Kt=3*u;return this.float32[Kt+0]=F,this.float32[Kt+1]=Vt,this.float32[Kt+2]=Wt,u}}ps.prototype.bytesPerElement=12,wi("StructArrayLayout3f12",ps);class fs extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const F=this.length;return this.resize(F+1),this.emplace(F,u)}emplace(u,F){return this.uint32[1*u+0]=F,u}}fs.prototype.bytesPerElement=4,wi("StructArrayLayout1ul4",fs);class ds extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){const Ar=this.length;return this.resize(Ar+1),this.emplace(Ar,u,F,Vt,Wt,Kt,Qi,fr,_r,Sr)}emplace(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar){const Jr=10*u,zn=5*u;return this.int16[Jr+0]=F,this.int16[Jr+1]=Vt,this.int16[Jr+2]=Wt,this.int16[Jr+3]=Kt,this.int16[Jr+4]=Qi,this.int16[Jr+5]=fr,this.uint32[zn+3]=_r,this.uint16[Jr+8]=Sr,this.uint16[Jr+9]=Ar,u}}ds.prototype.bytesPerElement=20,wi("StructArrayLayout6i1ul2ui20",ds);class ys extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi){const fr=this.length;return this.resize(fr+1),this.emplace(fr,u,F,Vt,Wt,Kt,Qi)}emplace(u,F,Vt,Wt,Kt,Qi,fr){const _r=6*u;return this.int16[_r+0]=F,this.int16[_r+1]=Vt,this.int16[_r+2]=Wt,this.int16[_r+3]=Kt,this.int16[_r+4]=Qi,this.int16[_r+5]=fr,u}}ys.prototype.bytesPerElement=12,wi("StructArrayLayout2i2i2i12",ys);class ms extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt){const Qi=this.length;return this.resize(Qi+1),this.emplace(Qi,u,F,Vt,Wt,Kt)}emplace(u,F,Vt,Wt,Kt,Qi){const fr=4*u,_r=8*u;return this.float32[fr+0]=F,this.float32[fr+1]=Vt,this.float32[fr+2]=Wt,this.int16[_r+6]=Kt,this.int16[_r+7]=Qi,u}}ms.prototype.bytesPerElement=16,wi("StructArrayLayout2f1f2i16",ms);class gs extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi){const fr=this.length;return this.resize(fr+1),this.emplace(fr,u,F,Vt,Wt,Kt,Qi)}emplace(u,F,Vt,Wt,Kt,Qi,fr){const _r=16*u,Sr=4*u,Ar=8*u;return this.uint8[_r+0]=F,this.uint8[_r+1]=Vt,this.float32[Sr+1]=Wt,this.float32[Sr+2]=Kt,this.int16[Ar+6]=Qi,this.int16[Ar+7]=fr,u}}gs.prototype.bytesPerElement=16,wi("StructArrayLayout2ub2f2i16",gs);class xs extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Vt){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F,Vt)}emplace(u,F,Vt,Wt){const Kt=3*u;return this.uint16[Kt+0]=F,this.uint16[Kt+1]=Vt,this.uint16[Kt+2]=Wt,u}}xs.prototype.bytesPerElement=6,wi("StructArrayLayout3ui6",xs);class vs extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va){const Ba=this.length;return this.resize(Ba+1),this.emplace(Ba,u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va)}emplace(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va,Ba){const Ya=24*u,to=12*u,eo=48*u;return this.int16[Ya+0]=F,this.int16[Ya+1]=Vt,this.uint16[Ya+2]=Wt,this.uint16[Ya+3]=Kt,this.uint32[to+2]=Qi,this.uint32[to+3]=fr,this.uint32[to+4]=_r,this.uint16[Ya+10]=Sr,this.uint16[Ya+11]=Ar,this.uint16[Ya+12]=Jr,this.float32[to+7]=zn,this.float32[to+8]=Qs,this.uint8[eo+36]=ta,this.uint8[eo+37]=ia,this.uint8[eo+38]=aa,this.uint32[to+10]=va,this.int16[Ya+22]=Ba,u}}vs.prototype.bytesPerElement=48,wi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vs);class bs extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va,Ba,Ya,to,eo,io,so,co,ho,bo,wo,So){const Ao=this.length;return this.resize(Ao+1),this.emplace(Ao,u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va,Ba,Ya,to,eo,io,so,co,ho,bo,wo,So)}emplace(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va,Ba,Ya,to,eo,io,so,co,ho,bo,wo,So,Ao){const ko=32*u,Wo=16*u;return this.int16[ko+0]=F,this.int16[ko+1]=Vt,this.int16[ko+2]=Wt,this.int16[ko+3]=Kt,this.int16[ko+4]=Qi,this.int16[ko+5]=fr,this.int16[ko+6]=_r,this.int16[ko+7]=Sr,this.uint16[ko+8]=Ar,this.uint16[ko+9]=Jr,this.uint16[ko+10]=zn,this.uint16[ko+11]=Qs,this.uint16[ko+12]=ta,this.uint16[ko+13]=ia,this.uint16[ko+14]=aa,this.uint16[ko+15]=va,this.uint16[ko+16]=Ba,this.uint16[ko+17]=Ya,this.uint16[ko+18]=to,this.uint16[ko+19]=eo,this.uint16[ko+20]=io,this.uint16[ko+21]=so,this.uint16[ko+22]=co,this.uint32[Wo+12]=ho,this.float32[Wo+13]=bo,this.float32[Wo+14]=wo,this.uint16[ko+30]=So,this.uint16[ko+31]=Ao,u}}bs.prototype.bytesPerElement=64,wi("StructArrayLayout8i15ui1ul2f2ui64",bs);class ws extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const F=this.length;return this.resize(F+1),this.emplace(F,u)}emplace(u,F){return this.float32[1*u+0]=F,u}}ws.prototype.bytesPerElement=4,wi("StructArrayLayout1f4",ws);class _s extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Vt){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F,Vt)}emplace(u,F,Vt,Wt){const Kt=3*u;return this.uint16[6*u+0]=F,this.float32[Kt+1]=Vt,this.float32[Kt+2]=Wt,u}}_s.prototype.bytesPerElement=12,wi("StructArrayLayout1ui2f12",_s);class As extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F,Vt){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,u,F,Vt)}emplace(u,F,Vt,Wt){const Kt=4*u;return this.uint32[2*u+0]=F,this.uint16[Kt+2]=Vt,this.uint16[Kt+3]=Wt,u}}As.prototype.bytesPerElement=8,wi("StructArrayLayout1ul2ui8",As);class Ss extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,F){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,u,F)}emplace(u,F,Vt){const Wt=2*u;return this.uint16[Wt+0]=F,this.uint16[Wt+1]=Vt,u}}Ss.prototype.bytesPerElement=4,wi("StructArrayLayout2ui4",Ss);class ks extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const F=this.length;return this.resize(F+1),this.emplace(F,u)}emplace(u,F){return this.uint16[1*u+0]=F,u}}ks.prototype.bytesPerElement=2,wi("StructArrayLayout1ui2",ks);class Ms extends es{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,F,Vt,Wt){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,u,F,Vt,Wt)}emplace(u,F,Vt,Wt,Kt){const Qi=4*u;return this.float32[Qi+0]=F,this.float32[Qi+1]=Vt,this.float32[Qi+2]=Wt,this.float32[Qi+3]=Kt,u}}Ms.prototype.bytesPerElement=16,wi("StructArrayLayout4f16",Ms);class Is extends ts{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Wt(this.anchorPointX,this.anchorPointY)}}Is.prototype.size=20;class zs extends ds{get(u){return new Is(this,u)}}wi("CollisionBoxArray",zs);class Ps extends ts{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ps.prototype.size=48;class Bs extends vs{get(u){return new Ps(this,u)}}wi("PlacedSymbolArray",Bs);class Cs extends ts{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Cs.prototype.size=64;class Vs extends bs{get(u){return new Cs(this,u)}}wi("SymbolInstanceArray",Vs);class Es extends ws{getoffsetX(u){return this.float32[1*u+0]}}wi("GlyphOffsetArray",Es);class Fs extends ss{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}wi("SymbolLineVertexArray",Fs);class Ts extends ts{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ts.prototype.size=12;class $s extends _s{get(u){return new Ts(this,u)}}wi("TextAnchorOffsetArray",$s);class Ls extends ts{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ls.prototype.size=8;class Ds extends As{get(u){return new Ls(this,u)}}wi("FeatureIndexArray",Ds);class Os extends is{}class Rs extends is{}class Us extends is{}class js extends os{}class qs extends ls{}class Ns extends us{}class Zs extends cs{}class Ks extends hs{}class Gs extends ps{}class Js extends fs{}class Xs extends ys{}class Hs extends gs{}class Ys extends xs{}class Ws extends Ss{}const Ac=rs([{name:"a_pos",components:2,type:"Int16"}],4),{members:kc}=Ac;class ea{constructor(u=[]){this.segments=u}prepareSegment(u,F,Vt,Wt){let Kt=this.segments[this.segments.length-1];return u>ea.MAX_VERTEX_ARRAY_LENGTH&&A(`Max vertices per segment is ${ea.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!Kt||Kt.vertexLength+u>ea.MAX_VERTEX_ARRAY_LENGTH||Kt.sortKey!==Wt)&&(Kt={vertexOffset:F.length,primitiveOffset:Vt.length,vertexLength:0,primitiveLength:0},void 0!==Wt&&(Kt.sortKey=Wt),this.segments.push(Kt)),Kt}get(){return this.segments}destroy(){for(const u of this.segments)for(const F in u.vaos)u.vaos[F].destroy()}static simpleSegment(u,F,Vt,Wt){return new ea([{vertexOffset:u,primitiveOffset:F,vertexLength:Vt,primitiveLength:Wt,vaos:{},sortKey:0}])}}function ra(u,F){return 256*(u=y(Math.floor(u),0,255))+y(Math.floor(F),0,255)}ea.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wi("SegmentVector",ea);const Qc=rs([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hh={exports:{}},ph={exports:{}};ph.exports=function(u,F){var Vt,Wt,Kt,Qi,fr,_r,Sr,Ar;for(Wt=u.length-(Vt=3&u.length),Kt=F,fr=3432918353,_r=461845907,Ar=0;Ar<Wt;)Sr=255&u.charCodeAt(Ar)|(255&u.charCodeAt(++Ar))<<8|(255&u.charCodeAt(++Ar))<<16|(255&u.charCodeAt(++Ar))<<24,++Ar,Kt=27492+(65535&(Qi=5*(65535&(Kt=(Kt^=Sr=(65535&(Sr=(Sr=(65535&Sr)*fr+(((Sr>>>16)*fr&65535)<<16)&4294967295)<<15|Sr>>>17))*_r+(((Sr>>>16)*_r&65535)<<16)&4294967295)<<13|Kt>>>19))+((5*(Kt>>>16)&65535)<<16)&4294967295))+((58964+(Qi>>>16)&65535)<<16);switch(Sr=0,Vt){case 3:Sr^=(255&u.charCodeAt(Ar+2))<<16;case 2:Sr^=(255&u.charCodeAt(Ar+1))<<8;case 1:Kt^=Sr=(65535&(Sr=(Sr=(65535&(Sr^=255&u.charCodeAt(Ar)))*fr+(((Sr>>>16)*fr&65535)<<16)&4294967295)<<15|Sr>>>17))*_r+(((Sr>>>16)*_r&65535)<<16)&4294967295}return Kt^=u.length,Kt=2246822507*(65535&(Kt^=Kt>>>16))+((2246822507*(Kt>>>16)&65535)<<16)&4294967295,Kt=3266489909*(65535&(Kt^=Kt>>>13))+((3266489909*(Kt>>>16)&65535)<<16)&4294967295,(Kt^=Kt>>>16)>>>0};var fh=ph.exports,wh={exports:{}};wh.exports=function(u,F){for(var Vt,Wt=u.length,Kt=F^Wt,Qi=0;Wt>=4;)Vt=1540483477*(65535&(Vt=255&u.charCodeAt(Qi)|(255&u.charCodeAt(++Qi))<<8|(255&u.charCodeAt(++Qi))<<16|(255&u.charCodeAt(++Qi))<<24))+((1540483477*(Vt>>>16)&65535)<<16),Kt=1540483477*(65535&Kt)+((1540483477*(Kt>>>16)&65535)<<16)^(Vt=1540483477*(65535&(Vt^=Vt>>>24))+((1540483477*(Vt>>>16)&65535)<<16)),Wt-=4,++Qi;switch(Wt){case 3:Kt^=(255&u.charCodeAt(Qi+2))<<16;case 2:Kt^=(255&u.charCodeAt(Qi+1))<<8;case 1:Kt=1540483477*(65535&(Kt^=255&u.charCodeAt(Qi)))+((1540483477*(Kt>>>16)&65535)<<16)}return Kt=1540483477*(65535&(Kt^=Kt>>>13))+((1540483477*(Kt>>>16)&65535)<<16),(Kt^=Kt>>>15)>>>0};var Th=fh,Ph=wh.exports;hh.exports=Th,hh.exports.murmur3=Th,hh.exports.murmur2=Ph;var Ch=r(hh.exports);class ha{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,F,Vt,Wt){this.ids.push(pa(u)),this.positions.push(F,Vt,Wt)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const F=pa(u);let Vt=0,Wt=this.ids.length-1;for(;Vt<Wt;){const u=Vt+Wt>>1;this.ids[u]>=F?Wt=u:Vt=u+1}const Kt=[];for(;this.ids[Vt]===F;)Kt.push({index:this.positions[3*Vt],start:this.positions[3*Vt+1],end:this.positions[3*Vt+2]}),Vt++;return Kt}static serialize(u,F){const Vt=new Float64Array(u.ids),Wt=new Uint32Array(u.positions);return fa(Vt,Wt,0,Vt.length-1),F&&F.push(Vt.buffer,Wt.buffer),{ids:Vt,positions:Wt}}static deserialize(u){const F=new ha;return F.ids=u.ids,F.positions=u.positions,F.indexed=!0,F}}function pa(u){const F=+u;return!isNaN(F)&&F<=Number.MAX_SAFE_INTEGER?F:Ch(String(u))}function fa(u,F,Vt,Wt){for(;Vt<Wt;){const Kt=u[Vt+Wt>>1];let Qi=Vt-1,fr=Wt+1;for(;;){do{Qi++}while(u[Qi]<Kt);do{fr--}while(u[fr]>Kt);if(Qi>=fr)break;da(u,Qi,fr),da(F,3*Qi,3*fr),da(F,3*Qi+1,3*fr+1),da(F,3*Qi+2,3*fr+2)}fr-Vt<Wt-fr?(fa(u,F,Vt,fr),Vt=fr+1):(fa(u,F,fr+1,Wt),Wt=fr)}}function da(u,F,Vt){const Wt=u[F];u[F]=u[Vt],u[Vt]=Wt}wi("FeaturePositionMap",ha);class ya{constructor(u,F){this.gl=u.gl,this.location=F}}class ma extends ya{constructor(u,F){super(u,F),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ga extends ya{constructor(u,F){super(u,F),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class xa extends ya{constructor(u,F){super(u,F),this.current=Gt.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const Eh=new Float32Array(16);function ba(u){return[ra(255*u.r,255*u.g),ra(255*u.b,255*u.a)]}class wa{constructor(u,F,Vt){this.value=u,this.uniformNames=F.map((u=>`u_${u}`)),this.type=Vt}setUniform(u,F,Vt){u.set(Vt.constantOr(this.value))}getBinding(u,F,Vt){return"color"===this.type?new xa(u,F):new ma(u,F)}}class _a{constructor(u,F){this.uniformNames=F.map((u=>`u_${u}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,F){this.pixelRatioFrom=F.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=F.tlbr,this.patternTo=u.tlbr}setUniform(u,F,Vt,Wt){const Kt="u_pattern_to"===Wt?this.patternTo:"u_pattern_from"===Wt?this.patternFrom:"u_pixel_ratio_to"===Wt?this.pixelRatioTo:"u_pixel_ratio_from"===Wt?this.pixelRatioFrom:null;Kt&&u.set(Kt)}getBinding(u,F,Vt){return"u_pattern"===Vt.substr(0,9)?new ga(u,F):new ma(u,F)}}class Aa{constructor(u,F,Vt,Wt){this.expression=u,this.type=Vt,this.maxValue=0,this.paintVertexAttributes=F.map((u=>({name:`a_${u}`,type:"Float32",components:"color"===Vt?2:1,offset:0}))),this.paintVertexArray=new Wt}populatePaintArray(u,F,Vt,Wt,Kt){const Qi=this.paintVertexArray.length,fr=this.expression.evaluate(new $i(0),F,{},Wt,[],Kt);this.paintVertexArray.resize(u),this._setPaintValue(Qi,u,fr)}updatePaintArray(u,F,Vt,Wt){const Kt=this.expression.evaluate({zoom:0},Vt,Wt);this._setPaintValue(u,F,Kt)}_setPaintValue(u,F,Vt){if("color"===this.type){const Wt=ba(Vt);for(let Vt=u;Vt<F;Vt++)this.paintVertexArray.emplace(Vt,Wt[0],Wt[1])}else{for(let Wt=u;Wt<F;Wt++)this.paintVertexArray.emplace(Wt,Vt);this.maxValue=Math.max(this.maxValue,Math.abs(Vt))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sa{constructor(u,F,Vt,Wt,Kt,Qi){this.expression=u,this.uniformNames=F.map((u=>`u_${u}_t`)),this.type=Vt,this.useIntegerZoom=Wt,this.zoom=Kt,this.maxValue=0,this.paintVertexAttributes=F.map((u=>({name:`a_${u}`,type:"Float32",components:"color"===Vt?4:2,offset:0}))),this.paintVertexArray=new Qi}populatePaintArray(u,F,Vt,Wt,Kt){const Qi=this.expression.evaluate(new $i(this.zoom),F,{},Wt,[],Kt),fr=this.expression.evaluate(new $i(this.zoom+1),F,{},Wt,[],Kt),_r=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(_r,u,Qi,fr)}updatePaintArray(u,F,Vt,Wt){const Kt=this.expression.evaluate({zoom:this.zoom},Vt,Wt),Qi=this.expression.evaluate({zoom:this.zoom+1},Vt,Wt);this._setPaintValue(u,F,Kt,Qi)}_setPaintValue(u,F,Vt,Wt){if("color"===this.type){const Kt=ba(Vt),Qi=ba(Wt);for(let Vt=u;Vt<F;Vt++)this.paintVertexArray.emplace(Vt,Kt[0],Kt[1],Qi[0],Qi[1])}else{for(let Kt=u;Kt<F;Kt++)this.paintVertexArray.emplace(Kt,Vt,Wt);this.maxValue=Math.max(this.maxValue,Math.abs(Vt),Math.abs(Wt))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,F){const Vt=this.useIntegerZoom?Math.floor(F.zoom):F.zoom,Wt=y(this.expression.interpolationFactor(Vt,this.zoom,this.zoom+1),0,1);u.set(Wt)}getBinding(u,F,Vt){return new ma(u,F)}}class ka{constructor(u,F,Vt,Wt,Kt,Qi){this.expression=u,this.type=F,this.useIntegerZoom=Vt,this.zoom=Wt,this.layerId=Qi,this.zoomInPaintVertexArray=new Kt,this.zoomOutPaintVertexArray=new Kt}populatePaintArray(u,F,Vt){const Wt=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(Wt,u,F.patterns&&F.patterns[this.layerId],Vt)}updatePaintArray(u,F,Vt,Wt,Kt){this._setPaintValues(u,F,Vt.patterns&&Vt.patterns[this.layerId],Kt)}_setPaintValues(u,F,Vt,Wt){if(!Wt||!Vt)return;const{min:Kt,mid:Qi,max:fr}=Vt,_r=Wt[Kt],Sr=Wt[Qi],Ar=Wt[fr];if(_r&&Sr&&Ar)for(let Vt=u;Vt<F;Vt++)this.zoomInPaintVertexArray.emplace(Vt,Sr.tl[0],Sr.tl[1],Sr.br[0],Sr.br[1],_r.tl[0],_r.tl[1],_r.br[0],_r.br[1],Sr.pixelRatio,_r.pixelRatio),this.zoomOutPaintVertexArray.emplace(Vt,Sr.tl[0],Sr.tl[1],Sr.br[0],Sr.br[1],Ar.tl[0],Ar.tl[1],Ar.br[0],Ar.br[1],Sr.pixelRatio,Ar.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,Qc.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,Qc.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ma{constructor(u,F,Vt){this.binders={},this._buffers=[];const Wt=[];for(const Kt in u.paint._values){if(!Vt(Kt))continue;const Qi=u.paint.get(Kt);if(!(Qi instanceof qi&&on(Qi.property.specification)))continue;const fr=za(Kt,u.type),_r=Qi.value,Sr=Qi.property.specification.type,Ar=Qi.property.useIntegerZoom,Jr=Qi.property.specification["property-type"],zn="cross-faded"===Jr||"cross-faded-data-driven"===Jr;if("constant"===_r.kind)this.binders[Kt]=zn?new _a(_r.value,fr):new wa(_r.value,fr,Sr),Wt.push(`/u_${Kt}`);else if("source"===_r.kind||zn){const Vt=Pa(Kt,Sr,"source");this.binders[Kt]=zn?new ka(_r,Sr,Ar,F,Vt,u.id):new Aa(_r,fr,Sr,Vt),Wt.push(`/a_${Kt}`)}else{const u=Pa(Kt,Sr,"composite");this.binders[Kt]=new Sa(_r,fr,Sr,Ar,F,u),Wt.push(`/z_${Kt}`)}}this.cacheKey=Wt.sort().join("")}getMaxValue(u){const F=this.binders[u];return F instanceof Aa||F instanceof Sa?F.maxValue:0}populatePaintArrays(u,F,Vt,Wt,Kt){for(const Qi in this.binders){const fr=this.binders[Qi];(fr instanceof Aa||fr instanceof Sa||fr instanceof ka)&&fr.populatePaintArray(u,F,Vt,Wt,Kt)}}setConstantPatternPositions(u,F){for(const Vt in this.binders){const Wt=this.binders[Vt];Wt instanceof _a&&Wt.setConstantPatternPositions(u,F)}}updatePaintArrays(u,F,Vt,Wt,Kt){let Qi=!1;for(const fr in u){const _r=F.getPositions(fr);for(const F of _r){const _r=Vt.feature(F.index);for(const Vt in this.binders){const Sr=this.binders[Vt];if((Sr instanceof Aa||Sr instanceof Sa||Sr instanceof ka)&&!0===Sr.expression.isStateDependent){const Ar=Wt.paint.get(Vt);Sr.expression=Ar.value,Sr.updatePaintArray(F.start,F.end,_r,u[fr],Kt),Qi=!0}}}}return Qi}defines(){const u=[];for(const F in this.binders){const Vt=this.binders[F];(Vt instanceof wa||Vt instanceof _a)&&u.push(...Vt.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return u}getBinderAttributes(){const u=[];for(const F in this.binders){const Vt=this.binders[F];if(Vt instanceof Aa||Vt instanceof Sa)for(let F=0;F<Vt.paintVertexAttributes.length;F++)u.push(Vt.paintVertexAttributes[F].name);else if(Vt instanceof ka)for(let F=0;F<Qc.members.length;F++)u.push(Qc.members[F].name)}return u}getBinderUniforms(){const u=[];for(const F in this.binders){const Vt=this.binders[F];if(Vt instanceof wa||Vt instanceof _a||Vt instanceof Sa)for(const F of Vt.uniformNames)u.push(F)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,F){const Vt=[];for(const Wt in this.binders){const Kt=this.binders[Wt];if(Kt instanceof wa||Kt instanceof _a||Kt instanceof Sa)for(const Qi of Kt.uniformNames)if(F[Qi]){const fr=Kt.getBinding(u,F[Qi],Qi);Vt.push({name:Qi,property:Wt,binding:fr})}}return Vt}setUniforms(u,F,Vt,Wt){for(const{name:u,property:Kt,binding:Qi}of F)this.binders[Kt].setUniform(Qi,Wt,Vt.get(Kt),u)}updatePaintBuffers(u){this._buffers=[];for(const F in this.binders){const Vt=this.binders[F];if(u&&Vt instanceof ka){const F=2===u.fromScale?Vt.zoomInPaintVertexBuffer:Vt.zoomOutPaintVertexBuffer;F&&this._buffers.push(F)}else(Vt instanceof Aa||Vt instanceof Sa)&&Vt.paintVertexBuffer&&this._buffers.push(Vt.paintVertexBuffer)}}upload(u){for(const F in this.binders){const Vt=this.binders[F];(Vt instanceof Aa||Vt instanceof Sa||Vt instanceof ka)&&Vt.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const F=this.binders[u];(F instanceof Aa||F instanceof Sa||F instanceof ka)&&F.destroy()}}}class Ia{constructor(u,F,Vt=(()=>!0)){this.programConfigurations={};for(const Wt of u)this.programConfigurations[Wt.id]=new Ma(Wt,F,Vt);this.needsUpload=!1,this._featureMap=new ha,this._bufferOffset=0}populatePaintArrays(u,F,Vt,Wt,Kt,Qi){for(const Vt in this.programConfigurations)this.programConfigurations[Vt].populatePaintArrays(u,F,Wt,Kt,Qi);void 0!==F.id&&this._featureMap.add(F.id,Vt,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,F,Vt,Wt){for(const Kt of Vt)this.needsUpload=this.programConfigurations[Kt.id].updatePaintArrays(u,this._featureMap,F,Kt,Wt)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const F in this.programConfigurations)this.programConfigurations[F].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function za(u,F){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${F}-`,"").replace(/-/g,"_")]}function Pa(u,F,Vt){const Wt={color:{source:us,composite:Ms},number:{source:ws,composite:us}},Kt=function(u){return{"line-pattern":{source:Zs,composite:Zs},"fill-pattern":{source:Zs,composite:Zs},"fill-extrusion-pattern":{source:Zs,composite:Zs}}[u]}(u);return Kt&&Kt[Vt]||Wt[F][Vt]}wi("ConstantBinder",wa),wi("CrossFadedConstantBinder",_a),wi("SourceExpressionBinder",Aa),wi("CrossFadedCompositeBinder",ka),wi("CompositeExpressionBinder",Sa),wi("ProgramConfiguration",Ma,{omit:["_buffers"]}),wi("ProgramConfigurationSet",Ia);const zh=8192,Dh=Math.pow(2,14)-1,Lh=-Dh-1;function Ea(u){const F=zh/u.extent,Vt=u.loadGeometry();for(let u=0;u<Vt.length;u++){const Wt=Vt[u];for(let u=0;u<Wt.length;u++){const Vt=Wt[u],Kt=Math.round(Vt.x*F),Qi=Math.round(Vt.y*F);Vt.x=y(Kt,Lh,Dh),Vt.y=y(Qi,Lh,Dh),(Kt<Vt.x||Kt>Vt.x+1||Qi<Vt.y||Qi>Vt.y+1)&&A("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return Vt}function Fa(u,F){return{type:u.type,id:u.id,properties:u.properties,geometry:F?Ea(u):[]}}function Ta(u,F,Vt,Wt,Kt){u.emplaceBack(2*F+(Wt+1)/2,2*Vt+(Kt+1)/2)}class $a{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Rs,this.indexArray=new Ys,this.segments=new ea,this.programConfigurations=new Ia(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Vt){const Wt=this.layers[0],Kt=[];let Qi=null,fr=!1;"circle"===Wt.type&&(Qi=Wt.layout.get("circle-sort-key"),fr=!Qi.isConstant());for(const{feature:F,id:Wt,index:_r,sourceLayerIndex:Sr}of u){const u=this.layers[0]._featureFilter.needGeometry,Ar=Fa(F,u);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),Ar,Vt))continue;const Jr=fr?Qi.evaluate(Ar,{},Vt):void 0,zn={id:Wt,properties:F.properties,type:F.type,sourceLayerIndex:Sr,index:_r,geometry:u?Ar.geometry:Ea(F),patterns:{},sortKey:Jr};Kt.push(zn)}fr&&Kt.sort(((u,F)=>u.sortKey-F.sortKey));for(const Wt of Kt){const{geometry:Kt,index:Qi,sourceLayerIndex:fr}=Wt,_r=u[Qi].feature;this.addFeature(Wt,Kt,Qi,Vt),F.featureIndex.insert(_r,Kt,Qi,fr,this.index)}}update(u,F,Vt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Vt)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,kc),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,F,Vt,Wt){for(const Vt of F)for(const F of Vt){const Vt=F.x,Wt=F.y;if(Vt<0||Vt>=zh||Wt<0||Wt>=zh)continue;const Kt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),Qi=Kt.vertexLength;Ta(this.layoutVertexArray,Vt,Wt,-1,-1),Ta(this.layoutVertexArray,Vt,Wt,1,-1),Ta(this.layoutVertexArray,Vt,Wt,1,1),Ta(this.layoutVertexArray,Vt,Wt,-1,1),this.indexArray.emplaceBack(Qi,Qi+1,Qi+2),this.indexArray.emplaceBack(Qi,Qi+3,Qi+2),Kt.vertexLength+=4,Kt.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Vt,{},Wt)}}function La(u,F){for(let Vt=0;Vt<u.length;Vt++)if(Ka(F,u[Vt]))return!0;for(let Vt=0;Vt<F.length;Vt++)if(Ka(u,F[Vt]))return!0;return!!Ua(u,F)}function Da(u,F,Vt){return!!Ka(u,F)||!!qa(F,u,Vt)}function Oa(u,F){if(1===u.length)return Za(F,u[0]);for(let Vt=0;Vt<F.length;Vt++){const Wt=F[Vt];for(let F=0;F<Wt.length;F++)if(Ka(u,Wt[F]))return!0}for(let Vt=0;Vt<u.length;Vt++)if(Za(F,u[Vt]))return!0;for(let Vt=0;Vt<F.length;Vt++)if(Ua(u,F[Vt]))return!0;return!1}function Ra(u,F,Vt){if(u.length>1){if(Ua(u,F))return!0;for(let Wt=0;Wt<F.length;Wt++)if(qa(F[Wt],u,Vt))return!0}for(let Wt=0;Wt<u.length;Wt++)if(qa(u[Wt],F,Vt))return!0;return!1}function Ua(u,F){if(0===u.length||0===F.length)return!1;for(let Vt=0;Vt<u.length-1;Vt++){const Wt=u[Vt],Kt=u[Vt+1];for(let u=0;u<F.length-1;u++)if(ja(Wt,Kt,F[u],F[u+1]))return!0}return!1}function ja(u,F,Vt,Wt){return S(u,Vt,Wt)!==S(F,Vt,Wt)&&S(u,F,Vt)!==S(u,F,Wt)}function qa(u,F,Vt){const Wt=Vt*Vt;if(1===F.length)return u.distSqr(F[0])<Wt;for(let Vt=1;Vt<F.length;Vt++)if(Na(u,F[Vt-1],F[Vt])<Wt)return!0;return!1}function Na(u,F,Vt){const Wt=F.distSqr(Vt);if(0===Wt)return u.distSqr(F);const Kt=((u.x-F.x)*(Vt.x-F.x)+(u.y-F.y)*(Vt.y-F.y))/Wt;return u.distSqr(Kt<0?F:Kt>1?Vt:Vt.sub(F)._mult(Kt)._add(F))}function Za(u,F){let Vt,Wt,Kt,Qi=!1;for(let fr=0;fr<u.length;fr++){Vt=u[fr];for(let u=0,fr=Vt.length-1;u<Vt.length;fr=u++)Wt=Vt[u],Kt=Vt[fr],Wt.y>F.y!=Kt.y>F.y&&F.x<(Kt.x-Wt.x)*(F.y-Wt.y)/(Kt.y-Wt.y)+Wt.x&&(Qi=!Qi)}return Qi}function Ka(u,F){let Vt=!1;for(let Wt=0,Kt=u.length-1;Wt<u.length;Kt=Wt++){const Qi=u[Wt],fr=u[Kt];Qi.y>F.y!=fr.y>F.y&&F.x<(fr.x-Qi.x)*(F.y-Qi.y)/(fr.y-Qi.y)+Qi.x&&(Vt=!Vt)}return Vt}function Ga(u,F,Vt){const Wt=Vt[0],Kt=Vt[2];if(u.x<Wt.x&&F.x<Wt.x||u.x>Kt.x&&F.x>Kt.x||u.y<Wt.y&&F.y<Wt.y||u.y>Kt.y&&F.y>Kt.y)return!1;const Qi=S(u,F,Vt[0]);return Qi!==S(u,F,Vt[1])||Qi!==S(u,F,Vt[2])||Qi!==S(u,F,Vt[3])}function Ja(u,F,Vt){const Wt=F.paint.get(u).value;return"constant"===Wt.kind?Wt.value:Vt.programConfigurations.get(F.id).getMaxValue(u)}function Xa(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Ha(u,F,Vt,Kt,Qi){if(!F[0]&&!F[1])return u;const fr=Wt.convert(F)._mult(Qi);"viewport"===Vt&&fr._rotate(-Kt);const _r=[];for(let F=0;F<u.length;F++)_r.push(u[F].sub(fr));return _r}let Rh,Bh;wi("CircleBucket",$a,{omit:["layers"]});var Fh={get paint(){return Bh=Bh||new Hi({"circle-radius":new Ki(Ya.paint_circle["circle-radius"]),"circle-color":new Ki(Ya.paint_circle["circle-color"]),"circle-blur":new Ki(Ya.paint_circle["circle-blur"]),"circle-opacity":new Ki(Ya.paint_circle["circle-opacity"]),"circle-translate":new Zi(Ya.paint_circle["circle-translate"]),"circle-translate-anchor":new Zi(Ya.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Zi(Ya.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Zi(Ya.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ki(Ya.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ki(Ya.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ki(Ya.paint_circle["circle-stroke-opacity"])})},get layout(){return Rh=Rh||new Hi({"circle-sort-key":new Ki(Ya.layout_circle["circle-sort-key"])})}},Oh=1e-6,Vh="undefined"!=typeof Float32Array?Float32Array:Array;function ro(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function no(u,F,Vt){var Wt=F[0],Kt=F[1],Qi=F[2],fr=F[3],_r=F[4],Sr=F[5],Ar=F[6],Jr=F[7],zn=F[8],Qs=F[9],ta=F[10],ia=F[11],aa=F[12],va=F[13],Ba=F[14],Ya=F[15],to=Vt[0],eo=Vt[1],io=Vt[2],so=Vt[3];return u[0]=to*Wt+eo*_r+io*zn+so*aa,u[1]=to*Kt+eo*Sr+io*Qs+so*va,u[2]=to*Qi+eo*Ar+io*ta+so*Ba,u[3]=to*fr+eo*Jr+io*ia+so*Ya,u[4]=(to=Vt[4])*Wt+(eo=Vt[5])*_r+(io=Vt[6])*zn+(so=Vt[7])*aa,u[5]=to*Kt+eo*Sr+io*Qs+so*va,u[6]=to*Qi+eo*Ar+io*ta+so*Ba,u[7]=to*fr+eo*Jr+io*ia+so*Ya,u[8]=(to=Vt[8])*Wt+(eo=Vt[9])*_r+(io=Vt[10])*zn+(so=Vt[11])*aa,u[9]=to*Kt+eo*Sr+io*Qs+so*va,u[10]=to*Qi+eo*Ar+io*ta+so*Ba,u[11]=to*fr+eo*Jr+io*ia+so*Ya,u[12]=(to=Vt[12])*Wt+(eo=Vt[13])*_r+(io=Vt[14])*zn+(so=Vt[15])*aa,u[13]=to*Kt+eo*Sr+io*Qs+so*va,u[14]=to*Qi+eo*Ar+io*ta+so*Ba,u[15]=to*fr+eo*Jr+io*ia+so*Ya,u}Math.hypot||(Math.hypot=function(){for(var u=0,F=arguments.length;F--;)u+=arguments[F]*arguments[F];return Math.sqrt(u)});var Uh,Nh=no;function ao(u,F,Vt){var Wt=F[0],Kt=F[1],Qi=F[2],fr=F[3];return u[0]=Vt[0]*Wt+Vt[4]*Kt+Vt[8]*Qi+Vt[12]*fr,u[1]=Vt[1]*Wt+Vt[5]*Kt+Vt[9]*Qi+Vt[13]*fr,u[2]=Vt[2]*Wt+Vt[6]*Kt+Vt[10]*Qi+Vt[14]*fr,u[3]=Vt[3]*Wt+Vt[7]*Kt+Vt[11]*Qi+Vt[15]*fr,u}Uh=new Vh(4),Vh!=Float32Array&&(Uh[0]=0,Uh[1]=0,Uh[2]=0,Uh[3]=0);class oo extends Wi{constructor(u){super(u,Fh)}createBucket(u){return new $a(u)}queryRadius(u){const F=u;return Ja("circle-radius",this,F)+Ja("circle-stroke-width",this,F)+Xa(this.paint.get("circle-translate"))}queryIntersectsFeature(u,F,Vt,Wt,Kt,Qi,fr,_r){const Sr=Ha(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),Qi.angle,fr),Ar=this.paint.get("circle-radius").evaluate(F,Vt)+this.paint.get("circle-stroke-width").evaluate(F,Vt),Jr="map"===this.paint.get("circle-pitch-alignment"),zn=Jr?Sr:function(u,F){return u.map((u=>lo(u,F)))}(Sr,_r),Qs=Jr?Ar*fr:Ar;for(const u of Wt)for(const F of u){const u=Jr?F:lo(F,_r);let Vt=Qs;const Wt=ao([],[F.x,F.y,0,1],_r);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?Vt*=Wt[3]/Qi.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(Vt*=Qi.cameraToCenterDistance/Wt[3]),Da(zn,u,Vt))return!0}return!1}}function lo(u,F){const Vt=ao([],[u.x,u.y,0,1],F);return new Wt(Vt[0]/Vt[3],Vt[1]/Vt[3])}class uo extends $a{}let jh;wi("HeatmapBucket",uo,{omit:["layers"]});var $h={get paint(){return jh=jh||new Hi({"heatmap-radius":new Ki(Ya.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ki(Ya.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Zi(Ya.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xi(Ya.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Zi(Ya.paint_heatmap["heatmap-opacity"])})}};function po(u,{width:F,height:Vt},Wt,Kt){if(Kt){if(Kt instanceof Uint8ClampedArray)Kt=new Uint8Array(Kt.buffer);else if(Kt.length!==F*Vt*Wt)throw new RangeError(`mismatched image size. expected: ${Kt.length} but got: ${F*Vt*Wt}`)}else Kt=new Uint8Array(F*Vt*Wt);return u.width=F,u.height=Vt,u.data=Kt,u}function fo(u,{width:F,height:Vt},Wt){if(F===u.width&&Vt===u.height)return;const Kt=po({},{width:F,height:Vt},Wt);yo(u,Kt,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,F),height:Math.min(u.height,Vt)},Wt),u.width=F,u.height=Vt,u.data=Kt.data}function yo(u,F,Vt,Wt,Kt,Qi){if(0===Kt.width||0===Kt.height)return F;if(Kt.width>u.width||Kt.height>u.height||Vt.x>u.width-Kt.width||Vt.y>u.height-Kt.height)throw new RangeError("out of range source coordinates for image copy");if(Kt.width>F.width||Kt.height>F.height||Wt.x>F.width-Kt.width||Wt.y>F.height-Kt.height)throw new RangeError("out of range destination coordinates for image copy");const fr=u.data,_r=F.data;if(fr===_r)throw new Error("srcData equals dstData, so image is already copied");for(let Sr=0;Sr<Kt.height;Sr++){const Ar=((Vt.y+Sr)*u.width+Vt.x)*Qi,Jr=((Wt.y+Sr)*F.width+Wt.x)*Qi;for(let u=0;u<Kt.width*Qi;u++)_r[Jr+u]=fr[Ar+u]}return F}class mo{constructor(u,F){po(this,u,1,F)}resize(u){fo(this,u,1)}clone(){return new mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,F,Vt,Wt,Kt){yo(u,F,Vt,Wt,Kt,1)}}class go{constructor(u,F){po(this,u,4,F)}resize(u){fo(this,u,4)}replace(u,F){F?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,F,Vt,Wt,Kt){yo(u,F,Vt,Wt,Kt,4)}}function xo(u){const F={},Vt=u.resolution||256,Wt=u.clips?u.clips.length:1,Kt=u.image||new go({width:Vt,height:Wt});if(Math.log(Vt)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${Vt}`);const s=(Vt,Wt,Qi)=>{F[u.evaluationKey]=Qi;const fr=u.expression.evaluate(F);Kt.data[Vt+Wt+0]=Math.floor(255*fr.r/fr.a),Kt.data[Vt+Wt+1]=Math.floor(255*fr.g/fr.a),Kt.data[Vt+Wt+2]=Math.floor(255*fr.b/fr.a),Kt.data[Vt+Wt+3]=Math.floor(255*fr.a)};if(u.clips)for(let F=0,Kt=0;F<Wt;++F,Kt+=4*Vt)for(let Wt=0,Qi=0;Wt<Vt;Wt++,Qi+=4){const fr=Wt/(Vt-1),{start:_r,end:Sr}=u.clips[F];s(Kt,Qi,_r*(1-fr)+Sr*fr)}else for(let u=0,F=0;u<Vt;u++,F+=4)s(0,F,u/(Vt-1));return Kt}wi("AlphaImage",mo),wi("RGBAImage",go);class vo extends Wi{createBucket(u){return new uo(u)}constructor(u){super(u,$h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){"heatmap-color"===u&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let Zh;var qh={get paint(){return Zh=Zh||new Hi({"hillshade-illumination-direction":new Zi(Ya.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Zi(Ya.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Zi(Ya.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Zi(Ya.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Zi(Ya.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Zi(Ya.paint_hillshade["hillshade-accent-color"])})}};class _o extends Wi{constructor(u){super(u,qh)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Gh=rs([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wh}=Gh;var Hh={exports:{}};function Mo(u,F,Vt){Vt=Vt||2;var Wt,Kt,Qi,fr,_r,Sr,Ar,Jr=F&&F.length,zn=Jr?F[0]*Vt:u.length,Qs=Io(u,0,zn,Vt,!0),ta=[];if(!Qs||Qs.next===Qs.prev)return ta;if(Jr&&(Qs=function(u,F,Vt,Wt){var Kt,Qi,fr,_r=[];for(Kt=0,Qi=F.length;Kt<Qi;Kt++)(fr=Io(u,F[Kt]*Wt,Kt<Qi-1?F[Kt+1]*Wt:u.length,Wt,!1))===fr.next&&(fr.steiner=!0),_r.push(Do(fr));for(_r.sort(Fo),Kt=0;Kt<_r.length;Kt++)Vt=To(_r[Kt],Vt);return Vt}(u,F,Qs,Vt)),u.length>80*Vt){Wt=Qi=u[0],Kt=fr=u[1];for(var ia=Vt;ia<zn;ia+=Vt)(_r=u[ia])<Wt&&(Wt=_r),(Sr=u[ia+1])<Kt&&(Kt=Sr),_r>Qi&&(Qi=_r),Sr>fr&&(fr=Sr);Ar=0!==(Ar=Math.max(Qi-Wt,fr-Kt))?32767/Ar:0}return Po(Qs,ta,Vt,Wt,Kt,Ar,0),ta}function Io(u,F,Vt,Wt,Kt){var Qi,fr;if(Kt===Yo(u,F,Vt,Wt)>0)for(Qi=F;Qi<Vt;Qi+=Wt)fr=Jo(Qi,u[Qi],u[Qi+1],fr);else for(Qi=Vt-Wt;Qi>=F;Qi-=Wt)fr=Jo(Qi,u[Qi],u[Qi+1],fr);return fr&&jo(fr,fr.next)&&(Xo(fr),fr=fr.next),fr}function zo(u,F){if(!u)return u;F||(F=u);var Vt,Wt=u;do{if(Vt=!1,Wt.steiner||!jo(Wt,Wt.next)&&0!==Uo(Wt.prev,Wt,Wt.next))Wt=Wt.next;else{if(Xo(Wt),(Wt=F=Wt.prev)===Wt.next)break;Vt=!0}}while(Vt||Wt!==F);return F}function Po(u,F,Vt,Wt,Kt,Qi,fr){if(u){!fr&&Qi&&function(u,F,Vt,Wt){var Kt=u;do{0===Kt.z&&(Kt.z=Lo(Kt.x,Kt.y,F,Vt,Wt)),Kt.prevZ=Kt.prev,Kt.nextZ=Kt.next,Kt=Kt.next}while(Kt!==u);Kt.prevZ.nextZ=null,Kt.prevZ=null,function(u){var F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar=1;do{for(Vt=u,u=null,Qi=null,fr=0;Vt;){for(fr++,Wt=Vt,_r=0,F=0;F<Ar&&(_r++,Wt=Wt.nextZ);F++);for(Sr=Ar;_r>0||Sr>0&&Wt;)0!==_r&&(0===Sr||!Wt||Vt.z<=Wt.z)?(Kt=Vt,Vt=Vt.nextZ,_r--):(Kt=Wt,Wt=Wt.nextZ,Sr--),Qi?Qi.nextZ=Kt:u=Kt,Kt.prevZ=Qi,Qi=Kt;Vt=Wt}Qi.nextZ=null,Ar*=2}while(fr>1)}(Kt)}(u,Wt,Kt,Qi);for(var _r,Sr,Ar=u;u.prev!==u.next;)if(_r=u.prev,Sr=u.next,Qi?Co(u,Wt,Kt,Qi):Bo(u))F.push(_r.i/Vt|0),F.push(u.i/Vt|0),F.push(Sr.i/Vt|0),Xo(u),u=Sr.next,Ar=Sr.next;else if((u=Sr)===Ar){fr?1===fr?Po(u=Vo(zo(u),F,Vt),F,Vt,Wt,Kt,Qi,2):2===fr&&Eo(u,F,Vt,Wt,Kt,Qi):Po(zo(u),F,Vt,Wt,Kt,Qi,1);break}}}function Bo(u){var F=u.prev,Vt=u,Wt=u.next;if(Uo(F,Vt,Wt)>=0)return!1;for(var Kt=F.x,Qi=Vt.x,fr=Wt.x,_r=F.y,Sr=Vt.y,Ar=Wt.y,Jr=Kt<Qi?Kt<fr?Kt:fr:Qi<fr?Qi:fr,zn=_r<Sr?_r<Ar?_r:Ar:Sr<Ar?Sr:Ar,Qs=Kt>Qi?Kt>fr?Kt:fr:Qi>fr?Qi:fr,ta=_r>Sr?_r>Ar?_r:Ar:Sr>Ar?Sr:Ar,ia=Wt.next;ia!==F;){if(ia.x>=Jr&&ia.x<=Qs&&ia.y>=zn&&ia.y<=ta&&Oo(Kt,_r,Qi,Sr,fr,Ar,ia.x,ia.y)&&Uo(ia.prev,ia,ia.next)>=0)return!1;ia=ia.next}return!0}function Co(u,F,Vt,Wt){var Kt=u.prev,Qi=u,fr=u.next;if(Uo(Kt,Qi,fr)>=0)return!1;for(var _r=Kt.x,Sr=Qi.x,Ar=fr.x,Jr=Kt.y,zn=Qi.y,Qs=fr.y,ta=_r<Sr?_r<Ar?_r:Ar:Sr<Ar?Sr:Ar,ia=Jr<zn?Jr<Qs?Jr:Qs:zn<Qs?zn:Qs,aa=_r>Sr?_r>Ar?_r:Ar:Sr>Ar?Sr:Ar,va=Jr>zn?Jr>Qs?Jr:Qs:zn>Qs?zn:Qs,Ba=Lo(ta,ia,F,Vt,Wt),Ya=Lo(aa,va,F,Vt,Wt),to=u.prevZ,eo=u.nextZ;to&&to.z>=Ba&&eo&&eo.z<=Ya;){if(to.x>=ta&&to.x<=aa&&to.y>=ia&&to.y<=va&&to!==Kt&&to!==fr&&Oo(_r,Jr,Sr,zn,Ar,Qs,to.x,to.y)&&Uo(to.prev,to,to.next)>=0)return!1;if(to=to.prevZ,eo.x>=ta&&eo.x<=aa&&eo.y>=ia&&eo.y<=va&&eo!==Kt&&eo!==fr&&Oo(_r,Jr,Sr,zn,Ar,Qs,eo.x,eo.y)&&Uo(eo.prev,eo,eo.next)>=0)return!1;eo=eo.nextZ}for(;to&&to.z>=Ba;){if(to.x>=ta&&to.x<=aa&&to.y>=ia&&to.y<=va&&to!==Kt&&to!==fr&&Oo(_r,Jr,Sr,zn,Ar,Qs,to.x,to.y)&&Uo(to.prev,to,to.next)>=0)return!1;to=to.prevZ}for(;eo&&eo.z<=Ya;){if(eo.x>=ta&&eo.x<=aa&&eo.y>=ia&&eo.y<=va&&eo!==Kt&&eo!==fr&&Oo(_r,Jr,Sr,zn,Ar,Qs,eo.x,eo.y)&&Uo(eo.prev,eo,eo.next)>=0)return!1;eo=eo.nextZ}return!0}function Vo(u,F,Vt){var Wt=u;do{var Kt=Wt.prev,Qi=Wt.next.next;!jo(Kt,Qi)&&qo(Kt,Wt,Wt.next,Qi)&&Ko(Kt,Qi)&&Ko(Qi,Kt)&&(F.push(Kt.i/Vt|0),F.push(Wt.i/Vt|0),F.push(Qi.i/Vt|0),Xo(Wt),Xo(Wt.next),Wt=u=Qi),Wt=Wt.next}while(Wt!==u);return zo(Wt)}function Eo(u,F,Vt,Wt,Kt,Qi){var fr=u;do{for(var _r=fr.next.next;_r!==fr.prev;){if(fr.i!==_r.i&&Ro(fr,_r)){var Sr=Go(fr,_r);return fr=zo(fr,fr.next),Sr=zo(Sr,Sr.next),Po(fr,F,Vt,Wt,Kt,Qi,0),void Po(Sr,F,Vt,Wt,Kt,Qi,0)}_r=_r.next}fr=fr.next}while(fr!==u)}function Fo(u,F){return u.x-F.x}function To(u,F){var Vt=function(u,F){var Vt,Wt=F,Kt=u.x,Qi=u.y,fr=-1/0;do{if(Qi<=Wt.y&&Qi>=Wt.next.y&&Wt.next.y!==Wt.y){var _r=Wt.x+(Qi-Wt.y)*(Wt.next.x-Wt.x)/(Wt.next.y-Wt.y);if(_r<=Kt&&_r>fr&&(fr=_r,Vt=Wt.x<Wt.next.x?Wt:Wt.next,_r===Kt))return Vt}Wt=Wt.next}while(Wt!==F);if(!Vt)return null;var Sr,Ar=Vt,Jr=Vt.x,zn=Vt.y,Qs=1/0;Wt=Vt;do{Kt>=Wt.x&&Wt.x>=Jr&&Kt!==Wt.x&&Oo(Qi<zn?Kt:fr,Qi,Jr,zn,Qi<zn?fr:Kt,Qi,Wt.x,Wt.y)&&(Sr=Math.abs(Qi-Wt.y)/(Kt-Wt.x),Ko(Wt,u)&&(Sr<Qs||Sr===Qs&&(Wt.x>Vt.x||Wt.x===Vt.x&&$o(Vt,Wt)))&&(Vt=Wt,Qs=Sr)),Wt=Wt.next}while(Wt!==Ar);return Vt}(u,F);if(!Vt)return F;var Wt=Go(Vt,u);return zo(Wt,Wt.next),zo(Vt,Vt.next)}function $o(u,F){return Uo(u.prev,u,F.prev)<0&&Uo(F.next,u,u.next)<0}function Lo(u,F,Vt,Wt,Kt){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-Vt)*Kt|0)|u<<8))|u<<4))|u<<2))|u<<1))|(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F=(F-Wt)*Kt|0)|F<<8))|F<<4))|F<<2))|F<<1))<<1}function Do(u){var F=u,Vt=u;do{(F.x<Vt.x||F.x===Vt.x&&F.y<Vt.y)&&(Vt=F),F=F.next}while(F!==u);return Vt}function Oo(u,F,Vt,Wt,Kt,Qi,fr,_r){return(Kt-fr)*(F-_r)>=(u-fr)*(Qi-_r)&&(u-fr)*(Wt-_r)>=(Vt-fr)*(F-_r)&&(Vt-fr)*(Qi-_r)>=(Kt-fr)*(Wt-_r)}function Ro(u,F){return u.next.i!==F.i&&u.prev.i!==F.i&&!function(u,F){var Vt=u;do{if(Vt.i!==u.i&&Vt.next.i!==u.i&&Vt.i!==F.i&&Vt.next.i!==F.i&&qo(Vt,Vt.next,u,F))return!0;Vt=Vt.next}while(Vt!==u);return!1}(u,F)&&(Ko(u,F)&&Ko(F,u)&&function(u,F){var Vt=u,Wt=!1,Kt=(u.x+F.x)/2,Qi=(u.y+F.y)/2;do{Vt.y>Qi!=Vt.next.y>Qi&&Vt.next.y!==Vt.y&&Kt<(Vt.next.x-Vt.x)*(Qi-Vt.y)/(Vt.next.y-Vt.y)+Vt.x&&(Wt=!Wt),Vt=Vt.next}while(Vt!==u);return Wt}(u,F)&&(Uo(u.prev,u,F.prev)||Uo(u,F.prev,F))||jo(u,F)&&Uo(u.prev,u,u.next)>0&&Uo(F.prev,F,F.next)>0)}function Uo(u,F,Vt){return(F.y-u.y)*(Vt.x-F.x)-(F.x-u.x)*(Vt.y-F.y)}function jo(u,F){return u.x===F.x&&u.y===F.y}function qo(u,F,Vt,Wt){var Kt=Zo(Uo(u,F,Vt)),Qi=Zo(Uo(u,F,Wt)),fr=Zo(Uo(Vt,Wt,u)),_r=Zo(Uo(Vt,Wt,F));return Kt!==Qi&&fr!==_r||!(0!==Kt||!No(u,Vt,F))||!(0!==Qi||!No(u,Wt,F))||!(0!==fr||!No(Vt,u,Wt))||!(0!==_r||!No(Vt,F,Wt))}function No(u,F,Vt){return F.x<=Math.max(u.x,Vt.x)&&F.x>=Math.min(u.x,Vt.x)&&F.y<=Math.max(u.y,Vt.y)&&F.y>=Math.min(u.y,Vt.y)}function Zo(u){return u>0?1:u<0?-1:0}function Ko(u,F){return Uo(u.prev,u,u.next)<0?Uo(u,F,u.next)>=0&&Uo(u,u.prev,F)>=0:Uo(u,F,u.prev)<0||Uo(u,u.next,F)<0}function Go(u,F){var Vt=new Ho(u.i,u.x,u.y),Wt=new Ho(F.i,F.x,F.y),Kt=u.next,Qi=F.prev;return u.next=F,F.prev=u,Vt.next=Kt,Kt.prev=Vt,Wt.next=Vt,Vt.prev=Wt,Qi.next=Wt,Wt.prev=Qi,Wt}function Jo(u,F,Vt,Wt){var Kt=new Ho(u,F,Vt);return Wt?(Kt.next=Wt.next,Kt.prev=Wt,Wt.next.prev=Kt,Wt.next=Kt):(Kt.prev=Kt,Kt.next=Kt),Kt}function Xo(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Ho(F,Vt,Wt){(this||u).i=F,(this||u).x=Vt,(this||u).y=Wt,(this||u).prev=null,(this||u).next=null,(this||u).z=0,(this||u).prevZ=null,(this||u).nextZ=null,(this||u).steiner=!1}function Yo(u,F,Vt,Wt){for(var Kt=0,Qi=F,fr=Vt-Wt;Qi<Vt;Qi+=Wt)Kt+=(u[fr]-u[Qi])*(u[Qi+1]+u[fr+1]),fr=Qi;return Kt}Hh.exports=Mo,Hh.exports.default=Mo,Mo.deviation=function(u,F,Vt,Wt){var Kt=F&&F.length,Qi=Math.abs(Yo(u,0,Kt?F[0]*Vt:u.length,Vt));if(Kt)for(var fr=0,_r=F.length;fr<_r;fr++)Qi-=Math.abs(Yo(u,F[fr]*Vt,fr<_r-1?F[fr+1]*Vt:u.length,Vt));var Sr=0;for(fr=0;fr<Wt.length;fr+=3){var Ar=Wt[fr]*Vt,Jr=Wt[fr+1]*Vt,zn=Wt[fr+2]*Vt;Sr+=Math.abs((u[Ar]-u[zn])*(u[Jr+1]-u[Ar+1])-(u[Ar]-u[Jr])*(u[zn+1]-u[Ar+1]))}return 0===Qi&&0===Sr?0:Math.abs((Sr-Qi)/Qi)},Mo.flatten=function(u){for(var F=u[0][0].length,Vt={vertices:[],holes:[],dimensions:F},Wt=0,Kt=0;Kt<u.length;Kt++){for(var Qi=0;Qi<u[Kt].length;Qi++)for(var fr=0;fr<F;fr++)Vt.vertices.push(u[Kt][Qi][fr]);Kt>0&&Vt.holes.push(Wt+=u[Kt-1].length)}return Vt};var Xh=r(Hh.exports);function Qo(u,F,Vt){const Wt=Vt.patternDependencies;let Kt=!1;for(const Vt of F){const F=Vt.paint.get(`${u}-pattern`);F.isConstant()||(Kt=!0);const Qi=F.constantOr(null);Qi&&(Kt=!0,Wt[Qi.to]=!0,Wt[Qi.from]=!0)}return Kt}function tl(u,F,Vt,Wt,Kt){const Qi=Kt.patternDependencies;for(const fr of F){const F=fr.paint.get(`${u}-pattern`).value;if("constant"!==F.kind){let u=F.evaluate({zoom:Wt-1},Vt,{},Kt.availableImages),_r=F.evaluate({zoom:Wt},Vt,{},Kt.availableImages),Sr=F.evaluate({zoom:Wt+1},Vt,{},Kt.availableImages);u=u&&u.name?u.name:u,_r=_r&&_r.name?_r.name:_r,Sr=Sr&&Sr.name?Sr.name:Sr,Qi[u]=!0,Qi[_r]=!0,Qi[Sr]=!0,Vt.patterns[fr.id]={min:u,mid:_r,max:Sr}}}return Vt}class el{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Us,this.indexArray=new Ys,this.indexArray2=new Ws,this.programConfigurations=new Ia(u.layers,u.zoom),this.segments=new ea,this.segments2=new ea,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Vt){this.hasPattern=Qo("fill",this.layers,F);const Wt=this.layers[0].layout.get("fill-sort-key"),Kt=!Wt.isConstant(),Qi=[];for(const{feature:fr,id:_r,index:Sr,sourceLayerIndex:Ar}of u){const u=this.layers[0]._featureFilter.needGeometry,Jr=Fa(fr,u);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),Jr,Vt))continue;const zn=Kt?Wt.evaluate(Jr,{},Vt,F.availableImages):void 0,Qs={id:_r,properties:fr.properties,type:fr.type,sourceLayerIndex:Ar,index:Sr,geometry:u?Jr.geometry:Ea(fr),patterns:{},sortKey:zn};Qi.push(Qs)}Kt&&Qi.sort(((u,F)=>u.sortKey-F.sortKey));for(const Wt of Qi){const{geometry:Kt,index:Qi,sourceLayerIndex:fr}=Wt;if(this.hasPattern){const u=tl("fill",this.layers,Wt,this.zoom,F);this.patternFeatures.push(u)}else this.addFeature(Wt,Kt,Qi,Vt,{});F.featureIndex.insert(u[Qi].feature,Kt,Qi,fr,this.index)}}update(u,F,Vt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Vt)}addFeatures(u,F,Vt){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,F,Vt)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Wh),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,F,Vt,Wt,Kt){for(const u of vr(F,500)){let F=0;for(const Vt of u)F+=Vt.length;const Vt=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),Wt=Vt.vertexLength,Kt=[],Qi=[];for(const F of u){if(0===F.length)continue;F!==u[0]&&Qi.push(Kt.length/2);const Vt=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Wt=Vt.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Wt+F.length-1,Wt),Kt.push(F[0].x),Kt.push(F[0].y);for(let u=1;u<F.length;u++)this.layoutVertexArray.emplaceBack(F[u].x,F[u].y),this.indexArray2.emplaceBack(Wt+u-1,Wt+u),Kt.push(F[u].x),Kt.push(F[u].y);Vt.vertexLength+=F.length,Vt.primitiveLength+=F.length}const fr=Xh(Kt,Qi);for(let u=0;u<fr.length;u+=3)this.indexArray.emplaceBack(Wt+fr[u],Wt+fr[u+1],Wt+fr[u+2]);Vt.vertexLength+=F,Vt.primitiveLength+=fr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Vt,Kt,Wt)}}let Kh,Jh;wi("FillBucket",el,{omit:["layers","patternFeatures"]});var Yh={get paint(){return Jh=Jh||new Hi({"fill-antialias":new Zi(Ya.paint_fill["fill-antialias"]),"fill-opacity":new Ki(Ya.paint_fill["fill-opacity"]),"fill-color":new Ki(Ya.paint_fill["fill-color"]),"fill-outline-color":new Ki(Ya.paint_fill["fill-outline-color"]),"fill-translate":new Zi(Ya.paint_fill["fill-translate"]),"fill-translate-anchor":new Zi(Ya.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gi(Ya.paint_fill["fill-pattern"])})},get layout(){return Kh=Kh||new Hi({"fill-sort-key":new Ki(Ya.layout_fill["fill-sort-key"])})}};class sl extends Wi{constructor(u){super(u,Yh)}recalculate(u,F){super.recalculate(u,F);const Vt=this.paint._values["fill-outline-color"];"constant"===Vt.value.kind&&void 0===Vt.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new el(u)}queryRadius(){return Xa(this.paint.get("fill-translate"))}queryIntersectsFeature(u,F,Vt,Wt,Kt,Qi,fr){return Oa(Ha(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),Qi.angle,fr),Wt)}isTileClipped(){return!0}}const Qh=rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tu=rs([{name:"a_centroid",components:2,type:"Int16"}],4),{members:eu}=Qh;var su={},au=Vt,ou=pl;function pl(F,Vt,Wt,Kt,Qi){(this||u).properties={},(this||u).extent=Wt,(this||u).type=0,(this||u)._pbf=F,(this||u)._geometry=-1,(this||u)._keys=Kt,(this||u)._values=Qi,F.readFields(fl,this||u,Vt)}function fl(u,F,Vt){1==u?F.id=Vt.readVarint():2==u?function(u,F){for(var Vt=u.readVarint()+u.pos;u.pos<Vt;){var Wt=F._keys[u.readVarint()],Kt=F._values[u.readVarint()];F.properties[Wt]=Kt}}(Vt,F):3==u?F.type=Vt.readVarint():4==u&&(F._geometry=Vt.pos)}function dl(u){for(var F,Vt,Wt=0,Kt=0,Qi=u.length,fr=Qi-1;Kt<Qi;fr=Kt++)Wt+=((Vt=u[fr]).x-(F=u[Kt]).x)*(F.y+Vt.y);return Wt}pl.types=["Unknown","Point","LineString","Polygon"],pl.prototype.loadGeometry=function(){var F=(this||u)._pbf;F.pos=(this||u)._geometry;for(var Vt,Wt=F.readVarint()+F.pos,Kt=1,Qi=0,fr=0,_r=0,Sr=[];F.pos<Wt;){if(Qi<=0){var Ar=F.readVarint();Kt=7&Ar,Qi=Ar>>3}if(Qi--,1===Kt||2===Kt)fr+=F.readSVarint(),_r+=F.readSVarint(),1===Kt&&(Vt&&Sr.push(Vt),Vt=[]),Vt.push(new au(fr,_r));else{if(7!==Kt)throw new Error("unknown command "+Kt);Vt&&Vt.push(Vt[0].clone())}}return Vt&&Sr.push(Vt),Sr},pl.prototype.bbox=function(){var F=(this||u)._pbf;F.pos=(this||u)._geometry;for(var Vt=F.readVarint()+F.pos,Wt=1,Kt=0,Qi=0,fr=0,_r=1/0,Sr=-1/0,Ar=1/0,Jr=-1/0;F.pos<Vt;){if(Kt<=0){var zn=F.readVarint();Wt=7&zn,Kt=zn>>3}if(Kt--,1===Wt||2===Wt)(Qi+=F.readSVarint())<_r&&(_r=Qi),Qi>Sr&&(Sr=Qi),(fr+=F.readSVarint())<Ar&&(Ar=fr),fr>Jr&&(Jr=fr);else if(7!==Wt)throw new Error("unknown command "+Wt)}return[_r,Ar,Sr,Jr]},pl.prototype.toGeoJSON=function(F,Vt,Wt){var Kt,Qi,fr=(this||u).extent*Math.pow(2,Wt),_r=(this||u).extent*F,Sr=(this||u).extent*Vt,Ar=this.loadGeometry(),Jr=pl.types[(this||u).type];function c(u){for(var F=0;F<u.length;F++){var Vt=u[F];u[F]=[360*(Vt.x+_r)/fr-180,360/Math.PI*Math.atan(Math.exp((180-360*(Vt.y+Sr)/fr)*Math.PI/180))-90]}}switch((this||u).type){case 1:var zn=[];for(Kt=0;Kt<Ar.length;Kt++)zn[Kt]=Ar[Kt][0];c(Ar=zn);break;case 2:for(Kt=0;Kt<Ar.length;Kt++)c(Ar[Kt]);break;case 3:for(Ar=function(u){var F=u.length;if(F<=1)return[u];for(var Vt,Wt,Kt=[],Qi=0;Qi<F;Qi++){var fr=dl(u[Qi]);0!==fr&&(void 0===Wt&&(Wt=fr<0),Wt===fr<0?(Vt&&Kt.push(Vt),Vt=[u[Qi]]):Vt.push(u[Qi]))}return Vt&&Kt.push(Vt),Kt}(Ar),Kt=0;Kt<Ar.length;Kt++)for(Qi=0;Qi<Ar[Kt].length;Qi++)c(Ar[Kt][Qi])}1===Ar.length?Ar=Ar[0]:Jr="Multi"+Jr;var Qs={type:"Feature",geometry:{type:Jr,coordinates:Ar},properties:(this||u).properties};return"id"in(this||u)&&(Qs.id=(this||u).id),Qs};var Su=ou,Au=gl;function gl(F,Vt){(this||u).version=1,(this||u).name=null,(this||u).extent=4096,(this||u).length=0,(this||u)._pbf=F,(this||u)._keys=[],(this||u)._values=[],(this||u)._features=[],F.readFields(xl,this||u,Vt),(this||u).length=(this||u)._features.length}function xl(u,F,Vt){15===u?F.version=Vt.readVarint():1===u?F.name=Vt.readString():5===u?F.extent=Vt.readVarint():2===u?F._features.push(Vt.pos):3===u?F._keys.push(Vt.readString()):4===u&&F._values.push(function(u){for(var F=null,Vt=u.readVarint()+u.pos;u.pos<Vt;){var Wt=u.readVarint()>>3;F=1===Wt?u.readString():2===Wt?u.readFloat():3===Wt?u.readDouble():4===Wt?u.readVarint64():5===Wt?u.readVarint():6===Wt?u.readSVarint():7===Wt?u.readBoolean():null}return F}(Vt))}gl.prototype.feature=function(F){if(F<0||F>=(this||u)._features.length)throw new Error("feature index out of bounds");(this||u)._pbf.pos=(this||u)._features[F];var Vt=(this||u)._pbf.readVarint()+(this||u)._pbf.pos;return new Su((this||u)._pbf,Vt,(this||u).extent,(this||u)._keys,(this||u)._values)};var Eu=Au;function bl(u,F,Vt){if(3===u){var Wt=new Eu(Vt,Vt.readVarint()+Vt.pos);Wt.length&&(F[Wt.name]=Wt)}}su.VectorTile=function(F,Vt){(this||u).layers=F.readFields(bl,{},Vt)},su.VectorTileFeature=ou,su.VectorTileLayer=Au;const zu=su.VectorTileFeature.types,Du=Math.pow(2,13);function Al(u,F,Vt,Wt,Kt,Qi,fr,_r){u.emplaceBack(F,Vt,2*Math.floor(Wt*Du)+fr,Kt*Du*2,Qi*Du*2,Math.round(_r))}class Sl{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new js,this.centroidVertexArray=new Os,this.indexArray=new Ys,this.programConfigurations=new Ia(u.layers,u.zoom),this.segments=new ea,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Vt){this.features=[],this.hasPattern=Qo("fill-extrusion",this.layers,F);for(const{feature:Wt,id:Kt,index:Qi,sourceLayerIndex:fr}of u){const u=this.layers[0]._featureFilter.needGeometry,_r=Fa(Wt,u);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),_r,Vt))continue;const Sr={id:Kt,sourceLayerIndex:fr,index:Qi,geometry:u?_r.geometry:Ea(Wt),properties:Wt.properties,type:Wt.type,patterns:{}};this.hasPattern?this.features.push(tl("fill-extrusion",this.layers,Sr,this.zoom,F)):this.addFeature(Sr,Sr.geometry,Qi,Vt,{}),F.featureIndex.insert(Wt,Sr.geometry,Qi,fr,this.index,!0)}}addFeatures(u,F,Vt){for(const u of this.features){const{geometry:Wt}=u;this.addFeature(u,Wt,u.index,F,Vt)}}update(u,F,Vt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Vt)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,eu),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,tu.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,F,Vt,Wt,Kt){const Qi={x:0,y:0,vertexCount:0};for(const Vt of vr(F,500)){let F=0;for(const u of Vt)F+=u.length;let Wt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const u of Vt){if(0===u.length)continue;if(Ml(u))continue;let F=0;for(let Vt=0;Vt<u.length;Vt++){const Kt=u[Vt];if(Vt>=1){const fr=u[Vt-1];if(!kl(Kt,fr)){Wt.vertexLength+4>ea.MAX_VERTEX_ARRAY_LENGTH&&(Wt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const u=Kt.sub(fr)._perp()._unit(),Vt=fr.dist(Kt);F+Vt>32768&&(F=0),Al(this.layoutVertexArray,Kt.x,Kt.y,u.x,u.y,0,0,F),Al(this.layoutVertexArray,Kt.x,Kt.y,u.x,u.y,0,1,F),Qi.x+=2*Kt.x,Qi.y+=2*Kt.y,Qi.vertexCount+=2,F+=Vt,Al(this.layoutVertexArray,fr.x,fr.y,u.x,u.y,0,0,F),Al(this.layoutVertexArray,fr.x,fr.y,u.x,u.y,0,1,F),Qi.x+=2*fr.x,Qi.y+=2*fr.y,Qi.vertexCount+=2;const _r=Wt.vertexLength;this.indexArray.emplaceBack(_r,_r+2,_r+1),this.indexArray.emplaceBack(_r+1,_r+2,_r+3),Wt.vertexLength+=4,Wt.primitiveLength+=2}}}}if(Wt.vertexLength+F>ea.MAX_VERTEX_ARRAY_LENGTH&&(Wt=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),"Polygon"!==zu[u.type])continue;const Kt=[],fr=[],_r=Wt.vertexLength;for(const u of Vt)if(0!==u.length){u!==Vt[0]&&fr.push(Kt.length/2);for(let F=0;F<u.length;F++){const Vt=u[F];Al(this.layoutVertexArray,Vt.x,Vt.y,0,0,1,1,0),Qi.x+=Vt.x,Qi.y+=Vt.y,Qi.vertexCount+=1,Kt.push(Vt.x),Kt.push(Vt.y)}}const Sr=Xh(Kt,fr);for(let u=0;u<Sr.length;u+=3)this.indexArray.emplaceBack(_r+Sr[u],_r+Sr[u+2],_r+Sr[u+1]);Wt.primitiveLength+=Sr.length/3,Wt.vertexLength+=F}for(let u=0;u<Qi.vertexCount;u++)this.centroidVertexArray.emplaceBack(Math.floor(Qi.x/Qi.vertexCount),Math.floor(Qi.y/Qi.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Vt,Kt,Wt)}}function kl(u,F){return u.x===F.x&&(u.x<0||u.x>zh)||u.y===F.y&&(u.y<0||u.y>zh)}function Ml(u){return u.every((u=>u.x<0))||u.every((u=>u.x>zh))||u.every((u=>u.y<0))||u.every((u=>u.y>zh))}let Bu;wi("FillExtrusionBucket",Sl,{omit:["layers","features"]});var Fu={get paint(){return Bu=Bu||new Hi({"fill-extrusion-opacity":new Zi(Ya["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ki(Ya["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Zi(Ya["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Zi(Ya["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gi(Ya["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ki(Ya["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ki(Ya["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Zi(Ya["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Pl extends Wi{constructor(u){super(u,Fu)}createBucket(u){return new Sl(u)}queryRadius(){return Xa(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,F,Vt,Kt,Qi,fr,_r,Sr){const Ar=Ha(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),fr.angle,_r),Jr=this.paint.get("fill-extrusion-height").evaluate(F,Vt),zn=this.paint.get("fill-extrusion-base").evaluate(F,Vt),Qs=function(u,F,Vt,Kt){const Qi=[];for(const Vt of u){const u=[Vt.x,Vt.y,0,1];ao(u,u,F),Qi.push(new Wt(u[0]/u[3],u[1]/u[3]))}return Qi}(Ar,Sr),ta=function(u,F,Vt,Kt){const Qi=[],fr=[],_r=Kt[8]*F,Sr=Kt[9]*F,Ar=Kt[10]*F,Jr=Kt[11]*F,zn=Kt[8]*Vt,Qs=Kt[9]*Vt,ta=Kt[10]*Vt,ia=Kt[11]*Vt;for(const F of u){const u=[],Vt=[];for(const Qi of F){const F=Qi.x,fr=Qi.y,aa=Kt[0]*F+Kt[4]*fr+Kt[12],va=Kt[1]*F+Kt[5]*fr+Kt[13],Ba=Kt[2]*F+Kt[6]*fr+Kt[14],Ya=Kt[3]*F+Kt[7]*fr+Kt[15],to=Ba+Ar,eo=Ya+Jr,io=aa+zn,so=va+Qs,co=Ba+ta,ho=Ya+ia,bo=new Wt((aa+_r)/eo,(va+Sr)/eo);bo.z=to/eo,u.push(bo);const wo=new Wt(io/ho,so/ho);wo.z=co/ho,Vt.push(wo)}Qi.push(u),fr.push(Vt)}return[Qi,fr]}(Kt,zn,Jr,Sr);return function(u,F,Vt){let Wt=1/0;Oa(Vt,F)&&(Wt=Cl(Vt,F[0]));for(let Kt=0;Kt<F.length;Kt++){const Qi=F[Kt],fr=u[Kt];for(let u=0;u<Qi.length-1;u++){const F=Qi[u],Kt=[F,Qi[u+1],fr[u+1],fr[u],F];La(Vt,Kt)&&(Wt=Math.min(Wt,Cl(Vt,Kt)))}}return Wt!==1/0&&Wt}(ta[0],ta[1],Qs)}}function Bl(u,F){return u.x*F.x+u.y*F.y}function Cl(u,F){if(1===u.length){let Vt=0;const Wt=F[Vt++];let Kt;for(;!Kt||Wt.equals(Kt);)if(Kt=F[Vt++],!Kt)return 1/0;for(;Vt<F.length;Vt++){const Qi=F[Vt],fr=u[0],_r=Kt.sub(Wt),Sr=Qi.sub(Wt),Ar=fr.sub(Wt),Jr=Bl(_r,_r),zn=Bl(_r,Sr),Qs=Bl(Sr,Sr),ta=Bl(Ar,_r),ia=Bl(Ar,Sr),aa=Jr*Qs-zn*zn,va=(Qs*ta-zn*ia)/aa,Ba=(Jr*ia-zn*ta)/aa,Ya=Wt.z*(1-va-Ba)+Kt.z*va+Qi.z*Ba;if(isFinite(Ya))return Ya}return 1/0}{let u=1/0;for(const Vt of F)u=Math.min(u,Vt.z);return u}}const Ou=rs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Wu}=Ou,Yu=rs([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Qu}=Yu,td=su.VectorTileFeature.types,ed=Math.cos(Math.PI/180*37.5),id=Math.pow(2,14)/.5;class Ol{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new qs,this.layoutVertexArray2=new Ns,this.indexArray=new Ys,this.programConfigurations=new Ia(u.layers,u.zoom),this.segments=new ea,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(u,F,Vt){this.hasPattern=Qo("line",this.layers,F);const Wt=this.layers[0].layout.get("line-sort-key"),Kt=!Wt.isConstant(),Qi=[];for(const{feature:F,id:fr,index:_r,sourceLayerIndex:Sr}of u){const u=this.layers[0]._featureFilter.needGeometry,Ar=Fa(F,u);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),Ar,Vt))continue;const Jr=Kt?Wt.evaluate(Ar,{},Vt):void 0,zn={id:fr,properties:F.properties,type:F.type,sourceLayerIndex:Sr,index:_r,geometry:u?Ar.geometry:Ea(F),patterns:{},sortKey:Jr};Qi.push(zn)}Kt&&Qi.sort(((u,F)=>u.sortKey-F.sortKey));for(const Wt of Qi){const{geometry:Kt,index:Qi,sourceLayerIndex:fr}=Wt;if(this.hasPattern){const u=tl("line",this.layers,Wt,this.zoom,F);this.patternFeatures.push(u)}else this.addFeature(Wt,Kt,Qi,Vt,{});F.featureIndex.insert(u[Qi].feature,Kt,Qi,fr,this.index)}}update(u,F,Vt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,F,this.stateDependentLayers,Vt)}addFeatures(u,F,Vt){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,F,Vt)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,Qu)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Wu),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,F,Vt,Wt,Kt){const Qi=this.layers[0].layout,fr=Qi.get("line-join").evaluate(u,{}),_r=Qi.get("line-cap"),Sr=Qi.get("line-miter-limit"),Ar=Qi.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const Vt of F)this.addLine(Vt,u,fr,_r,Sr,Ar);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,Vt,Kt,Wt)}addLine(u,F,Vt,Wt,Kt,Qi){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let F=0;F<u.length-1;F++)this.totalDistance+=u[F].dist(u[F+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const fr="Polygon"===td[F.type];let _r=u.length;for(;_r>=2&&u[_r-1].equals(u[_r-2]);)_r--;let Sr=0;for(;Sr<_r-1&&u[Sr].equals(u[Sr+1]);)Sr++;if(_r<(fr?3:2))return;"bevel"===Vt&&(Kt=1.05);const Ar=this.overscaling<=16?15*zh/(512*this.overscaling):0,Jr=this.segments.prepareSegment(10*_r,this.layoutVertexArray,this.indexArray);let zn,Qs,ta,ia,aa;this.e1=this.e2=-1,fr&&(zn=u[_r-2],aa=u[Sr].sub(zn)._unit()._perp());for(let F=Sr;F<_r;F++){if(ta=F===_r-1?fr?u[Sr+1]:void 0:u[F+1],ta&&u[F].equals(ta))continue;aa&&(ia=aa),zn&&(Qs=zn),zn=u[F],aa=ta?ta.sub(zn)._unit()._perp():ia,ia=ia||aa;let va=ia.add(aa);0===va.x&&0===va.y||va._unit();const Ba=ia.x*aa.x+ia.y*aa.y,Ya=va.x*aa.x+va.y*aa.y,to=0!==Ya?1/Ya:1/0,eo=2*Math.sqrt(2-2*Ya),io=Ya<ed&&Qs&&ta,so=ia.x*aa.y-ia.y*aa.x>0;if(io&&F>Sr){const u=zn.dist(Qs);if(u>2*Ar){const F=zn.sub(zn.sub(Qs)._mult(Ar/u)._round());this.updateDistance(Qs,F),this.addCurrentVertex(F,ia,0,0,Jr),Qs=F}}const co=Qs&&ta;let ho=co?Vt:fr?"butt":Wt;if(co&&"round"===ho&&(to<Qi?ho="miter":to<=2&&(ho="fakeround")),"miter"===ho&&to>Kt&&(ho="bevel"),"bevel"===ho&&(to>2&&(ho="flipbevel"),to<Kt&&(ho="miter")),Qs&&this.updateDistance(Qs,zn),"miter"===ho)va._mult(to),this.addCurrentVertex(zn,va,0,0,Jr);else if("flipbevel"===ho){if(to>100)va=aa.mult(-1);else{const u=to*ia.add(aa).mag()/ia.sub(aa).mag();va._perp()._mult(u*(so?-1:1))}this.addCurrentVertex(zn,va,0,0,Jr),this.addCurrentVertex(zn,va.mult(-1),0,0,Jr)}else if("bevel"===ho||"fakeround"===ho){const u=-Math.sqrt(to*to-1),F=so?u:0,Vt=so?0:u;if(Qs&&this.addCurrentVertex(zn,ia,F,Vt,Jr),"fakeround"===ho){const u=Math.round(180*eo/Math.PI/20);for(let F=1;F<u;F++){let Vt=F/u;if(.5!==Vt){const u=Vt-.5;Vt+=Vt*u*(Vt-1)*((1.0904+Ba*(Ba*(3.55645-1.43519*Ba)-3.2452))*u*u+(.848013+Ba*(.215638*Ba-1.06021)))}const Wt=aa.sub(ia)._mult(Vt)._add(ia)._unit()._mult(so?-1:1);this.addHalfVertex(zn,Wt.x,Wt.y,!1,so,0,Jr)}}ta&&this.addCurrentVertex(zn,aa,-F,-Vt,Jr)}else if("butt"===ho)this.addCurrentVertex(zn,va,0,0,Jr);else if("square"===ho){const u=Qs?1:-1;this.addCurrentVertex(zn,va,u,u,Jr)}else"round"===ho&&(Qs&&(this.addCurrentVertex(zn,ia,0,0,Jr),this.addCurrentVertex(zn,ia,1,1,Jr,!0)),ta&&(this.addCurrentVertex(zn,aa,-1,-1,Jr,!0),this.addCurrentVertex(zn,aa,0,0,Jr)));if(io&&F<_r-1){const u=zn.dist(ta);if(u>2*Ar){const F=zn.add(ta.sub(zn)._mult(Ar/u)._round());this.updateDistance(zn,F),this.addCurrentVertex(F,aa,0,0,Jr),zn=F}}}}addCurrentVertex(u,F,Vt,Wt,Kt,Qi=!1){const fr=F.y*Wt-F.x,_r=-F.y-F.x*Wt;this.addHalfVertex(u,F.x+F.y*Vt,F.y-F.x*Vt,Qi,!1,Vt,Kt),this.addHalfVertex(u,fr,_r,Qi,!0,-Wt,Kt),this.distance>id/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,F,Vt,Wt,Kt,Qi))}addHalfVertex({x:u,y:F},Vt,Wt,Kt,Qi,fr,_r){const Sr=.5*(this.lineClips?this.scaledDistance*(id-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((u<<1)+(Kt?1:0),(F<<1)+(Qi?1:0),Math.round(63*Vt)+128,Math.round(63*Wt)+128,1+(0===fr?0:fr<0?-1:1)|(63&Sr)<<2,Sr>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Ar=_r.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ar),_r.primitiveLength++),Qi?this.e2=Ar:this.e1=Ar}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,F){this.distance+=u.dist(F),this.updateScaledDistance()}}let rd,nd;wi("LineBucket",Ol,{omit:["layers","patternFeatures"]});var sd={get paint(){return nd=nd||new Hi({"line-opacity":new Ki(Ya.paint_line["line-opacity"]),"line-color":new Ki(Ya.paint_line["line-color"]),"line-translate":new Zi(Ya.paint_line["line-translate"]),"line-translate-anchor":new Zi(Ya.paint_line["line-translate-anchor"]),"line-width":new Ki(Ya.paint_line["line-width"]),"line-gap-width":new Ki(Ya.paint_line["line-gap-width"]),"line-offset":new Ki(Ya.paint_line["line-offset"]),"line-blur":new Ki(Ya.paint_line["line-blur"]),"line-dasharray":new Ji(Ya.paint_line["line-dasharray"]),"line-pattern":new Gi(Ya.paint_line["line-pattern"]),"line-gradient":new Xi(Ya.paint_line["line-gradient"])})},get layout(){return rd=rd||new Hi({"line-cap":new Zi(Ya.layout_line["line-cap"]),"line-join":new Ki(Ya.layout_line["line-join"]),"line-miter-limit":new Zi(Ya.layout_line["line-miter-limit"]),"line-round-limit":new Zi(Ya.layout_line["line-round-limit"]),"line-sort-key":new Ki(Ya.layout_line["line-sort-key"])})}};class ql extends Ki{possiblyEvaluate(u,F){return F=new $i(Math.floor(F.zoom),{now:F.now,fadeDuration:F.fadeDuration,zoomHistory:F.zoomHistory,transition:F.transition}),super.possiblyEvaluate(u,F)}evaluate(u,F,Vt,Wt){return F=g({},F,{zoom:Math.floor(F.zoom)}),super.evaluate(u,F,Vt,Wt)}}let ad;class Zl extends Wi{constructor(u){super(u,sd),this.gradientVersion=0,ad||(ad=new ql(sd.paint.properties["line-width"].specification),ad.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if("line-gradient"===u){const u=this.gradientExpression();this.stepInterpolant=!!function(u){return void 0!==u._styleExpression}(u)&&u._styleExpression.expression instanceof Ae,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,F){super.recalculate(u,F),this.paint._values["line-floorwidth"]=ad.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new Ol(u)}queryRadius(u){const F=u,Vt=Kl(Ja("line-width",this,F),Ja("line-gap-width",this,F)),Wt=Ja("line-offset",this,F);return Vt/2+Math.abs(Wt)+Xa(this.paint.get("line-translate"))}queryIntersectsFeature(u,F,Vt,Kt,Qi,fr,_r){const Sr=Ha(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),fr.angle,_r),Ar=_r/2*Kl(this.paint.get("line-width").evaluate(F,Vt),this.paint.get("line-gap-width").evaluate(F,Vt)),Jr=this.paint.get("line-offset").evaluate(F,Vt);return Jr&&(Kt=function(u,F){const Vt=[];for(let Kt=0;Kt<u.length;Kt++){const Qi=u[Kt],fr=[];for(let u=0;u<Qi.length;u++){const Vt=Qi[u-1],Kt=Qi[u],_r=Qi[u+1],Sr=0===u?new Wt(0,0):Kt.sub(Vt)._unit()._perp(),Ar=u===Qi.length-1?new Wt(0,0):_r.sub(Kt)._unit()._perp(),Jr=Sr._add(Ar)._unit(),zn=Jr.x*Ar.x+Jr.y*Ar.y;0!==zn&&Jr._mult(1/zn),fr.push(Jr._mult(F)._add(Kt))}Vt.push(fr)}return Vt}(Kt,Jr*_r)),function(u,F,Vt){for(let Wt=0;Wt<F.length;Wt++){const Kt=F[Wt];if(u.length>=3)for(let F=0;F<Kt.length;F++)if(Ka(u,Kt[F]))return!0;if(Ra(u,Kt,Vt))return!0}return!1}(Sr,Kt,Ar)}isTileClipped(){return!0}}function Kl(u,F){return F>0?F+2*u:u}const od=rs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ld=rs([{name:"a_projected_pos",components:3,type:"Float32"}],4);rs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cd=rs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);rs([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hd=rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ud=rs([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Wl(u,F,Vt){return u.sections.forEach((u=>{u.text=function(u,F,Vt){const Wt=F.layout.get("text-transform").evaluate(Vt,{});return"uppercase"===Wt?u=u.toLocaleUpperCase():"lowercase"===Wt&&(u=u.toLocaleLowerCase()),yc.applyArabicShaping&&(u=yc.applyArabicShaping(u)),u}(u.text,F,Vt)})),u}rs([{name:"triangle",components:3,type:"Uint16"}]),rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),rs([{type:"Float32",name:"offsetX"}]),rs([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),rs([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const dd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var pd=24,fd=iu,ru=function(u,F,Vt,Wt,Kt){var Qi,fr,_r=8*Kt-Wt-1,Sr=(1<<_r)-1,Ar=Sr>>1,Jr=-7,zn=Vt?Kt-1:0,Qs=Vt?-1:1,ta=u[F+zn];for(zn+=Qs,Qi=ta&(1<<-Jr)-1,ta>>=-Jr,Jr+=_r;Jr>0;Qi=256*Qi+u[F+zn],zn+=Qs,Jr-=8);for(fr=Qi&(1<<-Jr)-1,Qi>>=-Jr,Jr+=Wt;Jr>0;fr=256*fr+u[F+zn],zn+=Qs,Jr-=8);if(0===Qi)Qi=1-Ar;else{if(Qi===Sr)return fr?NaN:1/0*(ta?-1:1);fr+=Math.pow(2,Wt),Qi-=Ar}return(ta?-1:1)*fr*Math.pow(2,Qi-Wt)},nu=function(u,F,Vt,Wt,Kt,Qi){var fr,_r,Sr,Ar=8*Qi-Kt-1,Jr=(1<<Ar)-1,zn=Jr>>1,Qs=23===Kt?Math.pow(2,-24)-Math.pow(2,-77):0,ta=Wt?0:Qi-1,ia=Wt?1:-1,aa=F<0||0===F&&1/F<0?1:0;for(F=Math.abs(F),isNaN(F)||F===1/0?(_r=isNaN(F)?1:0,fr=Jr):(fr=Math.floor(Math.log(F)/Math.LN2),F*(Sr=Math.pow(2,-fr))<1&&(fr--,Sr*=2),(F+=fr+zn>=1?Qs/Sr:Qs*Math.pow(2,1-zn))*Sr>=2&&(fr++,Sr/=2),fr+zn>=Jr?(_r=0,fr=Jr):fr+zn>=1?(_r=(F*Sr-1)*Math.pow(2,Kt),fr+=zn):(_r=F*Math.pow(2,zn-1)*Math.pow(2,Kt),fr=0));Kt>=8;u[Vt+ta]=255&_r,ta+=ia,_r/=256,Kt-=8);for(fr=fr<<Kt|_r,Ar+=Kt;Ar>0;u[Vt+ta]=255&fr,ta+=ia,fr/=256,Ar-=8);u[Vt+ta-ia]|=128*aa};function iu(F){(this||u).buf=ArrayBuffer.isView&&ArrayBuffer.isView(F)?F:new Uint8Array(F||0),(this||u).pos=0,(this||u).type=0,(this||u).length=(this||u).buf.length}iu.Varint=0,iu.Fixed64=1,iu.Bytes=2,iu.Fixed32=5;var md=4294967296,_d=1/md,gd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function lu(u){return u.type===iu.Bytes?u.readVarint()+u.pos:u.pos+1}function uu(u,F,Vt){return Vt?4294967296*F+(u>>>0):4294967296*(F>>>0)+(u>>>0)}function cu(u,F,Vt){var Wt=F<=16383?1:F<=2097151?2:F<=268435455?3:Math.floor(Math.log(F)/(7*Math.LN2));Vt.realloc(Wt);for(var Kt=Vt.pos-1;Kt>=u;Kt--)Vt.buf[Kt+Wt]=Vt.buf[Kt]}function hu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeVarint(u[Vt])}function pu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeSVarint(u[Vt])}function fu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeFloat(u[Vt])}function du(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeDouble(u[Vt])}function yu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeBoolean(u[Vt])}function mu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeFixed32(u[Vt])}function gu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeSFixed32(u[Vt])}function xu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeFixed64(u[Vt])}function vu(u,F){for(var Vt=0;Vt<u.length;Vt++)F.writeSFixed64(u[Vt])}function bu(u,F){return(u[F]|u[F+1]<<8|u[F+2]<<16)+16777216*u[F+3]}function wu(u,F,Vt){u[Vt]=F,u[Vt+1]=F>>>8,u[Vt+2]=F>>>16,u[Vt+3]=F>>>24}function _u(u,F){return(u[F]|u[F+1]<<8|u[F+2]<<16)+(u[F+3]<<24)}iu.prototype={destroy:function(){(this||u).buf=null},readFields:function(F,Vt,Wt){for(Wt=Wt||(this||u).length;(this||u).pos<Wt;){var Kt=this.readVarint(),Qi=Kt>>3,fr=(this||u).pos;(this||u).type=7&Kt,F(Qi,Vt,this||u),(this||u).pos===fr&&this.skip(Kt)}return Vt},readMessage:function(F,Vt){return this.readFields(F,Vt,this.readVarint()+(this||u).pos)},readFixed32:function(){var F=bu((this||u).buf,(this||u).pos);return(this||u).pos+=4,F},readSFixed32:function(){var F=_u((this||u).buf,(this||u).pos);return(this||u).pos+=4,F},readFixed64:function(){var F=bu((this||u).buf,(this||u).pos)+bu((this||u).buf,(this||u).pos+4)*md;return(this||u).pos+=8,F},readSFixed64:function(){var F=bu((this||u).buf,(this||u).pos)+_u((this||u).buf,(this||u).pos+4)*md;return(this||u).pos+=8,F},readFloat:function(){var F=ru((this||u).buf,(this||u).pos,!0,23,4);return(this||u).pos+=4,F},readDouble:function(){var F=ru((this||u).buf,(this||u).pos,!0,52,8);return(this||u).pos+=8,F},readVarint:function(F){var Vt,Wt,Kt=(this||u).buf;return Vt=127&(Wt=Kt[(this||u).pos++]),Wt<128?Vt:(Vt|=(127&(Wt=Kt[(this||u).pos++]))<<7,Wt<128?Vt:(Vt|=(127&(Wt=Kt[(this||u).pos++]))<<14,Wt<128?Vt:(Vt|=(127&(Wt=Kt[(this||u).pos++]))<<21,Wt<128?Vt:function(u,F,Vt){var Wt,Kt,Qi=Vt.buf;if(Wt=(112&(Kt=Qi[Vt.pos++]))>>4,Kt<128)return uu(u,Wt,F);if(Wt|=(127&(Kt=Qi[Vt.pos++]))<<3,Kt<128)return uu(u,Wt,F);if(Wt|=(127&(Kt=Qi[Vt.pos++]))<<10,Kt<128)return uu(u,Wt,F);if(Wt|=(127&(Kt=Qi[Vt.pos++]))<<17,Kt<128)return uu(u,Wt,F);if(Wt|=(127&(Kt=Qi[Vt.pos++]))<<24,Kt<128)return uu(u,Wt,F);if(Wt|=(1&(Kt=Qi[Vt.pos++]))<<31,Kt<128)return uu(u,Wt,F);throw new Error("Expected varint not more than 10 bytes")}(Vt|=(15&(Wt=Kt[(this||u).pos]))<<28,F,this||u))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var F=this.readVarint()+(this||u).pos,Vt=(this||u).pos;return(this||u).pos=F,F-Vt>=12&&gd?function(u,F,Vt){return gd.decode(u.subarray(F,Vt))}((this||u).buf,Vt,F):function(u,F,Vt){for(var Wt="",Kt=F;Kt<Vt;){var Qi,fr,_r,Sr=u[Kt],Ar=null,Jr=Sr>239?4:Sr>223?3:Sr>191?2:1;if(Kt+Jr>Vt)break;1===Jr?Sr<128&&(Ar=Sr):2===Jr?128==(192&(Qi=u[Kt+1]))&&(Ar=(31&Sr)<<6|63&Qi)<=127&&(Ar=null):3===Jr?(fr=u[Kt+2],128==(192&(Qi=u[Kt+1]))&&128==(192&fr)&&((Ar=(15&Sr)<<12|(63&Qi)<<6|63&fr)<=2047||Ar>=55296&&Ar<=57343)&&(Ar=null)):4===Jr&&(fr=u[Kt+2],_r=u[Kt+3],128==(192&(Qi=u[Kt+1]))&&128==(192&fr)&&128==(192&_r)&&((Ar=(15&Sr)<<18|(63&Qi)<<12|(63&fr)<<6|63&_r)<=65535||Ar>=1114112)&&(Ar=null)),null===Ar?(Ar=65533,Jr=1):Ar>65535&&(Ar-=65536,Wt+=String.fromCharCode(Ar>>>10&1023|55296),Ar=56320|1023&Ar),Wt+=String.fromCharCode(Ar),Kt+=Jr}return Wt}((this||u).buf,Vt,F)},readBytes:function(){var F=this.readVarint()+(this||u).pos,Vt=(this||u).buf.subarray((this||u).pos,F);return(this||u).pos=F,Vt},readPackedVarint:function(F,Vt){if((this||u).type!==iu.Bytes)return F.push(this.readVarint(Vt));var Wt=lu(this||u);for(F=F||[];(this||u).pos<Wt;)F.push(this.readVarint(Vt));return F},readPackedSVarint:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readSVarint());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readSVarint());return F},readPackedBoolean:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readBoolean());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readBoolean());return F},readPackedFloat:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readFloat());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readFloat());return F},readPackedDouble:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readDouble());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readDouble());return F},readPackedFixed32:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readFixed32());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readFixed32());return F},readPackedSFixed32:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readSFixed32());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readSFixed32());return F},readPackedFixed64:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readFixed64());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readFixed64());return F},readPackedSFixed64:function(F){if((this||u).type!==iu.Bytes)return F.push(this.readSFixed64());var Vt=lu(this||u);for(F=F||[];(this||u).pos<Vt;)F.push(this.readSFixed64());return F},skip:function(F){var Vt=7&F;if(Vt===iu.Varint)for(;(this||u).buf[(this||u).pos++]>127;);else if(Vt===iu.Bytes)(this||u).pos=this.readVarint()+(this||u).pos;else if(Vt===iu.Fixed32)(this||u).pos+=4;else{if(Vt!==iu.Fixed64)throw new Error("Unimplemented type: "+Vt);(this||u).pos+=8}},writeTag:function(u,F){this.writeVarint(u<<3|F)},realloc:function(F){for(var Vt=(this||u).length||16;Vt<(this||u).pos+F;)Vt*=2;if(Vt!==(this||u).length){var Wt=new Uint8Array(Vt);Wt.set((this||u).buf),(this||u).buf=Wt,(this||u).length=Vt}},finish:function(){return(this||u).length=(this||u).pos,(this||u).pos=0,(this||u).buf.subarray(0,(this||u).length)},writeFixed32:function(F){this.realloc(4),wu((this||u).buf,F,(this||u).pos),(this||u).pos+=4},writeSFixed32:function(F){this.realloc(4),wu((this||u).buf,F,(this||u).pos),(this||u).pos+=4},writeFixed64:function(F){this.realloc(8),wu((this||u).buf,-1&F,(this||u).pos),wu((this||u).buf,Math.floor(F*_d),(this||u).pos+4),(this||u).pos+=8},writeSFixed64:function(F){this.realloc(8),wu((this||u).buf,-1&F,(this||u).pos),wu((this||u).buf,Math.floor(F*_d),(this||u).pos+4),(this||u).pos+=8},writeVarint:function(F){(F=+F||0)>268435455||F<0?function(u,F){var Vt,Wt;if(u>=0?(Vt=u%4294967296|0,Wt=u/4294967296|0):(Wt=~(-u/4294967296),4294967295^(Vt=~(-u%4294967296))?Vt=Vt+1|0:(Vt=0,Wt=Wt+1|0)),u>=0x10000000000000000||u<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");F.realloc(10),function(u,F,Vt){Vt.buf[Vt.pos++]=127&u|128,u>>>=7,Vt.buf[Vt.pos++]=127&u|128,u>>>=7,Vt.buf[Vt.pos++]=127&u|128,u>>>=7,Vt.buf[Vt.pos++]=127&u|128,Vt.buf[Vt.pos]=127&(u>>>=7)}(Vt,0,F),function(u,F){var Vt=(7&u)<<4;F.buf[F.pos++]|=Vt|((u>>>=3)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u|((u>>>=7)?128:0),u&&(F.buf[F.pos++]=127&u)))))}(Wt,F)}(F,this||u):(this.realloc(4),(this||u).buf[(this||u).pos++]=127&F|(F>127?128:0),F<=127||((this||u).buf[(this||u).pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||((this||u).buf[(this||u).pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||((this||u).buf[(this||u).pos++]=F>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(Boolean(u))},writeString:function(F){F=String(F),this.realloc(4*F.length),(this||u).pos++;var Vt=(this||u).pos;(this||u).pos=function(u,F,Vt){for(var Wt,Kt,Qi=0;Qi<F.length;Qi++){if((Wt=F.charCodeAt(Qi))>55295&&Wt<57344){if(!Kt){Wt>56319||Qi+1===F.length?(u[Vt++]=239,u[Vt++]=191,u[Vt++]=189):Kt=Wt;continue}if(Wt<56320){u[Vt++]=239,u[Vt++]=191,u[Vt++]=189,Kt=Wt;continue}Wt=Kt-55296<<10|Wt-56320|65536,Kt=null}else Kt&&(u[Vt++]=239,u[Vt++]=191,u[Vt++]=189,Kt=null);Wt<128?u[Vt++]=Wt:(Wt<2048?u[Vt++]=Wt>>6|192:(Wt<65536?u[Vt++]=Wt>>12|224:(u[Vt++]=Wt>>18|240,u[Vt++]=Wt>>12&63|128),u[Vt++]=Wt>>6&63|128),u[Vt++]=63&Wt|128)}return Vt}((this||u).buf,F,(this||u).pos);var Wt=(this||u).pos-Vt;Wt>=128&&cu(Vt,Wt,this||u),(this||u).pos=Vt-1,this.writeVarint(Wt),(this||u).pos+=Wt},writeFloat:function(F){this.realloc(4),nu((this||u).buf,F,(this||u).pos,!0,23,4),(this||u).pos+=4},writeDouble:function(F){this.realloc(8),nu((this||u).buf,F,(this||u).pos,!0,52,8),(this||u).pos+=8},writeBytes:function(F){var Vt=F.length;this.writeVarint(Vt),this.realloc(Vt);for(var Wt=0;Wt<Vt;Wt++)(this||u).buf[(this||u).pos++]=F[Wt]},writeRawMessage:function(F,Vt){(this||u).pos++;var Wt=(this||u).pos;F(Vt,this||u);var Kt=(this||u).pos-Wt;Kt>=128&&cu(Wt,Kt,this||u),(this||u).pos=Wt-1,this.writeVarint(Kt),(this||u).pos+=Kt},writeMessage:function(u,F,Vt){this.writeTag(u,iu.Bytes),this.writeRawMessage(F,Vt)},writePackedVarint:function(u,F){F.length&&this.writeMessage(u,hu,F)},writePackedSVarint:function(u,F){F.length&&this.writeMessage(u,pu,F)},writePackedBoolean:function(u,F){F.length&&this.writeMessage(u,yu,F)},writePackedFloat:function(u,F){F.length&&this.writeMessage(u,fu,F)},writePackedDouble:function(u,F){F.length&&this.writeMessage(u,du,F)},writePackedFixed32:function(u,F){F.length&&this.writeMessage(u,mu,F)},writePackedSFixed32:function(u,F){F.length&&this.writeMessage(u,gu,F)},writePackedFixed64:function(u,F){F.length&&this.writeMessage(u,xu,F)},writePackedSFixed64:function(u,F){F.length&&this.writeMessage(u,vu,F)},writeBytesField:function(u,F){this.writeTag(u,iu.Bytes),this.writeBytes(F)},writeFixed32Field:function(u,F){this.writeTag(u,iu.Fixed32),this.writeFixed32(F)},writeSFixed32Field:function(u,F){this.writeTag(u,iu.Fixed32),this.writeSFixed32(F)},writeFixed64Field:function(u,F){this.writeTag(u,iu.Fixed64),this.writeFixed64(F)},writeSFixed64Field:function(u,F){this.writeTag(u,iu.Fixed64),this.writeSFixed64(F)},writeVarintField:function(u,F){this.writeTag(u,iu.Varint),this.writeVarint(F)},writeSVarintField:function(u,F){this.writeTag(u,iu.Varint),this.writeSVarint(F)},writeStringField:function(u,F){this.writeTag(u,iu.Bytes),this.writeString(F)},writeFloatField:function(u,F){this.writeTag(u,iu.Fixed32),this.writeFloat(F)},writeDoubleField:function(u,F){this.writeTag(u,iu.Fixed64),this.writeDouble(F)},writeBooleanField:function(u,F){this.writeVarintField(u,Boolean(F))}};var yd=r(fd);const xd=3;function ku(u,F,Vt){1===u&&Vt.readMessage(Mu,F)}function Mu(u,F,Vt){if(3===u){const{id:u,bitmap:Wt,width:Kt,height:Qi,left:fr,top:_r,advance:Sr}=Vt.readMessage(Iu,{});F.push({id:u,bitmap:new mo({width:Kt+2*xd,height:Qi+2*xd},Wt),metrics:{width:Kt,height:Qi,left:fr,top:_r,advance:Sr}})}}function Iu(u,F,Vt){1===u?F.id=Vt.readVarint():2===u?F.bitmap=Vt.readBytes():3===u?F.width=Vt.readVarint():4===u?F.height=Vt.readVarint():5===u?F.left=Vt.readSVarint():6===u?F.top=Vt.readSVarint():7===u&&(F.advance=Vt.readVarint())}const vd=xd;function Pu(u){let F=0,Vt=0;for(const Wt of u)F+=Wt.w*Wt.h,Vt=Math.max(Vt,Wt.w);u.sort(((u,F)=>F.h-u.h));const Wt=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(F/.95)),Vt),h:1/0}];let Kt=0,Qi=0;for(const F of u)for(let u=Wt.length-1;u>=0;u--){const Vt=Wt[u];if(!(F.w>Vt.w||F.h>Vt.h)){if(F.x=Vt.x,F.y=Vt.y,Qi=Math.max(Qi,F.y+F.h),Kt=Math.max(Kt,F.x+F.w),F.w===Vt.w&&F.h===Vt.h){const F=Wt.pop();u<Wt.length&&(Wt[u]=F)}else F.h===Vt.h?(Vt.x+=F.w,Vt.w-=F.w):F.w===Vt.w?(Vt.y+=F.h,Vt.h-=F.h):(Wt.push({x:Vt.x+F.w,y:Vt.y,w:Vt.w-F.w,h:F.h}),Vt.y+=F.h,Vt.h-=F.h);break}}return{w:Kt,h:Qi,fill:F/(Kt*Qi)||0}}const bd=1;class Cu{constructor(u,{pixelRatio:F,version:Vt,stretchX:Wt,stretchY:Kt,content:Qi,textFitWidth:fr,textFitHeight:_r}){this.paddedRect=u,this.pixelRatio=F,this.stretchX=Wt,this.stretchY=Kt,this.content=Qi,this.version=Vt,this.textFitWidth=fr,this.textFitHeight=_r}get tl(){return[this.paddedRect.x+bd,this.paddedRect.y+bd]}get br(){return[this.paddedRect.x+this.paddedRect.w-bd,this.paddedRect.y+this.paddedRect.h-bd]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*bd)/this.pixelRatio,(this.paddedRect.h-2*bd)/this.pixelRatio]}}class Vu{constructor(u,F){const Vt={},Wt={};this.haveRenderCallbacks=[];const Kt=[];this.addImages(u,Vt,Kt),this.addImages(F,Wt,Kt);const{w:Qi,h:fr}=Pu(Kt),_r=new go({width:Qi||1,height:fr||1});for(const F in u){const Wt=u[F],Kt=Vt[F].paddedRect;go.copy(Wt.data,_r,{x:0,y:0},{x:Kt.x+bd,y:Kt.y+bd},Wt.data)}for(const u in F){const Vt=F[u],Kt=Wt[u].paddedRect,Qi=Kt.x+bd,fr=Kt.y+bd,Sr=Vt.data.width,Ar=Vt.data.height;go.copy(Vt.data,_r,{x:0,y:0},{x:Qi,y:fr},Vt.data),go.copy(Vt.data,_r,{x:0,y:Ar-1},{x:Qi,y:fr-1},{width:Sr,height:1}),go.copy(Vt.data,_r,{x:0,y:0},{x:Qi,y:fr+Ar},{width:Sr,height:1}),go.copy(Vt.data,_r,{x:Sr-1,y:0},{x:Qi-1,y:fr},{width:1,height:Ar}),go.copy(Vt.data,_r,{x:0,y:0},{x:Qi+Sr,y:fr},{width:1,height:Ar})}this.image=_r,this.iconPositions=Vt,this.patternPositions=Wt}addImages(u,F,Vt){for(const Wt in u){const Kt=u[Wt],Qi={x:0,y:0,w:Kt.data.width+2*bd,h:Kt.data.height+2*bd};Vt.push(Qi),F[Wt]=new Cu(Qi,Kt),Kt.hasRenderCallback&&this.haveRenderCallbacks.push(Wt)}}patchUpdatedImages(u,F){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const Vt in u.updatedImages)this.patchUpdatedImage(this.iconPositions[Vt],u.getImage(Vt),F),this.patchUpdatedImage(this.patternPositions[Vt],u.getImage(Vt),F)}patchUpdatedImage(u,F,Vt){if(!u||!F)return;if(u.version===F.version)return;u.version=F.version;const[Wt,Kt]=u.tl;Vt.update(F.data,void 0,{x:Wt,y:Kt})}}var wd;wi("ImagePosition",Cu),wi("ImageAtlas",Vu),F.ah=void 0,(wd=F.ah||(F.ah={}))[wd.none=0]="none",wd[wd.horizontal=1]="horizontal",wd[wd.vertical=2]="vertical",wd[wd.horizontalOnly=3]="horizontalOnly";const Td=-17;class Tu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,F){const Vt=new Tu;return Vt.scale=u||1,Vt.fontStack=F,Vt}static forImage(u){const F=new Tu;return F.imageName=u,F}}class $u{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,F){const Vt=new $u;for(let Wt=0;Wt<u.sections.length;Wt++){const Kt=u.sections[Wt];Kt.image?Vt.addImageSection(Kt):Vt.addTextSection(Kt,F)}return Vt}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let F="";for(let Vt=0;Vt<u.length;Vt++){const Wt=u.charCodeAt(Vt+1)||null,Kt=u.charCodeAt(Vt-1)||null;F+=Wt&&Ci(Wt)&&!dd[u[Vt+1]]||Kt&&Ci(Kt)&&!dd[u[Vt-1]]||!dd[u[Vt]]?u[Vt]:dd[u[Vt]]}return F}(this.text)}trim(){let u=0;for(let F=0;F<this.text.length&&Sd[this.text.charCodeAt(F)];F++)u++;let F=this.text.length;for(let Vt=this.text.length-1;Vt>=0&&Vt>=u&&Sd[this.text.charCodeAt(Vt)];Vt--)F--;this.text=this.text.substring(u,F),this.sectionIndex=this.sectionIndex.slice(u,F)}substring(u,F){const Vt=new $u;return Vt.text=this.text.substring(u,F),Vt.sectionIndex=this.sectionIndex.slice(u,F),Vt.sections=this.sections,Vt}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((u,F)=>Math.max(u,this.sections[F].scale)),0)}addTextSection(u,F){this.text+=u.text,this.sections.push(Tu.forText(u.scale,u.fontStack||F));const Vt=this.sections.length-1;for(let F=0;F<u.text.length;++F)this.sectionIndex.push(Vt)}addImageSection(u){const F=u.image?u.image.name:"";if(0===F.length)return void A("Can't add FormattedSection with an empty image.");const Vt=this.getNextImageSectionCharCode();Vt?(this.text+=String.fromCharCode(Vt),this.sections.push(Tu.forImage(F)),this.sectionIndex.push(this.sections.length-1)):A("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lu(u,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va){const Ba=$u.fromFeature(u,Qi);let Ya;Qs===F.ah.vertical&&Ba.verticalizePunctuation();const{processBidirectionalText:to,processStyledBidirectionalText:eo}=yc;if(to&&1===Ba.sections.length){Ya=[];const u=to(Ba.toString(),Zu(Ba,Jr,fr,Vt,Kt,ia,aa));for(const F of u){const u=new $u;u.text=F,u.sections=Ba.sections;for(let Vt=0;Vt<F.length;Vt++)u.sectionIndex.push(0);Ya.push(u)}}else if(eo){Ya=[];const u=eo(Ba.text,Ba.sectionIndex,Zu(Ba,Jr,fr,Vt,Kt,ia,aa));for(const F of u){const u=new $u;u.text=F[0],u.sectionIndex=F[1],u.sections=Ba.sections,Ya.push(u)}}else Ya=function(u,F){const Vt=[],Wt=u.text;let Kt=0;for(const Wt of F)Vt.push(u.substring(Kt,Wt)),Kt=Wt;return Kt<Wt.length&&Vt.push(u.substring(Kt,Wt.length)),Vt}(Ba,Zu(Ba,Jr,fr,Vt,Kt,ia,aa));const io=[],so={positionedLines:io,text:Ba.toString(),top:zn[1],bottom:zn[1],left:zn[0],right:zn[0],writingMode:Qs,iconsInText:!1,verticalizable:!1};return function(u,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs){let ta=0,ia=Td,aa=0,va=0;const Ba="right"===Sr?1:"left"===Sr?0:.5;let Ya=0;for(const _r of Qi){_r.trim();const Qi=_r.getMaxScale(),Sr=(Qi-1)*pd,eo={positionedGlyphs:[],lineOffset:0};u.positionedLines[Ya]=eo;const io=eo.positionedGlyphs;let so=0;if(!_r.length()){ia+=fr,++Ya;continue}for(let fr=0;fr<_r.length();fr++){const aa=_r.getSection(fr),va=_r.getSectionIndex(fr),Ba=_r.getCharCode(fr);let Ya=0,eo=null,co=null,ho=null,bo=pd;const wo=!(Ar===F.ah.horizontal||!zn&&!Bi(Ba)||zn&&(Sd[Ba]||(to=Ba,mc.Arabic(to)||mc["Arabic Supplement"](to)||mc["Arabic Extended-A"](to)||mc["Arabic Presentation Forms-A"](to)||mc["Arabic Presentation Forms-B"](to))));if(aa.imageName){const F=Kt[aa.imageName];if(!F)continue;ho=aa.imageName,u.iconsInText=u.iconsInText||!0,co=F.paddedRect;const Vt=F.displaySize;aa.scale=aa.scale*pd/Qs,eo={width:Vt[0],height:Vt[1],left:bd,top:-vd,advance:wo?Vt[1]:Vt[0]},Ya=Sr+(pd-Vt[1]*aa.scale),bo=eo.advance;const Wt=wo?Vt[0]*aa.scale-pd*Qi:Vt[1]*aa.scale-pd*Qi;Wt>0&&Wt>so&&(so=Wt)}else{const u=Wt[aa.fontStack],F=u&&u[Ba];if(F&&F.rect)co=F.rect,eo=F.metrics;else{const u=Vt[aa.fontStack],F=u&&u[Ba];if(!F)continue;eo=F.metrics}Ya=(Qi-aa.scale)*pd}wo?(u.verticalizable=!0,io.push({glyph:Ba,imageName:ho,x:ta,y:ia+Ya,vertical:wo,scale:aa.scale,fontStack:aa.fontStack,sectionIndex:va,metrics:eo,rect:co}),ta+=bo*aa.scale+Jr):(io.push({glyph:Ba,imageName:ho,x:ta,y:ia+Ya,vertical:wo,scale:aa.scale,fontStack:aa.fontStack,sectionIndex:va,metrics:eo,rect:co}),ta+=eo.advance*aa.scale+Jr)}0!==io.length&&(aa=Math.max(ta-Jr,aa),Gu(io,0,io.length-1,Ba,so)),ta=0;const co=fr*Qi+so;eo.lineOffset=Math.max(so,Sr),ia+=co,va=Math.max(co,va),++Ya}var to;const eo=ia-Td,{horizontalAlign:io,verticalAlign:so}=Ku(_r);(function(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){const Ar=(F-Vt)*Kt;let Jr=0;Jr=Qi!==fr?-_r*Wt-Td:(-Wt*Sr+.5)*fr;for(const F of u)for(const u of F.positionedGlyphs)u.x+=Ar,u.y+=Jr})(u.positionedLines,Ba,io,so,aa,va,fr,eo,Qi.length),u.top+=-so*eo,u.bottom=u.top+eo,u.left+=-io*aa,u.right=u.left+aa}(so,Vt,Wt,Kt,Ya,_r,Sr,Ar,Qs,Jr,ta,va),!function(u){for(const F of u)if(0!==F.positionedGlyphs.length)return!1;return!0}(io)&&so}const Sd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Id={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ru(u,F,Vt,Wt,Kt,Qi){if(F.imageName){const u=Wt[F.imageName];return u?u.displaySize[0]*F.scale*pd/Qi+Kt:0}{const Wt=Vt[F.fontStack],Qi=Wt&&Wt[u];return Qi?Qi.metrics.advance*F.scale+Kt:0}}function Uu(u,F,Vt,Wt){const Kt=Math.pow(u-F,2);return Wt?u<F?Kt/2:2*Kt:Kt+Math.abs(Vt)*Vt}function ju(u,F,Vt){let Wt=0;return 10===u&&(Wt-=1e4),Vt&&(Wt+=150),40!==u&&65288!==u||(Wt+=50),41!==F&&65289!==F||(Wt+=50),Wt}function qu(u,F,Vt,Wt,Kt,Qi){let fr=null,_r=Uu(F,Vt,Kt,Qi);for(const u of Wt){const Wt=Uu(F-u.x,Vt,Kt,Qi)+u.badness;Wt<=_r&&(fr=u,_r=Wt)}return{index:u,x:F,priorBreak:fr,badness:_r}}function Nu(u){return u?Nu(u.priorBreak).concat(u.index):[]}function Zu(u,F,Vt,Wt,Kt,Qi,fr){if("point"!==Qi)return[];if(!u)return[];const _r=[],Sr=function(u,F,Vt,Wt,Kt,Qi){let fr=0;for(let Vt=0;Vt<u.length();Vt++){const _r=u.getSection(Vt);fr+=Ru(u.getCharCode(Vt),_r,Wt,Kt,F,Qi)}return fr/Math.max(1,Math.ceil(fr/Vt))}(u,F,Vt,Wt,Kt,fr),Ar=u.text.indexOf("​")>=0;let Jr=0;for(let Vt=0;Vt<u.length();Vt++){const Qi=u.getSection(Vt),Qs=u.getCharCode(Vt);if(Sd[Qs]||(Jr+=Ru(Qs,Qi,Wt,Kt,F,fr)),Vt<u.length()-1){const F=!((zn=Qs)<11904||!(mc["Bopomofo Extended"](zn)||mc.Bopomofo(zn)||mc["CJK Compatibility Forms"](zn)||mc["CJK Compatibility Ideographs"](zn)||mc["CJK Compatibility"](zn)||mc["CJK Radicals Supplement"](zn)||mc["CJK Strokes"](zn)||mc["CJK Symbols and Punctuation"](zn)||mc["CJK Unified Ideographs Extension A"](zn)||mc["CJK Unified Ideographs"](zn)||mc["Enclosed CJK Letters and Months"](zn)||mc["Halfwidth and Fullwidth Forms"](zn)||mc.Hiragana(zn)||mc["Ideographic Description Characters"](zn)||mc["Kangxi Radicals"](zn)||mc["Katakana Phonetic Extensions"](zn)||mc.Katakana(zn)||mc["Vertical Forms"](zn)||mc["Yi Radicals"](zn)||mc["Yi Syllables"](zn)));(Id[Qs]||F||Qi.imageName)&&_r.push(qu(Vt+1,Jr,Sr,_r,ju(Qs,u.getCharCode(Vt+1),F&&Ar),!1))}}var zn;return Nu(qu(u.length(),Jr,Sr,_r,0,!0))}function Ku(u){let F=.5,Vt=.5;switch(u){case"right":case"top-right":case"bottom-right":F=1;break;case"left":case"top-left":case"bottom-left":F=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":Vt=1;break;case"top":case"top-right":case"top-left":Vt=0}return{horizontalAlign:F,verticalAlign:Vt}}function Gu(u,F,Vt,Wt,Kt){if(!Wt&&!Kt)return;const Qi=u[Vt],fr=(u[Vt].x+Qi.metrics.advance*Qi.scale)*Wt;for(let Wt=F;Wt<=Vt;Wt++)u[Wt].x-=fr,u[Wt].y+=Kt}function Ju(u,F,Vt){const{horizontalAlign:Wt,verticalAlign:Kt}=Ku(Vt),Qi=F[0]-u.displaySize[0]*Wt,fr=F[1]-u.displaySize[1]*Kt;return{image:u,top:fr,bottom:fr+u.displaySize[1],left:Qi,right:Qi+u.displaySize[0]}}function Xu(u){var F,Vt;let Wt=u.left,Kt=u.top,Qi=u.right-Wt,fr=u.bottom-Kt;const _r=null!==(F=u.image.textFitWidth)&&void 0!==F?F:"stretchOrShrink",Sr=null!==(Vt=u.image.textFitHeight)&&void 0!==Vt?Vt:"stretchOrShrink",Ar=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if("proportional"===Sr){if("stretchOnly"===_r&&Qi/fr<Ar||"proportional"===_r){const u=Math.ceil(fr*Ar);Wt*=u/Qi,Qi=u}}else if("proportional"===_r&&"stretchOnly"===Sr&&0!==Ar&&Qi/fr>Ar){const u=Math.ceil(Qi/Ar);Kt*=u/fr,fr=u}return{x1:Wt,y1:Kt,x2:Wt+Qi,y2:Kt+fr}}function Hu(u,F,Vt,Wt,Kt,Qi){const fr=u.image;let _r;if(fr.content){const u=fr.content,F=fr.pixelRatio||1;_r=[u[0]/F,u[1]/F,fr.displaySize[0]-u[2]/F,fr.displaySize[1]-u[3]/F]}const Sr=F.left*Qi,Ar=F.right*Qi;let Jr,zn,Qs,ta;"width"===Vt||"both"===Vt?(ta=Kt[0]+Sr-Wt[3],zn=Kt[0]+Ar+Wt[1]):(ta=Kt[0]+(Sr+Ar-fr.displaySize[0])/2,zn=ta+fr.displaySize[0]);const ia=F.top*Qi,aa=F.bottom*Qi;return"height"===Vt||"both"===Vt?(Jr=Kt[1]+ia-Wt[0],Qs=Kt[1]+aa+Wt[2]):(Jr=Kt[1]+(ia+aa-fr.displaySize[1])/2,Qs=Jr+fr.displaySize[1]),{image:fr,top:Jr,right:zn,bottom:Qs,left:ta,collisionPadding:_r}}const Ad=255,Pd=128,Md=Ad*Pd;function tc(u,F){const{expression:Vt}=F;if("constant"===Vt.kind)return{kind:"constant",layoutSize:Vt.evaluate(new $i(u+1))};if("source"===Vt.kind)return{kind:"source"};{const{zoomStops:F,interpolationType:Wt}=Vt;let Kt=0;for(;Kt<F.length&&F[Kt]<=u;)Kt++;Kt=Math.max(0,Kt-1);let Qi=Kt;for(;Qi<F.length&&F[Qi]<u+1;)Qi++;Qi=Math.min(F.length-1,Qi);const fr=F[Kt],_r=F[Qi];return"composite"===Vt.kind?{kind:"composite",minZoom:fr,maxZoom:_r,interpolationType:Wt}:{kind:"camera",minZoom:fr,maxZoom:_r,minSize:Vt.evaluate(new $i(fr)),maxSize:Vt.evaluate(new $i(_r)),interpolationType:Wt}}}function ec(u,F,Vt){let Wt="never";const Kt=u.get(F);return Kt?Wt=Kt:u.get(Vt)&&(Wt="always"),Wt}const Cd=su.VectorTileFeature.types,Ed=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ic(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs){const ta=_r?Math.min(Md,Math.round(_r[0])):0,ia=_r?Math.min(Md,Math.round(_r[1])):0;u.emplaceBack(F,Vt,Math.round(32*Wt),Math.round(32*Kt),Qi,fr,(ta<<1)+(Sr?1:0),ia,16*Ar,16*Jr,256*zn,256*Qs)}function sc(u,F,Vt){u.emplaceBack(F.x,F.y,Vt),u.emplaceBack(F.x,F.y,Vt),u.emplaceBack(F.x,F.y,Vt),u.emplaceBack(F.x,F.y,Vt)}function ac(u){for(const F of u.sections)if(Fi(F.text))return!0;return!1}class oc{constructor(u){this.layoutVertexArray=new Ks,this.indexArray=new Ys,this.programConfigurations=u,this.segments=new ea,this.dynamicLayoutVertexArray=new Gs,this.opacityVertexArray=new Js,this.hasVisibleVertices=!1,this.placedSymbolArray=new Bs}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(u,F,Vt,Wt){this.isEmpty()||(Vt&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,od.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,F),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,ld.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,Ed,!0),this.opacityVertexBuffer.itemSize=1),(Vt||Wt)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wi("SymbolBuffers",oc);class lc{constructor(u,F,Vt){this.layoutVertexArray=new u,this.layoutAttributes=F,this.indexArray=new Vt,this.segments=new ea,this.collisionVertexArray=new Hs}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,cd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wi("CollisionBuffers",lc);class uc{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ro([]),this.placementViewportMatrix=ro([]);const Vt=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tc(this.zoom,Vt["text-size"]),this.iconSizeData=tc(this.zoom,Vt["icon-size"]);const Wt=this.layers[0].layout,Kt=Wt.get("symbol-sort-key"),Qi=Wt.get("symbol-z-order");this.canOverlap="never"!==ec(Wt,"text-overlap","text-allow-overlap")||"never"!==ec(Wt,"icon-overlap","icon-allow-overlap")||Wt.get("text-ignore-placement")||Wt.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==Qi&&!Kt.isConstant(),this.sortFeaturesByY=("viewport-y"===Qi||"auto"===Qi&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===Wt.get("symbol-placement")&&(this.writingModes=Wt.get("text-writing-mode").map((u=>F.ah[u]))),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id)),this.sourceID=u.sourceID}createArrays(){this.text=new oc(new Ia(this.layers,this.zoom,(u=>/^text/.test(u)))),this.icon=new oc(new Ia(this.layers,this.zoom,(u=>/^icon/.test(u)))),this.glyphOffsetArray=new Es,this.lineVertexArray=new Fs,this.symbolInstances=new Vs,this.textAnchorOffsets=new $s}calculateGlyphDependencies(u,F,Vt,Wt,Kt){for(let Qi=0;Qi<u.length;Qi++)if(F[u.charCodeAt(Qi)]=!0,(Vt||Wt)&&Kt){const Vt=dd[u.charAt(Qi)];Vt&&(F[Vt.charCodeAt(0)]=!0)}}populate(u,Vt,Wt){const Kt=this.layers[0],Qi=Kt.layout,fr=Qi.get("text-font"),_r=Qi.get("text-field"),Sr=Qi.get("icon-image"),Ar=("constant"!==_r.value.kind||_r.value.value instanceof Ht&&!_r.value.value.isEmpty()||_r.value.value.toString().length>0)&&("constant"!==fr.value.kind||fr.value.value.length>0),Jr="constant"!==Sr.value.kind||!!Sr.value.value||Object.keys(Sr.parameters).length>0,zn=Qi.get("symbol-sort-key");if(this.features=[],!Ar&&!Jr)return;const Qs=Vt.iconDependencies,ta=Vt.glyphDependencies,ia=Vt.availableImages,aa=new $i(this.zoom);for(const{feature:Vt,id:_r,index:Sr,sourceLayerIndex:va}of u){const u=Kt._featureFilter.needGeometry,Ba=Fa(Vt,u);if(!Kt._featureFilter.filter(aa,Ba,Wt))continue;let Ya,to;if(u||(Ba.geometry=Ea(Vt)),Ar){const u=Kt.getValueAndResolveTokens("text-field",Ba,Wt,ia),F=Ht.factory(u),Vt=this.hasRTLText=this.hasRTLText||ac(F);(!Vt||"unavailable"===yc.getRTLTextPluginStatus()||Vt&&yc.isParsed())&&(Ya=Wl(F,Kt,Ba))}if(Jr){const u=Kt.getValueAndResolveTokens("icon-image",Ba,Wt,ia);to=u instanceof te?u:te.fromString(u)}if(!Ya&&!to)continue;const eo=this.sortFeaturesByKey?zn.evaluate(Ba,{},Wt):void 0;if(this.features.push({id:_r,text:Ya,icon:to,index:Sr,sourceLayerIndex:va,geometry:Ba.geometry,properties:Vt.properties,type:Cd[Vt.type],sortKey:eo}),to&&(Qs[to.name]=!0),Ya){const u=fr.evaluate(Ba,{},Wt).join(","),Vt="viewport"!==Qi.get("text-rotation-alignment")&&"point"!==Qi.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(F.ah.vertical)>=0;for(const F of Ya.sections)if(F.image)Qs[F.image.name]=!0;else{const Wt=Ii(Ya.toString()),Kt=F.fontStack||u,Qi=ta[Kt]=ta[Kt]||{};this.calculateGlyphDependencies(F.text,Qi,Vt,this.allowVerticalPlacement,Wt)}}}"line"===Qi.get("symbol-placement")&&(this.features=function(u){const F={},Vt={},Wt=[];let Kt=0;function s(F){Wt.push(u[F]),Kt++}function a(u,F,Kt){const Qi=Vt[u];return delete Vt[u],Vt[F]=Qi,Wt[Qi].geometry[0].pop(),Wt[Qi].geometry[0]=Wt[Qi].geometry[0].concat(Kt[0]),Qi}function o(u,Vt,Kt){const Qi=F[Vt];return delete F[Vt],F[u]=Qi,Wt[Qi].geometry[0].shift(),Wt[Qi].geometry[0]=Kt[0].concat(Wt[Qi].geometry[0]),Qi}function l(u,F,Vt){const Wt=Vt?F[0][F[0].length-1]:F[0][0];return`${u}:${Wt.x}:${Wt.y}`}for(let Qi=0;Qi<u.length;Qi++){const fr=u[Qi],_r=fr.geometry,Sr=fr.text?fr.text.toString():null;if(!Sr){s(Qi);continue}const Ar=l(Sr,_r),Jr=l(Sr,_r,!0);if(Ar in Vt&&Jr in F&&Vt[Ar]!==F[Jr]){const u=o(Ar,Jr,_r),Kt=a(Ar,Jr,Wt[u].geometry);delete F[Ar],delete Vt[Jr],Vt[l(Sr,Wt[Kt].geometry,!0)]=Kt,Wt[u].geometry=null}else Ar in Vt?a(Ar,Jr,_r):Jr in F?o(Ar,Jr,_r):(s(Qi),F[Ar]=Kt-1,Vt[Jr]=Kt-1)}return Wt.filter((u=>u.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((u,F)=>u.sortKey-F.sortKey))}update(u,F,Vt){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,F,this.layers,Vt),this.icon.programConfigurations.updatePaintArrays(u,F,this.layers,Vt))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,F){const Vt=this.lineVertexArray.length;if(void 0!==u.segment){let Vt=u.dist(F[u.segment+1]),Wt=u.dist(F[u.segment]);const Kt={};for(let Wt=u.segment+1;Wt<F.length;Wt++)Kt[Wt]={x:F[Wt].x,y:F[Wt].y,tileUnitDistanceFromAnchor:Vt},Wt<F.length-1&&(Vt+=F[Wt+1].dist(F[Wt]));for(let Vt=u.segment||0;Vt>=0;Vt--)Kt[Vt]={x:F[Vt].x,y:F[Vt].y,tileUnitDistanceFromAnchor:Wt},Vt>0&&(Wt+=F[Vt-1].dist(F[Vt]));for(let u=0;u<F.length;u++){const F=Kt[u];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:Vt,lineLength:this.lineVertexArray.length-Vt}}addSymbols(u,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs){const ta=u.indexArray,ia=u.layoutVertexArray,aa=u.segments.prepareSegment(4*Vt.length,ia,ta,this.canOverlap?fr.sortKey:void 0),va=this.glyphOffsetArray.length,Ba=aa.vertexLength,Ya=this.allowVerticalPlacement&&_r===F.ah.vertical?Math.PI/2:0,to=fr.text&&fr.text.sections;for(let F=0;F<Vt.length;F++){const{tl:Kt,tr:Qi,bl:_r,br:Ar,tex:Jr,pixelOffsetTL:zn,pixelOffsetBR:va,minFontScaleX:Ba,minFontScaleY:eo,glyphOffset:io,isSDF:so,sectionIndex:co}=Vt[F],ho=aa.vertexLength,bo=io[1];ic(ia,Sr.x,Sr.y,Kt.x,bo+Kt.y,Jr.x,Jr.y,Wt,so,zn.x,zn.y,Ba,eo),ic(ia,Sr.x,Sr.y,Qi.x,bo+Qi.y,Jr.x+Jr.w,Jr.y,Wt,so,va.x,zn.y,Ba,eo),ic(ia,Sr.x,Sr.y,_r.x,bo+_r.y,Jr.x,Jr.y+Jr.h,Wt,so,zn.x,va.y,Ba,eo),ic(ia,Sr.x,Sr.y,Ar.x,bo+Ar.y,Jr.x+Jr.w,Jr.y+Jr.h,Wt,so,va.x,va.y,Ba,eo),sc(u.dynamicLayoutVertexArray,Sr,Ya),ta.emplaceBack(ho,ho+1,ho+2),ta.emplaceBack(ho+1,ho+2,ho+3),aa.vertexLength+=4,aa.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(io[0]),F!==Vt.length-1&&co===Vt[F+1].sectionIndex||u.programConfigurations.populatePaintArrays(ia.length,fr,fr.index,{},Qs,to&&to[co])}u.placedSymbolArray.emplaceBack(Sr.x,Sr.y,va,this.glyphOffsetArray.length-va,Ba,Ar,Jr,Sr.segment,Wt?Wt[0]:0,Wt?Wt[1]:0,Kt[0],Kt[1],_r,0,!1,0,zn)}_addCollisionDebugVertex(u,F,Vt,Wt,Kt,Qi){return F.emplaceBack(0,0),u.emplaceBack(Vt.x,Vt.y,Wt,Kt,Math.round(Qi.x),Math.round(Qi.y))}addCollisionDebugVertices(u,F,Vt,Kt,Qi,fr,_r){const Sr=Qi.segments.prepareSegment(4,Qi.layoutVertexArray,Qi.indexArray),Ar=Sr.vertexLength,Jr=Qi.layoutVertexArray,zn=Qi.collisionVertexArray,Qs=_r.anchorX,ta=_r.anchorY;this._addCollisionDebugVertex(Jr,zn,fr,Qs,ta,new Wt(u,F)),this._addCollisionDebugVertex(Jr,zn,fr,Qs,ta,new Wt(Vt,F)),this._addCollisionDebugVertex(Jr,zn,fr,Qs,ta,new Wt(Vt,Kt)),this._addCollisionDebugVertex(Jr,zn,fr,Qs,ta,new Wt(u,Kt)),Sr.vertexLength+=4;const ia=Qi.indexArray;ia.emplaceBack(Ar,Ar+1),ia.emplaceBack(Ar+1,Ar+2),ia.emplaceBack(Ar+2,Ar+3),ia.emplaceBack(Ar+3,Ar),Sr.primitiveLength+=4}addDebugCollisionBoxes(u,F,Vt,Wt){for(let Kt=u;Kt<F;Kt++){const u=this.collisionBoxArray.get(Kt);this.addCollisionDebugVertices(u.x1,u.y1,u.x2,u.y2,Wt?this.textCollisionBox:this.iconCollisionBox,u.anchorPoint,Vt)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lc(Xs,hd.members,Ws),this.iconCollisionBox=new lc(Xs,hd.members,Ws);for(let u=0;u<this.symbolInstances.length;u++){const F=this.symbolInstances.get(u);this.addDebugCollisionBoxes(F.textBoxStartIndex,F.textBoxEndIndex,F,!0),this.addDebugCollisionBoxes(F.verticalTextBoxStartIndex,F.verticalTextBoxEndIndex,F,!0),this.addDebugCollisionBoxes(F.iconBoxStartIndex,F.iconBoxEndIndex,F,!1),this.addDebugCollisionBoxes(F.verticalIconBoxStartIndex,F.verticalIconBoxEndIndex,F,!1)}}_deserializeCollisionBoxesForSymbol(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){const Ar={};for(let Wt=F;Wt<Vt;Wt++){const F=u.get(Wt);Ar.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},Ar.textFeatureIndex=F.featureIndex;break}for(let F=Wt;F<Kt;F++){const Vt=u.get(F);Ar.verticalTextBox={x1:Vt.x1,y1:Vt.y1,x2:Vt.x2,y2:Vt.y2,anchorPointX:Vt.anchorPointX,anchorPointY:Vt.anchorPointY},Ar.verticalTextFeatureIndex=Vt.featureIndex;break}for(let F=Qi;F<fr;F++){const Vt=u.get(F);Ar.iconBox={x1:Vt.x1,y1:Vt.y1,x2:Vt.x2,y2:Vt.y2,anchorPointX:Vt.anchorPointX,anchorPointY:Vt.anchorPointY},Ar.iconFeatureIndex=Vt.featureIndex;break}for(let F=_r;F<Sr;F++){const Vt=u.get(F);Ar.verticalIconBox={x1:Vt.x1,y1:Vt.y1,x2:Vt.x2,y2:Vt.y2,anchorPointX:Vt.anchorPointX,anchorPointY:Vt.anchorPointY},Ar.verticalIconFeatureIndex=Vt.featureIndex;break}return Ar}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let F=0;F<this.symbolInstances.length;F++){const Vt=this.symbolInstances.get(F);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,Vt.textBoxStartIndex,Vt.textBoxEndIndex,Vt.verticalTextBoxStartIndex,Vt.verticalTextBoxEndIndex,Vt.iconBoxStartIndex,Vt.iconBoxEndIndex,Vt.verticalIconBoxStartIndex,Vt.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,F){const Vt=u.placedSymbolArray.get(F),Wt=Vt.vertexStartIndex+4*Vt.numGlyphs;for(let F=Vt.vertexStartIndex;F<Wt;F+=4)u.indexArray.emplaceBack(F,F+1,F+2),u.indexArray.emplaceBack(F+1,F+2,F+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const F=Math.sin(u),Vt=Math.cos(u),Wt=[],Kt=[],Qi=[];for(let u=0;u<this.symbolInstances.length;++u){Qi.push(u);const fr=this.symbolInstances.get(u);Wt.push(0|Math.round(F*fr.anchorX+Vt*fr.anchorY)),Kt.push(fr.featureIndex)}return Qi.sort(((u,F)=>Wt[u]-Wt[F]||Kt[F]-Kt[u])),Qi}addToSortKeyRanges(u,F){const Vt=this.sortKeyRanges[this.sortKeyRanges.length-1];Vt&&Vt.sortKey===F?Vt.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:F,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const F=this.symbolInstances.get(u);this.featureSortOrder.push(F.featureIndex),[F.rightJustifiedTextSymbolIndex,F.centerJustifiedTextSymbolIndex,F.leftJustifiedTextSymbolIndex].forEach(((u,F,Vt)=>{u>=0&&Vt.indexOf(u)===F&&this.addIndicesForPlacedSymbol(this.text,u)})),F.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,F.verticalPlacedTextSymbolIndex),F.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,F.placedIconSymbolIndex),F.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,F.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let kd,zd;wi("SymbolBucket",uc,{omit:["layers","collisionBoxArray","features","compareText"]}),uc.MAX_GLYPHS=65535,uc.addDynamicAttributes=sc;var Dd={get paint(){return zd=zd||new Hi({"icon-opacity":new Ki(Ya.paint_symbol["icon-opacity"]),"icon-color":new Ki(Ya.paint_symbol["icon-color"]),"icon-halo-color":new Ki(Ya.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ki(Ya.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ki(Ya.paint_symbol["icon-halo-blur"]),"icon-translate":new Zi(Ya.paint_symbol["icon-translate"]),"icon-translate-anchor":new Zi(Ya.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ki(Ya.paint_symbol["text-opacity"]),"text-color":new Ki(Ya.paint_symbol["text-color"],{runtimeType:ho,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Ki(Ya.paint_symbol["text-halo-color"]),"text-halo-width":new Ki(Ya.paint_symbol["text-halo-width"]),"text-halo-blur":new Ki(Ya.paint_symbol["text-halo-blur"]),"text-translate":new Zi(Ya.paint_symbol["text-translate"]),"text-translate-anchor":new Zi(Ya.paint_symbol["text-translate-anchor"])})},get layout(){return kd=kd||new Hi({"symbol-placement":new Zi(Ya.layout_symbol["symbol-placement"]),"symbol-spacing":new Zi(Ya.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Zi(Ya.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ki(Ya.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Zi(Ya.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Zi(Ya.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Zi(Ya.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Zi(Ya.layout_symbol["icon-ignore-placement"]),"icon-optional":new Zi(Ya.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Zi(Ya.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ki(Ya.layout_symbol["icon-size"]),"icon-text-fit":new Zi(Ya.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Zi(Ya.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ki(Ya.layout_symbol["icon-image"]),"icon-rotate":new Ki(Ya.layout_symbol["icon-rotate"]),"icon-padding":new Ki(Ya.layout_symbol["icon-padding"]),"icon-keep-upright":new Zi(Ya.layout_symbol["icon-keep-upright"]),"icon-offset":new Ki(Ya.layout_symbol["icon-offset"]),"icon-anchor":new Ki(Ya.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Zi(Ya.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Zi(Ya.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Zi(Ya.layout_symbol["text-rotation-alignment"]),"text-field":new Ki(Ya.layout_symbol["text-field"]),"text-font":new Ki(Ya.layout_symbol["text-font"]),"text-size":new Ki(Ya.layout_symbol["text-size"]),"text-max-width":new Ki(Ya.layout_symbol["text-max-width"]),"text-line-height":new Zi(Ya.layout_symbol["text-line-height"]),"text-letter-spacing":new Ki(Ya.layout_symbol["text-letter-spacing"]),"text-justify":new Ki(Ya.layout_symbol["text-justify"]),"text-radial-offset":new Ki(Ya.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Zi(Ya.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ki(Ya.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ki(Ya.layout_symbol["text-anchor"]),"text-max-angle":new Zi(Ya.layout_symbol["text-max-angle"]),"text-writing-mode":new Zi(Ya.layout_symbol["text-writing-mode"]),"text-rotate":new Ki(Ya.layout_symbol["text-rotate"]),"text-padding":new Zi(Ya.layout_symbol["text-padding"]),"text-keep-upright":new Zi(Ya.layout_symbol["text-keep-upright"]),"text-transform":new Ki(Ya.layout_symbol["text-transform"]),"text-offset":new Ki(Ya.layout_symbol["text-offset"]),"text-allow-overlap":new Zi(Ya.layout_symbol["text-allow-overlap"]),"text-overlap":new Zi(Ya.layout_symbol["text-overlap"]),"text-ignore-placement":new Zi(Ya.layout_symbol["text-ignore-placement"]),"text-optional":new Zi(Ya.layout_symbol["text-optional"])})}};class fc{constructor(u){if(void 0===u.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:eo,this.defaultValue=u}evaluate(u){if(u.formattedSection){const F=this.defaultValue.property.overrides;if(F&&F.hasOverride(u.formattedSection))return F.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wi("FormatSectionOverride",fc,{omit:["defaultValue"]});class dc extends Wi{constructor(u){super(u,Dd)}recalculate(u,F){if(super.recalculate(u,F),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const u=this.layout.get("text-writing-mode");if(u){const F=[];for(const Vt of u)F.indexOf(Vt)<0&&F.push(Vt);this.layout._values["text-writing-mode"]=F}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,F,Vt,Wt){const Kt=this.layout.get(u).evaluate(F,{},Vt,Wt),Qi=this._unevaluatedLayout._values[u];return Qi.isDataDriven()||bn(Qi.value)||!Kt?Kt:function(u,F){return F.replace(/{([^{}]+)}/g,((F,Vt)=>u&&Vt in u?String(u[Vt]):""))}(F.properties,Kt)}createBucket(u){return new uc(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of Dd.paint.overridableProperties){if(!dc.hasPaintOverride(this.layout,u))continue;const F=this.paint.get(u),Vt=new fc(F),Wt=new vn(Vt,F.property.specification);let Kt=null;Kt="constant"===F.value.kind||"source"===F.value.kind?new _n("source",Wt):new An("composite",Wt,F.value.zoomStops),this.paint._values[u]=new qi(F.property,Kt,F.parameters)}}_handleOverridablePaintPropertyUpdate(u,F,Vt){return!(!this.layout||F.isDataDriven()||Vt.isDataDriven())&&dc.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,F){const Vt=u.get("text-field"),Wt=Dd.paint.properties[F];let Kt=!1;const s=u=>{for(const F of u)if(Wt.overrides&&Wt.overrides.hasOverride(F))return void(Kt=!0)};if("constant"===Vt.value.kind&&Vt.value.value instanceof Ht)s(Vt.value.value.sections);else if("source"===Vt.value.kind){const t=u=>{Kt||(u instanceof se&&ne(u.value)===Ao?s(u.value.sections):u instanceof Ze?s(u.sections):u.eachChild(t))},u=Vt.value;u._styleExpression&&t(u._styleExpression.expression)}return Kt}}let Ld;var Rd={get paint(){return Ld=Ld||new Hi({"background-color":new Zi(Ya.paint_background["background-color"]),"background-pattern":new Ji(Ya.paint_background["background-pattern"]),"background-opacity":new Zi(Ya.paint_background["background-opacity"])})}};class gc extends Wi{constructor(u){super(u,Rd)}}let Bd;var Fd={get paint(){return Bd=Bd||new Hi({"raster-opacity":new Zi(Ya.paint_raster["raster-opacity"]),"raster-hue-rotate":new Zi(Ya.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Zi(Ya.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Zi(Ya.paint_raster["raster-brightness-max"]),"raster-saturation":new Zi(Ya.paint_raster["raster-saturation"]),"raster-contrast":new Zi(Ya.paint_raster["raster-contrast"]),"raster-resampling":new Zi(Ya.paint_raster["raster-resampling"]),"raster-fade-duration":new Zi(Ya.paint_raster["raster-fade-duration"])})}};class bc extends Wi{constructor(u){super(u,Fd)}}class wc extends Wi{constructor(u){super(u,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=u}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _c{constructor(u){this._methodToThrottle=u,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Od=6371008.8;class Sc{constructor(u,F){if(isNaN(u)||isNaN(F))throw new Error(`Invalid LngLat object: (${u}, ${F})`);if(this.lng=+u,this.lat=+F,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sc(m(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const F=Math.PI/180,Vt=this.lat*F,Wt=u.lat*F,Kt=Math.sin(Vt)*Math.sin(Wt)+Math.cos(Vt)*Math.cos(Wt)*Math.cos((u.lng-this.lng)*F);return Od*Math.acos(Math.min(Kt,1))}static convert(u){if(u instanceof Sc)return u;if(Array.isArray(u)&&(2===u.length||3===u.length))return new Sc(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&"object"==typeof u&&null!==u)return new Sc(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Vd=2*Math.PI*Od;function Mc(u){return Vd*Math.cos(u*Math.PI/180)}function Ic(u){return(180+u)/360}function zc(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Pc(u,F){return u/Mc(F)}function Bc(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class Cc{constructor(u,F,Vt=0){this.x=+u,this.y=+F,this.z=+Vt}static fromLngLat(u,F=0){const Vt=Sc.convert(u);return new Cc(Ic(Vt.lng),zc(Vt.lat),Pc(F,Vt.lat))}toLngLat(){return new Sc(360*this.x-180,Bc(this.y))}toAltitude(){return this.z*Mc(Bc(this.y))}meterInMercatorCoordinateUnits(){return 1/Vd*(u=Bc(this.y),1/Math.cos(u*Math.PI/180));var u}}function Vc(u,F,Vt){var Wt=2*Math.PI*6378137/256/Math.pow(2,Vt);return[u*Wt-2*Math.PI*6378137/2,F*Wt-2*Math.PI*6378137/2]}class Ec{constructor(u,F,Vt){if(u<0||u>25||Vt<0||Vt>=Math.pow(2,u)||F<0||F>=Math.pow(2,u))throw new Error(`x=${F}, y=${Vt}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=F,this.y=Vt,this.key=$c(0,u,u,F,Vt)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,F,Vt){const Wt=(Qi=this.y,fr=this.z,_r=Vc(256*(Kt=this.x),256*(Qi=Math.pow(2,fr)-Qi-1),fr),Sr=Vc(256*(Kt+1),256*(Qi+1),fr),_r[0]+","+_r[1]+","+Sr[0]+","+Sr[1]);var Kt,Qi,fr,_r,Sr;const Ar=function(u,F,Vt){let Wt,Kt="";for(let Qi=u;Qi>0;Qi--)Wt=1<<Qi-1,Kt+=(F&Wt?1:0)+(Vt&Wt?2:0);return Kt}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===Vt?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,F>1?"@2x":"").replace(/{quadkey}/g,Ar).replace(/{bbox-epsg-3857}/g,Wt)}isChildOf(u){const F=this.z-u.z;return F>0&&u.x===this.x>>F&&u.y===this.y>>F}getTilePoint(u){const F=Math.pow(2,this.z);return new Wt((u.x*F-this.x)*zh,(u.y*F-this.y)*zh)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fc{constructor(u,F){this.wrap=u,this.canonical=F,this.key=$c(u,F.z,F.z,F.x,F.y)}}class Tc{constructor(u,F,Vt,Wt,Kt){if(u<Vt)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${Vt}`);this.overscaledZ=u,this.wrap=F,this.canonical=new Ec(Vt,+Wt,+Kt),this.key=$c(F,u,Vt,Wt,Kt)}clone(){return new Tc(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const F=this.canonical.z-u;return u>this.canonical.z?new Tc(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Tc(u,this.wrap,u,this.canonical.x>>F,this.canonical.y>>F)}calculateScaledKey(u,F){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const Vt=this.canonical.z-u;return u>this.canonical.z?$c(this.wrap*+F,u,this.canonical.z,this.canonical.x,this.canonical.y):$c(this.wrap*+F,u,u,this.canonical.x>>Vt,this.canonical.y>>Vt)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const F=this.canonical.z-u.canonical.z;return 0===u.overscaledZ||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>F&&u.canonical.y===this.canonical.y>>F}children(u){if(this.overscaledZ>=u)return[new Tc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const F=this.canonical.z+1,Vt=2*this.canonical.x,Wt=2*this.canonical.y;return[new Tc(F,this.wrap,F,Vt,Wt),new Tc(F,this.wrap,F,Vt+1,Wt),new Tc(F,this.wrap,F,Vt,Wt+1),new Tc(F,this.wrap,F,Vt+1,Wt+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new Tc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new Tc(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new Cc(u.x-this.wrap,u.y))}}function $c(u,F,Vt,Wt,Kt){(u*=2)<0&&(u=-1*u-1);const Qi=1<<Vt;return(Qi*Qi*u+Qi*Kt+Wt).toString(36)+Vt.toString(36)+F.toString(36)}wi("CanonicalTileID",Ec),wi("OverscaledTileID",Tc,{omit:["posMatrix"]});class Lc{constructor(u,F,Vt,Wt=1,Kt=1,Qi=1,fr=0){if(this.uid=u,F.height!==F.width)throw new RangeError("DEM tiles must be square");if(Vt&&!["mapbox","terrarium","custom"].includes(Vt))return void A(`"${Vt}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=F.height;const _r=this.dim=F.height-2;switch(this.data=new Uint32Array(F.data.buffer),Vt){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=Wt,this.greenFactor=Kt,this.blueFactor=Qi,this.baseShift=fr;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let u=0;u<_r;u++)this.data[this._idx(-1,u)]=this.data[this._idx(0,u)],this.data[this._idx(_r,u)]=this.data[this._idx(_r-1,u)],this.data[this._idx(u,-1)]=this.data[this._idx(u,0)],this.data[this._idx(u,_r)]=this.data[this._idx(u,_r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_r,-1)]=this.data[this._idx(_r-1,0)],this.data[this._idx(-1,_r)]=this.data[this._idx(0,_r-1)],this.data[this._idx(_r,_r)]=this.data[this._idx(_r-1,_r-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let u=0;u<_r;u++)for(let F=0;F<_r;F++){const Vt=this.get(u,F);Vt>this.max&&(this.max=Vt),Vt<this.min&&(this.min=Vt)}}get(u,F){const Vt=new Uint8Array(this.data.buffer),Wt=4*this._idx(u,F);return this.unpack(Vt[Wt],Vt[Wt+1],Vt[Wt+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,F){if(u<-1||u>=this.dim+1||F<-1||F>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(F+1)*this.stride+(u+1)}unpack(u,F,Vt){return u*this.redFactor+F*this.greenFactor+Vt*this.blueFactor-this.baseShift}getPixels(){return new go({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,F,Vt){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let Wt=F*this.dim,Kt=F*this.dim+this.dim,Qi=Vt*this.dim,fr=Vt*this.dim+this.dim;switch(F){case-1:Wt=Kt-1;break;case 1:Kt=Wt+1}switch(Vt){case-1:Qi=fr-1;break;case 1:fr=Qi+1}const _r=-F*this.dim,Sr=-Vt*this.dim;for(let F=Qi;F<fr;F++)for(let Vt=Wt;Vt<Kt;Vt++)this.data[this._idx(Vt,F)]=u.data[this._idx(Vt+_r,F+Sr)]}}wi("DEMData",Lc);class Dc{constructor(u){this._stringToNumber={},this._numberToString=[];for(let F=0;F<u.length;F++){const Vt=u[F];this._stringToNumber[Vt]=F,this._numberToString[F]=Vt}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class Oc{constructor(u,F,Vt,Wt,Kt){this.type="Feature",this._vectorTileFeature=u,u._z=F,u._x=Vt,u._y=Wt,this.properties=u.properties,this.id=Kt}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const F in this)"_geometry"!==F&&"_vectorTileFeature"!==F&&(u[F]=this[F]);return u}}class Rc{constructor(u,F){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new vi(zh,16,0),this.grid3D=new vi(zh,16,0),this.featureIndexArray=new Ds,this.promoteId=F}insert(u,F,Vt,Wt,Kt,Qi){const fr=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(Vt,Wt,Kt);const _r=Qi?this.grid3D:this.grid;for(let u=0;u<F.length;u++){const Vt=F[u],Wt=[1/0,1/0,-1/0,-1/0];for(let u=0;u<Vt.length;u++){const F=Vt[u];Wt[0]=Math.min(Wt[0],F.x),Wt[1]=Math.min(Wt[1],F.y),Wt[2]=Math.max(Wt[2],F.x),Wt[3]=Math.max(Wt[3],F.y)}Wt[0]<zh&&Wt[1]<zh&&Wt[2]>=0&&Wt[3]>=0&&_r.insert(fr,Wt[0],Wt[1],Wt[2],Wt[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new su.VectorTile(new yd(this.rawTileData)).layers,this.sourceLayerCoder=new Dc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,F,Vt,Kt){this.loadVTLayers();const Qi=u.params||{},fr=zh/u.tileSize/u.scale,_r=Pn(Qi.filter),Sr=u.queryGeometry,Ar=u.queryPadding*fr,Jr=jc(Sr),zn=this.grid.query(Jr.minX-Ar,Jr.minY-Ar,Jr.maxX+Ar,Jr.maxY+Ar),Qs=jc(u.cameraQueryGeometry),ta=this.grid3D.query(Qs.minX-Ar,Qs.minY-Ar,Qs.maxX+Ar,Qs.maxY+Ar,((F,Vt,Kt,Qi)=>function(u,F,Vt,Kt,Qi){for(const Wt of u)if(F<=Wt.x&&Vt<=Wt.y&&Kt>=Wt.x&&Qi>=Wt.y)return!0;const fr=[new Wt(F,Vt),new Wt(F,Qi),new Wt(Kt,Qi),new Wt(Kt,Vt)];if(u.length>2)for(const F of fr)if(Ka(u,F))return!0;for(let F=0;F<u.length-1;F++)if(Ga(u[F],u[F+1],fr))return!0;return!1}(u.cameraQueryGeometry,F-Ar,Vt-Ar,Kt+Ar,Qi+Ar)));for(const u of ta)zn.push(u);zn.sort(qc);const ia={};let aa;for(let Wt=0;Wt<zn.length;Wt++){const Ar=zn[Wt];if(Ar===aa)continue;aa=Ar;const Jr=this.featureIndexArray.get(Ar);let Qs=null;this.loadMatchingFeature(ia,Jr.bucketIndex,Jr.sourceLayerIndex,Jr.featureIndex,_r,Qi.layers,Qi.availableImages,F,Vt,Kt,((F,Vt,Wt)=>(Qs||(Qs=Ea(F)),Vt.queryIntersectsFeature(Sr,F,Wt,Qs,this.z,u.transform,fr,u.pixelPosMatrix))))}return ia}loadMatchingFeature(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr){const zn=this.bucketLayerIDs[F];if(Qi&&!function(u,F){for(let Vt=0;Vt<u.length;Vt++)if(F.indexOf(u[Vt])>=0)return!0;return!1}(Qi,zn))return;const Qs=this.sourceLayerCoder.decode(Vt),ta=this.vtLayers[Qs].feature(Wt);if(Kt.needGeometry){const u=Fa(ta,!0);if(!Kt.filter(new $i(this.tileID.overscaledZ),u,this.tileID.canonical))return}else if(!Kt.filter(new $i(this.tileID.overscaledZ),ta))return;const ia=this.getId(ta,Qs);for(let F=0;F<zn.length;F++){const Vt=zn[F];if(Qi&&Qi.indexOf(Vt)<0)continue;const Kt=_r[Vt];if(!Kt)continue;let Qs={};ia&&Ar&&(Qs=Ar.getState(Kt.sourceLayer||"_geojsonTileLayer",ia));const aa=g({},Sr[Vt]);aa.paint=Uc(aa.paint,Kt.paint,ta,Qs,fr),aa.layout=Uc(aa.layout,Kt.layout,ta,Qs,fr);const va=!Jr||Jr(ta,Kt,Qs);if(!va)continue;const Ba=new Oc(ta,this.z,this.x,this.y,ia);Ba.layer=aa;let Ya=u[Vt];void 0===Ya&&(Ya=u[Vt]=[]),Ya.push({featureIndex:Wt,feature:Ba,intersectionZ:va})}}lookupSymbolFeatures(u,F,Vt,Wt,Kt,Qi,fr,_r){const Sr={};this.loadVTLayers();const Ar=Pn(Kt);for(const Kt of u)this.loadMatchingFeature(Sr,Vt,Wt,Kt,Ar,Qi,fr,_r,F);return Sr}hasLayer(u){for(const F of this.bucketLayerIDs)for(const Vt of F)if(u===Vt)return!0;return!1}getId(u,F){let Vt=u.id;return this.promoteId&&(Vt=u.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[F]],"boolean"==typeof Vt&&(Vt=Number(Vt))),Vt}}function Uc(u,F,Vt,Wt,Kt){return v(u,((u,Qi)=>{const fr=F instanceof Ni?F.get(Qi):null;return fr&&fr.evaluate?fr.evaluate(Vt,Wt,Kt):fr}))}function jc(u){let F=1/0,Vt=1/0,Wt=-1/0,Kt=-1/0;for(const Qi of u)F=Math.min(F,Qi.x),Vt=Math.min(Vt,Qi.y),Wt=Math.max(Wt,Qi.x),Kt=Math.max(Kt,Qi.y);return{minX:F,minY:Vt,maxX:Wt,maxY:Kt}}function qc(u,F){return F-u}function Nc(u,F,Vt,Kt,Qi){const fr=[];for(let _r=0;_r<u.length;_r++){const Sr=u[_r];let Ar;for(let u=0;u<Sr.length-1;u++){let _r=Sr[u],Jr=Sr[u+1];_r.x<F&&Jr.x<F||(_r.x<F?_r=new Wt(F,_r.y+(F-_r.x)/(Jr.x-_r.x)*(Jr.y-_r.y))._round():Jr.x<F&&(Jr=new Wt(F,_r.y+(F-_r.x)/(Jr.x-_r.x)*(Jr.y-_r.y))._round()),_r.y<Vt&&Jr.y<Vt||(_r.y<Vt?_r=new Wt(_r.x+(Vt-_r.y)/(Jr.y-_r.y)*(Jr.x-_r.x),Vt)._round():Jr.y<Vt&&(Jr=new Wt(_r.x+(Vt-_r.y)/(Jr.y-_r.y)*(Jr.x-_r.x),Vt)._round()),_r.x>=Kt&&Jr.x>=Kt||(_r.x>=Kt?_r=new Wt(Kt,_r.y+(Kt-_r.x)/(Jr.x-_r.x)*(Jr.y-_r.y))._round():Jr.x>=Kt&&(Jr=new Wt(Kt,_r.y+(Kt-_r.x)/(Jr.x-_r.x)*(Jr.y-_r.y))._round()),_r.y>=Qi&&Jr.y>=Qi||(_r.y>=Qi?_r=new Wt(_r.x+(Qi-_r.y)/(Jr.y-_r.y)*(Jr.x-_r.x),Qi)._round():Jr.y>=Qi&&(Jr=new Wt(_r.x+(Qi-_r.y)/(Jr.y-_r.y)*(Jr.x-_r.x),Qi)._round()),Ar&&_r.equals(Ar[Ar.length-1])||(Ar=[_r],fr.push(Ar)),Ar.push(Jr)))))}}return fr}wi("FeatureIndex",Rc,{omit:["rawTileData","sourceLayerCoder"]});class Zc extends Wt{constructor(u,F,Vt,Wt){super(u,F),this.angle=Vt,void 0!==Wt&&(this.segment=Wt)}clone(){return new Zc(this.x,this.y,this.angle,this.segment)}}function Kc(u,F,Vt,Wt,Kt){if(void 0===F.segment||0===Vt)return!0;let Qi=F,fr=F.segment+1,_r=0;for(;_r>-Vt/2;){if(fr--,fr<0)return!1;_r-=u[fr].dist(Qi),Qi=u[fr]}_r+=u[fr].dist(u[fr+1]),fr++;const Sr=[];let Ar=0;for(;_r<Vt/2;){const F=u[fr],Vt=u[fr+1];if(!Vt)return!1;let Qi=u[fr-1].angleTo(F)-F.angleTo(Vt);for(Qi=Math.abs((Qi+3*Math.PI)%(2*Math.PI)-Math.PI),Sr.push({distance:_r,angleDelta:Qi}),Ar+=Qi;_r-Sr[0].distance>Wt;)Ar-=Sr.shift().angleDelta;if(Ar>Kt)return!1;fr++,_r+=F.dist(Vt)}return!0}function Gc(u){let F=0;for(let Vt=0;Vt<u.length-1;Vt++)F+=u[Vt].dist(u[Vt+1]);return F}function Jc(u,F,Vt){return u?.6*F*Vt:0}function Xc(u,F){return Math.max(u?u.right-u.left:0,F?F.right-F.left:0)}function Hc(u,F,Vt,Wt,Kt,Qi){const fr=Jc(Vt,Kt,Qi),_r=Xc(Vt,Wt)*Qi;let Sr=0;const Ar=Gc(u)/2;for(let Vt=0;Vt<u.length-1;Vt++){const Wt=u[Vt],Kt=u[Vt+1],Qi=Wt.dist(Kt);if(Sr+Qi>Ar){const Jr=(Ar-Sr)/Qi,zn=zl.number(Wt.x,Kt.x,Jr),Qs=zl.number(Wt.y,Kt.y,Jr),ta=new Zc(zn,Qs,Kt.angleTo(Wt),Vt);return ta._round(),!fr||Kc(u,ta,_r,fr,F)?ta:void 0}Sr+=Qi}}function Yc(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){const Ar=Jc(Wt,Qi,fr),Jr=Xc(Wt,Kt),zn=Jr*fr,Qs=0===u[0].x||u[0].x===Sr||0===u[0].y||u[0].y===Sr;return F-zn<F/4&&(F=zn+F/4),Wc(u,Qs?F/2*_r%F:(Jr/2+2*Qi)*fr*_r%F,F,Ar,Vt,zn,Qs,!1,Sr)}function Wc(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){const Ar=Qi/2,Jr=Gc(u);let zn=0,Qs=F-Vt,ta=[];for(let F=0;F<u.length-1;F++){const fr=u[F],_r=u[F+1],ia=fr.dist(_r),aa=_r.angleTo(fr);for(;Qs+Vt<zn+ia;){Qs+=Vt;const va=(Qs-zn)/ia,Ba=zl.number(fr.x,_r.x,va),Ya=zl.number(fr.y,_r.y,va);if(Ba>=0&&Ba<Sr&&Ya>=0&&Ya<Sr&&Qs-Ar>=0&&Qs+Ar<=Jr){const Vt=new Zc(Ba,Ya,aa,F);Vt._round(),Wt&&!Kc(u,Vt,Qi,Wt,Kt)||ta.push(Vt)}}zn+=ia}return _r||ta.length||fr||(ta=Wc(u,zn/2,Vt,Wt,Kt,Qi,fr,!0,Sr)),ta}wi("Anchor",Zc);const Ud=bd;function th(u,F,Vt,Kt){const Qi=[],fr=u.image,_r=fr.pixelRatio,Sr=fr.paddedRect.w-2*Ud,Ar=fr.paddedRect.h-2*Ud;let Jr={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const zn=fr.stretchX||[[0,Sr]],Qs=fr.stretchY||[[0,Ar]],f=(u,F)=>u+F[1]-F[0],ta=zn.reduce(f,0),ia=Qs.reduce(f,0),aa=Sr-ta,va=Ar-ia;let Ba=0,Ya=ta,to=0,eo=ia,io=0,so=aa,co=0,ho=va;if(fr.content&&Kt){const F=fr.content,Vt=F[2]-F[0],Wt=F[3]-F[1];(fr.textFitWidth||fr.textFitHeight)&&(Jr=Xu(u)),Ba=eh(zn,0,F[0]),to=eh(Qs,0,F[1]),Ya=eh(zn,F[0],F[2]),eo=eh(Qs,F[1],F[3]),io=F[0]-Ba,co=F[1]-to,so=Vt-Ya,ho=Wt-eo}const bo=Jr.x1,wo=Jr.y1,So=Jr.x2-bo,Ao=Jr.y2-wo,B=(u,Kt,Qi,Sr)=>{const Ar=nh(u.stretch-Ba,Ya,So,bo),Jr=ih(u.fixed-io,so,u.stretch,ta),zn=nh(Kt.stretch-to,eo,Ao,wo),Qs=ih(Kt.fixed-co,ho,Kt.stretch,ia),aa=nh(Qi.stretch-Ba,Ya,So,bo),va=ih(Qi.fixed-io,so,Qi.stretch,ta),ko=nh(Sr.stretch-to,eo,Ao,wo),Wo=ih(Sr.fixed-co,ho,Sr.stretch,ia),il=new Wt(Ar,zn),rl=new Wt(aa,zn),nl=new Wt(aa,ko),al=new Wt(Ar,ko),ol=new Wt(Jr/_r,Qs/_r),ll=new Wt(va/_r,Wo/_r),cl=F*Math.PI/180;if(cl){const u=Math.sin(cl),F=Math.cos(cl),Vt=[F,-u,u,F];il._matMult(Vt),rl._matMult(Vt),al._matMult(Vt),nl._matMult(Vt)}const hl=u.stretch+u.fixed,ul=Kt.stretch+Kt.fixed;return{tl:il,tr:rl,bl:al,br:nl,tex:{x:fr.paddedRect.x+Ud+hl,y:fr.paddedRect.y+Ud+ul,w:Qi.stretch+Qi.fixed-hl,h:Sr.stretch+Sr.fixed-ul},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ol,pixelOffsetBR:ll,minFontScaleX:so/_r/So,minFontScaleY:ho/_r/Ao,isSDF:Vt}};if(Kt&&(fr.stretchX||fr.stretchY)){const u=rh(zn,aa,ta),F=rh(Qs,va,ia);for(let Vt=0;Vt<u.length-1;Vt++){const Wt=u[Vt],Kt=u[Vt+1];for(let u=0;u<F.length-1;u++)Qi.push(B(Wt,F[u],Kt,F[u+1]))}}else Qi.push(B({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:Sr+1},{fixed:0,stretch:Ar+1}));return Qi}function eh(u,F,Vt){let Wt=0;for(const Kt of u)Wt+=Math.max(F,Math.min(Vt,Kt[1]))-Math.max(F,Math.min(Vt,Kt[0]));return Wt}function rh(u,F,Vt){const Wt=[{fixed:-Ud,stretch:0}];for(const[F,Vt]of u){const u=Wt[Wt.length-1];Wt.push({fixed:F-u.stretch,stretch:u.stretch}),Wt.push({fixed:F-u.stretch,stretch:u.stretch+(Vt-F)})}return Wt.push({fixed:F+Ud,stretch:Vt}),Wt}function nh(u,F,Vt,Wt){return u/F*Vt+Wt}function ih(u,F,Vt,Wt){return u-F*Vt/Wt}class sh{constructor(u,F,Vt,Kt,Qi,fr,_r,Sr,Ar,Jr){var zn;if(this.boxStartIndex=u.length,Ar){let u=fr.top,F=fr.bottom;const Vt=fr.collisionPadding;Vt&&(u-=Vt[1],F+=Vt[3]);let Wt=F-u;Wt>0&&(Wt=Math.max(10,Wt),this.circleDiameter=Wt)}else{const Ar=(null===(zn=fr.image)||void 0===zn?void 0:zn.content)&&(fr.image.textFitWidth||fr.image.textFitHeight)?Xu(fr):{x1:fr.left,y1:fr.top,x2:fr.right,y2:fr.bottom};Ar.y1=Ar.y1*_r-Sr[0],Ar.y2=Ar.y2*_r+Sr[2],Ar.x1=Ar.x1*_r-Sr[3],Ar.x2=Ar.x2*_r+Sr[1];const Qs=fr.collisionPadding;if(Qs&&(Ar.x1-=Qs[0]*_r,Ar.y1-=Qs[1]*_r,Ar.x2+=Qs[2]*_r,Ar.y2+=Qs[3]*_r),Jr){const u=new Wt(Ar.x1,Ar.y1),F=new Wt(Ar.x2,Ar.y1),Vt=new Wt(Ar.x1,Ar.y2),Kt=new Wt(Ar.x2,Ar.y2),Qi=Jr*Math.PI/180;u._rotate(Qi),F._rotate(Qi),Vt._rotate(Qi),Kt._rotate(Qi),Ar.x1=Math.min(u.x,F.x,Vt.x,Kt.x),Ar.x2=Math.max(u.x,F.x,Vt.x,Kt.x),Ar.y1=Math.min(u.y,F.y,Vt.y,Kt.y),Ar.y2=Math.max(u.y,F.y,Vt.y,Kt.y)}u.emplaceBack(F.x,F.y,Ar.x1,Ar.y1,Ar.x2,Ar.y2,Vt,Kt,Qi)}this.boxEndIndex=u.length}}class ah{constructor(u=[],F=oh){if(this.data=u,this.length=this.data.length,this.compare=F,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const u=this.data[0],F=this.data.pop();return this.length--,this.length>0&&(this.data[0]=F,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:F,compare:Vt}=this,Wt=F[u];for(;u>0;){const Kt=u-1>>1,Qi=F[Kt];if(Vt(Wt,Qi)>=0)break;F[u]=Qi,u=Kt}F[u]=Wt}_down(u){const{data:F,compare:Vt}=this,Wt=this.length>>1,Kt=F[u];for(;u<Wt;){let Wt=1+(u<<1),Qi=F[Wt];const fr=Wt+1;if(fr<this.length&&Vt(F[fr],Qi)<0&&(Wt=fr,Qi=F[fr]),Vt(Qi,Kt)>=0)break;F[u]=Qi,u=Wt}F[u]=Kt}}function oh(u,F){return u<F?-1:u>F?1:0}function lh(u,F=1,Vt=!1){let Kt=1/0,Qi=1/0,fr=-1/0,_r=-1/0;const Sr=u[0];for(let u=0;u<Sr.length;u++){const F=Sr[u];(!u||F.x<Kt)&&(Kt=F.x),(!u||F.y<Qi)&&(Qi=F.y),(!u||F.x>fr)&&(fr=F.x),(!u||F.y>_r)&&(_r=F.y)}const Ar=Math.min(fr-Kt,_r-Qi);let Jr=Ar/2;const zn=new ah([],uh);if(0===Ar)return new Wt(Kt,Qi);for(let F=Kt;F<fr;F+=Ar)for(let Vt=Qi;Vt<_r;Vt+=Ar)zn.push(new ch(F+Jr,Vt+Jr,Jr,u));let Qs=function(u){let F=0,Vt=0,Wt=0;const Kt=u[0];for(let u=0,Qi=Kt.length,fr=Qi-1;u<Qi;fr=u++){const Qi=Kt[u],_r=Kt[fr],Sr=Qi.x*_r.y-_r.x*Qi.y;Vt+=(Qi.x+_r.x)*Sr,Wt+=(Qi.y+_r.y)*Sr,F+=3*Sr}return new ch(Vt/F,Wt/F,0,u)}(u),ta=zn.length;for(;zn.length;){const Wt=zn.pop();(Wt.d>Qs.d||!Qs.d)&&(Qs=Wt,Vt&&console.log("found best %d after %d probes",Math.round(1e4*Wt.d)/1e4,ta)),Wt.max-Qs.d<=F||(Jr=Wt.h/2,zn.push(new ch(Wt.p.x-Jr,Wt.p.y-Jr,Jr,u)),zn.push(new ch(Wt.p.x+Jr,Wt.p.y-Jr,Jr,u)),zn.push(new ch(Wt.p.x-Jr,Wt.p.y+Jr,Jr,u)),zn.push(new ch(Wt.p.x+Jr,Wt.p.y+Jr,Jr,u)),ta+=4)}return Vt&&(console.log(`num probes: ${ta}`),console.log(`best distance: ${Qs.d}`)),Qs.p}function uh(u,F){return F.max-u.max}function ch(F,Vt,Kt,Qi){(this||u).p=new Wt(F,Vt),(this||u).h=Kt,(this||u).d=function(u,F){let Vt=!1,Wt=1/0;for(let Kt=0;Kt<F.length;Kt++){const Qi=F[Kt];for(let F=0,Kt=Qi.length,fr=Kt-1;F<Kt;fr=F++){const Kt=Qi[F],_r=Qi[fr];Kt.y>u.y!=_r.y>u.y&&u.x<(_r.x-Kt.x)*(u.y-Kt.y)/(_r.y-Kt.y)+Kt.x&&(Vt=!Vt),Wt=Math.min(Wt,Na(u,Kt,_r))}}return(Vt?1:-1)*Math.sqrt(Wt)}((this||u).p,Qi),(this||u).max=(this||u).d+(this||u).h*Math.SQRT2}var Nd;F.aq=void 0,(Nd=F.aq||(F.aq={}))[Nd.center=1]="center",Nd[Nd.left=2]="left",Nd[Nd.right=3]="right",Nd[Nd.top=4]="top",Nd[Nd.bottom=5]="bottom",Nd[Nd["top-left"]=6]="top-left",Nd[Nd["top-right"]=7]="top-right",Nd[Nd["bottom-left"]=8]="bottom-left",Nd[Nd["bottom-right"]=9]="bottom-right";const jd=7,$d=Number.POSITIVE_INFINITY;function dh(u,F){return F[1]!==$d?function(u,F,Vt){let Wt=0,Kt=0;switch(F=Math.abs(F),Vt=Math.abs(Vt),u){case"top-right":case"top-left":case"top":Kt=Vt-jd;break;case"bottom-right":case"bottom-left":case"bottom":Kt=-Vt+jd}switch(u){case"top-right":case"bottom-right":case"right":Wt=-F;break;case"top-left":case"bottom-left":case"left":Wt=F}return[Wt,Kt]}(u,F[0],F[1]):function(u,F){let Vt=0,Wt=0;F<0&&(F=0);const Kt=F/Math.SQRT2;switch(u){case"top-right":case"top-left":Wt=Kt-jd;break;case"bottom-right":case"bottom-left":Wt=-Kt+jd;break;case"bottom":Wt=-F+jd;break;case"top":Wt=F-jd}switch(u){case"top-right":case"bottom-right":Vt=-Kt;break;case"top-left":case"bottom-left":Vt=Kt;break;case"left":Vt=F;break;case"right":Vt=-F}return[Vt,Wt]}(u,F[0])}function yh(u,F,Vt){var Wt;const Kt=u.layout,Qi=null===(Wt=Kt.get("text-variable-anchor-offset"))||void 0===Wt?void 0:Wt.evaluate(F,{},Vt);if(Qi){const u=Qi.values,F=[];for(let Vt=0;Vt<u.length;Vt+=2){const Wt=F[Vt]=u[Vt],Kt=u[Vt+1].map((u=>u*pd));Wt.startsWith("top")?Kt[1]-=jd:Wt.startsWith("bottom")&&(Kt[1]+=jd),F[Vt+1]=Kt}return new Qt(F)}const fr=Kt.get("text-variable-anchor");if(fr){let Wt;Wt=void 0!==u._unevaluatedLayout.getValue("text-radial-offset")?[Kt.get("text-radial-offset").evaluate(F,{},Vt)*pd,$d]:Kt.get("text-offset").evaluate(F,{},Vt).map((u=>u*pd));const Qi=[];for(const u of fr)Qi.push(u,dh(u,Wt));return new Qt(Qi)}return null}function mh(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gh(u,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn){let Qs=fr.textMaxSize.evaluate(Vt,{});void 0===Qs&&(Qs=_r);const ta=u.layers[0].layout,ia=ta.get("icon-offset").evaluate(Vt,{},zn),aa=vh(Wt.horizontal),va=_r/24,Ba=u.tilePixelRatio*va,Ya=u.tilePixelRatio*Qs/24,to=u.tilePixelRatio*Sr,eo=u.tilePixelRatio*ta.get("symbol-spacing"),io=ta.get("text-padding")*u.tilePixelRatio,so=function(u,F,Vt,Wt=1){const Kt=u.get("icon-padding").evaluate(F,{},Vt),Qi=Kt&&Kt.values;return[Qi[0]*Wt,Qi[1]*Wt,Qi[2]*Wt,Qi[3]*Wt]}(ta,Vt,zn,u.tilePixelRatio),co=ta.get("text-max-angle")/180*Math.PI,ho="viewport"!==ta.get("text-rotation-alignment")&&"point"!==ta.get("symbol-placement"),bo="map"===ta.get("icon-rotation-alignment")&&"point"!==ta.get("symbol-placement"),wo=ta.get("symbol-placement"),So=eo/2,Ao=ta.get("icon-text-fit");let ko;Kt&&"none"!==Ao&&(u.allowVerticalPlacement&&Wt.vertical&&(ko=Hu(Kt,Wt.vertical,Ao,ta.get("icon-text-fit-padding"),ia,va)),aa&&(Kt=Hu(Kt,aa,Ao,ta.get("icon-text-fit-padding"),ia,va)));const C=(Sr,Qs)=>{Qs.x<0||Qs.x>=zh||Qs.y<0||Qs.y>=zh||function(u,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va,Ba,Ya,to,eo,io,so,co,ho,bo){const wo=u.addToLineVertexArray(Vt,Wt);let So,Ao,ko,Wo,il=0,rl=0,nl=0,al=0,ol=-1,ll=-1;const cl={};let hl=Ch("");if(u.allowVerticalPlacement&&Kt.vertical){const u=Sr.layout.get("text-rotate").evaluate(io,{},ho)+90;ko=new sh(Ar,Vt,Jr,zn,Qs,Kt.vertical,ta,ia,aa,u),_r&&(Wo=new sh(Ar,Vt,Jr,zn,Qs,_r,Ba,Ya,aa,u))}if(Qi){const Wt=Sr.layout.get("icon-rotate").evaluate(io,{}),Kt="none"!==Sr.layout.get("icon-text-fit"),fr=th(Qi,Wt,co,Kt),ta=_r?th(_r,Wt,co,Kt):void 0;Ao=new sh(Ar,Vt,Jr,zn,Qs,Qi,Ba,Ya,!1,Wt),il=4*fr.length;const ia=u.iconSizeData;let aa=null;"source"===ia.kind?(aa=[Pd*Sr.layout.get("icon-size").evaluate(io,{})],aa[0]>Md&&A(`${u.layerIds[0]}: Value for "icon-size" is >= ${Ad}. Reduce your "icon-size".`)):"composite"===ia.kind&&(aa=[Pd*so.compositeIconSizes[0].evaluate(io,{},ho),Pd*so.compositeIconSizes[1].evaluate(io,{},ho)],(aa[0]>Md||aa[1]>Md)&&A(`${u.layerIds[0]}: Value for "icon-size" is >= ${Ad}. Reduce your "icon-size".`)),u.addSymbols(u.icon,fr,aa,eo,to,io,F.ah.none,Vt,wo.lineStartIndex,wo.lineLength,-1,ho),ol=u.icon.placedSymbolArray.length-1,ta&&(rl=4*ta.length,u.addSymbols(u.icon,ta,aa,eo,to,io,F.ah.vertical,Vt,wo.lineStartIndex,wo.lineLength,-1,ho),ll=u.icon.placedSymbolArray.length-1)}const ul=Object.keys(Kt.horizontal);for(const Wt of ul){const Qi=Kt.horizontal[Wt];if(!So){hl=Ch(Qi.text);const u=Sr.layout.get("text-rotate").evaluate(io,{},ho);So=new sh(Ar,Vt,Jr,zn,Qs,Qi,ta,ia,aa,u)}const _r=1===Qi.positionedLines.length;if(nl+=xh(u,Vt,Qi,fr,Sr,aa,io,va,wo,Kt.vertical?F.ah.horizontal:F.ah.horizontalOnly,_r?ul:[Wt],cl,ol,so,ho),_r)break}Kt.vertical&&(al+=xh(u,Vt,Kt.vertical,fr,Sr,aa,io,va,wo,F.ah.vertical,["vertical"],cl,ll,so,ho));const ml=So?So.boxStartIndex:u.collisionBoxArray.length,_l=So?So.boxEndIndex:u.collisionBoxArray.length,yl=ko?ko.boxStartIndex:u.collisionBoxArray.length,vl=ko?ko.boxEndIndex:u.collisionBoxArray.length,wl=Ao?Ao.boxStartIndex:u.collisionBoxArray.length,Tl=Ao?Ao.boxEndIndex:u.collisionBoxArray.length,Il=Wo?Wo.boxStartIndex:u.collisionBoxArray.length,El=Wo?Wo.boxEndIndex:u.collisionBoxArray.length;let zl=-1;const H=(u,F)=>u&&u.circleDiameter?Math.max(u.circleDiameter,F):F;zl=H(So,zl),zl=H(ko,zl),zl=H(Ao,zl),zl=H(Wo,zl);const Dl=zl>-1?1:0;Dl&&(zl*=bo/pd),u.glyphOffsetArray.length>=uc.MAX_GLYPHS&&A("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==io.sortKey&&u.addToSortKeyRanges(u.symbolInstances.length,io.sortKey);const Ll=yh(Sr,io,ho),[Rl,Fl]=function(u,Vt){const Wt=u.length,Kt=null==Vt?void 0:Vt.values;if((null==Kt?void 0:Kt.length)>0)for(let Vt=0;Vt<Kt.length;Vt+=2){const Wt=Kt[Vt+1];u.emplaceBack(F.aq[Kt[Vt]],Wt[0],Wt[1])}return[Wt,u.length]}(u.textAnchorOffsets,Ll);u.symbolInstances.emplaceBack(Vt.x,Vt.y,cl.right>=0?cl.right:-1,cl.center>=0?cl.center:-1,cl.left>=0?cl.left:-1,cl.vertical||-1,ol,ll,hl,ml,_l,yl,vl,wl,Tl,Il,El,Jr,nl,al,il,rl,Dl,0,ta,zl,Rl,Fl)}(u,Qs,Sr,Wt,Kt,Qi,ko,u.layers[0],u.collisionBoxArray,Vt.index,Vt.sourceLayerIndex,u.index,Ba,[io,io,io,io],ho,Ar,to,so,bo,ia,Vt,fr,Jr,zn,_r)};if("line"===wo)for(const F of Nc(Vt.geometry,0,0,zh,zh)){const Vt=Yc(F,eo,co,Wt.vertical||aa,Kt,24,Ya,u.overscaling,zh);for(const Wt of Vt)aa&&bh(u,aa.text,So,Wt)||C(F,Wt)}else if("line-center"===wo){for(const u of Vt.geometry)if(u.length>1){const F=Hc(u,co,Wt.vertical||aa,Kt,24,Ya);F&&C(u,F)}}else if("Polygon"===Vt.type)for(const u of vr(Vt.geometry,0)){const F=lh(u,16);C(u[0],new Zc(F.x,F.y,0))}else if("LineString"===Vt.type)for(const u of Vt.geometry)C(u,new Zc(u[0].x,u[0].y,0));else if("Point"===Vt.type)for(const u of Vt.geometry)for(const F of u)C([F],new Zc(F.x,F.y,0))}function xh(u,F,Vt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa){const va=function(u,F,Vt,Kt,Qi,fr,_r,Sr){const Ar=Kt.layout.get("text-rotate").evaluate(fr,{})*Math.PI/180,Jr=[];for(const u of F.positionedLines)for(const Kt of u.positionedGlyphs){if(!Kt.rect)continue;const fr=Kt.rect||{};let zn=vd+1,Qs=!0,ta=1,ia=0;const aa=(Qi||Sr)&&Kt.vertical,va=Kt.metrics.advance*Kt.scale/2;if(Sr&&F.verticalizable&&(ia=u.lineOffset/2-(Kt.imageName?-(pd-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*pd)),Kt.imageName){const u=_r[Kt.imageName];Qs=u.sdf,ta=u.pixelRatio,zn=bd/ta}const Ba=Qi?[Kt.x+va,Kt.y]:[0,0];let Ya=Qi?[0,0]:[Kt.x+va+Vt[0],Kt.y+Vt[1]-ia],to=[0,0];aa&&(to=Ya,Ya=[0,0]);const eo=Kt.metrics.isDoubleResolution?2:1,io=(Kt.metrics.left-zn)*Kt.scale-va+Ya[0],so=(-Kt.metrics.top-zn)*Kt.scale+Ya[1],co=io+fr.w/eo*Kt.scale/ta,ho=so+fr.h/eo*Kt.scale/ta,bo=new Wt(io,so),wo=new Wt(co,so),So=new Wt(io,ho),Ao=new Wt(co,ho);if(aa){const u=new Wt(-va,va-Td),F=-Math.PI/2,Vt=pd/2-va,Qi=new Wt(5-Td-Vt,-(Kt.imageName?Vt:0)),fr=new Wt(...to);bo._rotateAround(F,u)._add(Qi)._add(fr),wo._rotateAround(F,u)._add(Qi)._add(fr),So._rotateAround(F,u)._add(Qi)._add(fr),Ao._rotateAround(F,u)._add(Qi)._add(fr)}if(Ar){const u=Math.sin(Ar),F=Math.cos(Ar),Vt=[F,-u,u,F];bo._matMult(Vt),wo._matMult(Vt),So._matMult(Vt),Ao._matMult(Vt)}const ko=new Wt(0,0),Wo=new Wt(0,0);Jr.push({tl:bo,tr:wo,bl:So,br:Ao,tex:fr,writingMode:F.writingMode,glyphOffset:Ba,sectionIndex:Kt.sectionIndex,isSDF:Qs,pixelOffsetTL:ko,pixelOffsetBR:Wo,minFontScaleX:0,minFontScaleY:0})}return Jr}(0,Vt,Sr,Qi,fr,_r,Kt,u.allowVerticalPlacement),Ba=u.textSizeData;let Ya=null;"source"===Ba.kind?(Ya=[Pd*Qi.layout.get("text-size").evaluate(_r,{})],Ya[0]>Md&&A(`${u.layerIds[0]}: Value for "text-size" is >= ${Ad}. Reduce your "text-size".`)):"composite"===Ba.kind&&(Ya=[Pd*ia.compositeTextSizes[0].evaluate(_r,{},aa),Pd*ia.compositeTextSizes[1].evaluate(_r,{},aa)],(Ya[0]>Md||Ya[1]>Md)&&A(`${u.layerIds[0]}: Value for "text-size" is >= ${Ad}. Reduce your "text-size".`)),u.addSymbols(u.text,va,Ya,Sr,fr,_r,Jr,F,Ar.lineStartIndex,Ar.lineLength,ta,aa);for(const F of zn)Qs[F]=u.text.placedSymbolArray.length-1;return 4*va.length}function vh(u){for(const F in u)return u[F];return null}function bh(u,F,Vt,Wt){const Kt=u.compareText;if(F in Kt){const u=Kt[F];for(let F=u.length-1;F>=0;F--)if(Wt.dist(u[F])<Vt)return!0}else Kt[F]=[];return Kt[F].push(Wt),!1}const Zd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _h{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[F,Vt]=new Uint8Array(u,0,2);if(219!==F)throw new Error("Data does not appear to be in a KDBush format.");const Wt=Vt>>4;if(1!==Wt)throw new Error(`Got v${Wt} data when expected v1.`);const Kt=Zd[15&Vt];if(!Kt)throw new Error("Unrecognized array type.");const[Qi]=new Uint16Array(u,2,1),[fr]=new Uint32Array(u,4,1);return new _h(fr,Qi,Kt,u)}constructor(u,F=64,Vt=Float64Array,Wt){if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+F,2),65535),this.ArrayType=Vt,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const Kt=Zd.indexOf(this.ArrayType),Qi=2*u*this.ArrayType.BYTES_PER_ELEMENT,fr=u*this.IndexArrayType.BYTES_PER_ELEMENT,_r=(8-fr%8)%8;if(Kt<0)throw new Error(`Unexpected typed array class: ${Vt}.`);Wt&&Wt instanceof ArrayBuffer?(this.data=Wt,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+fr+_r,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+Qi+fr+_r),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+fr+_r,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Kt]),new Uint16Array(this.data,2,1)[0]=F,new Uint32Array(this.data,4,1)[0]=u)}add(u,F){const Vt=this._pos>>1;return this.ids[Vt]=Vt,this.coords[this._pos++]=u,this.coords[this._pos++]=F,Vt}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return Ah(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,F,Vt,Wt){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Kt,coords:Qi,nodeSize:fr}=this,_r=[0,Kt.length-1,0],Sr=[];for(;_r.length;){const Ar=_r.pop()||0,Jr=_r.pop()||0,zn=_r.pop()||0;if(Jr-zn<=fr){for(let fr=zn;fr<=Jr;fr++){const _r=Qi[2*fr],Ar=Qi[2*fr+1];_r>=u&&_r<=Vt&&Ar>=F&&Ar<=Wt&&Sr.push(Kt[fr])}continue}const Qs=zn+Jr>>1,ta=Qi[2*Qs],ia=Qi[2*Qs+1];ta>=u&&ta<=Vt&&ia>=F&&ia<=Wt&&Sr.push(Kt[Qs]),(0===Ar?u<=ta:F<=ia)&&(_r.push(zn),_r.push(Qs-1),_r.push(1-Ar)),(0===Ar?Vt>=ta:Wt>=ia)&&(_r.push(Qs+1),_r.push(Jr),_r.push(1-Ar))}return Sr}within(u,F,Vt){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Wt,coords:Kt,nodeSize:Qi}=this,fr=[0,Wt.length-1,0],_r=[],Sr=Vt*Vt;for(;fr.length;){const Ar=fr.pop()||0,Jr=fr.pop()||0,zn=fr.pop()||0;if(Jr-zn<=Qi){for(let Vt=zn;Vt<=Jr;Vt++)Ih(Kt[2*Vt],Kt[2*Vt+1],u,F)<=Sr&&_r.push(Wt[Vt]);continue}const Qs=zn+Jr>>1,ta=Kt[2*Qs],ia=Kt[2*Qs+1];Ih(ta,ia,u,F)<=Sr&&_r.push(Wt[Qs]),(0===Ar?u-Vt<=ta:F-Vt<=ia)&&(fr.push(zn),fr.push(Qs-1),fr.push(1-Ar)),(0===Ar?u+Vt>=ta:F+Vt>=ia)&&(fr.push(Qs+1),fr.push(Jr),fr.push(1-Ar))}return _r}}function Ah(u,F,Vt,Wt,Kt,Qi){if(Kt-Wt<=Vt)return;const fr=Wt+Kt>>1;Sh(u,F,fr,Wt,Kt,Qi),Ah(u,F,Vt,Wt,fr-1,1-Qi),Ah(u,F,Vt,fr+1,Kt,1-Qi)}function Sh(u,F,Vt,Wt,Kt,Qi){for(;Kt>Wt;){if(Kt-Wt>600){const fr=Kt-Wt+1,_r=Vt-Wt+1,Sr=Math.log(fr),Ar=.5*Math.exp(2*Sr/3),Jr=.5*Math.sqrt(Sr*Ar*(fr-Ar)/fr)*(_r-fr/2<0?-1:1);Sh(u,F,Vt,Math.max(Wt,Math.floor(Vt-_r*Ar/fr+Jr)),Math.min(Kt,Math.floor(Vt+(fr-_r)*Ar/fr+Jr)),Qi)}const fr=F[2*Vt+Qi];let _r=Wt,Sr=Kt;for(kh(u,F,Wt,Vt),F[2*Kt+Qi]>fr&&kh(u,F,Wt,Kt);_r<Sr;){for(kh(u,F,_r,Sr),_r++,Sr--;F[2*_r+Qi]<fr;)_r++;for(;F[2*Sr+Qi]>fr;)Sr--}F[2*Wt+Qi]===fr?kh(u,F,Wt,Sr):(Sr++,kh(u,F,Sr,Kt)),Sr<=Vt&&(Wt=Sr+1),Vt<=Sr&&(Kt=Sr-1)}}function kh(u,F,Vt,Wt){Mh(u,Vt,Wt),Mh(F,2*Vt,2*Wt),Mh(F,2*Vt+1,2*Wt+1)}function Mh(u,F,Vt){const Wt=u[F];u[F]=u[Vt],u[Vt]=Wt}function Ih(u,F,Vt,Wt){const Kt=u-Vt,Qi=F-Wt;return Kt*Kt+Qi*Qi}var qd;F.be=void 0,(qd=F.be||(F.be={})).create="create",qd.load="load",qd.fullLoad="fullLoad";let Gd=null,Wd=[];const Hd=1e3/60,Xd="loadTime",Kd="fullLoadTime",Jd={mark(u){performance.mark(u)},frame(u){const F=u;null!=Gd&&Wd.push(F-Gd),Gd=F},clearMetrics(){Gd=null,Wd=[],performance.clearMeasures(Xd),performance.clearMeasures(Kd);for(const u in F.be)performance.clearMarks(F.be[u])},getPerformanceMetrics(){performance.measure(Xd,F.be.create,F.be.load),performance.measure(Kd,F.be.create,F.be.fullLoad);const u=performance.getEntriesByName(Xd)[0].duration,Vt=performance.getEntriesByName(Kd)[0].duration,Wt=Wd.length,Kt=1/(Wd.reduce(((u,F)=>u+F),0)/Wt/1e3),Qi=Wd.filter((u=>u>Hd)).reduce(((u,F)=>u+(F-Hd)/Hd),0);return{loadTime:u,fullLoadTime:Vt,fps:Kt,percentDroppedFrames:Qi/(Wt+Qi)*100,totalFrames:Wt}}};F.$=ea,F.A=Vh,F.B=function(u){if(null==zn){const F=u.navigator?u.navigator.userAgent:null;zn=!!u.safari||!(!F||!(/\b(iPad|iPhone|iPod)\b/.test(F)||F.match("Safari")&&!F.match("Chrome")))}return zn},F.C=class{constructor(u,F){this.target=u,this.mapId=F,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _c((()=>this.process())),this.subscription=function(u,F,Vt,Wt){return u.addEventListener(F,Vt,!1),{unsubscribe:()=>{u.removeEventListener(F,Vt,!1)}}}(this.target,"message",(u=>this.receive(u))),this.globalScope=k(self)?u:window}registerMessageHandler(u,F){this.messageHandlers[u]=F}sendAsync(u,F){return new Promise(((Vt,Wt)=>{const Kt=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[Kt]={resolve:Vt,reject:Wt},F&&F.signal.addEventListener("abort",(()=>{delete this.resolveRejects[Kt];const F={id:Kt,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(F)}),{once:!0});const Qi=[],fr=Object.assign(Object.assign({},u),{id:Kt,sourceMapId:this.mapId,origin:location.origin,data:Ai(u.data,Qi)});this.target.postMessage(fr,{transfer:Qi})}))}receive(u){const F=u.data,Vt=F.id;if(!("file://"!==F.origin&&"file://"!==location.origin&&F.origin!==location.origin||F.targetMapId&&this.mapId!==F.targetMapId)){if("<cancel>"===F.type){delete this.tasks[Vt];const u=this.abortControllers[Vt];return delete this.abortControllers[Vt],void(u&&u.abort())}if(k(self)||F.mustQueue)return this.tasks[Vt]=F,this.taskQueue.push(Vt),void this.invoker.trigger();this.processTask(Vt,F)}}process(){if(0===this.taskQueue.length)return;const u=this.taskQueue.shift(),F=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),F&&this.processTask(u,F)}processTask(u,F){return e(this,void 0,void 0,(function*(){if("<response>"===F.type){const Vt=this.resolveRejects[u];if(delete this.resolveRejects[u],!Vt)return;return void(F.error?Vt.reject(Si(F.error)):Vt.resolve(Si(F.data)))}if(!this.messageHandlers[F.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${F.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const Vt=Si(F.data),Wt=new AbortController;this.abortControllers[u]=Wt;try{const Kt=yield this.messageHandlers[F.type](F.sourceMapId,Vt,Wt);this.completeTask(u,null,Kt)}catch(Vt){this.completeTask(u,Vt)}}))}completeTask(u,F,Vt){const Wt=[];delete this.abortControllers[u];const Kt={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:F?Ai(F):null,data:Ai(Vt,Wt)};this.target.postMessage(Kt,{transfer:Wt})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},F.D=Zi,F.E=Z,F.F=function(){var u=new Vh(16);return Vh!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},F.G=Ba,F.H=function(u,F,Vt){var Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa=Vt[0],va=Vt[1],Ba=Vt[2];return F===u?(u[12]=F[0]*aa+F[4]*va+F[8]*Ba+F[12],u[13]=F[1]*aa+F[5]*va+F[9]*Ba+F[13],u[14]=F[2]*aa+F[6]*va+F[10]*Ba+F[14],u[15]=F[3]*aa+F[7]*va+F[11]*Ba+F[15]):(Kt=F[1],Qi=F[2],fr=F[3],_r=F[4],Sr=F[5],Ar=F[6],Jr=F[7],zn=F[8],Qs=F[9],ta=F[10],ia=F[11],u[0]=Wt=F[0],u[1]=Kt,u[2]=Qi,u[3]=fr,u[4]=_r,u[5]=Sr,u[6]=Ar,u[7]=Jr,u[8]=zn,u[9]=Qs,u[10]=ta,u[11]=ia,u[12]=Wt*aa+_r*va+zn*Ba+F[12],u[13]=Kt*aa+Sr*va+Qs*Ba+F[13],u[14]=Qi*aa+Ar*va+ta*Ba+F[14],u[15]=fr*aa+Jr*va+ia*Ba+F[15]),u},F.I=Cu,F.J=function(u,F,Vt){var Wt=Vt[0],Kt=Vt[1],Qi=Vt[2];return u[0]=F[0]*Wt,u[1]=F[1]*Wt,u[2]=F[2]*Wt,u[3]=F[3]*Wt,u[4]=F[4]*Kt,u[5]=F[5]*Kt,u[6]=F[6]*Kt,u[7]=F[7]*Kt,u[8]=F[8]*Qi,u[9]=F[9]*Qi,u[10]=F[10]*Qi,u[11]=F[11]*Qi,u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15],u},F.K=no,F.L=function(u,F){const Vt={};for(let Wt=0;Wt<F.length;Wt++){const Kt=F[Wt];Kt in u&&(Vt[Kt]=u[Kt])}return Vt},F.M=Sc,F.N=Ic,F.O=zc,F.P=Wt,F.Q=Tc,F.R=go,F.S=h,F.T=Oi,F.U=p,F.V=P,F.W=zh,F.X=rs,F.Y=Cc,F.Z=class extends as{},F._=e,F.a=va,F.a$=function(u,F){return u[0]=F[0],u[1]=F[1],u[2]=F[2],u[3]=F[3],u[4]=F[4],u[5]=F[5],u[6]=F[6],u[7]=F[7],u[8]=F[8],u[9]=F[9],u[10]=F[10],u[11]=F[11],u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15],u},F.a0=Ec,F.a1=it,F.a2=u=>{const F=window.document.createElement("video");return F.muted=!0,new Promise((Vt=>{F.onloadstart=()=>{Vt(F)};for(const Vt of u){const u=window.document.createElement("source");R(Vt)||(F.crossOrigin="Anonymous"),u.src=Vt,F.appendChild(u)}}))},F.a3=function(){return Ar++},F.a4=zs,F.a5=uc,F.a6=Pn,F.a7=Fa,F.a8=$i,F.a9=Oc,F.aA=function(u){if("custom"===u.type)return new wc(u);switch(u.type){case"background":return new gc(u);case"circle":return new oo(u);case"fill":return new sl(u);case"fill-extrusion":return new Pl(u);case"heatmap":return new vo(u);case"hillshade":return new _o(u);case"line":return new Zl(u);case"raster":return new bc(u);case"symbol":return new dc(u)}},F.aB=w,F.aC=function(u,F){if(!u)return[{command:"setStyle",args:[F]}];let Vt=[];try{if(!X(u.version,F.version))return[{command:"setStyle",args:[F]}];X(u.center,F.center)||Vt.push({command:"setCenter",args:[F.center]}),X(u.zoom,F.zoom)||Vt.push({command:"setZoom",args:[F.zoom]}),X(u.bearing,F.bearing)||Vt.push({command:"setBearing",args:[F.bearing]}),X(u.pitch,F.pitch)||Vt.push({command:"setPitch",args:[F.pitch]}),X(u.sprite,F.sprite)||Vt.push({command:"setSprite",args:[F.sprite]}),X(u.glyphs,F.glyphs)||Vt.push({command:"setGlyphs",args:[F.glyphs]}),X(u.transition,F.transition)||Vt.push({command:"setTransition",args:[F.transition]}),X(u.light,F.light)||Vt.push({command:"setLight",args:[F.light]}),X(u.terrain,F.terrain)||Vt.push({command:"setTerrain",args:[F.terrain]}),X(u.sky,F.sky)||Vt.push({command:"setSky",args:[F.sky]});const Wt={},Kt=[];!function(u,F,Vt,Wt){let Kt;for(Kt in F=F||{},u=u||{})Object.prototype.hasOwnProperty.call(u,Kt)&&(Object.prototype.hasOwnProperty.call(F,Kt)||W(Kt,Vt,Wt));for(Kt in F)Object.prototype.hasOwnProperty.call(F,Kt)&&(Object.prototype.hasOwnProperty.call(u,Kt)?X(u[Kt],F[Kt])||("geojson"===u[Kt].type&&"geojson"===F[Kt].type&&tt(u,F,Kt)?H(Vt,{command:"setGeoJSONSourceData",args:[Kt,F[Kt].data]}):Q(Kt,F,Vt,Wt)):Y(Kt,F,Vt))}(u.sources,F.sources,Kt,Wt);const Qi=[];u.layers&&u.layers.forEach((u=>{"source"in u&&Wt[u.source]?Vt.push({command:"removeLayer",args:[u.id]}):Qi.push(u)})),Vt=Vt.concat(Kt),function(u,F,Vt){F=F||[];const Wt=(u=u||[]).map(rt),Kt=F.map(rt),Qi=u.reduce(nt,{}),fr=F.reduce(nt,{}),_r=Wt.slice(),Sr=Object.create(null);let Ar,Jr,zn,Qs,ta;for(let u=0,F=0;u<Wt.length;u++)Ar=Wt[u],Object.prototype.hasOwnProperty.call(fr,Ar)?F++:(H(Vt,{command:"removeLayer",args:[Ar]}),_r.splice(_r.indexOf(Ar,F),1));for(let u=0,F=0;u<Kt.length;u++)Ar=Kt[Kt.length-1-u],_r[_r.length-1-u]!==Ar&&(Object.prototype.hasOwnProperty.call(Qi,Ar)?(H(Vt,{command:"removeLayer",args:[Ar]}),_r.splice(_r.lastIndexOf(Ar,_r.length-F),1)):F++,Qs=_r[_r.length-u],H(Vt,{command:"addLayer",args:[fr[Ar],Qs]}),_r.splice(_r.length-u,0,Ar),Sr[Ar]=!0);for(let u=0;u<Kt.length;u++)if(Ar=Kt[u],Jr=Qi[Ar],zn=fr[Ar],!Sr[Ar]&&!X(Jr,zn))if(X(Jr.source,zn.source)&&X(Jr["source-layer"],zn["source-layer"])&&X(Jr.type,zn.type)){for(ta in et(Jr.layout,zn.layout,Vt,Ar,null,"setLayoutProperty"),et(Jr.paint,zn.paint,Vt,Ar,null,"setPaintProperty"),X(Jr.filter,zn.filter)||H(Vt,{command:"setFilter",args:[Ar,zn.filter]}),X(Jr.minzoom,zn.minzoom)&&X(Jr.maxzoom,zn.maxzoom)||H(Vt,{command:"setLayerZoomRange",args:[Ar,zn.minzoom,zn.maxzoom]}),Jr)Object.prototype.hasOwnProperty.call(Jr,ta)&&"layout"!==ta&&"paint"!==ta&&"filter"!==ta&&"metadata"!==ta&&"minzoom"!==ta&&"maxzoom"!==ta&&(0===ta.indexOf("paint.")?et(Jr[ta],zn[ta],Vt,Ar,ta.slice(6),"setPaintProperty"):X(Jr[ta],zn[ta])||H(Vt,{command:"setLayerProperty",args:[Ar,ta,zn[ta]]}));for(ta in zn)Object.prototype.hasOwnProperty.call(zn,ta)&&!Object.prototype.hasOwnProperty.call(Jr,ta)&&"layout"!==ta&&"paint"!==ta&&"filter"!==ta&&"metadata"!==ta&&"minzoom"!==ta&&"maxzoom"!==ta&&(0===ta.indexOf("paint.")?et(Jr[ta],zn[ta],Vt,Ar,ta.slice(6),"setPaintProperty"):X(Jr[ta],zn[ta])||H(Vt,{command:"setLayerProperty",args:[Ar,ta,zn[ta]]}))}else H(Vt,{command:"removeLayer",args:[Ar]}),Qs=_r[_r.lastIndexOf(Ar)+1],H(Vt,{command:"addLayer",args:[zn,Qs]})}(Qi,F.layers,Vt)}catch(u){console.warn("Unable to compute style diff:",u),Vt=[{command:"setStyle",args:[F]}]}return Vt},F.aD=function(u){const F=[],Vt=u.id;return void 0===Vt&&F.push({message:`layers.${Vt}: missing required property "id"`}),void 0===u.render&&F.push({message:`layers.${Vt}: missing required method "render"`}),u.renderingMode&&"2d"!==u.renderingMode&&"3d"!==u.renderingMode&&F.push({message:`layers.${Vt}: property "renderingMode" must be either "2d" or "3d"`}),F},F.aE=function t(u,F){if(Array.isArray(u)){if(!Array.isArray(F)||u.length!==F.length)return!1;for(let Vt=0;Vt<u.length;Vt++)if(!t(u[Vt],F[Vt]))return!1;return!0}if("object"==typeof u&&null!==u&&null!==F){if("object"!=typeof F)return!1;if(Object.keys(u).length!==Object.keys(F).length)return!1;for(const Vt in u)if(!t(u[Vt],F[Vt]))return!1;return!0}return u===F},F.aF=v,F.aG=b,F.aH=class extends ya{constructor(u,F){super(u,F),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},F.aI=ma,F.aJ=class extends ya{constructor(u,F){super(u,F),this.current=Eh}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let F=1;F<16;F++)if(u[F]!==this.current[F]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},F.aK=ga,F.aL=class extends ya{constructor(u,F){super(u,F),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},F.aM=class extends ya{constructor(u,F){super(u,F),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},F.aN=xa,F.aO=function(u,F,Vt,Wt,Kt,Qi,fr){var _r=1/(F-Vt),Sr=1/(Wt-Kt),Ar=1/(Qi-fr);return u[0]=-2*_r,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*Sr,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*Ar,u[11]=0,u[12]=(F+Vt)*_r,u[13]=(Kt+Wt)*Sr,u[14]=(fr+Qi)*Ar,u[15]=1,u},F.aP=Gt,F.aQ=Nh,F.aR=class extends ms{},F.aS=ud,F.aT=class extends xs{},F.aU=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},F.aV=xo,F.aW=Os,F.aX=class extends ks{},F.aY=Ys,F.aZ=function(u,F){return u[0]===F[0]&&u[1]===F[1]&&u[2]===F[2]&&u[3]===F[3]&&u[4]===F[4]&&u[5]===F[5]&&u[6]===F[6]&&u[7]===F[7]&&u[8]===F[8]&&u[9]===F[9]&&u[10]===F[10]&&u[11]===F[11]&&u[12]===F[12]&&u[13]===F[13]&&u[14]===F[14]&&u[15]===F[15]},F.a_=function(u,F){var Vt=u[0],Wt=u[1],Kt=u[2],Qi=u[3],fr=u[4],_r=u[5],Sr=u[6],Ar=u[7],Jr=u[8],zn=u[9],Qs=u[10],ta=u[11],ia=u[12],aa=u[13],va=u[14],Ba=u[15],Ya=F[0],to=F[1],eo=F[2],io=F[3],so=F[4],co=F[5],ho=F[6],bo=F[7],wo=F[8],So=F[9],Ao=F[10],ko=F[11],Wo=F[12],il=F[13],rl=F[14],nl=F[15];return Math.abs(Vt-Ya)<=Oh*Math.max(1,Math.abs(Vt),Math.abs(Ya))&&Math.abs(Wt-to)<=Oh*Math.max(1,Math.abs(Wt),Math.abs(to))&&Math.abs(Kt-eo)<=Oh*Math.max(1,Math.abs(Kt),Math.abs(eo))&&Math.abs(Qi-io)<=Oh*Math.max(1,Math.abs(Qi),Math.abs(io))&&Math.abs(fr-so)<=Oh*Math.max(1,Math.abs(fr),Math.abs(so))&&Math.abs(_r-co)<=Oh*Math.max(1,Math.abs(_r),Math.abs(co))&&Math.abs(Sr-ho)<=Oh*Math.max(1,Math.abs(Sr),Math.abs(ho))&&Math.abs(Ar-bo)<=Oh*Math.max(1,Math.abs(Ar),Math.abs(bo))&&Math.abs(Jr-wo)<=Oh*Math.max(1,Math.abs(Jr),Math.abs(wo))&&Math.abs(zn-So)<=Oh*Math.max(1,Math.abs(zn),Math.abs(So))&&Math.abs(Qs-Ao)<=Oh*Math.max(1,Math.abs(Qs),Math.abs(Ao))&&Math.abs(ta-ko)<=Oh*Math.max(1,Math.abs(ta),Math.abs(ko))&&Math.abs(ia-Wo)<=Oh*Math.max(1,Math.abs(ia),Math.abs(Wo))&&Math.abs(aa-il)<=Oh*Math.max(1,Math.abs(aa),Math.abs(il))&&Math.abs(va-rl)<=Oh*Math.max(1,Math.abs(va),Math.abs(rl))&&Math.abs(Ba-nl)<=Oh*Math.max(1,Math.abs(Ba),Math.abs(nl))},F.aa=function(u){const F={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,Vt,Wt,Kt)=>{const Qi=Wt||Kt;return F[Vt]=!Qi||Qi.toLowerCase(),""})),F["max-age"]){const u=parseInt(F["max-age"],10);isNaN(u)?delete F["max-age"]:F["max-age"]=u}return F},F.ab=function(u,F){const Vt=[];for(const Wt in u)Wt in F||Vt.push(Wt);return Vt},F.ac=y,F.ad=function(u,F,Vt){var Wt=Math.sin(Vt),Kt=Math.cos(Vt),Qi=F[0],fr=F[1],_r=F[2],Sr=F[3],Ar=F[4],Jr=F[5],zn=F[6],Qs=F[7];return F!==u&&(u[8]=F[8],u[9]=F[9],u[10]=F[10],u[11]=F[11],u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15]),u[0]=Qi*Kt+Ar*Wt,u[1]=fr*Kt+Jr*Wt,u[2]=_r*Kt+zn*Wt,u[3]=Sr*Kt+Qs*Wt,u[4]=Ar*Kt-Qi*Wt,u[5]=Jr*Kt-fr*Wt,u[6]=zn*Kt-_r*Wt,u[7]=Qs*Kt-Sr*Wt,u},F.ae=function(u){var F=new Vh(16);return F[0]=u[0],F[1]=u[1],F[2]=u[2],F[3]=u[3],F[4]=u[4],F[5]=u[5],F[6]=u[6],F[7]=u[7],F[8]=u[8],F[9]=u[9],F[10]=u[10],F[11]=u[11],F[12]=u[12],F[13]=u[13],F[14]=u[14],F[15]=u[15],F},F.af=ao,F.ag=function(u,F){let Vt=0,Wt=0;if("constant"===u.kind)Wt=u.layoutSize;else if("source"!==u.kind){const{interpolationType:Kt,minZoom:Qi,maxZoom:fr}=u,_r=Kt?y(Ce.interpolationFactor(Kt,F,Qi,fr),0,1):0;"camera"===u.kind?Wt=zl.number(u.minSize,u.maxSize,_r):Vt=_r}return{uSizeT:Vt,uSize:Wt}},F.ai=function(u,{uSize:F,uSizeT:Vt},{lowerSize:Wt,upperSize:Kt}){return"source"===u.kind?Wt/Pd:"composite"===u.kind?zl.number(Wt/Pd,Kt/Pd,Vt):F},F.aj=sc,F.ak=function(u,F,Vt,Kt){const Qi=F.y-u.y,fr=F.x-u.x,_r=Kt.y-Vt.y,Sr=Kt.x-Vt.x,Ar=_r*fr-Sr*Qi;if(0===Ar)return null;const Jr=(Sr*(u.y-Vt.y)-_r*(u.x-Vt.x))/Ar;return new Wt(u.x+Jr*fr,u.y+Jr*Qi)},F.al=Nc,F.am=La,F.an=ro,F.ao=function(u){let F=1/0,Vt=1/0,Wt=-1/0,Kt=-1/0;for(const Qi of u)F=Math.min(F,Qi.x),Vt=Math.min(Vt,Qi.y),Wt=Math.max(Wt,Qi.x),Kt=Math.max(Kt,Qi.y);return[F,Vt,Wt,Kt]},F.ap=pd,F.ar=ec,F.as=function(u,F){var Vt=F[0],Wt=F[1],Kt=F[2],Qi=F[3],fr=F[4],_r=F[5],Sr=F[6],Ar=F[7],Jr=F[8],zn=F[9],Qs=F[10],ta=F[11],ia=F[12],aa=F[13],va=F[14],Ba=F[15],Ya=Vt*_r-Wt*fr,to=Vt*Sr-Kt*fr,eo=Vt*Ar-Qi*fr,io=Wt*Sr-Kt*_r,so=Wt*Ar-Qi*_r,co=Kt*Ar-Qi*Sr,ho=Jr*aa-zn*ia,bo=Jr*va-Qs*ia,wo=Jr*Ba-ta*ia,So=zn*va-Qs*aa,Ao=zn*Ba-ta*aa,ko=Qs*Ba-ta*va,Wo=Ya*ko-to*Ao+eo*So+io*wo-so*bo+co*ho;return Wo?(u[0]=(_r*ko-Sr*Ao+Ar*So)*(Wo=1/Wo),u[1]=(Kt*Ao-Wt*ko-Qi*So)*Wo,u[2]=(aa*co-va*so+Ba*io)*Wo,u[3]=(Qs*so-zn*co-ta*io)*Wo,u[4]=(Sr*wo-fr*ko-Ar*bo)*Wo,u[5]=(Vt*ko-Kt*wo+Qi*bo)*Wo,u[6]=(va*eo-ia*co-Ba*to)*Wo,u[7]=(Jr*co-Qs*eo+ta*to)*Wo,u[8]=(fr*Ao-_r*wo+Ar*ho)*Wo,u[9]=(Wt*wo-Vt*Ao-Qi*ho)*Wo,u[10]=(ia*so-aa*eo+Ba*Ya)*Wo,u[11]=(zn*eo-Jr*so-ta*Ya)*Wo,u[12]=(_r*bo-fr*So-Sr*ho)*Wo,u[13]=(Vt*So-Wt*bo+Kt*ho)*Wo,u[14]=(aa*to-ia*io-va*Ya)*Wo,u[15]=(Jr*io-zn*to+Qs*Ya)*Wo,u):null},F.at=mh,F.au=Ku,F.av=_h,F.aw=function(){const u={},F=Ya.$version;for(const Vt in Ya.$root){const Wt=Ya.$root[Vt];if(Wt.required){let Kt=null;Kt="version"===Vt?F:"array"===Wt.type?[]:{},null!=Kt&&(u[Vt]=Kt)}}return u},F.ax=ki,F.ay=D,F.az=function(u){u=u.slice();const F=Object.create(null);for(let Vt=0;Vt<u.length;Vt++)F[u[Vt].id]=u[Vt];for(let Vt=0;Vt<u.length;Vt++)"ref"in u[Vt]&&(u[Vt]=J(u[Vt],F[u[Vt].ref]));return u},F.b=I,F.b0=function(u,F,Vt){return u[0]=F[0]*Vt[0],u[1]=F[1]*Vt[1],u[2]=F[2]*Vt[2],u[3]=F[3]*Vt[3],u},F.b1=function(u,F){return u[0]*F[0]+u[1]*F[1]+u[2]*F[2]+u[3]*F[3]},F.b2=m,F.b3=Fc,F.b4=Pc,F.b5=function(u,F,Vt,Wt,Kt){var Qi,fr=1/Math.tan(F/2);return u[0]=fr/Vt,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=fr,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,null!=Kt&&Kt!==1/0?(u[10]=(Kt+Wt)*(Qi=1/(Wt-Kt)),u[14]=2*Kt*Wt*Qi):(u[10]=-1,u[14]=-2*Wt),u},F.b6=function(u,F,Vt){var Wt=Math.sin(Vt),Kt=Math.cos(Vt),Qi=F[4],fr=F[5],_r=F[6],Sr=F[7],Ar=F[8],Jr=F[9],zn=F[10],Qs=F[11];return F!==u&&(u[0]=F[0],u[1]=F[1],u[2]=F[2],u[3]=F[3],u[12]=F[12],u[13]=F[13],u[14]=F[14],u[15]=F[15]),u[4]=Qi*Kt+Ar*Wt,u[5]=fr*Kt+Jr*Wt,u[6]=_r*Kt+zn*Wt,u[7]=Sr*Kt+Qs*Wt,u[8]=Ar*Kt-Qi*Wt,u[9]=Jr*Kt-fr*Wt,u[10]=zn*Kt-_r*Wt,u[11]=Qs*Kt-Sr*Wt,u},F.b7=f,F.b8=Sr,F.b9=function(u){return u*Math.PI/180},F.bA=wn,F.bB=yc,F.ba=function(u,F){return u[0]=F[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=F[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=F[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},F.bb=class extends ss{},F.bc=Od,F.bd=Jd,F.bf=L,F.bg=function(u,F){va.REGISTERED_PROTOCOLS[u]=F},F.bh=function(u){delete va.REGISTERED_PROTOCOLS[u]},F.bi=function(u,F){const Vt={};for(let Wt=0;Wt<u.length;Wt++){const Kt=F&&F[u[Wt].id]||Dn(u[Wt]);F&&(F[u[Wt].id]=Kt);let Qi=Vt[Kt];Qi||(Qi=Vt[Kt]=[]),Qi.push(u[Wt])}const Wt=[];for(const u in Vt)Wt.push(Vt[u]);return Wt},F.bj=wi,F.bk=Dc,F.bl=Rc,F.bm=Vu,F.bn=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=zh/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const Vt=u.bucket.layers[0],Wt=Vt.layout,Kt=Vt._unevaluatedLayout._values,Qi={layoutIconSize:Kt["icon-size"].possiblyEvaluate(new $i(u.bucket.zoom+1),u.canonical),layoutTextSize:Kt["text-size"].possiblyEvaluate(new $i(u.bucket.zoom+1),u.canonical),textMaxSize:Kt["text-size"].possiblyEvaluate(new $i(18))};if("composite"===u.bucket.textSizeData.kind){const{minZoom:F,maxZoom:Vt}=u.bucket.textSizeData;Qi.compositeTextSizes=[Kt["text-size"].possiblyEvaluate(new $i(F),u.canonical),Kt["text-size"].possiblyEvaluate(new $i(Vt),u.canonical)]}if("composite"===u.bucket.iconSizeData.kind){const{minZoom:F,maxZoom:Vt}=u.bucket.iconSizeData;Qi.compositeIconSizes=[Kt["icon-size"].possiblyEvaluate(new $i(F),u.canonical),Kt["icon-size"].possiblyEvaluate(new $i(Vt),u.canonical)]}const fr=Wt.get("text-line-height")*pd,_r="viewport"!==Wt.get("text-rotation-alignment")&&"point"!==Wt.get("symbol-placement"),Sr=Wt.get("text-keep-upright"),Ar=Wt.get("text-size");for(const Kt of u.bucket.features){const Jr=Wt.get("text-font").evaluate(Kt,{},u.canonical).join(","),zn=Ar.evaluate(Kt,{},u.canonical),Qs=Qi.layoutTextSize.evaluate(Kt,{},u.canonical),ta=Qi.layoutIconSize.evaluate(Kt,{},u.canonical),ia={horizontal:{},vertical:void 0},aa=Kt.text;let va,Ba=[0,0];if(aa){const Qi=aa.toString(),Ar=Wt.get("text-letter-spacing").evaluate(Kt,{},u.canonical)*pd,ta=zi(Qi)?Ar:0,va=Wt.get("text-anchor").evaluate(Kt,{},u.canonical),Ya=yh(Vt,Kt,u.canonical);if(!Ya){const F=Wt.get("text-radial-offset").evaluate(Kt,{},u.canonical);Ba=F?dh(va,[F*pd,$d]):Wt.get("text-offset").evaluate(Kt,{},u.canonical).map((u=>u*pd))}let to=_r?"center":Wt.get("text-justify").evaluate(Kt,{},u.canonical);const eo=Wt.get("symbol-placement"),io="point"===eo?Wt.get("text-max-width").evaluate(Kt,{},u.canonical)*pd:0,_=()=>{u.bucket.allowVerticalPlacement&&Ii(Qi)&&(ia.vertical=Lu(aa,u.glyphMap,u.glyphPositions,u.imagePositions,Jr,io,fr,va,"left",ta,Ba,F.ah.vertical,!0,eo,Qs,zn))};if(!_r&&Ya){const Vt=new Set;if("auto"===to)for(let u=0;u<Ya.values.length;u+=2)Vt.add(mh(Ya.values[u]));else Vt.add(to);let Wt=!1;for(const Kt of Vt)if(!ia.horizontal[Kt])if(Wt)ia.horizontal[Kt]=ia.horizontal[0];else{const Vt=Lu(aa,u.glyphMap,u.glyphPositions,u.imagePositions,Jr,io,fr,"center",Kt,ta,Ba,F.ah.horizontal,!1,eo,Qs,zn);Vt&&(ia.horizontal[Kt]=Vt,Wt=1===Vt.positionedLines.length)}_()}else{"auto"===to&&(to=mh(va));const Vt=Lu(aa,u.glyphMap,u.glyphPositions,u.imagePositions,Jr,io,fr,va,to,ta,Ba,F.ah.horizontal,!1,eo,Qs,zn);Vt&&(ia.horizontal[to]=Vt),_(),Ii(Qi)&&_r&&Sr&&(ia.vertical=Lu(aa,u.glyphMap,u.glyphPositions,u.imagePositions,Jr,io,fr,va,to,ta,Ba,F.ah.vertical,!1,eo,Qs,zn))}}let Ya=!1;if(Kt.icon&&Kt.icon.name){const F=u.imageMap[Kt.icon.name];F&&(va=Ju(u.imagePositions[Kt.icon.name],Wt.get("icon-offset").evaluate(Kt,{},u.canonical),Wt.get("icon-anchor").evaluate(Kt,{},u.canonical)),Ya=!!F.sdf,void 0===u.bucket.sdfIcons?u.bucket.sdfIcons=Ya:u.bucket.sdfIcons!==Ya&&A("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(F.pixelRatio!==u.bucket.pixelRatio||0!==Wt.get("icon-rotate").constantOr(1))&&(u.bucket.iconsNeedLinear=!0))}const to=vh(ia.horizontal)||ia.vertical;u.bucket.iconsInText=!!to&&to.iconsInText,(to||va)&&gh(u.bucket,Kt,ia,va,u.imageMap,Qi,Qs,ta,Ba,Ya,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},F.bo=Ol,F.bp=el,F.bq=Sl,F.br=su,F.bs=yd,F.bt=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return 0===u.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},F.bu=function(F,Vt,Wt,Kt,Qi){return e(this||u,void 0,void 0,(function*(){if(p())try{return yield P(F,Vt,Wt,Kt,Qi)}catch(u){}return function(u,F,Vt,Wt,Kt){const Qi=u.width,fr=u.height;ta&&ia||(ta=new OffscreenCanvas(Qi,fr),ia=ta.getContext("2d",{willReadFrequently:!0})),ta.width=Qi,ta.height=fr,ia.drawImage(u,0,0,Qi,fr);const _r=ia.getImageData(F,Vt,Wt,Kt);return ia.clearRect(0,0,Qi,fr),_r.data}(F,Vt,Wt,Kt,Qi)}))},F.bv=Lc,F.bw=r,F.bx=Vt,F.by=fd,F.bz=function(u){return u.message===aa},F.c=E,F.d=u=>e(void 0,void 0,void 0,(function*(){if(0===u.byteLength)return createImageBitmap(new ImageData(1,1));const F=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(F)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),F.e=g,F.f=u=>new Promise(((F,Vt)=>{const Wt=new Image;Wt.onload=()=>{F(Wt),URL.revokeObjectURL(Wt.src),Wt.onload=null,window.requestAnimationFrame((()=>{Wt.src=Qs}))},Wt.onerror=()=>Vt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Kt=new Blob([new Uint8Array(u)],{type:"image/png"});Wt.src=u.byteLength?URL.createObjectURL(Kt):Qs})),F.g=T,F.h=(u,F)=>O(g(u,{type:"json"}),F),F.i=k,F.j=N,F.k=q,F.l=(u,F)=>O(g(u,{type:"arrayBuffer"}),F),F.m=O,F.n=function(u){return new yd(u).readFields(ku,[])},F.o=mo,F.p=Pu,F.q=Hi,F.r=nc,F.s=R,F.t=xi,F.u=mc,F.v=Ya,F.w=A,F.x=rc,F.y=function([u,F,Vt]){return F+=90,F*=Math.PI/180,Vt*=Math.PI/180,{x:u*Math.cos(F)*Math.sin(Vt),y:u*Math.sin(F)*Math.sin(Vt),z:u*Math.cos(Vt)}},F.z=zl}));define("worker",["./shared"],(function(F){class t{constructor(u){this.keyCache={},u&&this.replace(u)}replace(u){this._layerConfigs={},this._layers={},this.update(u,[])}update(u,Vt){for(const Vt of u){this._layerConfigs[Vt.id]=Vt;const u=this._layers[Vt.id]=F.aA(Vt);u._featureFilter=F.a6(u.filter),this.keyCache[Vt.id]&&delete this.keyCache[Vt.id]}for(const u of Vt)delete this.keyCache[u],delete this._layerConfigs[u],delete this._layers[u];this.familiesBySource={};const Wt=F.bi(Object.values(this._layerConfigs),this.keyCache);for(const u of Wt){const F=u.map((u=>this._layers[u.id])),Vt=F[0];if("none"===Vt.visibility)continue;const Wt=Vt.source||"";let Kt=this.familiesBySource[Wt];Kt||(Kt=this.familiesBySource[Wt]={});const Qi=Vt.sourceLayer||"_geojsonTileLayer";let fr=Kt[Qi];fr||(fr=Kt[Qi]=[]),fr.push(F)}}}class r{constructor(u){const Vt={},Wt=[];for(const F in u){const Kt=u[F],Qi=Vt[F]={};for(const u in Kt){const F=Kt[+u];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const Vt={x:0,y:0,w:F.bitmap.width+2,h:F.bitmap.height+2};Wt.push(Vt),Qi[u]={rect:Vt,metrics:F.metrics}}}const{w:Kt,h:Qi}=F.p(Wt),fr=new F.o({width:Kt||1,height:Qi||1});for(const Wt in u){const Kt=u[Wt];for(const u in Kt){const Qi=Kt[+u];if(!Qi||0===Qi.bitmap.width||0===Qi.bitmap.height)continue;const _r=Vt[Wt][u].rect;F.o.copy(Qi.bitmap,fr,{x:0,y:0},{x:_r.x+1,y:_r.y+1},Qi.bitmap)}}this.image=fr,this.positions=Vt}}F.bj("GlyphAtlas",r);class i{constructor(u){this.tileID=new F.Q(u.tileID.overscaledZ,u.tileID.wrap,u.tileID.canonical.z,u.tileID.canonical.x,u.tileID.canonical.y),this.uid=u.uid,this.zoom=u.zoom,this.pixelRatio=u.pixelRatio,this.tileSize=u.tileSize,this.source=u.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=u.showCollisionBoxes,this.collectResourceTiming=!!u.collectResourceTiming,this.returnDependencies=!!u.returnDependencies,this.promoteId=u.promoteId,this.inFlightDependencies=[]}parse(u,Vt,Wt,Kt){return F._(this,void 0,void 0,(function*(){this.status="parsing",this.data=u,this.collisionBoxArray=new F.a4;const Qi=new F.bk(Object.keys(u.layers).sort()),fr=new F.bl(this.tileID,this.promoteId);fr.bucketLayerIDs=[];const _r={},Sr={featureIndex:fr,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Wt},Ar=Vt.familiesBySource[this.source];for(const Vt in Ar){const Kt=u.layers[Vt];if(!Kt)continue;1===Kt.version&&F.w(`Vector tile source "${this.source}" layer "${Vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Jr=Qi.encode(Vt),zn=[];for(let u=0;u<Kt.length;u++){const F=Kt.feature(u),Wt=fr.getId(F,Vt);zn.push({feature:F,id:Wt,index:u,sourceLayerIndex:Jr})}for(const u of Ar[Vt]){const Vt=u[0];Vt.source!==this.source&&F.w(`layer.source = ${Vt.source} does not equal this.source = ${this.source}`),Vt.minzoom&&this.zoom<Math.floor(Vt.minzoom)||Vt.maxzoom&&this.zoom>=Vt.maxzoom||"none"!==Vt.visibility&&(o(u,this.zoom,Wt),(_r[Vt.id]=Vt.createBucket({index:fr.bucketLayerIDs.length,layers:u,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jr,sourceID:this.source})).populate(zn,Sr,this.tileID.canonical),fr.bucketLayerIDs.push(u.map((u=>u.id))))}}const Jr=F.aF(Sr.glyphDependencies,(u=>Object.keys(u).map(Number)));this.inFlightDependencies.forEach((u=>null==u?void 0:u.abort())),this.inFlightDependencies=[];let zn=Promise.resolve({});if(Object.keys(Jr).length){const u=new AbortController;this.inFlightDependencies.push(u),zn=Kt.sendAsync({type:"GG",data:{stacks:Jr,source:this.source,tileID:this.tileID,type:"glyphs"}},u)}const Qs=Object.keys(Sr.iconDependencies);let ta=Promise.resolve({});if(Qs.length){const u=new AbortController;this.inFlightDependencies.push(u),ta=Kt.sendAsync({type:"GI",data:{icons:Qs,source:this.source,tileID:this.tileID,type:"icons"}},u)}const ia=Object.keys(Sr.patternDependencies);let aa=Promise.resolve({});if(ia.length){const u=new AbortController;this.inFlightDependencies.push(u),aa=Kt.sendAsync({type:"GI",data:{icons:ia,source:this.source,tileID:this.tileID,type:"patterns"}},u)}const[va,Ba,Ya]=yield Promise.all([zn,ta,aa]),to=new r(va),eo=new F.bm(Ba,Ya);for(const u in _r){const Vt=_r[u];Vt instanceof F.a5?(o(Vt.layers,this.zoom,Wt),F.bn({bucket:Vt,glyphMap:va,glyphPositions:to.positions,imageMap:Ba,imagePositions:eo.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vt.hasPattern&&(Vt instanceof F.bo||Vt instanceof F.bp||Vt instanceof F.bq)&&(o(Vt.layers,this.zoom,Wt),Vt.addFeatures(Sr,this.tileID.canonical,eo.patternPositions))}return this.status="done",{buckets:Object.values(_r).filter((u=>!u.isEmpty())),featureIndex:fr,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:to.image,imageAtlas:eo,glyphMap:this.returnDependencies?va:null,iconMap:this.returnDependencies?Ba:null,glyphPositions:this.returnDependencies?to.positions:null}}))}}function o(u,Vt,Wt){const Kt=new F.a8(Vt);for(const F of u)F.recalculate(Kt,Wt)}class s{constructor(u,F,Vt){this.actor=u,this.layerIndex=F,this.availableImages=Vt,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(u,Vt){return F._(this,void 0,void 0,(function*(){const Wt=yield F.l(u.request,Vt);try{return{vectorTile:new F.br.VectorTile(new F.bs(Wt.data)),rawData:Wt.data,cacheControl:Wt.cacheControl,expires:Wt.expires}}catch(F){const Vt=new Uint8Array(Wt.data);let Kt=`Unable to parse the tile at ${u.request.url}, `;throw Kt+=31===Vt[0]&&139===Vt[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${F.messge}`,new Error(Kt)}}))}loadTile(u){return F._(this,void 0,void 0,(function*(){const Vt=u.uid,Wt=!!(u&&u.request&&u.request.collectResourceTiming)&&new F.bt(u.request),Kt=new i(u);this.loading[Vt]=Kt;const Qi=new AbortController;Kt.abort=Qi;try{const fr=yield this.loadVectorTile(u,Qi);if(delete this.loading[Vt],!fr)return null;const _r=fr.rawData,Sr={};fr.expires&&(Sr.expires=fr.expires),fr.cacheControl&&(Sr.cacheControl=fr.cacheControl);const Ar={};if(Wt){const u=Wt.finish();u&&(Ar.resourceTiming=JSON.parse(JSON.stringify(u)))}Kt.vectorTile=fr.vectorTile;const Jr=Kt.parse(fr.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Vt]=Kt,this.fetching[Vt]={rawTileData:_r,cacheControl:Sr,resourceTiming:Ar};try{const u=yield Jr;return F.e({rawTileData:_r.slice(0)},u,Sr,Ar)}finally{delete this.fetching[Vt]}}catch(u){throw delete this.loading[Vt],Kt.status="done",this.loaded[Vt]=Kt,u}}))}reloadTile(u){return F._(this,void 0,void 0,(function*(){const Vt=u.uid;if(!this.loaded||!this.loaded[Vt])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Wt=this.loaded[Vt];if(Wt.showCollisionBoxes=u.showCollisionBoxes,"parsing"===Wt.status){const u=yield Wt.parse(Wt.vectorTile,this.layerIndex,this.availableImages,this.actor);let Kt;if(this.fetching[Vt]){const{rawTileData:Wt,cacheControl:Qi,resourceTiming:fr}=this.fetching[Vt];delete this.fetching[Vt],Kt=F.e({rawTileData:Wt.slice(0)},u,Qi,fr)}else Kt=u;return Kt}if("done"===Wt.status&&Wt.vectorTile)return Wt.parse(Wt.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(u){return F._(this,void 0,void 0,(function*(){const F=this.loading,Vt=u.uid;F&&F[Vt]&&F[Vt].abort&&(F[Vt].abort.abort(),delete F[Vt])}))}removeTile(u){return F._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[u.uid]&&delete this.loaded[u.uid]}))}}class n{constructor(){this.loaded={}}loadTile(u){return F._(this,void 0,void 0,(function*(){const{uid:Vt,encoding:Wt,rawImageData:Kt,redFactor:Qi,greenFactor:fr,blueFactor:_r,baseShift:Sr}=u,Ar=Kt.width+2,Jr=Kt.height+2,zn=F.b(Kt)?new F.R({width:Ar,height:Jr},yield F.bu(Kt,-1,-1,Ar,Jr)):Kt,Qs=new F.bv(Vt,zn,Wt,Qi,fr,_r,Sr);return this.loaded=this.loaded||{},this.loaded[Vt]=Qs,Qs}))}removeTile(u){const F=this.loaded,Vt=u.uid;F&&F[Vt]&&delete F[Vt]}}function a(u,F){if(0!==u.length){l(u[0],F);for(var Vt=1;Vt<u.length;Vt++)l(u[Vt],!F)}}function l(u,F){for(var Vt=0,Wt=0,Kt=0,Qi=u.length,fr=Qi-1;Kt<Qi;fr=Kt++){var _r=(u[Kt][0]-u[fr][0])*(u[fr][1]+u[Kt][1]),Sr=Vt+_r;Wt+=Math.abs(Vt)>=Math.abs(_r)?Vt-Sr+_r:_r-Sr+Vt,Vt=Sr}Vt+Wt>=0!=!!F&&u.reverse()}var Vt=F.bw((function e(u,F){var Vt,Wt=u&&u.type;if("FeatureCollection"===Wt)for(Vt=0;Vt<u.features.length;Vt++)e(u.features[Vt],F);else if("GeometryCollection"===Wt)for(Vt=0;Vt<u.geometries.length;Vt++)e(u.geometries[Vt],F);else if("Feature"===Wt)e(u.geometry,F);else if("Polygon"===Wt)a(u.coordinates,F);else if("MultiPolygon"===Wt)for(Vt=0;Vt<u.coordinates.length;Vt++)a(u.coordinates[Vt],F);return u}));const Wt=F.br.VectorTileFeature.prototype.toGeoJSON;var Kt={exports:{}},Qi=F.bx,fr=F.br.VectorTileFeature,_r=f;function f(F,Vt){(this||u).options=Vt||{},(this||u).features=F,(this||u).length=F.length}function m(F,Vt){(this||u).id="number"==typeof F.id?F.id:void 0,(this||u).type=F.type,(this||u).rawGeometry=1===F.type?[F.geometry]:F.geometry,(this||u).properties=F.tags,(this||u).extent=Vt||4096}f.prototype.feature=function(F){return new m((this||u).features[F],(this||u).options.extent)},m.prototype.loadGeometry=function(){var F=(this||u).rawGeometry;(this||u).geometry=[];for(var Vt=0;Vt<F.length;Vt++){for(var Wt=F[Vt],Kt=[],fr=0;fr<Wt.length;fr++)Kt.push(new Qi(Wt[fr][0],Wt[fr][1]));(this||u).geometry.push(Kt)}return(this||u).geometry},m.prototype.bbox=function(){(this||u).geometry||this.loadGeometry();for(var F=(this||u).geometry,Vt=1/0,Wt=-1/0,Kt=1/0,Qi=-1/0,fr=0;fr<F.length;fr++)for(var _r=F[fr],Sr=0;Sr<_r.length;Sr++){var Ar=_r[Sr];Vt=Math.min(Vt,Ar.x),Wt=Math.max(Wt,Ar.x),Kt=Math.min(Kt,Ar.y),Qi=Math.max(Qi,Ar.y)}return[Vt,Kt,Wt,Qi]},m.prototype.toGeoJSON=fr.prototype.toGeoJSON;var Sr=F.by,Ar=_r;function w(u){var F=new Sr;return function(u,F){for(var Vt in u.layers)F.writeMessage(3,x,u.layers[Vt])}(u,F),F.finish()}function x(u,F){var Vt;F.writeVarintField(15,u.version||1),F.writeStringField(1,u.name||""),F.writeVarintField(5,u.extent||4096);var Wt={keys:[],values:[],keycache:{},valuecache:{}};for(Vt=0;Vt<u.length;Vt++)Wt.feature=u.feature(Vt),F.writeMessage(2,b,Wt);var Kt=Wt.keys;for(Vt=0;Vt<Kt.length;Vt++)F.writeStringField(3,Kt[Vt]);var Qi=Wt.values;for(Vt=0;Vt<Qi.length;Vt++)F.writeMessage(4,P,Qi[Vt])}function b(u,F){var Vt=u.feature;void 0!==Vt.id&&F.writeVarintField(1,Vt.id),F.writeMessage(2,S,u),F.writeVarintField(3,Vt.type),F.writeMessage(4,I,Vt)}function S(u,F){var Vt=u.feature,Wt=u.keys,Kt=u.values,Qi=u.keycache,fr=u.valuecache;for(var _r in Vt.properties){var Sr=Vt.properties[_r],Ar=Qi[_r];if(null!==Sr){void 0===Ar&&(Wt.push(_r),Qi[_r]=Ar=Wt.length-1),F.writeVarint(Ar);var Jr=typeof Sr;"string"!==Jr&&"boolean"!==Jr&&"number"!==Jr&&(Sr=JSON.stringify(Sr));var zn=Jr+":"+Sr,Qs=fr[zn];void 0===Qs&&(Kt.push(Sr),fr[zn]=Qs=Kt.length-1),F.writeVarint(Qs)}}}function _(u,F){return(F<<3)+(7&u)}function M(u){return u<<1^u>>31}function I(u,F){for(var Vt=u.loadGeometry(),Wt=u.type,Kt=0,Qi=0,fr=Vt.length,_r=0;_r<fr;_r++){var Sr=Vt[_r],Ar=1;1===Wt&&(Ar=Sr.length),F.writeVarint(_(1,Ar));for(var Jr=3===Wt?Sr.length-1:Sr.length,zn=0;zn<Jr;zn++){1===zn&&1!==Wt&&F.writeVarint(_(2,Jr-1));var Qs=Sr[zn].x-Kt,ta=Sr[zn].y-Qi;F.writeVarint(M(Qs)),F.writeVarint(M(ta)),Kt+=Qs,Qi+=ta}3===Wt&&F.writeVarint(_(7,1))}}function P(u,F){var Vt=typeof u;"string"===Vt?F.writeStringField(1,u):"boolean"===Vt?F.writeBooleanField(7,u):"number"===Vt&&(u%1!=0?F.writeDoubleField(3,u):u<0?F.writeSVarintField(6,u):F.writeVarintField(5,u))}Kt.exports=w,Kt.exports.fromVectorTileJs=w,Kt.exports.fromGeojsonVt=function(u,F){F=F||{};var Vt={};for(var Wt in u)Vt[Wt]=new Ar(u[Wt].features,F),Vt[Wt].name=Wt,Vt[Wt].version=F.version,Vt[Wt].extent=F.extent;return w({layers:Vt})},Kt.exports.GeoJSONWrapper=Ar;var Jr=F.bw(Kt.exports);const zn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:u=>u},Qs=Math.fround||(ta=new Float32Array(1),u=>(ta[0]=+u,ta[0]));var ta;const ia=3,aa=5,va=6;class z{constructor(u){this.options=Object.assign(Object.create(zn),u),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(u){const{log:F,minZoom:Vt,maxZoom:Wt}=this.options;F&&console.time("total time");const Kt=`prepare ${u.length} points`;F&&console.time(Kt),this.points=u;const Qi=[];for(let F=0;F<u.length;F++){const Vt=u[F];if(!Vt.geometry)continue;const[Wt,Kt]=Vt.geometry.coordinates,fr=Qs(G(Wt)),_r=Qs(j(Kt));Qi.push(fr,_r,1/0,F,-1,1),this.options.reduce&&Qi.push(0)}let fr=this.trees[Wt+1]=this._createTree(Qi);F&&console.timeEnd(Kt);for(let u=Wt;u>=Vt;u--){const Vt=+Date.now();fr=this.trees[u]=this._createTree(this._cluster(fr,u)),F&&console.log("z%d: %d clusters in %dms",u,fr.numItems,+Date.now()-Vt)}return F&&console.timeEnd("total time"),this}getClusters(u,F){let Vt=((u[0]+180)%360+360)%360-180;const Wt=Math.max(-90,Math.min(90,u[1]));let Kt=180===u[2]?180:((u[2]+180)%360+360)%360-180;const Qi=Math.max(-90,Math.min(90,u[3]));if(u[2]-u[0]>=360)Vt=-180,Kt=180;else if(Vt>Kt){const u=this.getClusters([Vt,Wt,180,Qi],F),fr=this.getClusters([-180,Wt,Kt,Qi],F);return u.concat(fr)}const fr=this.trees[this._limitZoom(F)],_r=fr.range(G(Vt),j(Qi),G(Kt),j(Wt)),Sr=fr.data,Ar=[];for(const u of _r){const F=this.stride*u;Ar.push(Sr[F+aa]>1?A(Sr,F,this.clusterProps):this.points[Sr[F+ia]])}return Ar}getChildren(u){const F=this._getOriginId(u),Vt=this._getOriginZoom(u),Wt="No cluster with the specified id.",Kt=this.trees[Vt];if(!Kt)throw new Error(Wt);const Qi=Kt.data;if(F*this.stride>=Qi.length)throw new Error(Wt);const fr=this.options.radius/(this.options.extent*Math.pow(2,Vt-1)),_r=Kt.within(Qi[F*this.stride],Qi[F*this.stride+1],fr),Sr=[];for(const F of _r){const Vt=F*this.stride;Qi[Vt+4]===u&&Sr.push(Qi[Vt+aa]>1?A(Qi,Vt,this.clusterProps):this.points[Qi[Vt+ia]])}if(0===Sr.length)throw new Error(Wt);return Sr}getLeaves(u,F,Vt){const Wt=[];return this._appendLeaves(Wt,u,F=F||10,Vt=Vt||0,0),Wt}getTile(u,F,Vt){const Wt=this.trees[this._limitZoom(u)],Kt=Math.pow(2,u),{extent:Qi,radius:fr}=this.options,_r=fr/Qi,Sr=(Vt-_r)/Kt,Ar=(Vt+1+_r)/Kt,Jr={features:[]};return this._addTileFeatures(Wt.range((F-_r)/Kt,Sr,(F+1+_r)/Kt,Ar),Wt.data,F,Vt,Kt,Jr),0===F&&this._addTileFeatures(Wt.range(1-_r/Kt,Sr,1,Ar),Wt.data,Kt,Vt,Kt,Jr),F===Kt-1&&this._addTileFeatures(Wt.range(0,Sr,_r/Kt,Ar),Wt.data,-1,Vt,Kt,Jr),Jr.features.length?Jr:null}getClusterExpansionZoom(u){let F=this._getOriginZoom(u)-1;for(;F<=this.options.maxZoom;){const Vt=this.getChildren(u);if(F++,1!==Vt.length)break;u=Vt[0].properties.cluster_id}return F}_appendLeaves(u,F,Vt,Wt,Kt){const Qi=this.getChildren(F);for(const F of Qi){const Qi=F.properties;if(Qi&&Qi.cluster?Kt+Qi.point_count<=Wt?Kt+=Qi.point_count:Kt=this._appendLeaves(u,Qi.cluster_id,Vt,Wt,Kt):Kt<Wt?Kt++:u.push(F),u.length===Vt)break}return Kt}_createTree(u){const Vt=new F.av(u.length/this.stride|0,this.options.nodeSize,Float32Array);for(let F=0;F<u.length;F+=this.stride)Vt.add(u[F],u[F+1]);return Vt.finish(),Vt.data=u,Vt}_addTileFeatures(u,F,Vt,Wt,Kt,Qi){for(const fr of u){const u=fr*this.stride,_r=F[u+aa]>1;let Sr,Ar,Jr;if(_r)Sr=E(F,u,this.clusterProps),Ar=F[u],Jr=F[u+1];else{const Vt=this.points[F[u+ia]];Sr=Vt.properties;const[Wt,Kt]=Vt.geometry.coordinates;Ar=G(Wt),Jr=j(Kt)}const zn={type:1,geometry:[[Math.round(this.options.extent*(Ar*Kt-Vt)),Math.round(this.options.extent*(Jr*Kt-Wt))]],tags:Sr};let Qs;Qs=_r||this.options.generateId?F[u+ia]:this.points[F[u+ia]].id,void 0!==Qs&&(zn.id=Qs),Qi.features.push(zn)}}_limitZoom(u){return Math.max(this.options.minZoom,Math.min(Math.floor(+u),this.options.maxZoom+1))}_cluster(u,F){const{radius:Vt,extent:Wt,reduce:Kt,minPoints:Qi}=this.options,fr=Vt/(Wt*Math.pow(2,F)),_r=u.data,Sr=[],Ar=this.stride;for(let Vt=0;Vt<_r.length;Vt+=Ar){if(_r[Vt+2]<=F)continue;_r[Vt+2]=F;const Wt=_r[Vt],Jr=_r[Vt+1],zn=u.within(_r[Vt],_r[Vt+1],fr),Qs=_r[Vt+aa];let ta=Qs;for(const u of zn){const Vt=u*Ar;_r[Vt+2]>F&&(ta+=_r[Vt+aa])}if(ta>Qs&&ta>=Qi){let u,Qi=Wt*Qs,fr=Jr*Qs,ia=-1;const va=((Vt/Ar|0)<<5)+(F+1)+this.points.length;for(const Wt of zn){const Sr=Wt*Ar;if(_r[Sr+2]<=F)continue;_r[Sr+2]=F;const Jr=_r[Sr+aa];Qi+=_r[Sr]*Jr,fr+=_r[Sr+1]*Jr,_r[Sr+4]=va,Kt&&(u||(u=this._map(_r,Vt,!0),ia=this.clusterProps.length,this.clusterProps.push(u)),Kt(u,this._map(_r,Sr)))}_r[Vt+4]=va,Sr.push(Qi/ta,fr/ta,1/0,va,-1,ta),Kt&&Sr.push(ia)}else{for(let u=0;u<Ar;u++)Sr.push(_r[Vt+u]);if(ta>1)for(const u of zn){const Vt=u*Ar;if(!(_r[Vt+2]<=F)){_r[Vt+2]=F;for(let u=0;u<Ar;u++)Sr.push(_r[Vt+u])}}}}return Sr}_getOriginId(u){return u-this.points.length>>5}_getOriginZoom(u){return(u-this.points.length)%32}_map(u,F,Vt){if(u[F+aa]>1){const Wt=this.clusterProps[u[F+va]];return Vt?Object.assign({},Wt):Wt}const Wt=this.points[u[F+ia]].properties,Kt=this.options.map(Wt);return Vt&&Kt===Wt?Object.assign({},Kt):Kt}}function A(u,F,Vt){return{type:"Feature",id:u[F+ia],properties:E(u,F,Vt),geometry:{type:"Point",coordinates:[(Wt=u[F],360*(Wt-.5)),R(u[F+1])]}};var Wt}function E(u,F,Vt){const Wt=u[F+aa],Kt=Wt>=1e4?`${Math.round(Wt/1e3)}k`:Wt>=1e3?Math.round(Wt/100)/10+"k":Wt,Qi=u[F+va],fr=-1===Qi?{}:Object.assign({},Vt[Qi]);return Object.assign(fr,{cluster:!0,cluster_id:u[F+ia],point_count:Wt,point_count_abbreviated:Kt})}function G(u){return u/360+.5}function j(u){const F=Math.sin(u*Math.PI/180),Vt=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Vt<0?0:Vt>1?1:Vt}function R(u){const F=(180-360*u)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Z(u,F,Vt,Wt){for(var Kt,Qi=Wt,fr=Vt-F>>1,_r=Vt-F,Sr=u[F],Ar=u[F+1],Jr=u[Vt],zn=u[Vt+1],Qs=F+3;Qs<Vt;Qs+=3){var ta=N(u[Qs],u[Qs+1],Sr,Ar,Jr,zn);if(ta>Qi)Kt=Qs,Qi=ta;else if(ta===Qi){var ia=Math.abs(Qs-fr);ia<_r&&(Kt=Qs,_r=ia)}}Qi>Wt&&(Kt-F>3&&Z(u,F,Kt,Wt),u[Kt+2]=Qi,Vt-Kt>3&&Z(u,Kt,Vt,Wt))}function N(u,F,Vt,Wt,Kt,Qi){var fr=Kt-Vt,_r=Qi-Wt;if(0!==fr||0!==_r){var Sr=((u-Vt)*fr+(F-Wt)*_r)/(fr*fr+_r*_r);Sr>1?(Vt=Kt,Wt=Qi):Sr>0&&(Vt+=fr*Sr,Wt+=_r*Sr)}return(fr=u-Vt)*fr+(_r=F-Wt)*_r}function W(u,F,Vt,Wt){var Kt={id:void 0===u?null:u,type:F,geometry:Vt,tags:Wt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(u){var F=u.geometry,Vt=u.type;if("Point"===Vt||"MultiPoint"===Vt||"LineString"===Vt)J(u,F);else if("Polygon"===Vt||"MultiLineString"===Vt)for(var Wt=0;Wt<F.length;Wt++)J(u,F[Wt]);else if("MultiPolygon"===Vt)for(Wt=0;Wt<F.length;Wt++)for(var Kt=0;Kt<F[Wt].length;Kt++)J(u,F[Wt][Kt])}(Kt),Kt}function J(u,F){for(var Vt=0;Vt<F.length;Vt+=3)u.minX=Math.min(u.minX,F[Vt]),u.minY=Math.min(u.minY,F[Vt+1]),u.maxX=Math.max(u.maxX,F[Vt]),u.maxY=Math.max(u.maxY,F[Vt+1])}function B(u,F,Vt,Wt){if(F.geometry){var Kt=F.geometry.coordinates,Qi=F.geometry.type,fr=Math.pow(Vt.tolerance/((1<<Vt.maxZoom)*Vt.extent),2),_r=[],Sr=F.id;if(Vt.promoteId?Sr=F.properties[Vt.promoteId]:Vt.generateId&&(Sr=Wt||0),"Point"===Qi)Y(Kt,_r);else if("MultiPoint"===Qi)for(var Ar=0;Ar<Kt.length;Ar++)Y(Kt[Ar],_r);else if("LineString"===Qi)V(Kt,_r,fr,!1);else if("MultiLineString"===Qi){if(Vt.lineMetrics){for(Ar=0;Ar<Kt.length;Ar++)V(Kt[Ar],_r=[],fr,!1),u.push(W(Sr,"LineString",_r,F.properties));return}q(Kt,_r,fr,!1)}else if("Polygon"===Qi)q(Kt,_r,fr,!0);else{if("MultiPolygon"!==Qi){if("GeometryCollection"===Qi){for(Ar=0;Ar<F.geometry.geometries.length;Ar++)B(u,{id:Sr,geometry:F.geometry.geometries[Ar],properties:F.properties},Vt,Wt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ar=0;Ar<Kt.length;Ar++){var Jr=[];q(Kt[Ar],Jr,fr,!0),_r.push(Jr)}}u.push(W(Sr,Qi,_r,F.properties))}}function Y(u,F){F.push(X(u[0])),F.push(H(u[1])),F.push(0)}function V(u,F,Vt,Wt){for(var Kt,Qi,fr=0,_r=0;_r<u.length;_r++){var Sr=X(u[_r][0]),Ar=H(u[_r][1]);F.push(Sr),F.push(Ar),F.push(0),_r>0&&(fr+=Wt?(Kt*Ar-Sr*Qi)/2:Math.sqrt(Math.pow(Sr-Kt,2)+Math.pow(Ar-Qi,2))),Kt=Sr,Qi=Ar}var Jr=F.length-3;F[2]=1,Z(F,0,Jr,Vt),F[Jr+2]=1,F.size=Math.abs(fr),F.start=0,F.end=F.size}function q(u,F,Vt,Wt){for(var Kt=0;Kt<u.length;Kt++){var Qi=[];V(u[Kt],Qi,Vt,Wt),F.push(Qi)}}function X(u){return u/360+.5}function H(u){var F=Math.sin(u*Math.PI/180),Vt=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Vt<0?0:Vt>1?1:Vt}function U(u,F,Vt,Wt,Kt,Qi,fr,_r){if(Wt/=F,Qi>=(Vt/=F)&&fr<Wt)return u;if(fr<Vt||Qi>=Wt)return null;for(var Sr=[],Ar=0;Ar<u.length;Ar++){var Jr=u[Ar],zn=Jr.geometry,Qs=Jr.type,ta=0===Kt?Jr.minX:Jr.minY,ia=0===Kt?Jr.maxX:Jr.maxY;if(ta>=Vt&&ia<Wt)Sr.push(Jr);else if(!(ia<Vt||ta>=Wt)){var aa=[];if("Point"===Qs||"MultiPoint"===Qs)$(zn,aa,Vt,Wt,Kt);else if("LineString"===Qs)Q(zn,aa,Vt,Wt,Kt,!1,_r.lineMetrics);else if("MultiLineString"===Qs)ee(zn,aa,Vt,Wt,Kt,!1);else if("Polygon"===Qs)ee(zn,aa,Vt,Wt,Kt,!0);else if("MultiPolygon"===Qs)for(var va=0;va<zn.length;va++){var Ba=[];ee(zn[va],Ba,Vt,Wt,Kt,!0),Ba.length&&aa.push(Ba)}if(aa.length){if(_r.lineMetrics&&"LineString"===Qs){for(va=0;va<aa.length;va++)Sr.push(W(Jr.id,Qs,aa[va],Jr.tags));continue}"LineString"!==Qs&&"MultiLineString"!==Qs||(1===aa.length?(Qs="LineString",aa=aa[0]):Qs="MultiLineString"),"Point"!==Qs&&"MultiPoint"!==Qs||(Qs=3===aa.length?"Point":"MultiPoint"),Sr.push(W(Jr.id,Qs,aa,Jr.tags))}}}return Sr.length?Sr:null}function $(u,F,Vt,Wt,Kt){for(var Qi=0;Qi<u.length;Qi+=3){var fr=u[Qi+Kt];fr>=Vt&&fr<=Wt&&(F.push(u[Qi]),F.push(u[Qi+1]),F.push(u[Qi+2]))}}function Q(u,F,Vt,Wt,Kt,Qi,fr){for(var _r,Sr,Ar=K(u),Jr=0===Kt?re:ie,zn=u.start,Qs=0;Qs<u.length-3;Qs+=3){var ta=u[Qs],ia=u[Qs+1],aa=u[Qs+2],va=u[Qs+3],Ba=u[Qs+4],Ya=0===Kt?ta:ia,to=0===Kt?va:Ba,eo=!1;fr&&(_r=Math.sqrt(Math.pow(ta-va,2)+Math.pow(ia-Ba,2))),Ya<Vt?to>Vt&&(Sr=Jr(Ar,ta,ia,va,Ba,Vt),fr&&(Ar.start=zn+_r*Sr)):Ya>Wt?to<Wt&&(Sr=Jr(Ar,ta,ia,va,Ba,Wt),fr&&(Ar.start=zn+_r*Sr)):te(Ar,ta,ia,aa),to<Vt&&Ya>=Vt&&(Sr=Jr(Ar,ta,ia,va,Ba,Vt),eo=!0),to>Wt&&Ya<=Wt&&(Sr=Jr(Ar,ta,ia,va,Ba,Wt),eo=!0),!Qi&&eo&&(fr&&(Ar.end=zn+_r*Sr),F.push(Ar),Ar=K(u)),fr&&(zn+=_r)}var io=u.length-3;ta=u[io],ia=u[io+1],aa=u[io+2],(Ya=0===Kt?ta:ia)>=Vt&&Ya<=Wt&&te(Ar,ta,ia,aa),io=Ar.length-3,Qi&&io>=3&&(Ar[io]!==Ar[0]||Ar[io+1]!==Ar[1])&&te(Ar,Ar[0],Ar[1],Ar[2]),Ar.length&&F.push(Ar)}function K(u){var F=[];return F.size=u.size,F.start=u.start,F.end=u.end,F}function ee(u,F,Vt,Wt,Kt,Qi){for(var fr=0;fr<u.length;fr++)Q(u[fr],F,Vt,Wt,Kt,Qi,!1)}function te(u,F,Vt,Wt){u.push(F),u.push(Vt),u.push(Wt)}function re(u,F,Vt,Wt,Kt,Qi){var fr=(Qi-F)/(Wt-F);return u.push(Qi),u.push(Vt+(Kt-Vt)*fr),u.push(1),fr}function ie(u,F,Vt,Wt,Kt,Qi){var fr=(Qi-Vt)/(Kt-Vt);return u.push(F+(Wt-F)*fr),u.push(Qi),u.push(1),fr}function oe(u,F){for(var Vt=[],Wt=0;Wt<u.length;Wt++){var Kt,Qi=u[Wt],fr=Qi.type;if("Point"===fr||"MultiPoint"===fr||"LineString"===fr)Kt=se(Qi.geometry,F);else if("MultiLineString"===fr||"Polygon"===fr){Kt=[];for(var _r=0;_r<Qi.geometry.length;_r++)Kt.push(se(Qi.geometry[_r],F))}else if("MultiPolygon"===fr)for(Kt=[],_r=0;_r<Qi.geometry.length;_r++){for(var Sr=[],Ar=0;Ar<Qi.geometry[_r].length;Ar++)Sr.push(se(Qi.geometry[_r][Ar],F));Kt.push(Sr)}Vt.push(W(Qi.id,fr,Kt,Qi.tags))}return Vt}function se(u,F){var Vt=[];Vt.size=u.size,void 0!==u.start&&(Vt.start=u.start,Vt.end=u.end);for(var Wt=0;Wt<u.length;Wt+=3)Vt.push(u[Wt]+F,u[Wt+1],u[Wt+2]);return Vt}function ne(u,F){if(u.transformed)return u;var Vt,Wt,Kt,Qi=1<<u.z,fr=u.x,_r=u.y;for(Vt=0;Vt<u.features.length;Vt++){var Sr=u.features[Vt],Ar=Sr.geometry,Jr=Sr.type;if(Sr.geometry=[],1===Jr)for(Wt=0;Wt<Ar.length;Wt+=2)Sr.geometry.push(ae(Ar[Wt],Ar[Wt+1],F,Qi,fr,_r));else for(Wt=0;Wt<Ar.length;Wt++){var zn=[];for(Kt=0;Kt<Ar[Wt].length;Kt+=2)zn.push(ae(Ar[Wt][Kt],Ar[Wt][Kt+1],F,Qi,fr,_r));Sr.geometry.push(zn)}}return u.transformed=!0,u}function ae(u,F,Vt,Wt,Kt,Qi){return[Math.round(Vt*(u*Wt-Kt)),Math.round(Vt*(F*Wt-Qi))]}function le(u,F,Vt,Wt,Kt){for(var Qi=F===Kt.maxZoom?0:Kt.tolerance/((1<<F)*Kt.extent),fr={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Vt,y:Wt,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_r=0;_r<u.length;_r++){fr.numFeatures++,he(fr,u[_r],Qi,Kt);var Sr=u[_r].minX,Ar=u[_r].minY,Jr=u[_r].maxX,zn=u[_r].maxY;Sr<fr.minX&&(fr.minX=Sr),Ar<fr.minY&&(fr.minY=Ar),Jr>fr.maxX&&(fr.maxX=Jr),zn>fr.maxY&&(fr.maxY=zn)}return fr}function he(u,F,Vt,Wt){var Kt=F.geometry,Qi=F.type,fr=[];if("Point"===Qi||"MultiPoint"===Qi)for(var _r=0;_r<Kt.length;_r+=3)fr.push(Kt[_r]),fr.push(Kt[_r+1]),u.numPoints++,u.numSimplified++;else if("LineString"===Qi)ue(fr,Kt,u,Vt,!1,!1);else if("MultiLineString"===Qi||"Polygon"===Qi)for(_r=0;_r<Kt.length;_r++)ue(fr,Kt[_r],u,Vt,"Polygon"===Qi,0===_r);else if("MultiPolygon"===Qi)for(var Sr=0;Sr<Kt.length;Sr++){var Ar=Kt[Sr];for(_r=0;_r<Ar.length;_r++)ue(fr,Ar[_r],u,Vt,!0,0===_r)}if(fr.length){var Jr=F.tags||null;if("LineString"===Qi&&Wt.lineMetrics){for(var zn in Jr={},F.tags)Jr[zn]=F.tags[zn];Jr.mapbox_clip_start=Kt.start/Kt.size,Jr.mapbox_clip_end=Kt.end/Kt.size}var Qs={geometry:fr,type:"Polygon"===Qi||"MultiPolygon"===Qi?3:"LineString"===Qi||"MultiLineString"===Qi?2:1,tags:Jr};null!==F.id&&(Qs.id=F.id),u.features.push(Qs)}}function ue(u,F,Vt,Wt,Kt,Qi){var fr=Wt*Wt;if(Wt>0&&F.size<(Kt?fr:Wt))Vt.numPoints+=F.length/3;else{for(var _r=[],Sr=0;Sr<F.length;Sr+=3)(0===Wt||F[Sr+2]>fr)&&(Vt.numSimplified++,_r.push(F[Sr]),_r.push(F[Sr+1])),Vt.numPoints++;Kt&&function(u,F){for(var Vt=0,Wt=0,Kt=u.length,Qi=Kt-2;Wt<Kt;Qi=Wt,Wt+=2)Vt+=(u[Wt]-u[Qi])*(u[Wt+1]+u[Qi+1]);if(Vt>0===F)for(Wt=0,Kt=u.length;Wt<Kt/2;Wt+=2){var fr=u[Wt],_r=u[Wt+1];u[Wt]=u[Kt-2-Wt],u[Wt+1]=u[Kt-1-Wt],u[Kt-2-Wt]=fr,u[Kt-1-Wt]=_r}}(_r,Qi),u.push(_r)}}function ce(F,Vt){var Wt=(Vt=(this||u).options=function(u,F){for(var Vt in F)u[Vt]=F[Vt];return u}(Object.create((this||u).options),Vt)).debug;if(Wt&&console.time("preprocess data"),Vt.maxZoom<0||Vt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Vt.promoteId&&Vt.generateId)throw new Error("promoteId and generateId cannot be used together.");var Kt=function(u,F){var Vt=[];if("FeatureCollection"===u.type)for(var Wt=0;Wt<u.features.length;Wt++)B(Vt,u.features[Wt],F,Wt);else B(Vt,"Feature"===u.type?u:{geometry:u},F);return Vt}(F,Vt);(this||u).tiles={},(this||u).tileCoords=[],Wt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Vt.indexMaxZoom,Vt.indexMaxPoints),console.time("generate tiles"),(this||u).stats={},(this||u).total=0),Kt=function(u,F){var Vt=F.buffer/F.extent,Wt=u,Kt=U(u,1,-1-Vt,Vt,0,-1,2,F),Qi=U(u,1,1-Vt,2+Vt,0,-1,2,F);return(Kt||Qi)&&(Wt=U(u,1,-Vt,1+Vt,0,-1,2,F)||[],Kt&&(Wt=oe(Kt,1).concat(Wt)),Qi&&(Wt=Wt.concat(oe(Qi,-1)))),Wt}(Kt,Vt),Kt.length&&this.splitTile(Kt,0,0,0),Wt&&(Kt.length&&console.log("features: %d, points: %d",(this||u).tiles[0].numFeatures,(this||u).tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",(this||u).total,JSON.stringify((this||u).stats)))}function de(u,F,Vt){return 32*((1<<u)*Vt+F)+u}function pe(u,F){return F?u.properties[F]:u.id}function ge(u,F){if(null==u)return!0;if("Feature"===u.type)return null!=pe(u,F);if("FeatureCollection"===u.type){const Vt=new Set;for(const Wt of u.features){const u=pe(Wt,F);if(null==u)return!1;if(Vt.has(u))return!1;Vt.add(u)}return!0}return!1}function fe(u,F){const Vt=new Map;if(null==u);else if("Feature"===u.type)Vt.set(pe(u,F),u);else for(const Wt of u.features)Vt.set(pe(Wt,F),Wt);return Vt}ce.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ce.prototype.splitTile=function(F,Vt,Wt,Kt,Qi,fr,_r){for(var Sr=[F,Vt,Wt,Kt],Ar=(this||u).options,Jr=Ar.debug;Sr.length;){Kt=Sr.pop(),Wt=Sr.pop(),Vt=Sr.pop(),F=Sr.pop();var zn=1<<Vt,Qs=de(Vt,Wt,Kt),ta=(this||u).tiles[Qs];if(!ta&&(Jr>1&&console.time("creation"),ta=(this||u).tiles[Qs]=le(F,Vt,Wt,Kt,Ar),(this||u).tileCoords.push({z:Vt,x:Wt,y:Kt}),Jr)){Jr>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Vt,Wt,Kt,ta.numFeatures,ta.numPoints,ta.numSimplified),console.timeEnd("creation"));var ia="z"+Vt;(this||u).stats[ia]=((this||u).stats[ia]||0)+1,(this||u).total++}if(ta.source=F,Qi){if(Vt===Ar.maxZoom||Vt===Qi)continue;var aa=1<<Qi-Vt;if(Wt!==Math.floor(fr/aa)||Kt!==Math.floor(_r/aa))continue}else if(Vt===Ar.indexMaxZoom||ta.numPoints<=Ar.indexMaxPoints)continue;if(ta.source=null,0!==F.length){Jr>1&&console.time("clipping");var va,Ba,Ya,to,eo,io,so=.5*Ar.buffer/Ar.extent,co=.5-so,ho=.5+so,bo=1+so;va=Ba=Ya=to=null,eo=U(F,zn,Wt-so,Wt+ho,0,ta.minX,ta.maxX,Ar),io=U(F,zn,Wt+co,Wt+bo,0,ta.minX,ta.maxX,Ar),F=null,eo&&(va=U(eo,zn,Kt-so,Kt+ho,1,ta.minY,ta.maxY,Ar),Ba=U(eo,zn,Kt+co,Kt+bo,1,ta.minY,ta.maxY,Ar),eo=null),io&&(Ya=U(io,zn,Kt-so,Kt+ho,1,ta.minY,ta.maxY,Ar),to=U(io,zn,Kt+co,Kt+bo,1,ta.minY,ta.maxY,Ar),io=null),Jr>1&&console.timeEnd("clipping"),Sr.push(va||[],Vt+1,2*Wt,2*Kt),Sr.push(Ba||[],Vt+1,2*Wt,2*Kt+1),Sr.push(Ya||[],Vt+1,2*Wt+1,2*Kt),Sr.push(to||[],Vt+1,2*Wt+1,2*Kt+1)}}},ce.prototype.getTile=function(F,Vt,Wt){var Kt=(this||u).options,Qi=Kt.extent,fr=Kt.debug;if(F<0||F>24)return null;var _r=1<<F,Sr=de(F,Vt=(Vt%_r+_r)%_r,Wt);if((this||u).tiles[Sr])return ne((this||u).tiles[Sr],Qi);fr>1&&console.log("drilling down to z%d-%d-%d",F,Vt,Wt);for(var Ar,Jr=F,zn=Vt,Qs=Wt;!Ar&&Jr>0;)Jr--,zn=Math.floor(zn/2),Qs=Math.floor(Qs/2),Ar=(this||u).tiles[de(Jr,zn,Qs)];return Ar&&Ar.source?(fr>1&&console.log("found parent tile z%d-%d-%d",Jr,zn,Qs),fr>1&&console.time("drilling down"),this.splitTile(Ar.source,Jr,zn,Qs,F,Vt,Wt),fr>1&&console.timeEnd("drilling down"),(this||u).tiles[Sr]?ne((this||u).tiles[Sr],Qi):null):null};class me extends s{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(u,Vt){return F._(this,void 0,void 0,(function*(){const Vt=u.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Kt=this._geoJSONIndex.getTile(Vt.z,Vt.x,Vt.y);if(!Kt)return null;const Qi=new class{constructor(u){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=F.W,this.length=u.length,this._features=u}feature(u){return new class{constructor(u){this._feature=u,this.extent=F.W,this.type=u.type,this.properties=u.tags,"id"in u&&!isNaN(u.id)&&(this.id=parseInt(u.id,10))}loadGeometry(){if(1===this._feature.type){const u=[];for(const Vt of this._feature.geometry)u.push([new F.P(Vt[0],Vt[1])]);return u}{const u=[];for(const Vt of this._feature.geometry){const Wt=[];for(const u of Vt)Wt.push(new F.P(u[0],u[1]));u.push(Wt)}return u}}toGeoJSON(u,F,Vt){return Wt.call(this,u,F,Vt)}}(this._features[u])}}(Kt.features);let fr=Jr(Qi);return 0===fr.byteOffset&&fr.byteLength===fr.buffer.byteLength||(fr=new Uint8Array(fr)),{vectorTile:Qi,rawData:fr.buffer}}))}loadData(u){return F._(this,void 0,void 0,(function*(){var Vt;null===(Vt=this._pendingRequest)||void 0===Vt||Vt.abort();const Wt=!!(u&&u.request&&u.request.collectResourceTiming)&&new F.bt(u.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(u,this._pendingRequest),this._geoJSONIndex=u.cluster?new z(function({superclusterOptions:u,clusterProperties:Vt}){if(!Vt||!u)return u;const Wt={},Kt={},Qi={accumulated:null,zoom:0},fr={properties:null},_r=Object.keys(Vt);for(const u of _r){const[Qi,fr]=Vt[u],_r=F.bA(fr),Sr=F.bA("string"==typeof Qi?[Qi,["accumulated"],["get",u]]:Qi);Wt[u]=_r.value,Kt[u]=Sr.value}return u.map=u=>{fr.properties=u;const F={};for(const u of _r)F[u]=Wt[u].evaluate(Qi,fr);return F},u.reduce=(u,F)=>{fr.properties=F;for(const F of _r)Qi.accumulated=u[F],u[F]=Kt[F].evaluate(Qi,fr)},u}(u)).load((yield this._pendingData).features):new ce(yield this._pendingData,u.geojsonVtOptions),this.loaded={};const Vt={};if(Wt){const F=Wt.finish();F&&(Vt.resourceTiming={},Vt.resourceTiming[u.source]=JSON.parse(JSON.stringify(F)))}return Vt}catch(u){if(delete this._pendingRequest,F.bz(u))return{abandoned:!0};throw u}}))}getData(){return F._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(u){const F=this.loaded;return F&&F[u.uid]?super.reloadTile(u):this.loadTile(u)}loadAndProcessGeoJSON(u,Wt){return F._(this,void 0,void 0,(function*(){let Kt=yield this.loadGeoJSON(u,Wt);if(delete this._pendingRequest,"object"!=typeof Kt)throw new Error(`Input data given to '${u.source}' is not a valid GeoJSON object.`);if(Vt(Kt,!0),u.filter){const Vt=F.bA(u.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Vt.result)throw new Error(Vt.value.map((u=>`${u.key}: ${u.message}`)).join(", "));const Wt=Kt.features.filter((u=>Vt.value.evaluate({zoom:0},u)));Kt={type:"FeatureCollection",features:Wt}}return Kt}))}loadGeoJSON(u,Vt){return F._(this,void 0,void 0,(function*(){const{promoteId:Wt}=u;if(u.request){const Kt=yield F.h(u.request,Vt);return this._dataUpdateable=ge(Kt.data,Wt)?fe(Kt.data,Wt):void 0,Kt.data}if("string"==typeof u.data)try{const F=JSON.parse(u.data);return this._dataUpdateable=ge(F,Wt)?fe(F,Wt):void 0,F}catch(F){throw new Error(`Input data given to '${u.source}' is not a valid GeoJSON object.`)}if(!u.dataDiff)throw new Error(`Input data given to '${u.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${u.source}`);return function(u,F,Vt){var Wt,Kt,Qi,fr;if(F.removeAll&&u.clear(),F.remove)for(const Vt of F.remove)u.delete(Vt);if(F.add)for(const Wt of F.add){const F=pe(Wt,Vt);null!=F&&u.set(F,Wt)}if(F.update)for(const Vt of F.update){let F=u.get(Vt.id);if(null==F)continue;const _r=!Vt.removeAllProperties&&((null===(Wt=Vt.removeProperties)||void 0===Wt?void 0:Wt.length)>0||(null===(Kt=Vt.addOrUpdateProperties)||void 0===Kt?void 0:Kt.length)>0);if((Vt.newGeometry||Vt.removeAllProperties||_r)&&(F=Object.assign({},F),u.set(Vt.id,F),_r&&(F.properties=Object.assign({},F.properties))),Vt.newGeometry&&(F.geometry=Vt.newGeometry),Vt.removeAllProperties)F.properties={};else if((null===(Qi=Vt.removeProperties)||void 0===Qi?void 0:Qi.length)>0)for(const u of Vt.removeProperties)Object.prototype.hasOwnProperty.call(F.properties,u)&&delete F.properties[u];if((null===(fr=Vt.addOrUpdateProperties)||void 0===fr?void 0:fr.length)>0)for(const{key:u,value:Wt}of Vt.addOrUpdateProperties)F.properties[u]=Wt}}(this._dataUpdateable,u.dataDiff,Wt),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(u){return F._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(u){return this._geoJSONIndex.getClusterExpansionZoom(u.clusterId)}getClusterChildren(u){return this._geoJSONIndex.getChildren(u.clusterId)}getClusterLeaves(u){return this._geoJSONIndex.getLeaves(u.clusterId,u.limit,u.offset)}}class ve{constructor(u){this.self=u,this.actor=new F.C(u),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(u,F)=>{if(this.externalWorkerSourceTypes[u])throw new Error(`Worker source with name "${u}" already registered.`);this.externalWorkerSourceTypes[u]=F},this.self.addProtocol=F.bg,this.self.removeProtocol=F.bh,this.self.registerRTLTextPlugin=u=>{if(F.bB.isParsed())throw new Error("RTL text plugin already registered.");F.bB.setMethods(u)},this.actor.registerMessageHandler("LDT",((u,F)=>this._getDEMWorkerSource(u,F.source).loadTile(F))),this.actor.registerMessageHandler("RDT",((u,Vt)=>F._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(u,Vt.source).removeTile(Vt)})))),this.actor.registerMessageHandler("GCEZ",((u,Vt)=>F._(this,void 0,void 0,(function*(){return this._getWorkerSource(u,Vt.type,Vt.source).getClusterExpansionZoom(Vt)})))),this.actor.registerMessageHandler("GCC",((u,Vt)=>F._(this,void 0,void 0,(function*(){return this._getWorkerSource(u,Vt.type,Vt.source).getClusterChildren(Vt)})))),this.actor.registerMessageHandler("GCL",((u,Vt)=>F._(this,void 0,void 0,(function*(){return this._getWorkerSource(u,Vt.type,Vt.source).getClusterLeaves(Vt)})))),this.actor.registerMessageHandler("LD",((u,F)=>this._getWorkerSource(u,F.type,F.source).loadData(F))),this.actor.registerMessageHandler("GD",((u,F)=>this._getWorkerSource(u,F.type,F.source).getData())),this.actor.registerMessageHandler("LT",((u,F)=>this._getWorkerSource(u,F.type,F.source).loadTile(F))),this.actor.registerMessageHandler("RT",((u,F)=>this._getWorkerSource(u,F.type,F.source).reloadTile(F))),this.actor.registerMessageHandler("AT",((u,F)=>this._getWorkerSource(u,F.type,F.source).abortTile(F))),this.actor.registerMessageHandler("RMT",((u,F)=>this._getWorkerSource(u,F.type,F.source).removeTile(F))),this.actor.registerMessageHandler("RS",((u,Vt)=>F._(this,void 0,void 0,(function*(){if(!this.workerSources[u]||!this.workerSources[u][Vt.type]||!this.workerSources[u][Vt.type][Vt.source])return;const F=this.workerSources[u][Vt.type][Vt.source];delete this.workerSources[u][Vt.type][Vt.source],void 0!==F.removeSource&&F.removeSource(Vt)})))),this.actor.registerMessageHandler("RM",(u=>F._(this,void 0,void 0,(function*(){delete this.layerIndexes[u],delete this.availableImages[u],delete this.workerSources[u],delete this.demWorkerSources[u]})))),this.actor.registerMessageHandler("SR",((u,Vt)=>F._(this,void 0,void 0,(function*(){this.referrer=Vt})))),this.actor.registerMessageHandler("SRPS",((u,F)=>this._syncRTLPluginState(u,F))),this.actor.registerMessageHandler("IS",((u,Vt)=>F._(this,void 0,void 0,(function*(){this.self.importScripts(Vt)})))),this.actor.registerMessageHandler("SI",((u,F)=>this._setImages(u,F))),this.actor.registerMessageHandler("UL",((u,Vt)=>F._(this,void 0,void 0,(function*(){this._getLayerIndex(u).update(Vt.layers,Vt.removedIds)})))),this.actor.registerMessageHandler("SL",((u,Vt)=>F._(this,void 0,void 0,(function*(){this._getLayerIndex(u).replace(Vt)}))))}_setImages(u,Vt){return F._(this,void 0,void 0,(function*(){this.availableImages[u]=Vt;for(const F in this.workerSources[u]){const Wt=this.workerSources[u][F];for(const u in Wt)Wt[u].availableImages=Vt}}))}_syncRTLPluginState(u,Vt){return F._(this,void 0,void 0,(function*(){if(F.bB.isParsed())return F.bB.getState();if("loading"!==Vt.pluginStatus)return F.bB.setState(Vt),Vt;const u=Vt.pluginURL;if(this.self.importScripts(u),F.bB.isParsed()){const Vt={pluginStatus:"loaded",pluginURL:u};return F.bB.setState(Vt),Vt}throw F.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)}))}_getAvailableImages(u){let F=this.availableImages[u];return F||(F=[]),F}_getLayerIndex(u){let F=this.layerIndexes[u];return F||(F=this.layerIndexes[u]=new t),F}_getWorkerSource(u,F,Vt){if(this.workerSources[u]||(this.workerSources[u]={}),this.workerSources[u][F]||(this.workerSources[u][F]={}),!this.workerSources[u][F][Vt]){const Wt={sendAsync:(F,Vt)=>(F.targetMapId=u,this.actor.sendAsync(F,Vt))};switch(F){case"vector":this.workerSources[u][F][Vt]=new s(Wt,this._getLayerIndex(u),this._getAvailableImages(u));break;case"geojson":this.workerSources[u][F][Vt]=new me(Wt,this._getLayerIndex(u),this._getAvailableImages(u));break;default:this.workerSources[u][F][Vt]=new this.externalWorkerSourceTypes[F](Wt,this._getLayerIndex(u),this._getAvailableImages(u))}}return this.workerSources[u][F][Vt]}_getDEMWorkerSource(u,F){return this.demWorkerSources[u]||(this.demWorkerSources[u]={}),this.demWorkerSources[u][F]||(this.demWorkerSources[u][F]=new n),this.demWorkerSources[u][F]}}return F.i(self)&&(self.worker=new ve(self)),ve}));define("index",["exports","./shared"],(function(F,Vt){var Wt="4.3.2";let Kt,Qi;const fr={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:u=>new Promise(((F,Wt)=>{const Kt=requestAnimationFrame(F);u.signal.addEventListener("abort",(()=>{cancelAnimationFrame(Kt),Wt(Vt.c())}))})),getImageData(u,F=0){return this.getImageCanvasContext(u).getImageData(-F,-F,u.width+2*F,u.height+2*F)},getImageCanvasContext(u){const F=window.document.createElement("canvas"),Vt=F.getContext("2d",{willReadFrequently:!0});if(!Vt)throw new Error("failed to create canvas 2d context");return F.width=u.width,F.height=u.height,Vt.drawImage(u,0,0,u.width,u.height),Vt},resolveURL:u=>(Kt||(Kt=document.createElement("a")),Kt.href=u,Kt.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==Qi&&(Qi=matchMedia("(prefers-reduced-motion: reduce)")),Qi.matches)}};class r{static testProp(u){if(!r.docStyle)return u[0];for(let F=0;F<u.length;F++)if(u[F]in r.docStyle)return u[F];return u[0]}static create(u,F,Vt){const Wt=window.document.createElement(u);return void 0!==F&&(Wt.className=F),Vt&&Vt.appendChild(Wt),Wt}static createNS(u,F){return window.document.createElementNS(u,F)}static disableDrag(){r.docStyle&&r.selectProp&&(r.userSelect=r.docStyle[r.selectProp],r.docStyle[r.selectProp]="none")}static enableDrag(){r.docStyle&&r.selectProp&&(r.docStyle[r.selectProp]=r.userSelect)}static setTransform(u,F){u.style[r.transformProp]=F}static addEventListener(u,F,Vt,Wt={}){u.addEventListener(F,Vt,"passive"in Wt?Wt:Wt.capture)}static removeEventListener(u,F,Vt,Wt={}){u.removeEventListener(F,Vt,"passive"in Wt?Wt:Wt.capture)}static suppressClickInternal(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",r.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",r.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",r.suppressClickInternal,!0)}),0)}static getScale(u){const F=u.getBoundingClientRect();return{x:F.width/u.offsetWidth||1,y:F.height/u.offsetHeight||1,boundingClientRect:F}}static getPoint(u,F,Wt){const Kt=F.boundingClientRect;return new Vt.P((Wt.clientX-Kt.left)/F.x-u.clientLeft,(Wt.clientY-Kt.top)/F.y-u.clientTop)}static mousePos(u,F){const Vt=r.getScale(u);return r.getPoint(u,Vt,F)}static touchPos(u,F){const Vt=[],Wt=r.getScale(u);for(let Kt=0;Kt<F.length;Kt++)Vt.push(r.getPoint(u,Wt,F[Kt]));return Vt}static mouseButton(u){return u.button}static remove(u){u.parentNode&&u.parentNode.removeChild(u)}}r.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,r.selectProp=r.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),r.transformProp=r.testProp(["transform","WebkitTransform"]);const _r={supported:!1,testSupport:function(u){!Jr&&Ar&&(zn?d(u):Sr=u)}};let Sr,Ar,Jr=!1,zn=!1;function d(u){const F=u.createTexture();u.bindTexture(u.TEXTURE_2D,F);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Ar),u.isContextLost())return;_r.supported=!0}catch(u){}u.deleteTexture(F),Jr=!0}var Qs;"undefined"!=typeof document&&(Ar=document.createElement("img"),Ar.onload=()=>{Sr&&d(Sr),Sr=null,zn=!0},Ar.onerror=()=>{Jr=!0,Sr=null},Ar.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(F){let Wt,Kt,Qi,fr;F.resetRequestQueue=()=>{Wt=[],Kt=0,Qi=0,fr={}},F.addThrottleControl=u=>{const F=Qi++;return fr[F]=u,F},F.removeThrottleControl=u=>{delete fr[u],l()},F.getImage=(u,F,Kt=!0)=>new Promise(((Qi,fr)=>{_r.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Vt.e(u,{type:"image"}),Wt.push({abortController:F,requestParameters:u,supportImageRefresh:Kt,state:"queued",onError:u=>{fr(u)},onSuccess:u=>{Qi(u)}}),l()}));const r=F=>Vt._(this||u,void 0,void 0,(function*(){F.state="running";const{requestParameters:u,supportImageRefresh:Wt,onError:Qi,onSuccess:fr,abortController:_r}=F,Sr=!1===Wt&&!Vt.i(self)&&!Vt.g(u.url)&&(!u.headers||Object.keys(u.headers).reduce(((u,F)=>u&&"accept"===F),!0));Kt++;const Ar=Sr?h(u,_r):Vt.m(u,_r);try{const u=yield Ar;delete F.abortController,F.state="completed",u.data instanceof HTMLImageElement||Vt.b(u.data)?fr(u):u.data&&fr({data:yield(Jr=u.data,"function"==typeof createImageBitmap?Vt.d(Jr):Vt.f(Jr)),cacheControl:u.cacheControl,expires:u.expires})}catch(u){delete F.abortController,Qi(u)}finally{Kt--,l()}var Jr})),l=()=>{const u=(()=>{for(const u of Object.keys(fr))if(fr[u]())return!0;return!1})()?Vt.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:Vt.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=Kt;F<u&&Wt.length>0;F++){const u=Wt.shift();u.abortController.signal.aborted?F--:r(u)}},h=(u,F)=>new Promise(((Wt,Kt)=>{const Qi=new Image,fr=u.url,_r=u.credentials;_r&&"include"===_r?Qi.crossOrigin="use-credentials":(_r&&"same-origin"===_r||!Vt.s(fr))&&(Qi.crossOrigin="anonymous"),F.signal.addEventListener("abort",(()=>{Qi.src="",Kt(Vt.c())})),Qi.fetchPriority="high",Qi.onload=()=>{Qi.onerror=Qi.onload=null,Wt({data:Qi})},Qi.onerror=()=>{Qi.onerror=Qi.onload=null,F.signal.aborted||Kt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Qi.src=fr}))}(Qs||(Qs={})),Qs.resetRequestQueue();class p{constructor(u){this._transformRequestFn=u}transformRequest(u,F){return this._transformRequestFn&&this._transformRequestFn(u,F)||{url:u}}setTransformRequest(u){this._transformRequestFn=u}}function m(u){var F=new Vt.A(3);return F[0]=u[0],F[1]=u[1],F[2]=u[2],F}var ta,g=function(u,F,Vt){return u[0]=F[0]-Vt[0],u[1]=F[1]-Vt[1],u[2]=F[2]-Vt[2],u};ta=new Vt.A(3),Vt.A!=Float32Array&&(ta[0]=0,ta[1]=0,ta[2]=0);var v=function(u){var F=u[0],Vt=u[1];return F*F+Vt*Vt};function x(u){const F=[];if("string"==typeof u)F.push({id:"default",url:u});else if(u&&u.length>0){const Vt=[];for(const{id:Wt,url:Kt}of u){const u=`${Wt}${Kt}`;-1===Vt.indexOf(u)&&(Vt.push(u),F.push({id:Wt,url:Kt}))}}return F}function y(u,F,Vt){const Wt=u.split("?");return Wt[0]+=`${F}${Vt}`,Wt.join("?")}!function(){var u=new Vt.A(2);Vt.A!=Float32Array&&(u[0]=0,u[1]=0)}();class b{constructor(u,F,Vt,Wt){this.context=u,this.format=Vt,this.texture=u.gl.createTexture(),this.update(F,Wt)}update(u,F,Wt){const{width:Kt,height:Qi}=u,fr=!(this.size&&this.size[0]===Kt&&this.size[1]===Qi||Wt),{context:_r}=this,{gl:Sr}=_r;if(this.useMipmap=Boolean(F&&F.useMipmap),Sr.bindTexture(Sr.TEXTURE_2D,this.texture),_r.pixelStoreUnpackFlipY.set(!1),_r.pixelStoreUnpack.set(1),_r.pixelStoreUnpackPremultiplyAlpha.set(this.format===Sr.RGBA&&(!F||!1!==F.premultiply)),fr)this.size=[Kt,Qi],u instanceof HTMLImageElement||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement||u instanceof ImageData||Vt.b(u)?Sr.texImage2D(Sr.TEXTURE_2D,0,this.format,this.format,Sr.UNSIGNED_BYTE,u):Sr.texImage2D(Sr.TEXTURE_2D,0,this.format,Kt,Qi,0,this.format,Sr.UNSIGNED_BYTE,u.data);else{const{x:F,y:fr}=Wt||{x:0,y:0};u instanceof HTMLImageElement||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement||u instanceof ImageData||Vt.b(u)?Sr.texSubImage2D(Sr.TEXTURE_2D,0,F,fr,Sr.RGBA,Sr.UNSIGNED_BYTE,u):Sr.texSubImage2D(Sr.TEXTURE_2D,0,F,fr,Kt,Qi,Sr.RGBA,Sr.UNSIGNED_BYTE,u.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Sr.generateMipmap(Sr.TEXTURE_2D)}bind(u,F,Vt){const{context:Wt}=this,{gl:Kt}=Wt;Kt.bindTexture(Kt.TEXTURE_2D,this.texture),Vt!==Kt.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(Vt=Kt.LINEAR),u!==this.filter&&(Kt.texParameteri(Kt.TEXTURE_2D,Kt.TEXTURE_MAG_FILTER,u),Kt.texParameteri(Kt.TEXTURE_2D,Kt.TEXTURE_MIN_FILTER,Vt||u),this.filter=u),F!==this.wrap&&(Kt.texParameteri(Kt.TEXTURE_2D,Kt.TEXTURE_WRAP_S,F),Kt.texParameteri(Kt.TEXTURE_2D,Kt.TEXTURE_WRAP_T,F),this.wrap=F)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}}function w(u){const{userImage:F}=u;return!!(F&&F.render&&F.render())&&(u.data.replace(new Uint8Array(F.data.buffer)),!0)}class T extends Vt.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new Vt.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:u,promiseResolve:F}of this.requestors)F(this._getImagesForIds(u));this.requestors=[]}}getImage(u){const F=this.images[u];if(F&&!F.data&&F.spriteData){const u=F.spriteData;F.data=new Vt.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),F.spriteData=null}return F}addImage(u,F){if(this.images[u])throw new Error(`Image id ${u} already exist, use updateImage instead`);this._validate(u,F)&&(this.images[u]=F)}_validate(u,F){let Wt=!0;const Kt=F.data||F.spriteData;return this._validateStretch(F.stretchX,Kt&&Kt.width)||(this.fire(new Vt.j(new Error(`Image "${u}" has invalid "stretchX" value`))),Wt=!1),this._validateStretch(F.stretchY,Kt&&Kt.height)||(this.fire(new Vt.j(new Error(`Image "${u}" has invalid "stretchY" value`))),Wt=!1),this._validateContent(F.content,F)||(this.fire(new Vt.j(new Error(`Image "${u}" has invalid "content" value`))),Wt=!1),Wt}_validateStretch(u,F){if(!u)return!0;let Vt=0;for(const Wt of u){if(Wt[0]<Vt||Wt[1]<Wt[0]||F<Wt[1])return!1;Vt=Wt[1]}return!0}_validateContent(u,F){if(!u)return!0;if(4!==u.length)return!1;const Vt=F.spriteData,Wt=Vt&&Vt.width||F.data.width,Kt=Vt&&Vt.height||F.data.height;return!(u[0]<0||Wt<u[0]||u[1]<0||Kt<u[1]||u[2]<0||Wt<u[2]||u[3]<0||Kt<u[3]||u[2]<u[0]||u[3]<u[1])}updateImage(u,F,Vt=!0){const Wt=this.getImage(u);if(Vt&&(Wt.data.width!==F.data.width||Wt.data.height!==F.data.height))throw new Error(`size mismatch between old image (${Wt.data.width}x${Wt.data.height}) and new image (${F.data.width}x${F.data.height}).`);F.version=Wt.version+1,this.images[u]=F,this.updatedImages[u]=!0}removeImage(u){const F=this.images[u];delete this.images[u],delete this.patterns[u],F.userImage&&F.userImage.onRemove&&F.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u){return new Promise(((F,Vt)=>{let Wt=!0;if(!this.isLoaded())for(const F of u)this.images[F]||(Wt=!1);this.isLoaded()||Wt?F(this._getImagesForIds(u)):this.requestors.push({ids:u,promiseResolve:F})}))}_getImagesForIds(u){const F={};for(const Wt of u){let u=this.getImage(Wt);u||(this.fire(new Vt.k("styleimagemissing",{id:Wt})),u=this.getImage(Wt)),u?F[Wt]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:Boolean(u.userImage&&u.userImage.render)}:Vt.w(`Image "${Wt}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return F}getPixelSize(){const{width:u,height:F}=this.atlasImage;return{width:u,height:F}}getPattern(u){const F=this.patterns[u],Wt=this.getImage(u);if(!Wt)return null;if(F&&F.position.version===Wt.version)return F.position;if(F)F.position.version=Wt.version;else{const F={w:Wt.data.width+2,h:Wt.data.height+2,x:0,y:0},Kt=new Vt.I(F,Wt);this.patterns[u]={bin:F,position:Kt}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const F=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new b(u,this.atlasImage,F.RGBA),this.atlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const F in this.patterns)u.push(this.patterns[F].bin);const{w:F,h:Wt}=Vt.p(u),Kt=this.atlasImage;Kt.resize({width:F||1,height:Wt||1});for(const u in this.patterns){const{bin:F}=this.patterns[u],Wt=F.x+1,Qi=F.y+1,fr=this.getImage(u).data,_r=fr.width,Sr=fr.height;Vt.R.copy(fr,Kt,{x:0,y:0},{x:Wt,y:Qi},{width:_r,height:Sr}),Vt.R.copy(fr,Kt,{x:0,y:Sr-1},{x:Wt,y:Qi-1},{width:_r,height:1}),Vt.R.copy(fr,Kt,{x:0,y:0},{x:Wt,y:Qi+Sr},{width:_r,height:1}),Vt.R.copy(fr,Kt,{x:_r-1,y:0},{x:Wt-1,y:Qi},{width:1,height:Sr}),Vt.R.copy(fr,Kt,{x:0,y:0},{x:Wt+_r,y:Qi},{width:1,height:Sr})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const F of u){if(this.callbackDispatchedThisFrame[F])continue;this.callbackDispatchedThisFrame[F]=!0;const u=this.getImage(F);u||Vt.w(`Image with ID: "${F}" was not found`),w(u)&&this.updateImage(F,u)}}}const ia=1e20;function E(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){for(let Ar=F;Ar<F+Wt;Ar++)P(u,Vt*Qi+Ar,Qi,Kt,fr,_r,Sr);for(let Ar=Vt;Ar<Vt+Kt;Ar++)P(u,Ar*Qi+F,1,Wt,fr,_r,Sr)}function P(u,F,Vt,Wt,Kt,Qi,fr){Qi[0]=0,fr[0]=-ia,fr[1]=ia,Kt[0]=u[F];for(let _r=1,Sr=0,Ar=0;_r<Wt;_r++){Kt[_r]=u[F+_r*Vt];const Wt=_r*_r;do{const u=Qi[Sr];Ar=(Kt[_r]-Kt[u]+Wt-u*u)/(_r-u)/2}while(Ar<=fr[Sr]&&--Sr>-1);Sr++,Qi[Sr]=_r,fr[Sr]=Ar,fr[Sr+1]=ia}for(let _r=0,Sr=0;_r<Wt;_r++){for(;fr[Sr+1]<_r;)Sr++;const Wt=Qi[Sr],Ar=_r-Wt;u[F+_r*Vt]=Kt[Wt]+Ar*Ar}}class C{constructor(u,F){this.requestManager=u,this.localIdeographFontFamily=F,this.entries={}}setURL(u){this.url=u}getGlyphs(u){return Vt._(this,void 0,void 0,(function*(){const F=[];for(const Vt in u)for(const Wt of u[Vt])F.push(this._getAndCacheGlyphsPromise(Vt,Wt));const Vt=yield Promise.all(F),Wt={};for(const{stack:u,id:F,glyph:Kt}of Vt)Wt[u]||(Wt[u]={}),Wt[u][F]=Kt&&{id:Kt.id,bitmap:Kt.bitmap.clone(),metrics:Kt.metrics};return Wt}))}_getAndCacheGlyphsPromise(u,F){return Vt._(this,void 0,void 0,(function*(){let Vt=this.entries[u];Vt||(Vt=this.entries[u]={glyphs:{},requests:{},ranges:{}});let Wt=Vt.glyphs[F];if(void 0!==Wt)return{stack:u,id:F,glyph:Wt};if(Wt=this._tinySDF(Vt,u,F),Wt)return Vt.glyphs[F]=Wt,{stack:u,id:F,glyph:Wt};const Kt=Math.floor(F/256);if(256*Kt>65535)throw new Error("glyphs > 65535 not supported");if(Vt.ranges[Kt])return{stack:u,id:F,glyph:Wt};if(!this.url)throw new Error("glyphsUrl is not set");if(!Vt.requests[Kt]){const F=C.loadGlyphRange(u,Kt,this.url,this.requestManager);Vt.requests[Kt]=F}const Qi=yield Vt.requests[Kt];for(const u in Qi)this._doesCharSupportLocalGlyph(+u)||(Vt.glyphs[+u]=Qi[+u]);return Vt.ranges[Kt]=!0,{stack:u,id:F,glyph:Qi[F]||null}}))}_doesCharSupportLocalGlyph(u){return!!this.localIdeographFontFamily&&(Vt.u["CJK Unified Ideographs"](u)||Vt.u["Hangul Syllables"](u)||Vt.u.Hiragana(u)||Vt.u.Katakana(u))}_tinySDF(u,F,Wt){const Kt=this.localIdeographFontFamily;if(!Kt)return;if(!this._doesCharSupportLocalGlyph(Wt))return;let Qi=u.tinySDF;if(!Qi){let Vt="400";/bold/i.test(F)?Vt="900":/medium/i.test(F)?Vt="500":/light/i.test(F)&&(Vt="200"),Qi=u.tinySDF=new C.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:Kt,fontWeight:Vt})}const fr=Qi.draw(String.fromCharCode(Wt));return{id:Wt,bitmap:new Vt.o({width:fr.width||60,height:fr.height||60},fr.data),metrics:{width:fr.glyphWidth/2||24,height:fr.glyphHeight/2||24,left:fr.glyphLeft/2+.5||0,top:fr.glyphTop/2-27.5||-8,advance:fr.glyphAdvance/2||24,isDoubleResolution:!0}}}}C.loadGlyphRange=function(F,Wt,Kt,Qi){return Vt._(this||u,void 0,void 0,(function*(){const u=256*Wt,fr=u+255,_r=Qi.transformRequest(Kt.replace("{fontstack}",F).replace("{range}",`${u}-${fr}`),"Glyphs"),Sr=yield Vt.l(_r,new AbortController);if(!Sr||!Sr.data)throw new Error(`Could not load glyph range. range: ${Wt}, ${u}-${fr}`);const Ar={};for(const u of Vt.n(Sr.data))Ar[u.id]=u;return Ar}))},C.TinySDF=class{constructor({fontSize:u=24,buffer:F=3,radius:Vt=8,cutoff:Wt=.25,fontFamily:Kt="sans-serif",fontWeight:Qi="normal",fontStyle:fr="normal"}={}){this.buffer=F,this.cutoff=Wt,this.radius=Vt;const _r=this.size=u+4*F,Sr=this._createCanvas(_r),Ar=this.ctx=Sr.getContext("2d",{willReadFrequently:!0});Ar.font=`${fr} ${Qi} ${u}px ${Kt}`,Ar.textBaseline="alphabetic",Ar.textAlign="left",Ar.fillStyle="black",this.gridOuter=new Float64Array(_r*_r),this.gridInner=new Float64Array(_r*_r),this.f=new Float64Array(_r),this.z=new Float64Array(_r+1),this.v=new Uint16Array(_r)}_createCanvas(u){const F=document.createElement("canvas");return F.width=F.height=u,F}draw(u){const{width:F,actualBoundingBoxAscent:Vt,actualBoundingBoxDescent:Wt,actualBoundingBoxLeft:Kt,actualBoundingBoxRight:Qi}=this.ctx.measureText(u),fr=Math.ceil(Vt),_r=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(Qi-Kt))),Sr=Math.min(this.size-this.buffer,fr+Math.ceil(Wt)),Ar=_r+2*this.buffer,Jr=Sr+2*this.buffer,zn=Math.max(Ar*Jr,0),Qs=new Uint8ClampedArray(zn),ta={data:Qs,width:Ar,height:Jr,glyphWidth:_r,glyphHeight:Sr,glyphTop:fr,glyphLeft:0,glyphAdvance:F};if(0===_r||0===Sr)return ta;const{ctx:aa,buffer:va,gridInner:Ba,gridOuter:Ya}=this;aa.clearRect(va,va,_r,Sr),aa.fillText(u,va,va+fr);const to=aa.getImageData(va,va,_r,Sr);Ya.fill(ia,0,zn),Ba.fill(0,0,zn);for(let u=0;u<Sr;u++)for(let F=0;F<_r;F++){const Vt=to.data[4*(u*_r+F)+3]/255;if(0===Vt)continue;const Wt=(u+va)*Ar+F+va;if(1===Vt)Ya[Wt]=0,Ba[Wt]=ia;else{const u=.5-Vt;Ya[Wt]=u>0?u*u:0,Ba[Wt]=u<0?u*u:0}}E(Ya,0,0,Ar,Jr,Ar,this.f,this.v,this.z),E(Ba,va,va,_r,Sr,Ar,this.f,this.v,this.z);for(let u=0;u<zn;u++){const F=Math.sqrt(Ya[u])-Math.sqrt(Ba[u]);Qs[u]=Math.round(255-255*(F/this.radius+this.cutoff))}return ta}};class S{constructor(){this.specification=Vt.v.light.position}possiblyEvaluate(u,F){return Vt.y(u.expression.evaluate(F))}interpolate(u,F,Wt){return{x:Vt.z.number(u.x,F.x,Wt),y:Vt.z.number(u.y,F.y,Wt),z:Vt.z.number(u.z,F.z,Wt)}}}let aa;class M extends Vt.E{constructor(u){super(),aa=aa||new Vt.q({anchor:new Vt.D(Vt.v.light.anchor),position:new S,color:new Vt.D(Vt.v.light.color),intensity:new Vt.D(Vt.v.light.intensity)}),this._transitionable=new Vt.T(aa),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,F={}){if(!this._validate(Vt.r,u,F))for(const F in u){const Vt=u[F];F.endsWith("-transition")?this._transitionable.setTransition(F.slice(0,-11),Vt):this._transitionable.setValue(F,Vt)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,F,Wt){return(!Wt||!1!==Wt.validate)&&Vt.t(this,u.call(Vt.x,{value:F,style:{glyphs:!0,sprite:!0},styleSpec:Vt.v}))}}class z{constructor(u,F){this.width=u,this.height=F,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(u,F){const Vt=u.join(",")+String(F);return this.dashEntry[Vt]||(this.dashEntry[Vt]=this.addDash(u,F)),this.dashEntry[Vt]}getDashRanges(u,F,Vt){const Wt=[];let Kt=u.length%2==1?-u[u.length-1]*Vt:0,Qi=u[0]*Vt,fr=!0;Wt.push({left:Kt,right:Qi,isDash:fr,zeroLength:0===u[0]});let _r=u[0];for(let F=1;F<u.length;F++){fr=!fr;const Sr=u[F];Kt=_r*Vt,_r+=Sr,Qi=_r*Vt,Wt.push({left:Kt,right:Qi,isDash:fr,zeroLength:0===Sr})}return Wt}addRoundDash(u,F,Vt){const Wt=F/2;for(let F=-Vt;F<=Vt;F++){const Kt=this.width*(this.nextRow+Vt+F);let Qi=0,fr=u[Qi];for(let _r=0;_r<this.width;_r++){_r/fr.right>1&&(fr=u[++Qi]);const Sr=Math.abs(_r-fr.left),Ar=Math.abs(_r-fr.right),Jr=Math.min(Sr,Ar);let zn;const Qs=F/Vt*(Wt+1);if(fr.isDash){const u=Wt-Math.abs(Qs);zn=Math.sqrt(Jr*Jr+u*u)}else zn=Wt-Math.sqrt(Jr*Jr+Qs*Qs);this.data[Kt+_r]=Math.max(0,Math.min(255,zn+128))}}}addRegularDash(u){for(let F=u.length-1;F>=0;--F){const Vt=u[F],Wt=u[F+1];Vt.zeroLength?u.splice(F,1):Wt&&Wt.isDash===Vt.isDash&&(Wt.left=Vt.left,u.splice(F,1))}const F=u[0],Vt=u[u.length-1];F.isDash===Vt.isDash&&(F.left=Vt.left-this.width,Vt.right=F.right+this.width);const Wt=this.width*this.nextRow;let Kt=0,Qi=u[Kt];for(let F=0;F<this.width;F++){F/Qi.right>1&&(Qi=u[++Kt]);const Vt=Math.abs(F-Qi.left),fr=Math.abs(F-Qi.right),_r=Math.min(Vt,fr);this.data[Wt+F]=Math.max(0,Math.min(255,(Qi.isDash?_r:-_r)+128))}}addDash(u,F){const Wt=F?7:0,Kt=2*Wt+1;if(this.nextRow+Kt>this.height)return Vt.w("LineAtlas out of space"),null;let Qi=0;for(let F=0;F<u.length;F++)Qi+=u[F];if(0!==Qi){const Vt=this.width/Qi,Kt=this.getDashRanges(u,this.width,Vt);F?this.addRoundDash(Kt,Vt,Wt):this.addRegularDash(Kt)}const fr={y:(this.nextRow+Wt+.5)/this.height,height:2*Wt/this.height,width:Qi};return this.nextRow+=Kt,this.dirty=!0,fr}bind(u){const F=u.gl;this.texture?(F.bindTexture(F.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,F.texSubImage2D(F.TEXTURE_2D,0,0,0,this.width,this.height,F.ALPHA,F.UNSIGNED_BYTE,this.data))):(this.texture=F.createTexture(),F.bindTexture(F.TEXTURE_2D,this.texture),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.REPEAT),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),F.texImage2D(F.TEXTURE_2D,0,F.ALPHA,this.width,this.height,0,F.ALPHA,F.UNSIGNED_BYTE,this.data))}}const va="maplibre_preloaded_worker_pool";class R{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<R.workerCount;)this.workers.push(new Worker(Vt.a.WORKER_URL));return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],0===this.numActive()&&(this.workers.forEach((u=>{u.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[va]}numActive(){return Object.keys(this.active).length}}const Ba=Math.floor(fr.hardwareConcurrency/2);let Ya,to;function B(){return Ya||(Ya=new R),Ya}R.workerCount=Vt.B(globalThis)?Math.max(Math.min(Ba,3),1):1;class O{constructor(u,F){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=F;const Wt=this.workerPool.acquire(F);for(let u=0;u<Wt.length;u++){const Kt=new Vt.C(Wt[u],F);Kt.name=`Worker ${u}`,this.actors.push(Kt)}if(!this.actors.length)throw new Error("No actors found")}broadcast(u,F){const Vt=[];for(const Wt of this.actors)Vt.push(Wt.sendAsync({type:u,data:F}));return Promise.all(Vt)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(u=!0){this.actors.forEach((u=>{u.remove()})),this.actors=[],u&&this.workerPool.release(this.id)}registerMessageHandler(u,F){for(const Vt of this.actors)Vt.registerMessageHandler(u,F)}}function N(){return to||(to=new O(B(),Vt.G),to.registerMessageHandler("GR",((u,F,Wt)=>Vt.m(F,Wt)))),to}function j(u,F){const Wt=Vt.F();return Vt.H(Wt,Wt,[1,1,0]),Vt.J(Wt,Wt,[.5*u.width,.5*u.height,1]),Vt.K(Wt,Wt,u.calculatePosMatrix(F.toUnwrapped()))}function U(u,F,Vt,Wt,Kt,Qi){const fr=function(u,F,Vt){if(u)for(const Wt of u){const u=F[Wt];if(u&&u.source===Vt&&"fill-extrusion"===u.type)return!0}else for(const u in F){const Wt=F[u];if(Wt.source===Vt&&"fill-extrusion"===Wt.type)return!0}return!1}(Kt&&Kt.layers,F,u.id),_r=Qi.maxPitchScaleFactor(),Sr=u.tilesIn(Wt,_r,fr);Sr.sort(Z);const Ar=[];for(const Wt of Sr)Ar.push({wrappedTileID:Wt.tileID.wrapped().key,queryResults:Wt.tile.queryRenderedFeatures(F,Vt,u._state,Wt.queryGeometry,Wt.cameraQueryGeometry,Wt.scale,Kt,Qi,_r,j(u.transform,Wt.tileID))});const Jr=function(u){const F={},Vt={};for(const Wt of u){const u=Wt.queryResults,Kt=Wt.wrappedTileID,Qi=Vt[Kt]=Vt[Kt]||{};for(const Vt in u){const Wt=u[Vt],Kt=Qi[Vt]=Qi[Vt]||{},fr=F[Vt]=F[Vt]||[];for(const u of Wt)Kt[u.featureIndex]||(Kt[u.featureIndex]=!0,fr.push(u))}}return F}(Ar);for(const F in Jr)Jr[F].forEach((F=>{const Vt=F.feature,Wt=u.getFeatureState(Vt.layer["source-layer"],Vt.id);Vt.source=Vt.layer.source,Vt.layer["source-layer"]&&(Vt.sourceLayer=Vt.layer["source-layer"]),Vt.state=Wt}));return Jr}function Z(u,F){const Vt=u.tileID,Wt=F.tileID;return Vt.overscaledZ-Wt.overscaledZ||Vt.canonical.y-Wt.canonical.y||Vt.wrap-Wt.wrap||Vt.canonical.x-Wt.canonical.x}function q(F,Wt,Kt){return Vt._(this||u,void 0,void 0,(function*(){let u=F;if(F.url?u=(yield Vt.h(Wt.transformRequest(F.url,"Source"),Kt)).data:yield fr.frameAsync(Kt),!u)return null;const Qi=Vt.L(Vt.e(u,F),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(Qi.vectorLayerIds=u.vector_layers.map((u=>u.id))),Qi}))}class W{constructor(u,F){u&&(F?this.setSouthWest(u).setNorthEast(F):Array.isArray(u)&&(4===u.length?this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]]):this.setSouthWest(u[0]).setNorthEast(u[1])))}setNorthEast(u){return this._ne=u instanceof Vt.M?new Vt.M(u.lng,u.lat):Vt.M.convert(u),this}setSouthWest(u){return this._sw=u instanceof Vt.M?new Vt.M(u.lng,u.lat):Vt.M.convert(u),this}extend(u){const F=this._sw,Wt=this._ne;let Kt,Qi;if(u instanceof Vt.M)Kt=u,Qi=u;else{if(!(u instanceof W))return Array.isArray(u)?4===u.length||u.every(Array.isArray)?this.extend(W.convert(u)):this.extend(Vt.M.convert(u)):u&&("lng"in u||"lon"in u)&&"lat"in u?this.extend(Vt.M.convert(u)):this;if(Kt=u._sw,Qi=u._ne,!Kt||!Qi)return this}return F||Wt?(F.lng=Math.min(Kt.lng,F.lng),F.lat=Math.min(Kt.lat,F.lat),Wt.lng=Math.max(Qi.lng,Wt.lng),Wt.lat=Math.max(Qi.lat,Wt.lat)):(this._sw=new Vt.M(Kt.lng,Kt.lat),this._ne=new Vt.M(Qi.lng,Qi.lat)),this}getCenter(){return new Vt.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vt.M(this.getWest(),this.getNorth())}getSouthEast(){return new Vt.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(u){const{lng:F,lat:Wt}=Vt.M.convert(u);let Kt=this._sw.lng<=F&&F<=this._ne.lng;return this._sw.lng>this._ne.lng&&(Kt=this._sw.lng>=F&&F>=this._ne.lng),this._sw.lat<=Wt&&Wt<=this._ne.lat&&Kt}static convert(u){return u instanceof W?u:u?new W(u):u}static fromLngLat(u,F=0){const Wt=360*F/40075017,Kt=Wt/Math.cos(Math.PI/180*u.lat);return new W(new Vt.M(u.lng-Kt,u.lat-Wt),new Vt.M(u.lng+Kt,u.lat+Wt))}}class G{constructor(u,F,Vt){this.bounds=W.convert(this.validateBounds(u)),this.minzoom=F||0,this.maxzoom=Vt||24}validateBounds(u){return Array.isArray(u)&&4===u.length?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const F=Math.pow(2,u.z),Wt=Math.floor(Vt.N(this.bounds.getWest())*F),Kt=Math.floor(Vt.O(this.bounds.getNorth())*F),Qi=Math.ceil(Vt.N(this.bounds.getEast())*F),fr=Math.ceil(Vt.O(this.bounds.getSouth())*F);return u.x>=Wt&&u.x<Qi&&u.y>=Kt&&u.y<fr}}class V extends Vt.E{constructor(u,F,Wt,Kt){if(super(),this.id=u,this.dispatcher=Wt,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Vt.e(this,Vt.L(F,["url","scheme","tileSize","promoteId"])),this._options=Vt.e({type:"vector"},F),this._collectResourceTiming=F.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(Kt)}load(){return Vt._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new Vt.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),u&&(Vt.e(this,u),u.bounds&&(this.tileBounds=new G(u.bounds,this.minzoom,this.maxzoom)),this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"content"})))}catch(u){this._tileJSONRequest=null,this.fire(new Vt.j(u))}}))}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}setSourceProperty(u){this._tileJSONRequest&&this._tileJSONRequest.abort(),u(),this.load()}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return Vt.e({},this._options)}loadTile(u){return Vt._(this,void 0,void 0,(function*(){const F=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),Vt={request:this.map._requestManager.transformRequest(F,"Tile"),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};Vt.request.collectResourceTiming=this._collectResourceTiming;let Wt="RT";if(u.actor&&"expired"!==u.state){if("loading"===u.state)return new Promise(((F,Vt)=>{u.reloadPromise={resolve:F,reject:Vt}}))}else u.actor=this.dispatcher.getActor(),Wt="LT";u.abortController=new AbortController;try{const F=yield u.actor.sendAsync({type:Wt,data:Vt},u.abortController);if(delete u.abortController,u.aborted)return;this._afterTileLoadWorkerResponse(u,F)}catch(F){if(delete u.abortController,u.aborted)return;if(F&&404!==F.status)throw F;this._afterTileLoadWorkerResponse(u,null)}}))}_afterTileLoadWorkerResponse(u,F){if(F&&F.resourceTiming&&(u.resourceTiming=F.resourceTiming),F&&this.map._refreshExpiredTiles&&u.setExpiryData(F),u.loadVectorData(F,this.map.painter),u.reloadPromise){const F=u.reloadPromise;u.reloadPromise=null,this.loadTile(u).then(F.resolve).catch(F.reject)}}abortTile(u){return Vt._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.actor&&(yield u.actor.sendAsync({type:"AT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}unloadTile(u){return Vt._(this,void 0,void 0,(function*(){u.unloadVectorData(),u.actor&&(yield u.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class H extends Vt.E{constructor(u,F,Wt,Kt){super(),this.id=u,this.dispatcher=Wt,this.setEventedParent(Kt),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Vt.e({type:"raster"},F),Vt.e(this,Vt.L(F,["url","scheme","tileSize"]))}load(){return Vt._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new Vt.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield q(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(Vt.e(this,u),u.bounds&&(this.tileBounds=new G(u.bounds,this.minzoom,this.maxzoom)),this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"content"})))}catch(u){this._tileJSONRequest=null,this.fire(new Vt.j(u))}}))}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(u){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),u(),this.load()}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}serialize(){return Vt.e({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u){return Vt._(this,void 0,void 0,(function*(){const F=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);u.abortController=new AbortController;try{const Vt=yield Qs.getImage(this.map._requestManager.transformRequest(F,"Tile"),u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(Vt&&Vt.data){this.map._refreshExpiredTiles&&Vt.cacheControl&&Vt.expires&&u.setExpiryData({cacheControl:Vt.cacheControl,expires:Vt.expires});const F=this.map.painter.context,Wt=F.gl,Kt=Vt.data;u.texture=this.map.painter.getTileTexture(Kt.width),u.texture?u.texture.update(Kt,{useMipmap:!0}):(u.texture=new b(F,Kt,Wt.RGBA,{useMipmap:!0}),u.texture.bind(Wt.LINEAR,Wt.CLAMP_TO_EDGE,Wt.LINEAR_MIPMAP_NEAREST),F.extTextureFilterAnisotropic&&Wt.texParameterf(Wt.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax)),u.state="loaded"}}catch(F){if(delete u.abortController,u.aborted)u.state="unloaded";else if(F)throw u.state="errored",F}}))}abortTile(u){return Vt._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController)}))}unloadTile(u){return Vt._(this,void 0,void 0,(function*(){u.texture&&this.map.painter.saveTileTexture(u.texture)}))}hasTransition(){return!1}}class $ extends H{constructor(u,F,Wt,Kt){super(u,F,Wt,Kt),this.type="raster-dem",this.maxzoom=22,this._options=Vt.e({type:"raster-dem"},F),this.encoding=F.encoding||"mapbox",this.redFactor=F.redFactor,this.greenFactor=F.greenFactor,this.blueFactor=F.blueFactor,this.baseShift=F.baseShift}loadTile(u){return Vt._(this,void 0,void 0,(function*(){const F=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),Wt=this.map._requestManager.transformRequest(F,"Tile");u.neighboringTiles=this._getNeighboringTiles(u.tileID),u.abortController=new AbortController;try{const F=yield Qs.getImage(Wt,u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(F&&F.data){const Wt=F.data;this.map._refreshExpiredTiles&&F.cacheControl&&F.expires&&u.setExpiryData({cacheControl:F.cacheControl,expires:F.expires});const Kt=Vt.b(Wt)&&Vt.S()?Wt:yield this.readImageNow(Wt),Qi={type:this.type,uid:u.uid,source:this.id,rawImageData:Kt,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!u.actor||"expired"===u.state){u.actor=this.dispatcher.getActor();const F=yield u.actor.sendAsync({type:"LDT",data:Qi});u.dem=F,u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0,u.state="loaded"}}}catch(F){if(delete u.abortController,u.aborted)u.state="unloaded";else if(F)throw u.state="errored",F}}))}readImageNow(u){return Vt._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&Vt.U()){const F=u.width+2,Wt=u.height+2;try{return new Vt.R({width:F,height:Wt},yield Vt.V(u,-1,-1,F,Wt))}catch(u){}}return fr.getImageData(u,1)}))}_getNeighboringTiles(u){const F=u.canonical,Wt=Math.pow(2,F.z),Kt=(F.x-1+Wt)%Wt,Qi=0===F.x?u.wrap-1:u.wrap,fr=(F.x+1+Wt)%Wt,_r=F.x+1===Wt?u.wrap+1:u.wrap,Sr={};return Sr[new Vt.Q(u.overscaledZ,Qi,F.z,Kt,F.y).key]={backfilled:!1},Sr[new Vt.Q(u.overscaledZ,_r,F.z,fr,F.y).key]={backfilled:!1},F.y>0&&(Sr[new Vt.Q(u.overscaledZ,Qi,F.z,Kt,F.y-1).key]={backfilled:!1},Sr[new Vt.Q(u.overscaledZ,u.wrap,F.z,F.x,F.y-1).key]={backfilled:!1},Sr[new Vt.Q(u.overscaledZ,_r,F.z,fr,F.y-1).key]={backfilled:!1}),F.y+1<Wt&&(Sr[new Vt.Q(u.overscaledZ,Qi,F.z,Kt,F.y+1).key]={backfilled:!1},Sr[new Vt.Q(u.overscaledZ,u.wrap,F.z,F.x,F.y+1).key]={backfilled:!1},Sr[new Vt.Q(u.overscaledZ,_r,F.z,fr,F.y+1).key]={backfilled:!1}),Sr}unloadTile(u){return Vt._(this,void 0,void 0,(function*(){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&(yield u.actor.sendAsync({type:"RDT",data:{type:this.type,uid:u.uid,source:this.id}}))}))}}class X extends Vt.E{constructor(u,F,Wt,Kt){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=Wt.getActor(),this.setEventedParent(Kt),this._data=F.data,this._options=Vt.e({},F),this._collectResourceTiming=F.collectResourceTiming,void 0!==F.maxzoom&&(this.maxzoom=F.maxzoom),F.type&&(this.type=F.type),F.attribution&&(this.attribution=F.attribution),this.promoteId=F.promoteId;const Qi=Vt.W/this.tileSize;this.workerOptions=Vt.e({source:this.id,cluster:F.cluster||!1,geojsonVtOptions:{buffer:(void 0!==F.buffer?F.buffer:128)*Qi,tolerance:(void 0!==F.tolerance?F.tolerance:.375)*Qi,extent:Vt.W,maxZoom:this.maxzoom,lineMetrics:F.lineMetrics||!1,generateId:F.generateId||!1},superclusterOptions:{maxZoom:void 0!==F.clusterMaxZoom?F.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,F.clusterMinPoints||2),extent:Vt.W,radius:(F.clusterRadius||50)*Qi,log:!1,generateId:F.generateId||!1},clusterProperties:F.clusterProperties,filter:F.filter},F.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}load(){return Vt._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(u){this.map=u,this.load()}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){return this._updateWorkerData(u),this}getData(){return Vt._(this,void 0,void 0,(function*(){const u=Vt.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:u})}))}setClusterOptions(u){return this.workerOptions.cluster=u.cluster,u&&(void 0!==u.clusterRadius&&(this.workerOptions.superclusterOptions.radius=u.clusterRadius),void 0!==u.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=u.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(u){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:u,source:this.id}})}getClusterChildren(u){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:u,source:this.id}})}getClusterLeaves(u,F,Vt){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:u,limit:F,offset:Vt}})}_updateWorkerData(u){return Vt._(this,void 0,void 0,(function*(){const F=Vt.e({type:this.type},this.workerOptions);u?F.dataDiff=u:"string"==typeof this._data?(F.request=this.map._requestManager.transformRequest(fr.resolveURL(this._data),"Source"),F.request.collectResourceTiming=this._collectResourceTiming):F.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new Vt.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:F});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new Vt.k("dataabort",{dataType:"source"}));let Wt=null;u.resourceTiming&&u.resourceTiming[this.id]&&(Wt=u.resourceTiming[this.id].slice(0));const Kt={dataType:"source"};this._collectResourceTiming&&Wt&&Wt.length>0&&Vt.e(Kt,{resourceTiming:Wt}),this.fire(new Vt.k("data",Object.assign(Object.assign({},Kt),{sourceDataType:"metadata"}))),this.fire(new Vt.k("data",Object.assign(Object.assign({},Kt),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new Vt.k("dataabort",{dataType:"source"}));this.fire(new Vt.j(u))}}))}loaded(){return 0===this._pendingLoads}loadTile(u){return Vt._(this,void 0,void 0,(function*(){const F=u.actor?"RT":"LT";u.actor=this.actor;const Vt={type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.abortController=new AbortController;const Wt=yield this.actor.sendAsync({type:F,data:Vt},u.abortController);delete u.abortController,u.unloadVectorData(),u.aborted||u.loadVectorData(Wt,this.map.painter,"RT"===F)}))}abortTile(u){return Vt._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.aborted=!0}))}unloadTile(u){return Vt._(this,void 0,void 0,(function*(){u.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return Vt.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var eo=Vt.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class J extends Vt.E{constructor(u,F,Vt,Wt){super(),this.id=u,this.dispatcher=Vt,this.coordinates=F.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(Wt),this.options=F}load(u){return Vt._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new Vt.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const F=yield Qs.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,F&&F.data&&(this.image=F.data,u&&(this.coordinates=u),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new Vt.j(u))}}))}loaded(){return this._loaded}updateImage(u){return u.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=u.url,this.load(u.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(u){this.coordinates=u;const F=u.map(Vt.Y.fromLngLat);this.tileID=function(u){let F=1/0,Wt=1/0,Kt=-1/0,Qi=-1/0;for(const Vt of u)F=Math.min(F,Vt.x),Wt=Math.min(Wt,Vt.y),Kt=Math.max(Kt,Vt.x),Qi=Math.max(Qi,Vt.y);const fr=Math.max(Kt-F,Qi-Wt),_r=Math.max(0,Math.floor(-Math.log(fr)/Math.LN2)),Sr=Math.pow(2,_r);return new Vt.a0(_r,Math.floor((F+Kt)/2*Sr),Math.floor((Wt+Qi)/2*Sr))}(F),this.minzoom=this.maxzoom=this.tileID.z;const Wt=F.map((u=>this.tileID.getTilePoint(u)._round()));return this._boundsArray=new Vt.Z,this._boundsArray.emplaceBack(Wt[0].x,Wt[0].y,0,0),this._boundsArray.emplaceBack(Wt[1].x,Wt[1].y,Vt.W,0),this._boundsArray.emplaceBack(Wt[3].x,Wt[3].y,0,Vt.W),this._boundsArray.emplaceBack(Wt[2].x,Wt[2].y,Vt.W,Vt.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const u=this.map.painter.context,F=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,eo.members)),this.boundsSegments||(this.boundsSegments=Vt.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new b(u,this.image,F.RGBA),this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE));let Wt=!1;for(const u in this.tiles){const F=this.tiles[u];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture,Wt=!0)}Wt&&this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(u){return Vt._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={}):u.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Y extends J{constructor(u,F,Vt,Wt){super(u,F,Vt,Wt),this.roundZoom=!0,this.type="video",this.options=F}load(){return Vt._(this,void 0,void 0,(function*(){this._loaded=!1;const u=this.options;this.urls=[];for(const F of u.urls)this.urls.push(this.map._requestManager.transformRequest(F,"Source").url);try{const u=yield Vt.a2(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new Vt.j(u))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const F=this.video.seekable;u<F.start(0)||u>F.end(0)?this.fire(new Vt.j(new Vt.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${F.start(0)} and ${F.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const u=this.map.painter.context,F=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,eo.members)),this.boundsSegments||(this.boundsSegments=Vt.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.texSubImage2D(F.TEXTURE_2D,0,0,0,F.RGBA,F.UNSIGNED_BYTE,this.video)):(this.texture=new b(u,this.video,F.RGBA),this.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE));let Wt=!1;for(const u in this.tiles){const F=this.tiles[u];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture,Wt=!0)}Wt&&this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Q extends J{constructor(u,F,Wt,Kt){super(u,F,Wt,Kt),F.coordinates?Array.isArray(F.coordinates)&&4===F.coordinates.length&&!F.coordinates.some((u=>!Array.isArray(u)||2!==u.length||u.some((u=>"number"!=typeof u))))||this.fire(new Vt.j(new Vt.a1(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Vt.j(new Vt.a1(`sources.${u}`,null,'missing required property "coordinates"'))),F.animate&&"boolean"!=typeof F.animate&&this.fire(new Vt.j(new Vt.a1(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),F.canvas?"string"==typeof F.canvas||F.canvas instanceof HTMLCanvasElement||this.fire(new Vt.j(new Vt.a1(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Vt.j(new Vt.a1(`sources.${u}`,null,'missing required property "canvas"'))),this.options=F,this.animate=void 0===F.animate||F.animate}load(){return Vt._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Vt.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const F=this.map.painter.context,Wt=F.gl;this.boundsBuffer||(this.boundsBuffer=F.createVertexBuffer(this._boundsArray,eo.members)),this.boundsSegments||(this.boundsSegments=Vt.$.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new b(F,this.canvas,Wt.RGBA,{premultiply:!0});let Kt=!1;for(const u in this.tiles){const F=this.tiles[u];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture,Kt=!0)}Kt&&this.fire(new Vt.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}}const io={},et=u=>{switch(u){case"geojson":return X;case"image":return J;case"raster":return H;case"raster-dem":return $;case"vector":return V;case"video":return Y;case"canvas":return Q}return io[u]},so="RTLPluginLoaded";class at extends Vt.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=N()}_syncState(u){return this.status=u,this.dispatcher.broadcast("SRPS",{pluginStatus:u,pluginURL:this.url}).catch((u=>{throw this.status="error",u}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(u){return Vt._(this,arguments,void 0,(function*(u,F=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=fr.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if("unavailable"===this.status){if(!F)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return Vt._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new Vt.k(so))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let co=null;function ot(){return co||(co=new at),co}class rt{constructor(u,F){this.timeAdded=0,this.fadeEndTime=0,this.tileID=u,this.uid=Vt.a3(),this.uses=0,this.tileSize=F,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(u){const F=u+this.timeAdded;F<this.fadeEndTime||(this.fadeEndTime=F)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(u){this.demTexture&&u.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(u,F,Wt){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",u){u.featureIndex&&(this.latestFeatureIndex=u.featureIndex,u.rawTileData?(this.latestRawTileData=u.rawTileData,this.latestFeatureIndex.rawTileData=u.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=u.collisionBoxArray,this.buckets=function(u,F){const Vt={};if(!F)return Vt;for(const Wt of u){const u=Wt.layerIds.map((u=>F.getLayer(u))).filter(Boolean);if(0!==u.length){Wt.layers=u,Wt.stateDependentLayerIds&&(Wt.stateDependentLayers=Wt.stateDependentLayerIds.map((F=>u.filter((u=>u.id===F))[0])));for(const F of u)Vt[F.id]=Wt}}return Vt}(u.buckets,F.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const F=this.buckets[u];if(F instanceof Vt.a5){if(this.hasSymbolBuckets=!0,!Wt)break;F.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const F=this.buckets[u];if(F instanceof Vt.a5&&F.hasRTLText){this.hasRTLText=!0,ot().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const Vt=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,F.style.getLayer(u).queryRadius(Vt))}u.imageAtlas&&(this.imageAtlas=u.imageAtlas),u.glyphAtlasImage&&(this.glyphAtlasImage=u.glyphAtlasImage)}else this.collisionBoxArray=new Vt.a4}unloadVectorData(){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(u){return this.buckets[u.id]}upload(u){for(const F in this.buckets){const Vt=this.buckets[F];Vt.uploadPending()&&Vt.upload(u)}const F=u.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new b(u,this.imageAtlas.image,F.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new b(u,this.glyphAtlasImage,F.ALPHA),this.glyphAtlasImage=null)}prepare(u){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(u,this.imageAtlasTexture)}queryRenderedFeatures(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:Wt,cameraQueryGeometry:Kt,scale:Qi,tileSize:this.tileSize,pixelPosMatrix:Ar,transform:_r,params:fr,queryPadding:this.queryPadding*Sr},u,F,Vt):{}}querySourceFeatures(u,F){const Wt=this.latestFeatureIndex;if(!Wt||!Wt.rawTileData)return;const Kt=Wt.loadVTLayers(),Qi=F&&F.sourceLayer?F.sourceLayer:"",fr=Kt._geojsonTileLayer||Kt[Qi];if(!fr)return;const _r=Vt.a6(F&&F.filter),{z:Sr,x:Ar,y:Jr}=this.tileID.canonical,zn={z:Sr,x:Ar,y:Jr};for(let F=0;F<fr.length;F++){const Kt=fr.feature(F);if(_r.needGeometry){const u=Vt.a7(Kt,!0);if(!_r.filter(new Vt.a8(this.tileID.overscaledZ),u,this.tileID.canonical))continue}else if(!_r.filter(new Vt.a8(this.tileID.overscaledZ),Kt))continue;const Qs=Wt.getId(Kt,Qi),ta=new Vt.a9(Kt,Sr,Ar,Jr,Qs);ta.tile=zn,u.push(ta)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(u){const F=this.expirationTime;if(u.cacheControl){const F=Vt.aa(u.cacheControl);F["max-age"]&&(this.expirationTime=Date.now()+1e3*F["max-age"])}else u.expires&&(this.expirationTime=new Date(u.expires).getTime());if(this.expirationTime){const u=Date.now();let Vt=!1;if(this.expirationTime>u)Vt=!1;else if(F)if(this.expirationTime<F)Vt=!0;else{const Wt=this.expirationTime-F;Wt?this.expirationTime=u+Math.max(Wt,3e4):Vt=!0}else Vt=!0;Vt?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(u,F){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(u).length)return;const Vt=this.latestFeatureIndex.loadVTLayers();for(const Wt in this.buckets){if(!F.style.hasLayer(Wt))continue;const Kt=this.buckets[Wt],Qi=Kt.layers[0].sourceLayer||"_geojsonTileLayer",fr=Vt[Qi],_r=u[Qi];if(!fr||!_r||0===Object.keys(_r).length)continue;Kt.update(_r,fr,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Sr=F&&F.style&&F.style.getLayer(Wt);Sr&&(this.queryPadding=Math.max(this.queryPadding,Sr.queryRadius(Kt)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(u){this.symbolFadeHoldUntil=fr.now()+u}setDependencies(u,F){const Vt={};for(const u of F)Vt[u]=!0;this.dependencies[u]=Vt}hasDependency(u,F){for(const Vt of u){const u=this.dependencies[Vt];if(u)for(const Vt of F)if(u[Vt])return!0}return!1}}class nt{constructor(u,F){this.max=u,this.onRemove=F,this.reset()}reset(){for(const u in this.data)for(const F of this.data[u])F.timeout&&clearTimeout(F.timeout),this.onRemove(F.value);return this.data={},this.order=[],this}add(u,F,Vt){const Wt=u.wrapped().key;void 0===this.data[Wt]&&(this.data[Wt]=[]);const Kt={value:F,timeout:void 0};if(void 0!==Vt&&(Kt.timeout=setTimeout((()=>{this.remove(u,Kt)}),Vt)),this.data[Wt].push(Kt),this.order.push(Wt),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(u){return u.wrapped().key in this.data}getAndRemove(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null}_getAndRemoveByKey(u){const F=this.data[u].shift();return F.timeout&&clearTimeout(F.timeout),0===this.data[u].length&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),F.value}getByKey(u){const F=this.data[u];return F?F[0].value:null}get(u){return this.has(u)?this.data[u.wrapped().key][0].value:null}remove(u,F){if(!this.has(u))return this;const Vt=u.wrapped().key,Wt=void 0===F?0:this.data[Vt].indexOf(F),Kt=this.data[Vt][Wt];return this.data[Vt].splice(Wt,1),Kt.timeout&&clearTimeout(Kt.timeout),0===this.data[Vt].length&&delete this.data[Vt],this.onRemove(Kt.value),this.order.splice(this.order.indexOf(Vt),1),this}setMaxSize(u){for(this.max=u;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(u){const F=[];for(const Vt in this.data)for(const Wt of this.data[Vt])u(Wt.value)||F.push(Wt);for(const u of F)this.remove(u.value.tileID,u)}}class lt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(u,F,Wt){const Kt=String(F);if(this.stateChanges[u]=this.stateChanges[u]||{},this.stateChanges[u][Kt]=this.stateChanges[u][Kt]||{},Vt.e(this.stateChanges[u][Kt],Wt),null===this.deletedStates[u]){this.deletedStates[u]={};for(const F in this.state[u])F!==Kt&&(this.deletedStates[u][F]=null)}else if(this.deletedStates[u]&&null===this.deletedStates[u][Kt]){this.deletedStates[u][Kt]={};for(const F in this.state[u][Kt])Wt[F]||(this.deletedStates[u][Kt][F]=null)}else for(const F in Wt)this.deletedStates[u]&&this.deletedStates[u][Kt]&&null===this.deletedStates[u][Kt][F]&&delete this.deletedStates[u][Kt][F]}removeFeatureState(u,F,Vt){if(null===this.deletedStates[u])return;const Wt=String(F);if(this.deletedStates[u]=this.deletedStates[u]||{},Vt&&void 0!==F)null!==this.deletedStates[u][Wt]&&(this.deletedStates[u][Wt]=this.deletedStates[u][Wt]||{},this.deletedStates[u][Wt][Vt]=null);else if(void 0!==F)if(this.stateChanges[u]&&this.stateChanges[u][Wt])for(Vt in this.deletedStates[u][Wt]={},this.stateChanges[u][Wt])this.deletedStates[u][Wt][Vt]=null;else this.deletedStates[u][Wt]=null;else this.deletedStates[u]=null}getState(u,F){const Wt=String(F),Kt=Vt.e({},(this.state[u]||{})[Wt],(this.stateChanges[u]||{})[Wt]);if(null===this.deletedStates[u])return{};if(this.deletedStates[u]){const Vt=this.deletedStates[u][F];if(null===Vt)return{};for(const u in Vt)delete Kt[u]}return Kt}initializeTileState(u,F){u.setFeatureState(this.state,F)}coalesceChanges(u,F){const Wt={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const F={};for(const Wt in this.stateChanges[u])this.state[u][Wt]||(this.state[u][Wt]={}),Vt.e(this.state[u][Wt],this.stateChanges[u][Wt]),F[Wt]=this.state[u][Wt];Wt[u]=F}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const F={};if(null===this.deletedStates[u])for(const Vt in this.state[u])F[Vt]={},this.state[u][Vt]={};else for(const Vt in this.deletedStates[u]){if(null===this.deletedStates[u][Vt])this.state[u][Vt]={};else for(const F of Object.keys(this.deletedStates[u][Vt]))delete this.state[u][Vt][F];F[Vt]=this.state[u][Vt]}Wt[u]=Wt[u]||{},Vt.e(Wt[u],F)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(Wt).length)for(const Vt in u)u[Vt].setFeatureState(Wt,F)}}class ht extends Vt.E{constructor(u,F,Vt){super(),this.id=u,this.dispatcher=Vt,this.on("data",(u=>this._dataHandler(u))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((u,F,Vt,Wt)=>{const Kt=new(et(F.type))(u,F,Vt,Wt);if(Kt.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${Kt.id}`);return Kt})(u,F,Vt,this),this._tiles={},this._cache=new nt(0,(u=>this._unloadTile(u))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new lt,this._didEmitContent=!1,this._updated=!1}onAdd(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._maxTileCacheZoomLevels=u?u._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(u)}onRemove(u){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(u)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const u in this._tiles){const F=this._tiles[u];if("loaded"!==F.state&&"errored"!==F.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(u,F,Wt){return Vt._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(u),this._tileLoaded(u,F,Wt)}catch(F){u.state="errored",404!==F.status?this._source.fire(new Vt.j(F,{tile:u})):this.update(this.transform,this.terrain)}}))}_unloadTile(u){this._source.unloadTile&&this._source.unloadTile(u)}_abortTile(u){this._source.abortTile&&this._source.abortTile(u),this._source.fire(new Vt.k("dataabort",{tile:u,coord:u.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const F in this._tiles){const Vt=this._tiles[F];Vt.upload(u),Vt.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((u=>u.tileID)).sort(ct).map((u=>u.key))}getRenderableIds(u){const F=[];for(const Vt in this._tiles)this._isIdRenderable(Vt,u)&&F.push(this._tiles[Vt]);return u?F.sort(((u,F)=>{const Wt=u.tileID,Kt=F.tileID,Qi=new Vt.P(Wt.canonical.x,Wt.canonical.y)._rotate(this.transform.angle),fr=new Vt.P(Kt.canonical.x,Kt.canonical.y)._rotate(this.transform.angle);return Wt.overscaledZ-Kt.overscaledZ||fr.y-Qi.y||fr.x-Qi.x})).map((u=>u.tileID.key)):F.map((u=>u.tileID)).sort(ct).map((u=>u.key))}hasRenderableParent(u){const F=this.findLoadedParent(u,0);return!!F&&this._isIdRenderable(F.tileID.key)}_isIdRenderable(u,F){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(F||!this._tiles[u].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)"errored"!==this._tiles[u].state&&this._reloadTile(u,"reloading")}}_reloadTile(u,F){return Vt._(this,void 0,void 0,(function*(){const Vt=this._tiles[u];Vt&&("loading"!==Vt.state&&(Vt.state=F),yield this._loadTile(Vt,u,F))}))}_tileLoaded(u,F,Wt){u.timeAdded=fr.now(),"expired"===Wt&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(F,u),"raster-dem"===this.getSource().type&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),u.aborted||this._source.fire(new Vt.k("data",{dataType:"source",tile:u,coord:u.tileID}))}_backfillDEM(u){const F=this.getRenderableIds();for(let Vt=0;Vt<F.length;Vt++){const Wt=F[Vt];if(u.neighboringTiles&&u.neighboringTiles[Wt]){const F=this.getTileByID(Wt);i(u,F),i(F,u)}}function i(u,F){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let Vt=F.tileID.canonical.x-u.tileID.canonical.x;const Wt=F.tileID.canonical.y-u.tileID.canonical.y,Kt=Math.pow(2,u.tileID.canonical.z),Qi=F.tileID.key;0===Vt&&0===Wt||Math.abs(Wt)>1||(Math.abs(Vt)>1&&(1===Math.abs(Vt+Kt)?Vt+=Kt:1===Math.abs(Vt-Kt)&&(Vt-=Kt)),F.dem&&u.dem&&(u.dem.backfillBorder(F.dem,Vt,Wt),u.neighboringTiles&&u.neighboringTiles[Qi]&&(u.neighboringTiles[Qi].backfilled=!0)))}}getTile(u){return this.getTileByID(u.key)}getTileByID(u){return this._tiles[u]}_retainLoadedChildren(u,F,Vt,Wt){for(const Kt in this._tiles){let Qi=this._tiles[Kt];if(Wt[Kt]||!Qi.hasData()||Qi.tileID.overscaledZ<=F||Qi.tileID.overscaledZ>Vt)continue;let fr=Qi.tileID;for(;Qi&&Qi.tileID.overscaledZ>F+1;){const u=Qi.tileID.scaledTo(Qi.tileID.overscaledZ-1);Qi=this._tiles[u.key],Qi&&Qi.hasData()&&(fr=u)}let _r=fr;for(;_r.overscaledZ>F;)if(_r=_r.scaledTo(_r.overscaledZ-1),u[_r.key]){Wt[fr.key]=fr;break}}}findLoadedParent(u,F){if(u.key in this._loadedParentTiles){const Vt=this._loadedParentTiles[u.key];return Vt&&Vt.tileID.overscaledZ>=F?Vt:null}for(let Vt=u.overscaledZ-1;Vt>=F;Vt--){const F=u.scaledTo(Vt),Wt=this._getLoadedTile(F);if(Wt)return Wt}}findLoadedSibling(u){return this._getLoadedTile(u)}_getLoadedTile(u){const F=this._tiles[u.key];return F&&F.hasData()?F:this._cache.getByKey(u.wrapped().key)}updateCacheSize(u){const F=Math.ceil(u.width/this._source.tileSize)+1,Wt=Math.ceil(u.height/this._source.tileSize)+1,Kt=Math.floor(F*Wt*(null===this._maxTileCacheZoomLevels?Vt.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),Qi="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,Kt):Kt;this._cache.setMaxSize(Qi)}handleWrapJump(u){const F=Math.round((u-(void 0===this._prevLng?u:this._prevLng))/360);if(this._prevLng=u,F){const u={};for(const Vt in this._tiles){const Wt=this._tiles[Vt];Wt.tileID=Wt.tileID.unwrapTo(Wt.tileID.wrap+F),u[Wt.tileID.key]=Wt}this._tiles=u;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(u,F,Vt,Wt,Kt,Qi){const _r={},Sr={},Ar=Object.keys(u),Jr=fr.now();for(const Vt of Ar){const Wt=u[Vt],Kt=this._tiles[Vt];if(!Kt||0!==Kt.fadeEndTime&&Kt.fadeEndTime<=Jr)continue;const Qi=this.findLoadedParent(Wt,F),fr=this.findLoadedSibling(Wt),Ar=Qi||fr||null;Ar&&(this._addTile(Ar.tileID),_r[Ar.tileID.key]=Ar.tileID),Sr[Vt]=Wt}this._retainLoadedChildren(Sr,Wt,Vt,u);for(const F in _r)u[F]||(this._coveredTiles[F]=!0,u[F]=_r[F]);if(Qi){const F={},Vt={};for(const u of Kt)this._tiles[u.key].hasData()?F[u.key]=u:Vt[u.key]=u;for(const Wt in Vt){const Kt=Vt[Wt].children(this._source.maxzoom);this._tiles[Kt[0].key]&&this._tiles[Kt[1].key]&&this._tiles[Kt[2].key]&&this._tiles[Kt[3].key]&&(F[Kt[0].key]=u[Kt[0].key]=Kt[0],F[Kt[1].key]=u[Kt[1].key]=Kt[1],F[Kt[2].key]=u[Kt[2].key]=Kt[2],F[Kt[3].key]=u[Kt[3].key]=Kt[3],delete Vt[Wt])}for(const Wt in Vt){const Kt=Vt[Wt],Qi=this.findLoadedParent(Kt,this._source.minzoom),fr=this.findLoadedSibling(Kt),_r=Qi||fr||null;if(_r){F[_r.tileID.key]=u[_r.tileID.key]=_r.tileID;for(const u in F)F[u].isChildOf(_r.tileID)&&delete F[u]}}for(const u in this._tiles)F[u]||(this._coveredTiles[u]=!0)}}update(u,F){if(!this._sourceLoaded||this._paused)return;let Wt;this.transform=u,this.terrain=F,this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?Wt=u.getVisibleUnwrappedCoordinates(this._source.tileID).map((u=>new Vt.Q(u.canonical.z,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y))):(Wt=u.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:F}),this._source.hasTile&&(Wt=Wt.filter((u=>this._source.hasTile(u))))):Wt=[];const Kt=u.coveringZoomLevel(this._source),Qi=Math.max(Kt-ht.maxOverzooming,this._source.minzoom),fr=Math.max(Kt+ht.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const u={};for(const F of Wt)if(F.canonical.z>this._source.minzoom){const Vt=F.scaledTo(F.canonical.z-1);u[Vt.key]=Vt;const Wt=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));u[Wt.key]=Wt}Wt=Wt.concat(Object.values(u))}const _r=0===Wt.length&&!this._updated&&this._didEmitContent;this._updated=!0,_r&&this.fire(new Vt.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const Sr=this._updateRetainedTiles(Wt,Kt);ut(this._source.type)&&this._updateCoveredAndRetainedTiles(Sr,Qi,fr,Kt,Wt,F);for(const u in Sr)this._tiles[u].clearFadeHold();const Ar=Vt.ab(this._tiles,Sr);for(const u of Ar){const F=this._tiles[u];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(u)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(u)}_updateRetainedTiles(u,F){var Vt;const Wt={},Kt={},Qi=Math.max(F-ht.maxOverzooming,this._source.minzoom),fr=Math.max(F+ht.maxUnderzooming,this._source.minzoom),_r={};for(const Vt of u){const u=this._addTile(Vt);Wt[Vt.key]=Vt,u.hasData()||F<this._source.maxzoom&&(_r[Vt.key]=Vt)}this._retainLoadedChildren(_r,F,fr,Wt);for(const fr of u){let u=this._tiles[fr.key];if(u.hasData())continue;if(F+1>this._source.maxzoom){const u=fr.children(this._source.maxzoom)[0],F=this.getTile(u);if(F&&F.hasData()){Wt[u.key]=u;continue}}else{const u=fr.children(this._source.maxzoom);if(Wt[u[0].key]&&Wt[u[1].key]&&Wt[u[2].key]&&Wt[u[3].key])continue}let _r=u.wasRequested();for(let F=fr.overscaledZ-1;F>=Qi;--F){const Qi=fr.scaledTo(F);if(Kt[Qi.key])break;if(Kt[Qi.key]=!0,u=this.getTile(Qi),!u&&_r&&(u=this._addTile(Qi)),u){const F=u.hasData();if((F||!(null===(Vt=this.map)||void 0===Vt?void 0:Vt.cancelPendingTileRequestsWhileZooming)||_r)&&(Wt[Qi.key]=Qi),_r=u.wasRequested(),F)break}}}return Wt}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const u in this._tiles){const F=[];let Vt,Wt=this._tiles[u].tileID;for(;Wt.overscaledZ>0;){if(Wt.key in this._loadedParentTiles){Vt=this._loadedParentTiles[Wt.key];break}F.push(Wt.key);const u=Wt.scaledTo(Wt.overscaledZ-1);if(Vt=this._getLoadedTile(u),Vt)break;Wt=u}for(const u of F)this._loadedParentTiles[u]=Vt}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const u in this._tiles){const F=this._tiles[u].tileID,Vt=this._getLoadedTile(F);this._loadedSiblingTiles[F.key]=Vt}}_addTile(u){let F=this._tiles[u.key];if(F)return F;F=this._cache.getAndRemove(u),F&&(this._setTileReloadTimer(u.key,F),F.tileID=u,this._state.initializeTileState(F,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,F)));const Wt=F;return F||(F=new rt(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(F,u.key,F.state)),F.uses++,this._tiles[u.key]=F,Wt||this._source.fire(new Vt.k("dataloading",{tile:F,coord:F.tileID,dataType:"source"})),F}_setTileReloadTimer(u,F){u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);const Vt=F.getExpiryTimeout();Vt&&(this._timers[u]=setTimeout((()=>{this._reloadTile(u,"expired"),delete this._timers[u]}),Vt))}_removeTile(u){const F=this._tiles[u];F&&(F.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),F.uses>0||(F.hasData()&&"reloading"!==F.state?this._cache.add(F.tileID,F,F.getExpiryTimeout()):(F.aborted=!0,this._abortTile(F),this._unloadTile(F))))}_dataHandler(u){const F=u.sourceDataType;"source"===u.dataType&&"metadata"===F&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===F&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const u in this._tiles)this._removeTile(u);this._cache.reset()}tilesIn(u,F,Wt){const Kt=[],Qi=this.transform;if(!Qi)return Kt;const fr=Wt?Qi.getCameraQueryGeometry(u):u,_r=u.map((u=>Qi.pointCoordinate(u,this.terrain))),Sr=fr.map((u=>Qi.pointCoordinate(u,this.terrain))),Ar=this.getIds();let Jr=1/0,zn=1/0,Qs=-1/0,ta=-1/0;for(const u of Sr)Jr=Math.min(Jr,u.x),zn=Math.min(zn,u.y),Qs=Math.max(Qs,u.x),ta=Math.max(ta,u.y);for(let u=0;u<Ar.length;u++){const Wt=this._tiles[Ar[u]];if(Wt.holdingForFade())continue;const fr=Wt.tileID,ia=Math.pow(2,Qi.zoom-Wt.tileID.overscaledZ),aa=F*Wt.queryPadding*Vt.W/Wt.tileSize/ia,va=[fr.getTilePoint(new Vt.Y(Jr,zn)),fr.getTilePoint(new Vt.Y(Qs,ta))];if(va[0].x-aa<Vt.W&&va[0].y-aa<Vt.W&&va[1].x+aa>=0&&va[1].y+aa>=0){const u=_r.map((u=>fr.getTilePoint(u))),F=Sr.map((u=>fr.getTilePoint(u)));Kt.push({tile:Wt,tileID:fr,queryGeometry:u,cameraQueryGeometry:F,scale:ia})}}return Kt}getVisibleCoordinates(u){const F=this.getRenderableIds(u).map((u=>this._tiles[u].tileID));for(const u of F)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return F}hasTransition(){if(this._source.hasTransition())return!0;if(ut(this._source.type)){const u=fr.now();for(const F in this._tiles)if(this._tiles[F].fadeEndTime>=u)return!0}return!1}setFeatureState(u,F,Vt){this._state.updateState(u=u||"_geojsonTileLayer",F,Vt)}removeFeatureState(u,F,Vt){this._state.removeFeatureState(u=u||"_geojsonTileLayer",F,Vt)}getFeatureState(u,F){return this._state.getState(u=u||"_geojsonTileLayer",F)}setDependencies(u,F,Vt){const Wt=this._tiles[u];Wt&&Wt.setDependencies(F,Vt)}reloadTilesForDependencies(u,F){for(const Vt in this._tiles)this._tiles[Vt].hasDependency(u,F)&&this._reloadTile(Vt,"reloading");this._cache.filter((Vt=>!Vt.hasDependency(u,F)))}}function ct(u,F){const Vt=Math.abs(2*u.wrap)-+(u.wrap<0),Wt=Math.abs(2*F.wrap)-+(F.wrap<0);return u.overscaledZ-F.overscaledZ||Wt-Vt||F.canonical.y-u.canonical.y||F.canonical.x-u.canonical.x}function ut(u){return"raster"===u||"image"===u||"video"===u}ht.maxOverzooming=10,ht.maxUnderzooming=3;class dt{constructor(u,F){this.reset(u,F)}reset(u,F){this.points=u||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(F||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(1===this.points.length)return this.points[0];u=Vt.ac(u,0,1);let F=1,Wt=this._distances[F];const Kt=u*this.paddedLength+this.padding;for(;Wt<Kt&&F<this._distances.length;)Wt=this._distances[++F];const Qi=F-1,fr=this._distances[Qi],_r=Wt-fr,Sr=_r>0?(Kt-fr)/_r:0;return this.points[Qi].mult(1-Sr).add(this.points[F].mult(Sr))}}function _t(u,F){let Vt=!0;return"always"===u||"never"!==u&&"never"!==F||(Vt=!1),Vt}class pt{constructor(u,F,Vt){const Wt=this.boxCells=[],Kt=this.circleCells=[];this.xCellCount=Math.ceil(u/Vt),this.yCellCount=Math.ceil(F/Vt);for(let u=0;u<this.xCellCount*this.yCellCount;u++)Wt.push([]),Kt.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=F,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/F,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,F,Vt,Wt,Kt){this._forEachCell(F,Vt,Wt,Kt,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(F),this.bboxes.push(Vt),this.bboxes.push(Wt),this.bboxes.push(Kt)}insertCircle(u,F,Vt,Wt){this._forEachCell(F-Wt,Vt-Wt,F+Wt,Vt+Wt,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(F),this.circles.push(Vt),this.circles.push(Wt)}_insertBoxCell(u,F,Vt,Wt,Kt,Qi){this.boxCells[Kt].push(Qi)}_insertCircleCell(u,F,Vt,Wt,Kt,Qi){this.circleCells[Kt].push(Qi)}_query(u,F,Vt,Wt,Kt,Qi,fr){if(Vt<0||u>this.width||Wt<0||F>this.height)return[];const _r=[];if(u<=0&&F<=0&&this.width<=Vt&&this.height<=Wt){if(Kt)return[{key:null,x1:u,y1:F,x2:Vt,y2:Wt}];for(let u=0;u<this.boxKeys.length;u++)_r.push({key:this.boxKeys[u],x1:this.bboxes[4*u],y1:this.bboxes[4*u+1],x2:this.bboxes[4*u+2],y2:this.bboxes[4*u+3]});for(let u=0;u<this.circleKeys.length;u++){const F=this.circles[3*u],Vt=this.circles[3*u+1],Wt=this.circles[3*u+2];_r.push({key:this.circleKeys[u],x1:F-Wt,y1:Vt-Wt,x2:F+Wt,y2:Vt+Wt})}}else this._forEachCell(u,F,Vt,Wt,this._queryCell,_r,{hitTest:Kt,overlapMode:Qi,seenUids:{box:{},circle:{}}},fr);return _r}query(u,F,Vt,Wt){return this._query(u,F,Vt,Wt,!1,null)}hitTest(u,F,Vt,Wt,Kt,Qi){return this._query(u,F,Vt,Wt,!0,Kt,Qi).length>0}hitTestCircle(u,F,Vt,Wt,Kt){const Qi=u-Vt,fr=u+Vt,_r=F-Vt,Sr=F+Vt;if(fr<0||Qi>this.width||Sr<0||_r>this.height)return!1;const Ar=[];return this._forEachCell(Qi,_r,fr,Sr,this._queryCellCircle,Ar,{hitTest:!0,overlapMode:Wt,circle:{x:u,y:F,radius:Vt},seenUids:{box:{},circle:{}}},Kt),Ar.length>0}_queryCell(u,F,Vt,Wt,Kt,Qi,fr,_r){const{seenUids:Sr,hitTest:Ar,overlapMode:Jr}=fr,zn=this.boxCells[Kt];if(null!==zn){const Kt=this.bboxes;for(const fr of zn)if(!Sr.box[fr]){Sr.box[fr]=!0;const zn=4*fr,Qs=this.boxKeys[fr];if(u<=Kt[zn+2]&&F<=Kt[zn+3]&&Vt>=Kt[zn+0]&&Wt>=Kt[zn+1]&&(!_r||_r(Qs))&&(!Ar||!_t(Jr,Qs.overlapMode))&&(Qi.push({key:Qs,x1:Kt[zn],y1:Kt[zn+1],x2:Kt[zn+2],y2:Kt[zn+3]}),Ar))return!0}}const Qs=this.circleCells[Kt];if(null!==Qs){const Kt=this.circles;for(const fr of Qs)if(!Sr.circle[fr]){Sr.circle[fr]=!0;const zn=3*fr,Qs=this.circleKeys[fr];if(this._circleAndRectCollide(Kt[zn],Kt[zn+1],Kt[zn+2],u,F,Vt,Wt)&&(!_r||_r(Qs))&&(!Ar||!_t(Jr,Qs.overlapMode))){const u=Kt[zn],F=Kt[zn+1],Vt=Kt[zn+2];if(Qi.push({key:Qs,x1:u-Vt,y1:F-Vt,x2:u+Vt,y2:F+Vt}),Ar)return!0}}}return!1}_queryCellCircle(u,F,Vt,Wt,Kt,Qi,fr,_r){const{circle:Sr,seenUids:Ar,overlapMode:Jr}=fr,zn=this.boxCells[Kt];if(null!==zn){const u=this.bboxes;for(const F of zn)if(!Ar.box[F]){Ar.box[F]=!0;const Vt=4*F,Wt=this.boxKeys[F];if(this._circleAndRectCollide(Sr.x,Sr.y,Sr.radius,u[Vt+0],u[Vt+1],u[Vt+2],u[Vt+3])&&(!_r||_r(Wt))&&!_t(Jr,Wt.overlapMode))return Qi.push(!0),!0}}const Qs=this.circleCells[Kt];if(null!==Qs){const u=this.circles;for(const F of Qs)if(!Ar.circle[F]){Ar.circle[F]=!0;const Vt=3*F,Wt=this.circleKeys[F];if(this._circlesCollide(u[Vt],u[Vt+1],u[Vt+2],Sr.x,Sr.y,Sr.radius)&&(!_r||_r(Wt))&&!_t(Jr,Wt.overlapMode))return Qi.push(!0),!0}}}_forEachCell(u,F,Vt,Wt,Kt,Qi,fr,_r){const Sr=this._convertToXCellCoord(u),Ar=this._convertToYCellCoord(F),Jr=this._convertToXCellCoord(Vt),zn=this._convertToYCellCoord(Wt);for(let Qs=Sr;Qs<=Jr;Qs++)for(let Sr=Ar;Sr<=zn;Sr++)if(Kt.call(this,u,F,Vt,Wt,this.xCellCount*Sr+Qs,Qi,fr,_r))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,F,Vt,Wt,Kt,Qi){const fr=Wt-u,_r=Kt-F,Sr=Vt+Qi;return Sr*Sr>fr*fr+_r*_r}_circleAndRectCollide(u,F,Vt,Wt,Kt,Qi,fr){const _r=(Qi-Wt)/2,Sr=Math.abs(u-(Wt+_r));if(Sr>_r+Vt)return!1;const Ar=(fr-Kt)/2,Jr=Math.abs(F-(Kt+Ar));if(Jr>Ar+Vt)return!1;if(Sr<=_r||Jr<=Ar)return!0;const zn=Sr-_r,Qs=Jr-Ar;return zn*zn+Qs*Qs<=Vt*Vt}}function mt(u,F,Wt,Kt,Qi){const fr=Vt.F();return F?(Vt.J(fr,fr,[1/Qi,1/Qi,1]),Wt||Vt.ad(fr,fr,Kt.angle)):Vt.K(fr,Kt.labelPlaneMatrix,u),fr}function ft(u,F,Wt,Kt,Qi){if(F){const F=Vt.ae(u);return Vt.J(F,F,[Qi,Qi,1]),Wt||Vt.ad(F,F,-Kt.angle),F}return Kt.glCoordMatrix}function gt(u,F,Wt){let Kt;Wt?(Kt=[u.x,u.y,Wt(u.x,u.y),1],Vt.af(Kt,Kt,F)):(Kt=[u.x,u.y,0,1],function(u,F,Vt){const Wt=F[0],Kt=F[1];u[0]=Vt[0]*Wt+Vt[4]*Kt+Vt[12],u[1]=Vt[1]*Wt+Vt[5]*Kt+Vt[13],u[3]=Vt[3]*Wt+Vt[7]*Kt+Vt[15]}(Kt,Kt,F));const Qi=Kt[3];return{point:new Vt.P(Kt[0]/Qi,Kt[1]/Qi),signedDistanceFromCamera:Qi,isOccluded:!1}}function vt(u,F){return.5+u/F*.5}function xt(u,F){return u.x>=-F[0]&&u.x<=F[0]&&u.y>=-F[1]&&u.y<=F[1]}function yt(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa){const va=Kt?u.textSizeData:u.iconSizeData,Ba=Vt.ag(va,Wt.transform.zoom),Ya=[256/Wt.width*2+1,256/Wt.height*2+1],to=Kt?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;to.clear();const eo=u.lineVertexArray,io=Kt?u.text.placedSymbolArray:u.icon.placedSymbolArray,so=Wt.transform.width/Wt.transform.height;let co=!1;for(let Kt=0;Kt<io.length;Kt++){const ho=io.get(Kt);if(ho.hidden||ho.writingMode===Vt.ah.vertical&&!co){zt(ho.numGlyphs,to);continue}co=!1;const bo=gt(new Vt.P(ho.anchorX,ho.anchorY),F,aa);if(!xt(bo.point,Ya)){zt(ho.numGlyphs,to);continue}const wo=vt(Wt.transform.cameraToCenterDistance,bo.signedDistanceFromCamera),So=Vt.ai(va,Ba,ho),Ao=_r?So/wo:So*wo,ko={getElevation:aa,labelPlaneMatrix:Qi,lineVertexArray:eo,pitchWithMap:_r,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:Jr,tileAnchorPoint:new Vt.P(ho.anchorX,ho.anchorY),unwrappedTileID:zn,width:Qs,height:ta,translation:ia},Wo=Tt(ko,ho,Ao,!1,Sr,F,fr,u.glyphOffsetArray,to,so,Ar);co=Wo.useVertical,(Wo.notEnoughRoom||co||Wo.needsFlipping&&Tt(ko,ho,Ao,!0,Sr,F,fr,u.glyphOffsetArray,to,so,Ar).notEnoughRoom)&&zt(ho.numGlyphs,to)}Kt?u.text.dynamicLayoutVertexBuffer.updateData(to):u.icon.dynamicLayoutVertexBuffer.updateData(to)}function bt(u,F,Vt,Wt,Kt,Qi,fr,_r){const Sr=Qi.glyphStartIndex+Qi.numGlyphs,Ar=Qi.lineStartIndex,Jr=Qi.lineStartIndex+Qi.lineLength,zn=F.getoffsetX(Qi.glyphStartIndex),Qs=F.getoffsetX(Sr-1),ta=Dt(u*zn,Vt,Wt,Kt,Qi.segment,Ar,Jr,_r,fr);if(!ta)return null;const ia=Dt(u*Qs,Vt,Wt,Kt,Qi.segment,Ar,Jr,_r,fr);return ia?_r.projectionCache.anyProjectionOccluded?null:{first:ta,last:ia}:null}function wt(u,F,Wt,Kt){return u===Vt.ah.horizontal&&Math.abs(Wt.y-F.y)>Math.abs(Wt.x-F.x)*Kt?{useVertical:!0}:(u===Vt.ah.vertical?F.y<Wt.y:F.x>Wt.x)?{needsFlipping:!0}:null}function Tt(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn){const Qs=Wt/24,ta=F.lineOffsetX*Qs,ia=F.lineOffsetY*Qs;let aa;if(F.numGlyphs>1){const Vt=F.glyphStartIndex+F.numGlyphs,Wt=F.lineStartIndex,fr=F.lineStartIndex+F.lineLength,Ar=bt(Qs,Sr,ta,ia,Kt,F,zn,u);if(!Ar)return{notEnoughRoom:!0};const va=gt(Ar.first.point,_r,u.getElevation).point,Ba=gt(Ar.last.point,_r,u.getElevation).point;if(Qi&&!Kt){const u=wt(F.writingMode,va,Ba,Jr);if(u)return u}aa=[Ar.first];for(let Qi=F.glyphStartIndex+1;Qi<Vt-1;Qi++)aa.push(Dt(Qs*Sr.getoffsetX(Qi),ta,ia,Kt,F.segment,Wt,fr,u,zn));aa.push(Ar.last)}else{if(Qi&&!Kt){const Wt=gt(u.tileAnchorPoint,fr,u.getElevation).point,Kt=F.lineStartIndex+F.segment+1,Qi=new Vt.P(u.lineVertexArray.getx(Kt),u.lineVertexArray.gety(Kt)),_r=gt(Qi,fr,u.getElevation),Sr=_r.signedDistanceFromCamera>0?_r.point:function(u,F,Vt,Wt,Kt,Qi){return It(u,F,Vt,1,Kt,Qi)}(u.tileAnchorPoint,Qi,Wt,0,fr,u),Ar=wt(F.writingMode,Wt,Sr,Jr);if(Ar)return Ar}const Wt=Dt(Qs*Sr.getoffsetX(F.glyphStartIndex),ta,ia,Kt,F.segment,F.lineStartIndex,F.lineStartIndex+F.lineLength,u,zn);if(!Wt||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};aa=[Wt]}for(const u of aa)Vt.aj(Ar,u.point,u.angle);return{}}function It(u,F,Vt,Wt,Kt,Qi){const fr=u.add(u.sub(F)._unit()),_r=void 0!==Kt?gt(fr,Kt,Qi.getElevation).point:Pt(fr.x,fr.y,Qi).point,Sr=Vt.sub(_r);return Vt.add(Sr._mult(Wt/Sr.mag()))}function Et(u,F,Wt){const Kt=F.projectionCache;if(Kt.projections[u])return Kt.projections[u];const Qi=new Vt.P(F.lineVertexArray.getx(u),F.lineVertexArray.gety(u)),fr=Pt(Qi.x,Qi.y,F);if(fr.signedDistanceFromCamera>0)return Kt.projections[u]=fr.point,Kt.anyProjectionOccluded=Kt.anyProjectionOccluded||fr.isOccluded,fr.point;const _r=u-Wt.direction;return function(u,F,Vt,Wt,Kt){return It(u,F,Vt,Wt,void 0,Kt)}(0===Wt.distanceFromAnchor?F.tileAnchorPoint:new Vt.P(F.lineVertexArray.getx(_r),F.lineVertexArray.gety(_r)),Qi,Wt.previousVertex,Wt.absOffsetX-Wt.distanceFromAnchor+1,F)}function Pt(u,F,Wt){const Kt=u+Wt.translation[0],Qi=F+Wt.translation[1];let fr;return!Wt.pitchWithMap&&Wt.projection.useSpecialProjectionForSymbols?(fr=Wt.projection.projectTileCoordinates(Kt,Qi,Wt.unwrappedTileID,Wt.getElevation),fr.point.x=(.5*fr.point.x+.5)*Wt.width,fr.point.y=(.5*-fr.point.y+.5)*Wt.height):(fr=gt(new Vt.P(Kt,Qi),Wt.labelPlaneMatrix,Wt.getElevation),fr.isOccluded=!1),fr}function Ct(u,F,Vt){return u._unit()._perp()._mult(F*Vt)}function St(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar){if(Sr.projectionCache.offsets[u])return Sr.projectionCache.offsets[u];const Jr=Wt.add(F);if(u+Ar.direction<Kt||u+Ar.direction>=Qi)return Sr.projectionCache.offsets[u]=Jr,Jr;const zn=Et(u+Ar.direction,Sr,Ar),Qs=Ct(zn.sub(Wt),_r,Ar.direction),ta=Wt.add(Qs),ia=zn.add(Qs);return Sr.projectionCache.offsets[u]=Vt.ak(fr,Jr,ta,ia)||Jr,Sr.projectionCache.offsets[u]}function Dt(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){const Ar=Wt?u-F:u+F;let Jr=Ar>0?1:-1,zn=0;Wt&&(Jr*=-1,zn=Math.PI),Jr<0&&(zn+=Math.PI);let Qs,ta=Jr>0?Qi+Kt:Qi+Kt+1;_r.projectionCache.cachedAnchorPoint?Qs=_r.projectionCache.cachedAnchorPoint:(Qs=Pt(_r.tileAnchorPoint.x,_r.tileAnchorPoint.y,_r).point,_r.projectionCache.cachedAnchorPoint=Qs);let ia,aa,va=Qs,Ba=Qs,Ya=0,to=0;const eo=Math.abs(Ar),io=[];let so;for(;Ya+to<=eo;){if(ta+=Jr,ta<Qi||ta>=fr)return null;Ya+=to,Ba=va,aa=ia;const u={absOffsetX:eo,direction:Jr,distanceFromAnchor:Ya,previousVertex:Ba};if(va=Et(ta,_r,u),0===Vt)io.push(Ba),so=va.sub(Ba);else{let F;const Wt=va.sub(Ba);F=0===Wt.mag()?Ct(Et(ta+Jr,_r,u).sub(va),Vt,Jr):Ct(Wt,Vt,Jr),aa||(aa=Ba.add(F)),ia=St(ta,F,va,Qi,fr,aa,Vt,_r,u),io.push(aa),so=ia.sub(aa)}to=so.mag()}const co=so._mult((eo-Ya)/to)._add(aa||Ba),ho=zn+Math.atan2(va.y-Ba.y,va.x-Ba.x);return io.push(co),{point:co,angle:Sr?ho:0,path:io}}const ho=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function zt(u,F){for(let Vt=0;Vt<u;Vt++){const u=F.length;F.resize(u+4),F.float32.set(ho,3*u)}}const bo=100;class Rt{constructor(u,F,Vt=new pt(u.width+200,u.height+200,25),Wt=new pt(u.width+200,u.height+200,25)){this.transform=u,this.mapProjection=F,this.grid=Vt,this.ignoredGrid=Wt,this.pitchFactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+bo,this.screenBottomBoundary=u.height+bo,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr){const zn=u.anchorPointX+_r[0],Qs=u.anchorPointY+_r[1],ta=this.projectAndGetPerspectiveRatio(Wt,zn,Qs,Kt,Ar),ia=this._projectCollisionBox(u,Vt,Wt,Kt,Qi,fr,_r,ta,Ar,Jr),[aa,va,Ba,Ya]=ia.box;return this.mapProjection.useSpecialProjectionForSymbols&&(Qi?ia.allPointsOccluded:this.mapProjection.isOccluded(zn,Qs,Kt))||ta.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(aa,va,Ba,Ya)||"always"!==F&&this.grid.hitTest(aa,va,Ba,Ya,F,Sr)?{box:[aa,va,Ba,Ya],placeable:!1,offscreen:!1}:{box:[aa,va,Ba,Ya],placeable:!0,offscreen:this.isOffscreen(aa,va,Ba,Ya)}}placeCollisionCircles(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va){const Ba=[],Ya=new Vt.P(F.anchorX,F.anchorY),to=this.getPerspectiveRatio(fr,Ya.x,Ya.y,_r,va),eo=(zn?Qi/to:Qi*to)/Vt.ap,io={getElevation:va,labelPlaneMatrix:Sr,lineVertexArray:Wt,pitchWithMap:zn,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ya,unwrappedTileID:_r,width:this.transform.width,height:this.transform.height,translation:aa},so=bt(eo,Kt,F.lineOffsetX*eo,F.lineOffsetY*eo,!1,F,!1,io);let co=!1,ho=!1,wo=!0;if(so){const F=.5*ta*to+ia,Wt=new Vt.P(-100,-100),Kt=new Vt.P(this.screenRightBoundary,this.screenBottomBoundary),Qi=new dt,fr=so.first,_r=so.last;let Sr=[];for(let u=fr.path.length-1;u>=1;u--)Sr.push(fr.path[u]);for(let u=1;u<_r.path.length;u++)Sr.push(_r.path[u]);const zn=2.5*F;if(Ar){const u=this.projectPathToScreenSpace(Sr,io,Ar);Sr=u.some((u=>u.signedDistanceFromCamera<=0))?[]:u.map((u=>u.point))}let aa=[];if(Sr.length>0){const u=Sr[0].clone(),F=Sr[0].clone();for(let Vt=1;Vt<Sr.length;Vt++)u.x=Math.min(u.x,Sr[Vt].x),u.y=Math.min(u.y,Sr[Vt].y),F.x=Math.max(F.x,Sr[Vt].x),F.y=Math.max(F.y,Sr[Vt].y);aa=u.x>=Wt.x&&F.x<=Kt.x&&u.y>=Wt.y&&F.y<=Kt.y?[Sr]:F.x<Wt.x||u.x>Kt.x||F.y<Wt.y||u.y>Kt.y?[]:Vt.al([Sr],Wt.x,Wt.y,Kt.x,Kt.y)}for(const Vt of aa){Qi.reset(Vt,.25*F);let Wt=0;Wt=Qi.length<=.5*F?1:Math.ceil(Qi.paddedLength/zn)+1;for(let Vt=0;Vt<Wt;Vt++){const Kt=Vt/Math.max(Wt-1,1),fr=Qi.lerp(Kt),_r=fr.x+bo,Sr=fr.y+bo;Ba.push(_r,Sr,F,0);const Ar=_r-F,zn=Sr-F,ta=_r+F,ia=Sr+F;if(wo=wo&&this.isOffscreen(Ar,zn,ta,ia),ho=ho||this.isInsideGrid(Ar,zn,ta,ia),"always"!==u&&this.grid.hitTestCircle(_r,Sr,F,u,Qs)&&(co=!0,!Jr))return{circles:[],offscreen:!1,collisionDetected:co}}}}return{circles:!Jr&&co||!ho||to<this.perspectiveRatioCutoff?[]:Ba,offscreen:wo,collisionDetected:co}}projectPathToScreenSpace(u,F,Vt){return u.map((u=>gt(u,Vt,F.getElevation)))}queryRenderedSymbols(u){if(0===u.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const F=[];let Wt=1/0,Kt=1/0,Qi=-1/0,fr=-1/0;for(const _r of u){const u=new Vt.P(_r.x+bo,_r.y+bo);Wt=Math.min(Wt,u.x),Kt=Math.min(Kt,u.y),Qi=Math.max(Qi,u.x),fr=Math.max(fr,u.y),F.push(u)}const _r=this.grid.query(Wt,Kt,Qi,fr).concat(this.ignoredGrid.query(Wt,Kt,Qi,fr)),Sr={},Ar={};for(const u of _r){const Wt=u.key;if(void 0===Sr[Wt.bucketInstanceId]&&(Sr[Wt.bucketInstanceId]={}),Sr[Wt.bucketInstanceId][Wt.featureIndex])continue;const Kt=[new Vt.P(u.x1,u.y1),new Vt.P(u.x2,u.y1),new Vt.P(u.x2,u.y2),new Vt.P(u.x1,u.y2)];Vt.am(F,Kt)&&(Sr[Wt.bucketInstanceId][Wt.featureIndex]=!0,void 0===Ar[Wt.bucketInstanceId]&&(Ar[Wt.bucketInstanceId]=[]),Ar[Wt.bucketInstanceId].push(Wt.featureIndex))}return Ar}insertCollisionBox(u,F,Vt,Wt,Kt,Qi){(Vt?this.ignoredGrid:this.grid).insert({bucketInstanceId:Wt,featureIndex:Kt,collisionGroupID:Qi,overlapMode:F},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,F,Vt,Wt,Kt,Qi){const fr=Vt?this.ignoredGrid:this.grid,_r={bucketInstanceId:Wt,featureIndex:Kt,collisionGroupID:Qi,overlapMode:F};for(let F=0;F<u.length;F+=4)fr.insertCircle(_r,u[F],u[F+1],u[F+2])}projectAndGetPerspectiveRatio(u,F,Wt,Kt,Qi){const fr=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(F,Wt,Kt,Qi):gt(new Vt.P(F,Wt),u,Qi);return{point:new Vt.P((fr.point.x+1)/2*this.transform.width+bo,(1-fr.point.y)/2*this.transform.height+bo),perspectiveRatio:.5+this.transform.cameraToCenterDistance/fr.signedDistanceFromCamera*.5,isOccluded:fr.isOccluded,signedDistanceFromCamera:fr.signedDistanceFromCamera}}getPerspectiveRatio(u,F,Wt,Kt,Qi){const fr=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(F,Wt,Kt,Qi):gt(new Vt.P(F,Wt),u,Qi);return.5+this.transform.cameraToCenterDistance/fr.signedDistanceFromCamera*.5}isOffscreen(u,F,Vt,Wt){return Vt<bo||u>=this.screenRightBoundary||Wt<bo||F>this.screenBottomBoundary}isInsideGrid(u,F,Vt,Wt){return Vt>=0&&u<this.gridRightBoundary&&Wt>=0&&F<this.gridBottomBoundary}getViewportMatrix(){const u=Vt.an([]);return Vt.H(u,u,[-100,-100,0]),u}_projectCollisionBox(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr){const zn=F*Sr.perspectiveRatio;let Qs=new Vt.P(1,0),ta=new Vt.P(0,1);const ia=new Vt.P(u.anchorPointX+_r[0],u.anchorPointY+_r[1]);if(fr&&!Qi){const u=this.projectAndGetPerspectiveRatio(Wt,ia.x+1,ia.y,Kt,Ar).point.sub(Sr.point).unit(),F=Math.atan(u.y/u.x)+(u.x<0?Math.PI:0),Qi=Math.sin(F),fr=Math.cos(F);Qs=new Vt.P(fr,Qi),ta=new Vt.P(-Qi,fr)}else if(!fr&&Qi){const u=-this.transform.angle,F=Math.sin(u),Wt=Math.cos(u);Qs=new Vt.P(Wt,F),ta=new Vt.P(-F,Wt)}let aa=Sr.point,va=zn;if(Qi){aa=ia;const u=this.transform.zoom-Math.floor(this.transform.zoom);va=Math.pow(2,-u),va*=this.mapProjection.getPitchedTextCorrection(this.transform,ia,Kt),Jr||(va*=Vt.ac(.5+Sr.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}Jr&&(aa=aa.add(Qs.mult(Jr.x*va)).add(ta.mult(Jr.y*va)));const Ba=u.x1*va,Ya=u.x2*va,to=(Ba+Ya)/2,eo=u.y1*va,io=u.y2*va,so=(eo+io)/2,co=[{offsetX:Ba,offsetY:eo},{offsetX:to,offsetY:eo},{offsetX:Ya,offsetY:eo},{offsetX:Ya,offsetY:so},{offsetX:Ya,offsetY:io},{offsetX:to,offsetY:io},{offsetX:Ba,offsetY:io},{offsetX:Ba,offsetY:so}];let ho=[];for(const{offsetX:u,offsetY:F}of co)ho.push(new Vt.P(aa.x+Qs.x*u+ta.x*F,aa.y+Qs.y*u+ta.y*F));let bo=!1;if(Qi){const u=ho.map((u=>this.projectAndGetPerspectiveRatio(Wt,u.x,u.y,Kt,Ar)));bo=u.some((u=>!u.isOccluded)),ho=u.map((u=>u.point))}else bo=!0;return{box:Vt.ao(ho),allPointsOccluded:!bo}}}function Lt(u,F,Wt){return F*(Vt.W/(u.tileSize*Math.pow(2,Wt-u.tileID.overscaledZ)))}class kt{constructor(u,F,Vt,Wt){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?F:-F))):Wt&&Vt?1:0,this.placed=Vt}isHidden(){return 0===this.opacity&&!this.placed}}class Ft{constructor(u,F,Vt,Wt,Kt){this.text=new kt(u?u.text:null,F,Vt,Kt),this.icon=new kt(u?u.icon:null,F,Wt,Kt)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bt{constructor(u,F,Vt){this.text=u,this.icon=F,this.skipFade=Vt}}class Ot{constructor(){this.invProjMatrix=Vt.F(),this.viewportMatrix=Vt.F(),this.circles=[]}}class Nt{constructor(u,F,Vt,Wt,Kt){this.bucketInstanceId=u,this.featureIndex=F,this.sourceLayerIndex=Vt,this.bucketIndex=Wt,this.tileID=Kt}}class jt{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const F=++this.maxGroupID;this.collisionGroups[u]={ID:F,predicate:u=>u.collisionGroupID===F}}return this.collisionGroups[u]}}function Ut(u,F,Wt,Kt,Qi){const{horizontalAlign:fr,verticalAlign:_r}=Vt.au(u);return new Vt.P(-(fr-.5)*F+Kt[0]*Qi,-(_r-.5)*Wt+Kt[1]*Qi)}class Zt{constructor(u,F,Vt,Wt,Kt,Qi){this.transform=u.clone(),this.terrain=Vt,this.collisionIndex=new Rt(this.transform,F),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=Wt,this.retainedQueryData={},this.collisionGroups=new jt(Kt),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=Qi,Qi&&(Qi.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(u){const F=this.terrain;return F?(Vt,Wt)=>F.getElevation(u,Vt,Wt):null}getBucketParts(u,F,Wt,Kt){const Qi=Wt.getBucket(F),fr=Wt.latestFeatureIndex;if(!Qi||!fr||F.id!==Qi.layerIds[0])return;const _r=Wt.collisionBoxArray,Sr=Qi.layers[0].layout,Ar=Qi.layers[0].paint,Jr=Math.pow(2,this.transform.zoom-Wt.tileID.overscaledZ),zn=Wt.tileSize/Vt.W,Qs=Wt.tileID.toUnwrapped(),ta=this.transform.calculatePosMatrix(Qs),ia="map"===Sr.get("text-pitch-alignment"),aa="map"===Sr.get("text-rotation-alignment"),va=Lt(Wt,1,this.transform.zoom),Ba=this.collisionIndex.mapProjection.translatePosition(this.transform,Wt,Ar.get("text-translate"),Ar.get("text-translate-anchor")),Ya=this.collisionIndex.mapProjection.translatePosition(this.transform,Wt,Ar.get("icon-translate"),Ar.get("icon-translate-anchor")),to=mt(ta,ia,aa,this.transform,va);let eo=null;if(ia){const u=ft(ta,ia,aa,this.transform,va);eo=Vt.K([],this.transform.labelPlaneMatrix,u)}this.retainedQueryData[Qi.bucketInstanceId]=new Nt(Qi.bucketInstanceId,fr,Qi.sourceLayerIndex,Qi.index,Wt.tileID);const io={bucket:Qi,layout:Sr,translationText:Ba,translationIcon:Ya,posMatrix:ta,unwrappedTileID:Qs,textLabelPlaneMatrix:to,labelToScreenMatrix:eo,scale:Jr,textPixelRatio:zn,holdingForFade:Wt.holdingForFade(),collisionBoxArray:_r,partiallyEvaluatedTextSize:Vt.ag(Qi.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(Qi.sourceID)};if(Kt)for(const F of Qi.sortKeyRanges){const{sortKey:Vt,symbolInstanceStart:Wt,symbolInstanceEnd:Kt}=F;u.push({sortKey:Vt,symbolInstanceStart:Wt,symbolInstanceEnd:Kt,parameters:io})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:Qi.symbolInstances.length,parameters:io})}attemptAnchorPlacement(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va,Ba,Ya,to){const eo=Vt.aq[u.textAnchor],io=[u.textOffset0,u.textOffset1],so=Ut(eo,Wt,Kt,io,Qi),co=this.collisionIndex.placeCollisionBox(F,Qs,Sr,Ar,Jr,_r,fr,va,zn.predicate,to,so);if((!Ya||this.collisionIndex.placeCollisionBox(Ya,Qs,Sr,Ar,Jr,_r,fr,Ba,zn.predicate,to,so).placeable)&&co.placeable){let u;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ta.crossTileID]&&this.prevPlacement.placements[ta.crossTileID]&&this.prevPlacement.placements[ta.crossTileID].text&&(u=this.prevPlacement.variableOffsets[ta.crossTileID].anchor),0===ta.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ta.crossTileID]={textOffset:io,width:Wt,height:Kt,anchor:eo,textBoxScale:Qi,prevAnchor:u},this.markUsedJustification(ia,eo,ta,aa),ia.allowVerticalPlacement&&(this.markUsedOrientation(ia,aa,ta),this.placedOrientations[ta.crossTileID]=aa),{shift:so,placedGlyphBoxes:co}}}placeLayerBucketPart(u,F,Wt){const{bucket:Kt,layout:Qi,translationText:fr,translationIcon:_r,posMatrix:Sr,unwrappedTileID:Ar,textLabelPlaneMatrix:Jr,labelToScreenMatrix:zn,textPixelRatio:Qs,holdingForFade:ta,collisionBoxArray:ia,partiallyEvaluatedTextSize:aa,collisionGroup:va}=u.parameters,Ba=Qi.get("text-optional"),Ya=Qi.get("icon-optional"),to=Vt.ar(Qi,"text-overlap","text-allow-overlap"),eo="always"===to,io=Vt.ar(Qi,"icon-overlap","icon-allow-overlap"),so="always"===io,co="map"===Qi.get("text-rotation-alignment"),ho="map"===Qi.get("text-pitch-alignment"),bo="none"!==Qi.get("icon-text-fit"),wo="viewport-y"===Qi.get("symbol-z-order"),So=eo&&(so||!Kt.hasIconData()||Ya),Ao=so&&(eo||!Kt.hasTextData()||Ba);!Kt.collisionArrays&&ia&&Kt.deserializeCollisionBoxes(ia);const ko=this._getTerrainElevationFunc(this.retainedQueryData[Kt.bucketInstanceId].tileID),M=(u,ia,so)=>{var wo,Wo;if(F[u.crossTileID])return;if(ta)return void(this.placements[u.crossTileID]=new Bt(!1,!1,!1));let il=!1,rl=!1,nl=!0,al=null,ol={box:null,placeable:!1,offscreen:null},ll={box:null,placeable:!1,offscreen:null},cl=null,hl=null,ul=null,ml=0,_l=0,yl=0;ia.textFeatureIndex?ml=ia.textFeatureIndex:u.useRuntimeCollisionCircles&&(ml=u.featureIndex),ia.verticalTextFeatureIndex&&(_l=ia.verticalTextFeatureIndex);const vl=ia.textBox;if(vl){const i=F=>{let Wt=Vt.ah.horizontal;if(Kt.allowVerticalPlacement&&!F&&this.prevPlacement){const F=this.prevPlacement.placedOrientations[u.crossTileID];F&&(this.placedOrientations[u.crossTileID]=F,Wt=F,this.markUsedOrientation(Kt,Wt,u))}return Wt},o=(F,Wt)=>{if(Kt.allowVerticalPlacement&&u.numVerticalGlyphVertices>0&&ia.verticalTextBox){for(const u of Kt.writingModes)if(u===Vt.ah.vertical?(ol=Wt(),ll=ol):ol=F(),ol&&ol.placeable)break}else ol=F()},F=u.textAnchorOffsetStartIndex,Qi=u.textAnchorOffsetEndIndex;if(Qi===F){const a=(F,Vt)=>{const Wt=this.collisionIndex.placeCollisionBox(F,to,Qs,Sr,Ar,ho,co,fr,va.predicate,ko);return Wt&&Wt.placeable&&(this.markUsedOrientation(Kt,Vt,u),this.placedOrientations[u.crossTileID]=Vt),Wt};o((()=>a(vl,Vt.ah.horizontal)),(()=>{const F=ia.verticalTextBox;return Kt.allowVerticalPlacement&&u.numVerticalGlyphVertices>0&&F?a(F,Vt.ah.vertical):{box:null,offscreen:null}})),i(ol&&ol.placeable)}else{let Jr=Vt.aq[null===(Wo=null===(wo=this.prevPlacement)||void 0===wo?void 0:wo.variableOffsets[u.crossTileID])||void 0===Wo?void 0:Wo.anchor];const m=(zn,ta,ia)=>{const aa=zn.x2-zn.x1,Ba=zn.y2-zn.y1,Ya=u.textBoxScale,eo=bo&&"never"===io?ta:null;let so=null,wo="never"===to?1:2,So="never";Jr&&wo++;for(let Vt=0;Vt<wo;Vt++){for(let Vt=F;Vt<Qi;Vt++){const F=Kt.textAnchorOffsets.get(Vt);if(Jr&&F.textAnchor!==Jr)continue;const Wt=this.attemptAnchorPlacement(F,zn,aa,Ba,Ya,co,ho,Qs,Sr,Ar,va,So,u,Kt,ia,fr,_r,eo,ko);if(Wt&&(so=Wt.placedGlyphBoxes,so&&so.placeable))return il=!0,al=Wt.shift,so}Jr?Jr=null:So=to}return Wt&&!so&&(so={box:this.collisionIndex.placeCollisionBox(vl,"always",Qs,Sr,Ar,ho,co,fr,va.predicate,ko,new Vt.P(0,0)).box,offscreen:!1,placeable:!1}),so};o((()=>m(vl,ia.iconBox,Vt.ah.horizontal)),(()=>{const F=ia.verticalTextBox;return Kt.allowVerticalPlacement&&(!ol||!ol.placeable)&&u.numVerticalGlyphVertices>0&&F?m(F,ia.verticalIconBox,Vt.ah.vertical):{box:null,occluded:!0,offscreen:null}})),ol&&(il=ol.placeable,nl=ol.offscreen);const zn=i(ol&&ol.placeable);if(!il&&this.prevPlacement){const F=this.prevPlacement.variableOffsets[u.crossTileID];F&&(this.variableOffsets[u.crossTileID]=F,this.markUsedJustification(Kt,F.anchor,u,zn))}}}if(cl=ol,il=cl&&cl.placeable,nl=cl&&cl.offscreen,u.useRuntimeCollisionCircles){const F=Kt.text.placedSymbolArray.get(u.centerJustifiedTextSymbolIndex),_r=Vt.ai(Kt.textSizeData,aa,F),Qs=Qi.get("text-padding");hl=this.collisionIndex.placeCollisionCircles(to,F,Kt.lineVertexArray,Kt.glyphOffsetArray,_r,Sr,Ar,Jr,zn,Wt,ho,va.predicate,u.collisionCircleDiameter,Qs,fr,ko),hl.circles.length&&hl.collisionDetected&&!Wt&&Vt.w("Collisions detected, but collision boxes are not shown"),il=eo||hl.circles.length>0&&!hl.collisionDetected,nl=nl&&hl.offscreen}if(ia.iconFeatureIndex&&(yl=ia.iconFeatureIndex),ia.iconBox){const t=u=>this.collisionIndex.placeCollisionBox(u,io,Qs,Sr,Ar,ho,co,_r,va.predicate,ko,bo&&al?al:void 0);ll&&ll.placeable&&ia.verticalIconBox?(ul=t(ia.verticalIconBox),rl=ul.placeable):(ul=t(ia.iconBox),rl=ul.placeable),nl=nl&&ul.offscreen}const wl=Ba||0===u.numHorizontalGlyphVertices&&0===u.numVerticalGlyphVertices,Tl=Ya||0===u.numIconVertices;wl||Tl?Tl?wl||(rl=rl&&il):il=rl&&il:rl=il=rl&&il;const Il=rl&&ul.placeable;if(il&&cl.placeable&&this.collisionIndex.insertCollisionBox(cl.box,to,Qi.get("text-ignore-placement"),Kt.bucketInstanceId,ll&&ll.placeable&&_l?_l:ml,va.ID),Il&&this.collisionIndex.insertCollisionBox(ul.box,io,Qi.get("icon-ignore-placement"),Kt.bucketInstanceId,yl,va.ID),hl&&il&&this.collisionIndex.insertCollisionCircles(hl.circles,to,Qi.get("text-ignore-placement"),Kt.bucketInstanceId,ml,va.ID),Wt&&this.storeCollisionData(Kt.bucketInstanceId,so,ia,cl,ul,hl),0===u.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===Kt.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[u.crossTileID]=new Bt(il||So,rl||Ao,nl||Kt.justReloaded),F[u.crossTileID]=!0};if(wo){if(0!==u.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const F=Kt.getSortedSymbolIndexes(this.transform.angle);for(let u=F.length-1;u>=0;--u){const Vt=F[u];M(Kt.symbolInstances.get(Vt),Kt.collisionArrays[Vt],Vt)}}else for(let F=u.symbolInstanceStart;F<u.symbolInstanceEnd;F++)M(Kt.symbolInstances.get(F),Kt.collisionArrays[F],F);if(Wt&&Kt.bucketInstanceId in this.collisionCircleArrays){const u=this.collisionCircleArrays[Kt.bucketInstanceId];Vt.as(u.invProjMatrix,Sr),u.viewportMatrix=this.collisionIndex.getViewportMatrix()}Kt.justReloaded=!1}storeCollisionData(u,F,Vt,Wt,Kt,Qi){if(Vt.textBox||Vt.iconBox){let Qi,fr;this.collisionBoxArrays.has(u)?Qi=this.collisionBoxArrays.get(u):(Qi=new Map,this.collisionBoxArrays.set(u,Qi)),Qi.has(F)?fr=Qi.get(F):(fr={text:null,icon:null},Qi.set(F,fr)),Vt.textBox&&(fr.text=Wt.box),Vt.iconBox&&(fr.icon=Kt.box)}if(Qi){let F=this.collisionCircleArrays[u];void 0===F&&(F=this.collisionCircleArrays[u]=new Ot);for(let u=0;u<Qi.circles.length;u+=4)F.circles.push(Qi.circles[u+0]),F.circles.push(Qi.circles[u+1]),F.circles.push(Qi.circles[u+2]),F.circles.push(Qi.collisionDetected?1:0)}}markUsedJustification(u,F,Wt,Kt){let Qi;Qi=Kt===Vt.ah.vertical?Wt.verticalPlacedTextSymbolIndex:{left:Wt.leftJustifiedTextSymbolIndex,center:Wt.centerJustifiedTextSymbolIndex,right:Wt.rightJustifiedTextSymbolIndex}[Vt.at(F)];const fr=[Wt.leftJustifiedTextSymbolIndex,Wt.centerJustifiedTextSymbolIndex,Wt.rightJustifiedTextSymbolIndex,Wt.verticalPlacedTextSymbolIndex];for(const F of fr)F>=0&&(u.text.placedSymbolArray.get(F).crossTileID=Qi>=0&&F!==Qi?0:Wt.crossTileID)}markUsedOrientation(u,F,Wt){const Kt=F===Vt.ah.horizontal||F===Vt.ah.horizontalOnly?F:0,Qi=F===Vt.ah.vertical?F:0,fr=[Wt.leftJustifiedTextSymbolIndex,Wt.centerJustifiedTextSymbolIndex,Wt.rightJustifiedTextSymbolIndex];for(const F of fr)u.text.placedSymbolArray.get(F).placedOrientation=Kt;Wt.verticalPlacedTextSymbolIndex&&(u.text.placedSymbolArray.get(Wt.verticalPlacedTextSymbolIndex).placedOrientation=Qi)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const F=this.prevPlacement;let Vt=!1;this.prevZoomAdjustment=F?F.zoomAdjustment(this.transform.zoom):0;const Wt=F?F.symbolFadeChange(u):1,Kt=F?F.opacities:{},Qi=F?F.variableOffsets:{},fr=F?F.placedOrientations:{};for(const u in this.placements){const F=this.placements[u],Qi=Kt[u];Qi?(this.opacities[u]=new Ft(Qi,Wt,F.text,F.icon),Vt=Vt||F.text!==Qi.text.placed||F.icon!==Qi.icon.placed):(this.opacities[u]=new Ft(null,Wt,F.text,F.icon,F.skipFade),Vt=Vt||F.text||F.icon)}for(const u in Kt){const F=Kt[u];if(!this.opacities[u]){const Kt=new Ft(F,Wt,!1,!1);Kt.isHidden()||(this.opacities[u]=Kt,Vt=Vt||F.text.placed||F.icon.placed)}}for(const u in Qi)this.variableOffsets[u]||!this.opacities[u]||this.opacities[u].isHidden()||(this.variableOffsets[u]=Qi[u]);for(const u in fr)this.placedOrientations[u]||!this.opacities[u]||this.opacities[u].isHidden()||(this.placedOrientations[u]=fr[u]);if(F&&void 0===F.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");Vt?this.lastPlacementChangeTime=u:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=F?F.lastPlacementChangeTime:u)}updateLayerOpacities(u,F){const Vt={};for(const Wt of F){const F=Wt.getBucket(u);F&&Wt.latestFeatureIndex&&u.id===F.layerIds[0]&&this.updateBucketOpacities(F,Wt.tileID,Vt,Wt.collisionBoxArray)}}updateBucketOpacities(u,F,Wt,Kt){u.hasTextData()&&(u.text.opacityVertexArray.clear(),u.text.hasVisibleVertices=!1),u.hasIconData()&&(u.icon.opacityVertexArray.clear(),u.icon.hasVisibleVertices=!1),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const Qi=u.layers[0],fr=Qi.layout,_r=new Ft(null,0,!1,!1,!0),Sr=fr.get("text-allow-overlap"),Ar=fr.get("icon-allow-overlap"),Jr=Qi._unevaluatedLayout.hasValue("text-variable-anchor")||Qi._unevaluatedLayout.hasValue("text-variable-anchor-offset"),zn="map"===fr.get("text-rotation-alignment"),Qs="map"===fr.get("text-pitch-alignment"),ta="none"!==fr.get("icon-text-fit"),ia=new Ft(null,0,Sr&&(Ar||!u.hasIconData()||fr.get("icon-optional")),Ar&&(Sr||!u.hasTextData()||fr.get("text-optional")),!0);!u.collisionArrays&&Kt&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(Kt);const m=(u,F,Vt)=>{for(let Wt=0;Wt<F/4;Wt++)u.opacityVertexArray.emplaceBack(Vt);u.hasVisibleVertices=u.hasVisibleVertices||Vt!==nl},aa=this.collisionBoxArrays.get(u.bucketInstanceId);for(let F=0;F<u.symbolInstances.length;F++){const Kt=u.symbolInstances.get(F),{numHorizontalGlyphVertices:Qi,numVerticalGlyphVertices:fr,crossTileID:Sr}=Kt;let Ar=this.opacities[Sr];Wt[Sr]?Ar=_r:Ar||(Ar=ia,this.opacities[Sr]=Ar),Wt[Sr]=!0;const va=Kt.numIconVertices>0,Ba=this.placedOrientations[Kt.crossTileID],Ya=Ba===Vt.ah.vertical,to=Ba===Vt.ah.horizontal||Ba===Vt.ah.horizontalOnly;if(Qi>0||fr>0){const F=Jt(Ar.text);m(u.text,Qi,Ya?nl:F),m(u.text,fr,to?nl:F);const Vt=Ar.text.isHidden();[Kt.rightJustifiedTextSymbolIndex,Kt.centerJustifiedTextSymbolIndex,Kt.leftJustifiedTextSymbolIndex].forEach((F=>{F>=0&&(u.text.placedSymbolArray.get(F).hidden=Vt||Ya?1:0)})),Kt.verticalPlacedTextSymbolIndex>=0&&(u.text.placedSymbolArray.get(Kt.verticalPlacedTextSymbolIndex).hidden=Vt||to?1:0);const Wt=this.variableOffsets[Kt.crossTileID];Wt&&this.markUsedJustification(u,Wt.anchor,Kt,Ba);const _r=this.placedOrientations[Kt.crossTileID];_r&&(this.markUsedJustification(u,"left",Kt,_r),this.markUsedOrientation(u,_r,Kt))}if(va){const F=Jt(Ar.icon),Vt=!(ta&&Kt.verticalPlacedIconSymbolIndex&&Ya);Kt.placedIconSymbolIndex>=0&&(m(u.icon,Kt.numIconVertices,Vt?F:nl),u.icon.placedSymbolArray.get(Kt.placedIconSymbolIndex).hidden=Ar.icon.isHidden()),Kt.verticalPlacedIconSymbolIndex>=0&&(m(u.icon,Kt.numVerticalIconVertices,Vt?nl:F),u.icon.placedSymbolArray.get(Kt.verticalPlacedIconSymbolIndex).hidden=Ar.icon.isHidden())}const eo=aa&&aa.has(F)?aa.get(F):{text:null,icon:null};if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const Wt=u.collisionArrays[F];if(Wt){let F=new Vt.P(0,0);if(Wt.textBox||Wt.verticalTextBox){let Vt=!0;if(Jr){const u=this.variableOffsets[Sr];u?(F=Ut(u.anchor,u.width,u.height,u.textOffset,u.textBoxScale),zn&&F._rotate(Qs?this.transform.angle:-this.transform.angle)):Vt=!1}if(Wt.textBox||Wt.verticalTextBox){let Kt;Wt.textBox&&(Kt=Ya),Wt.verticalTextBox&&(Kt=to),qt(u.textCollisionBox.collisionVertexArray,Ar.text.placed,!Vt||Kt,eo.text,F.x,F.y)}}if(Wt.iconBox||Wt.verticalIconBox){const Vt=Boolean(!to&&Wt.verticalIconBox);let Kt;Wt.iconBox&&(Kt=Vt),Wt.verticalIconBox&&(Kt=!Vt),qt(u.iconCollisionBox.collisionVertexArray,Ar.icon.placed,Kt,eo.icon,ta?F.x:0,ta?F.y:0)}}}}if(u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.text.opacityVertexArray.length!==u.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${u.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${u.text.layoutVertexArray.length}) / 4`);if(u.icon.opacityVertexArray.length!==u.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${u.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${u.icon.layoutVertexArray.length}) / 4`);if(u.bucketInstanceId in this.collisionCircleArrays){const F=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=F.invProjMatrix,u.placementViewportMatrix=F.viewportMatrix,u.collisionCircleArray=F.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return 0===this.fadeDuration?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,F){const Vt=this.zoomAtLastRecencyCheck===F?1-this.zoomAdjustment(F):1;return this.zoomAtLastRecencyCheck=F,this.commitTime+this.fadeDuration*Vt>u}setStale(){this.stale=!0}}function qt(u,F,Vt,Wt,Kt,Qi){Wt&&0!==Wt.length||(Wt=[0,0,0,0]);const fr=Wt[0]-bo,_r=Wt[1]-bo,Sr=Wt[2]-bo,Ar=Wt[3]-bo;u.emplaceBack(F?1:0,Vt?1:0,Kt||0,Qi||0,fr,_r),u.emplaceBack(F?1:0,Vt?1:0,Kt||0,Qi||0,Sr,_r),u.emplaceBack(F?1:0,Vt?1:0,Kt||0,Qi||0,Sr,Ar),u.emplaceBack(F?1:0,Vt?1:0,Kt||0,Qi||0,fr,Ar)}const wo=Math.pow(2,25),So=Math.pow(2,24),Ao=Math.pow(2,17),ko=Math.pow(2,16),Wo=Math.pow(2,9),il=Math.pow(2,8),rl=Math.pow(2,1);function Jt(u){if(0===u.opacity&&!u.placed)return 0;if(1===u.opacity&&u.placed)return 4294967295;const F=u.placed?1:0,Vt=Math.floor(127*u.opacity);return Vt*wo+F*So+Vt*Ao+F*ko+Vt*Wo+F*il+Vt*rl+F}const nl=0;function Qt(){return{isOccluded:(u,F,Vt)=>!1,getPitchedTextCorrection:(u,F,Vt)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(u,F,Vt,Wt){throw new Error("Not implemented.")},translatePosition:(u,F,Vt,Wt)=>function(u,F,Vt,Wt,Kt=!1){if(!Vt[0]&&!Vt[1])return[0,0];const Qi=Kt?"map"===Wt?u.angle:0:"viewport"===Wt?-u.angle:0;if(Qi){const u=Math.sin(Qi),F=Math.cos(Qi);Vt=[Vt[0]*F-Vt[1]*u,Vt[0]*u+Vt[1]*F]}return[Kt?Vt[0]:Lt(F,Vt[0],u.zoom),Kt?Vt[1]:Lt(F,Vt[1],u.zoom)]}(u,F,Vt,Wt),getCircleRadiusCorrection:u=>1}}class te{constructor(u){this._sortAcrossTiles="viewport-y"!==u.layout.get("symbol-z-order")&&!u.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(u,F,Vt,Wt,Kt){const Qi=this._bucketParts;for(;this._currentTileIndex<u.length;)if(F.getBucketParts(Qi,Wt,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,Kt())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Qi.sort(((u,F)=>u.sortKey-F.sortKey)));this._currentPartIndex<Qi.length;)if(F.placeLayerBucketPart(Qi[this._currentPartIndex],this._seenCrossTileIDs,Vt),this._currentPartIndex++,Kt())return!0;return!1}}class ee{constructor(u,F,Vt,Wt,Kt,Qi,fr,_r){this.placement=new Zt(u,Qt(),F,Qi,fr,_r),this._currentPlacementIndex=Vt.length-1,this._forceFullPlacement=Wt,this._showCollisionBoxes=Kt,this._done=!1}isDone(){return this._done}continuePlacement(u,F,Vt){const Wt=fr.now(),s=()=>!this._forceFullPlacement&&fr.now()-Wt>2;for(;this._currentPlacementIndex>=0;){const Wt=F[u[this._currentPlacementIndex]],Kt=this.placement.collisionIndex.transform.zoom;if("symbol"===Wt.type&&(!Wt.minzoom||Wt.minzoom<=Kt)&&(!Wt.maxzoom||Wt.maxzoom>Kt)){if(this._inProgressLayer||(this._inProgressLayer=new te(Wt)),this._inProgressLayer.continuePlacement(Vt[Wt.source],this.placement,this._showCollisionBoxes,Wt,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const al=512/Vt.W/2;class ae{constructor(u,F,Wt){this.tileID=u,this.bucketInstanceId=Wt,this._symbolsByKey={};const Kt=new Map;for(let u=0;u<F.length;u++){const Vt=F.get(u),Wt=Vt.key,Qi=Kt.get(Wt);Qi?Qi.push(Vt):Kt.set(Wt,[Vt])}for(const[u,F]of Kt){const Wt={positions:F.map((u=>({x:Math.floor(u.anchorX*al),y:Math.floor(u.anchorY*al)}))),crossTileIDs:F.map((u=>u.crossTileID))};if(Wt.positions.length>128){const u=new Vt.av(Wt.positions.length,16,Uint16Array);for(const{x:F,y:Vt}of Wt.positions)u.add(F,Vt);u.finish(),delete Wt.positions,Wt.index=u}this._symbolsByKey[u]=Wt}}getScaledCoordinates(u,F){const{x:Wt,y:Kt,z:Qi}=this.tileID.canonical,{x:fr,y:_r,z:Sr}=F.canonical,Ar=al/Math.pow(2,Sr-Qi),Jr=(_r*Vt.W+u.anchorY)*Ar,zn=Kt*Vt.W*al;return{x:Math.floor((fr*Vt.W+u.anchorX)*Ar-Wt*Vt.W*al),y:Math.floor(Jr-zn)}}findMatches(u,F,Vt){const Wt=this.tileID.canonical.z<F.canonical.z?1:Math.pow(2,this.tileID.canonical.z-F.canonical.z);for(let Kt=0;Kt<u.length;Kt++){const Qi=u.get(Kt);if(Qi.crossTileID)continue;const fr=this._symbolsByKey[Qi.key];if(!fr)continue;const _r=this.getScaledCoordinates(Qi,F);if(fr.index){const u=fr.index.range(_r.x-Wt,_r.y-Wt,_r.x+Wt,_r.y+Wt).sort();for(const F of u){const u=fr.crossTileIDs[F];if(!Vt[u]){Vt[u]=!0,Qi.crossTileID=u;break}}}else if(fr.positions)for(let u=0;u<fr.positions.length;u++){const F=fr.positions[u],Kt=fr.crossTileIDs[u];if(Math.abs(F.x-_r.x)<=Wt&&Math.abs(F.y-_r.y)<=Wt&&!Vt[Kt]){Vt[Kt]=!0,Qi.crossTileID=Kt;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:u})=>u))}}class se{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oe{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const F=Math.round((u-this.lng)/360);if(0!==F)for(const u in this.indexes){const Vt=this.indexes[u],Wt={};for(const u in Vt){const Kt=Vt[u];Kt.tileID=Kt.tileID.unwrapTo(Kt.tileID.wrap+F),Wt[Kt.tileID.key]=Kt}this.indexes[u]=Wt}this.lng=u}addBucket(u,F,Vt){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===F.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let u=0;u<F.symbolInstances.length;u++)F.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});const Wt=this.usedCrossTileIDs[u.overscaledZ];for(const Vt in this.indexes){const Kt=this.indexes[Vt];if(Number(Vt)>u.overscaledZ)for(const Vt in Kt){const Qi=Kt[Vt];Qi.tileID.isChildOf(u)&&Qi.findMatches(F.symbolInstances,u,Wt)}else{const Qi=Kt[u.scaledTo(Number(Vt)).key];Qi&&Qi.findMatches(F.symbolInstances,u,Wt)}}for(let u=0;u<F.symbolInstances.length;u++){const Kt=F.symbolInstances.get(u);Kt.crossTileID||(Kt.crossTileID=Vt.generate(),Wt[Kt.crossTileID]=!0)}return void 0===this.indexes[u.overscaledZ]&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new ae(u,F.symbolInstances,F.bucketInstanceId),!0}removeBucketCrossTileIDs(u,F){for(const Vt of F.getCrossTileIDsLists())for(const F of Vt)delete this.usedCrossTileIDs[u][F]}removeStaleBuckets(u){let F=!1;for(const Vt in this.indexes){const Wt=this.indexes[Vt];for(const Kt in Wt)u[Wt[Kt].bucketInstanceId]||(this.removeBucketCrossTileIDs(Vt,Wt[Kt]),delete Wt[Kt],F=!0)}return F}}class re{constructor(){this.layerIndexes={},this.crossTileIDs=new se,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,F,Vt){let Wt=this.layerIndexes[u.id];void 0===Wt&&(Wt=this.layerIndexes[u.id]=new oe);let Kt=!1;const Qi={};Wt.handleWrapJump(Vt);for(const Vt of F){const F=Vt.getBucket(u);F&&u.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),Wt.addBucket(Vt.tileID,F,this.crossTileIDs)&&(Kt=!0),Qi[F.bucketInstanceId]=!0)}return Wt.removeStaleBuckets(Qi)&&(Kt=!0),Kt}pruneUnusedLayers(u){const F={};u.forEach((u=>{F[u]=!0}));for(const u in this.layerIndexes)F[u]||delete this.layerIndexes[u]}}const ne=(u,F)=>Vt.t(u,F&&F.filter((u=>"source.canvas"!==u.identifier))),ol=Vt.aw();class he extends Vt.E{constructor(u,F={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const F=this.sourceCaches[u].getSource().type;"vector"!==F&&"geojson"!==F||this.sourceCaches[u].reload()}},this.map=u,this.dispatcher=new O(B(),u._getMapId()),this.dispatcher.registerMessageHandler("GG",((u,F)=>this.getGlyphs(u,F))),this.dispatcher.registerMessageHandler("GI",((u,F)=>this.getImages(u,F))),this.imageManager=new T,this.imageManager.setEventedParent(this),this.glyphManager=new C(u._requestManager,F.localIdeographFontFamily),this.lineAtlas=new z(256,512),this.crossTileSymbolIndex=new re,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new Vt.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",Vt.ay()),ot().on(so,this._rtlPluginLoaded),this.on("data",(u=>{if("source"!==u.dataType||"metadata"!==u.sourceDataType)return;const F=this.sourceCaches[u.sourceId];if(!F)return;const Vt=F.getSource();if(Vt&&Vt.vectorLayerIds)for(const u in this._layers){const F=this._layers[u];F.source===Vt.id&&this._validateLayer(F)}}))}loadURL(u,F={},Wt){this.fire(new Vt.k("dataloading",{dataType:"style"})),F.validate="boolean"!=typeof F.validate||F.validate;const Kt=this.map._requestManager.transformRequest(u,"Style");this._loadStyleRequest=new AbortController,Vt.h(Kt,this._loadStyleRequest).then((u=>{this._loadStyleRequest=null,this._load(u.data,F,Wt)})).catch((u=>{this._loadStyleRequest=null,u&&this.fire(new Vt.j(u))}))}loadJSON(u,F={},Wt){this.fire(new Vt.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,fr.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,F.validate=!1!==F.validate,this._load(u,F,Wt)})).catch((()=>{}))}loadEmpty(){this.fire(new Vt.k("dataloading",{dataType:"style"})),this._load(ol,{validate:!1})}_load(u,F,Wt){var Kt;const Qi=F.transformStyle?F.transformStyle(Wt,u):u;if(!F.validate||!ne(this,Vt.x(Qi))){this._loaded=!0,this.stylesheet=Qi;for(const u in Qi.sources)this.addSource(u,Qi.sources[u],{validate:!1});Qi.sprite?this._loadSprite(Qi.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(Qi.glyphs),this._createLayers(),this.light=new M(this.stylesheet.light),this.map.setTerrain(null!==(Kt=this.stylesheet.terrain)&&void 0!==Kt?Kt:null),this.fire(new Vt.k("data",{dataType:"style"})),this.fire(new Vt.k("style.load"))}}_createLayers(){const u=Vt.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",u),this._order=u.map((u=>u.id)),this._layers={},this._serializedLayers=null;for(const F of u){const u=Vt.aA(F);u.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=u}}_loadSprite(u,F=!1,Wt=void 0){let Kt;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(u,F,Wt,Kt){return Vt._(this,void 0,void 0,(function*(){const Qi=x(u),_r=Wt>1?"@2x":"",Sr={},Ar={};for(const{id:u,url:Wt}of Qi){const Qi=F.transformRequest(y(Wt,_r,".json"),"SpriteJSON");Sr[u]=Vt.h(Qi,Kt);const fr=F.transformRequest(y(Wt,_r,".png"),"SpriteImage");Ar[u]=Qs.getImage(fr,Kt)}return yield Promise.all([...Object.values(Sr),...Object.values(Ar)]),function(u,F){return Vt._(this,void 0,void 0,(function*(){const Vt={};for(const Wt in u){Vt[Wt]={};const Kt=fr.getImageCanvasContext((yield F[Wt]).data),Qi=(yield u[Wt]).data;for(const u in Qi){const{width:F,height:fr,x:_r,y:Sr,sdf:Ar,pixelRatio:Jr,stretchX:zn,stretchY:Qs,content:ta,textFitWidth:ia,textFitHeight:aa}=Qi[u];Vt[Wt][u]={data:null,pixelRatio:Jr,sdf:Ar,stretchX:zn,stretchY:Qs,content:ta,textFitWidth:ia,textFitHeight:aa,spriteData:{width:F,height:fr,x:_r,y:Sr,context:Kt}}}}return Vt}))}(Sr,Ar)}))}(u,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((u=>{if(this._spriteRequest=null,u)for(const Vt in u){this._spritesImagesIds[Vt]=[];const Wt=this._spritesImagesIds[Vt]?this._spritesImagesIds[Vt].filter((F=>!(F in u))):[];for(const u of Wt)this.imageManager.removeImage(u),this._changedImages[u]=!0;for(const Wt in u[Vt]){const Kt="default"===Vt?Wt:`${Vt}:${Wt}`;this._spritesImagesIds[Vt].push(Kt),Kt in this.imageManager.images?this.imageManager.updateImage(Kt,u[Vt][Wt],!1):this.imageManager.addImage(Kt,u[Vt][Wt]),F&&(this._changedImages[Kt]=!0)}}})).catch((u=>{this._spriteRequest=null,Kt=u,this.fire(new Vt.j(Kt))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),F&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Vt.k("data",{dataType:"style"})),Wt&&Wt(Kt)}))}_unloadSprite(){for(const u of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(u),this._changedImages[u]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Vt.k("data",{dataType:"style"}))}_validateLayer(u){const F=this.sourceCaches[u.source];if(!F)return;const Wt=u.sourceLayer;if(!Wt)return;const Kt=F.getSource();("geojson"===Kt.type||Kt.vectorLayerIds&&-1===Kt.vectorLayerIds.indexOf(Wt))&&this.fire(new Vt.j(new Error(`Source layer "${Wt}" does not exist on source "${Kt.id}" as specified by style layer "${u.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(u){const F=this._serializedAllLayers();if(!u||0===u.length)return Object.values(F);const Vt=[];for(const Wt of u)F[Wt]&&Vt.push(F[Wt]);return Vt}_serializedAllLayers(){let u=this._serializedLayers;if(u)return u;u=this._serializedLayers={};const F=Object.keys(this._layers);for(const Vt of F){const F=this._layers[Vt];"custom"!==F.type&&(u[Vt]=F.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(u){if(!this._loaded)return;const F=this._changed;if(F){const F=Object.keys(this._updatedLayers),Vt=Object.keys(this._removedLayers);(F.length||Vt.length)&&this._updateWorkerLayers(F,Vt);for(const u in this._updatedSources){const F=this._updatedSources[u];if("reload"===F)this._reloadSource(u);else{if("clear"!==F)throw new Error(`Invalid action ${F}`);this._clearSource(u)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const F in this._updatedPaintProps)this._layers[F].updateTransitions(u);this.light.updateTransitions(u),this._resetUpdates()}const Wt={};for(const u in this.sourceCaches){const F=this.sourceCaches[u];Wt[u]=F.used,F.used=!1}for(const F of this._order){const Vt=this._layers[F];Vt.recalculate(u,this._availableImages),!Vt.isHidden(u.zoom)&&Vt.source&&(this.sourceCaches[Vt.source].used=!0)}for(const u in Wt){const F=this.sourceCaches[u];!!Wt[u]!=!!F.used&&F.fire(new Vt.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(u),this.z=u.zoom,F&&this.fire(new Vt.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const F in this.sourceCaches)this.sourceCaches[F].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(u,F){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(u),removedIds:F})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(u,F={}){var Wt;this._checkLoaded();const Kt=this.serialize();if(u=F.transformStyle?F.transformStyle(Kt,u):u,(null===(Wt=F.validate)||void 0===Wt||Wt)&&ne(this,Vt.x(u)))return!1;(u=Vt.aB(u)).layers=Vt.az(u.layers);const Qi=Vt.aC(Kt,u),fr=this._getOperationsToPerform(Qi);if(fr.unimplemented.length>0)throw new Error(`Unimplemented: ${fr.unimplemented.join(", ")}.`);if(0===fr.operations.length)return!1;for(const u of fr.operations)u();return this.stylesheet=u,this._serializedLayers=null,!0}_getOperationsToPerform(u){const F=[],Vt=[];for(const Wt of u)switch(Wt.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":F.push((()=>this.addLayer.apply(this,Wt.args)));break;case"removeLayer":F.push((()=>this.removeLayer.apply(this,Wt.args)));break;case"setPaintProperty":F.push((()=>this.setPaintProperty.apply(this,Wt.args)));break;case"setLayoutProperty":F.push((()=>this.setLayoutProperty.apply(this,Wt.args)));break;case"setFilter":F.push((()=>this.setFilter.apply(this,Wt.args)));break;case"addSource":F.push((()=>this.addSource.apply(this,Wt.args)));break;case"removeSource":F.push((()=>this.removeSource.apply(this,Wt.args)));break;case"setLayerZoomRange":F.push((()=>this.setLayerZoomRange.apply(this,Wt.args)));break;case"setLight":F.push((()=>this.setLight.apply(this,Wt.args)));break;case"setGeoJSONSourceData":F.push((()=>this.setGeoJSONSourceData.apply(this,Wt.args)));break;case"setGlyphs":F.push((()=>this.setGlyphs.apply(this,Wt.args)));break;case"setSprite":F.push((()=>this.setSprite.apply(this,Wt.args)));break;case"setTerrain":F.push((()=>this.map.setTerrain.apply(this,Wt.args)));break;case"setTransition":F.push((()=>{}));break;default:Vt.push(Wt.command)}return{operations:F,unimplemented:Vt}}addImage(u,F){if(this.getImage(u))return this.fire(new Vt.j(new Error(`An image named "${u}" already exists.`)));this.imageManager.addImage(u,F),this._afterImageUpdated(u)}updateImage(u,F){this.imageManager.updateImage(u,F)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){if(!this.getImage(u))return this.fire(new Vt.j(new Error(`An image named "${u}" does not exist.`)));this.imageManager.removeImage(u),this._afterImageUpdated(u)}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Vt.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(u,F,Wt={}){if(this._checkLoaded(),void 0!==this.sourceCaches[u])throw new Error(`Source "${u}" already exists.`);if(!F.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(F).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(F.type)>=0&&this._validate(Vt.x.source,`sources.${u}`,F,null,Wt))return;this.map&&this.map._collectResourceTiming&&(F.collectResourceTiming=!0);const Kt=this.sourceCaches[u]=new ht(u,F,this.dispatcher);Kt.style=this,Kt.setEventedParent(this,(()=>({isSourceLoaded:Kt.loaded(),source:Kt.serialize(),sourceId:u}))),Kt.onAdd(this.map),this._changed=!0}removeSource(u){if(this._checkLoaded(),void 0===this.sourceCaches[u])throw new Error("There is no source with this ID");for(const F in this._layers)if(this._layers[F].source===u)return this.fire(new Vt.j(new Error(`Source "${u}" cannot be removed while layer "${F}" is using it.`)));const F=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],F.fire(new Vt.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),F.setEventedParent(null),F.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(u,F){if(this._checkLoaded(),void 0===this.sourceCaches[u])throw new Error(`There is no source with this ID=${u}`);const Vt=this.sourceCaches[u].getSource();if("geojson"!==Vt.type)throw new Error(`geojsonSource.type is ${Vt.type}, which is !== 'geojson`);Vt.setData(F),this._changed=!0}getSource(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()}addLayer(u,F,Wt={}){this._checkLoaded();const Kt=u.id;if(this.getLayer(Kt))return void this.fire(new Vt.j(new Error(`Layer "${Kt}" already exists on this map.`)));let Qi;if("custom"===u.type){if(ne(this,Vt.aD(u)))return;Qi=Vt.aA(u)}else{if("source"in u&&"object"==typeof u.source&&(this.addSource(Kt,u.source),u=Vt.aB(u),u=Vt.e(u,{source:Kt})),this._validate(Vt.x.layer,`layers.${Kt}`,u,{arrayIndex:-1},Wt))return;Qi=Vt.aA(u),this._validateLayer(Qi),Qi.setEventedParent(this,{layer:{id:Kt}})}const fr=F?this._order.indexOf(F):this._order.length;if(F&&-1===fr)this.fire(new Vt.j(new Error(`Cannot add layer "${Kt}" before non-existing layer "${F}".`)));else{if(this._order.splice(fr,0,Kt),this._layerOrderChanged=!0,this._layers[Kt]=Qi,this._removedLayers[Kt]&&Qi.source&&"custom"!==Qi.type){const u=this._removedLayers[Kt];delete this._removedLayers[Kt],u.type!==Qi.type?this._updatedSources[Qi.source]="clear":(this._updatedSources[Qi.source]="reload",this.sourceCaches[Qi.source].pause())}this._updateLayer(Qi),Qi.onAdd&&Qi.onAdd(this.map)}}moveLayer(u,F){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new Vt.j(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===F)return;const Wt=this._order.indexOf(u);this._order.splice(Wt,1);const Kt=F?this._order.indexOf(F):this._order.length;F&&-1===Kt?this.fire(new Vt.j(new Error(`Cannot move layer "${u}" before non-existing layer "${F}".`))):(this._order.splice(Kt,0,u),this._layerOrderChanged=!0)}removeLayer(u){this._checkLoaded();const F=this._layers[u];if(!F)return void this.fire(new Vt.j(new Error(`Cannot remove non-existing layer "${u}".`)));F.setEventedParent(null);const Wt=this._order.indexOf(u);this._order.splice(Wt,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=F,delete this._layers[u],this._serializedLayers&&delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],F.onRemove&&F.onRemove(this.map)}getLayer(u){return this._layers[u]}getLayersOrder(){return[...this._order]}hasLayer(u){return u in this._layers}setLayerZoomRange(u,F,Wt){this._checkLoaded();const Kt=this.getLayer(u);Kt?Kt.minzoom===F&&Kt.maxzoom===Wt||(null!=F&&(Kt.minzoom=F),null!=Wt&&(Kt.maxzoom=Wt),this._updateLayer(Kt)):this.fire(new Vt.j(new Error(`Cannot set the zoom range of non-existing layer "${u}".`)))}setFilter(u,F,Wt={}){this._checkLoaded();const Kt=this.getLayer(u);if(Kt){if(!Vt.aE(Kt.filter,F))return null==F?(Kt.filter=void 0,void this._updateLayer(Kt)):void(this._validate(Vt.x.filter,`layers.${Kt.id}.filter`,F,null,Wt)||(Kt.filter=Vt.aB(F),this._updateLayer(Kt)))}else this.fire(new Vt.j(new Error(`Cannot filter non-existing layer "${u}".`)))}getFilter(u){return Vt.aB(this.getLayer(u).filter)}setLayoutProperty(u,F,Wt,Kt={}){this._checkLoaded();const Qi=this.getLayer(u);Qi?Vt.aE(Qi.getLayoutProperty(F),Wt)||(Qi.setLayoutProperty(F,Wt,Kt),this._updateLayer(Qi)):this.fire(new Vt.j(new Error(`Cannot style non-existing layer "${u}".`)))}getLayoutProperty(u,F){const Wt=this.getLayer(u);if(Wt)return Wt.getLayoutProperty(F);this.fire(new Vt.j(new Error(`Cannot get style of non-existing layer "${u}".`)))}setPaintProperty(u,F,Wt,Kt={}){this._checkLoaded();const Qi=this.getLayer(u);Qi?Vt.aE(Qi.getPaintProperty(F),Wt)||(Qi.setPaintProperty(F,Wt,Kt)&&this._updateLayer(Qi),this._changed=!0,this._updatedPaintProps[u]=!0,this._serializedLayers=null):this.fire(new Vt.j(new Error(`Cannot style non-existing layer "${u}".`)))}getPaintProperty(u,F){return this.getLayer(u).getPaintProperty(F)}setFeatureState(u,F){this._checkLoaded();const Wt=u.source,Kt=u.sourceLayer,Qi=this.sourceCaches[Wt];if(void 0===Qi)return void this.fire(new Vt.j(new Error(`The source '${Wt}' does not exist in the map's style.`)));const fr=Qi.getSource().type;"geojson"===fr&&Kt?this.fire(new Vt.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==fr||Kt?(void 0===u.id&&this.fire(new Vt.j(new Error("The feature id parameter must be provided."))),Qi.setFeatureState(Kt,u.id,F)):this.fire(new Vt.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(u,F){this._checkLoaded();const Wt=u.source,Kt=this.sourceCaches[Wt];if(void 0===Kt)return void this.fire(new Vt.j(new Error(`The source '${Wt}' does not exist in the map's style.`)));const Qi=Kt.getSource().type,fr="vector"===Qi?u.sourceLayer:void 0;"vector"!==Qi||fr?F&&"string"!=typeof u.id&&"number"!=typeof u.id?this.fire(new Vt.j(new Error("A feature id is required to remove its specific state property."))):Kt.removeFeatureState(fr,u.id,F):this.fire(new Vt.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(u){this._checkLoaded();const F=u.source,Wt=u.sourceLayer,Kt=this.sourceCaches[F];if(void 0!==Kt)return"vector"!==Kt.getSource().type||Wt?(void 0===u.id&&this.fire(new Vt.j(new Error("The feature id parameter must be provided."))),Kt.getFeatureState(Wt,u.id)):void this.fire(new Vt.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new Vt.j(new Error(`The source '${F}' does not exist in the map's style.`)))}getTransition(){return Vt.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const u=Vt.aF(this.sourceCaches,(u=>u.serialize())),F=this._serializeByIds(this._order),Wt=this.map.getTerrain()||void 0,Kt=this.stylesheet;return Vt.aG({version:Kt.version,name:Kt.name,metadata:Kt.metadata,light:Kt.light,center:Kt.center,zoom:Kt.zoom,bearing:Kt.bearing,pitch:Kt.pitch,sprite:Kt.sprite,glyphs:Kt.glyphs,transition:Kt.transition,sources:u,layers:F,terrain:Wt},(u=>void 0!==u))}_updateLayer(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&"raster"!==this.sourceCaches[u.source].getSource().type&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(u){const e=u=>"fill-extrusion"===this._layers[u].type,F={},Vt=[];for(let Wt=this._order.length-1;Wt>=0;Wt--){const Kt=this._order[Wt];if(e(Kt)){F[Kt]=Wt;for(const F of u){const u=F[Kt];if(u)for(const F of u)Vt.push(F)}}}Vt.sort(((u,F)=>F.intersectionZ-u.intersectionZ));const Wt=[];for(let Kt=this._order.length-1;Kt>=0;Kt--){const Qi=this._order[Kt];if(e(Qi))for(let u=Vt.length-1;u>=0;u--){const Qi=Vt[u].feature;if(F[Qi.layer.id]<Kt)break;Wt.push(Qi),Vt.pop()}else for(const F of u){const u=F[Qi];if(u)for(const F of u)Wt.push(F.feature)}}return Wt}queryRenderedFeatures(u,F,Wt){F&&F.filter&&this._validate(Vt.x.filter,"queryRenderedFeatures.filter",F.filter,null,F);const Kt={};if(F&&F.layers){if(!Array.isArray(F.layers))return this.fire(new Vt.j(new Error("parameters.layers must be an Array."))),[];for(const u of F.layers){const F=this._layers[u];if(!F)return this.fire(new Vt.j(new Error(`The layer '${u}' does not exist in the map's style and cannot be queried for features.`))),[];Kt[F.source]=!0}}const Qi=[];F.availableImages=this._availableImages;const fr=this._serializedAllLayers();for(const Vt in this.sourceCaches)F.layers&&!Kt[Vt]||Qi.push(U(this.sourceCaches[Vt],this._layers,fr,u,F,Wt));return this.placement&&Qi.push(function(u,F,Vt,Wt,Kt,Qi,fr){const _r={},Sr=Qi.queryRenderedSymbols(Wt),Ar=[];for(const u of Object.keys(Sr).map(Number))Ar.push(fr[u]);Ar.sort(Z);for(const Vt of Ar){const Wt=Vt.featureIndex.lookupSymbolFeatures(Sr[Vt.bucketInstanceId],F,Vt.bucketIndex,Vt.sourceLayerIndex,Kt.filter,Kt.layers,Kt.availableImages,u);for(const u in Wt){const F=_r[u]=_r[u]||[],Kt=Wt[u];Kt.sort(((u,F)=>{const Wt=Vt.featureSortOrder;if(Wt){const Vt=Wt.indexOf(u.featureIndex);return Wt.indexOf(F.featureIndex)-Vt}return F.featureIndex-u.featureIndex}));for(const u of Kt)F.push(u)}}for(const F in _r)_r[F].forEach((Wt=>{const Kt=Wt.feature,Qi=Vt[u[F].source].getFeatureState(Kt.layer["source-layer"],Kt.id);Kt.source=Kt.layer.source,Kt.layer["source-layer"]&&(Kt.sourceLayer=Kt.layer["source-layer"]),Kt.state=Qi}));return _r}(this._layers,fr,this.sourceCaches,u,F,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Qi)}querySourceFeatures(u,F){F&&F.filter&&this._validate(Vt.x.filter,"querySourceFeatures.filter",F.filter,null,F);const Wt=this.sourceCaches[u];return Wt?function(u,F){const Vt=u.getRenderableIds().map((F=>u.getTileByID(F))),Wt=[],Kt={};for(let u=0;u<Vt.length;u++){const Qi=Vt[u],fr=Qi.tileID.canonical.key;Kt[fr]||(Kt[fr]=!0,Qi.querySourceFeatures(Wt,F))}return Wt}(Wt,F):[]}getLight(){return this.light.getLight()}setLight(u,F={}){this._checkLoaded();const Wt=this.light.getLight();let Kt=!1;for(const F in u)if(!Vt.aE(u[F],Wt[F])){Kt=!0;break}if(!Kt)return;const Qi={now:fr.now(),transition:Vt.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,F),this.light.updateTransitions(Qi)}_validate(u,F,Wt,Kt,Qi={}){return(!Qi||!1!==Qi.validate)&&ne(this,u.call(Vt.x,Vt.e({key:F,style:this.serialize(),value:Wt,styleSpec:Vt.v},Kt)))}_remove(u=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ot().off(so,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const F=this.sourceCaches[u];F.setEventedParent(null),F.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),u&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(u)}_clearSource(u){this.sourceCaches[u].clearTiles()}_reloadSource(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()}_updateSources(u){for(const F in this.sourceCaches)this.sourceCaches[F].update(u,this.map.terrain)}_generateCollisionBoxes(){for(const u in this.sourceCaches)this._reloadSource(u)}_updatePlacement(u,F,Vt,Wt,Kt=!1){let Qi=!1,_r=!1;const Sr={};for(const F of this._order){const Vt=this._layers[F];if("symbol"!==Vt.type)continue;if(!Sr[Vt.source]){const u=this.sourceCaches[Vt.source];Sr[Vt.source]=u.getRenderableIds(!0).map((F=>u.getTileByID(F))).sort(((u,F)=>F.tileID.overscaledZ-u.tileID.overscaledZ||(u.tileID.isLessThan(F.tileID)?-1:1)))}const Wt=this.crossTileSymbolIndex.addLayer(Vt,Sr[Vt.source],u.center.lng);Qi=Qi||Wt}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((Kt=Kt||this._layerOrderChanged||0===Vt)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(fr.now(),u.zoom))&&(this.pauseablePlacement=new ee(u,this.map.terrain,this._order,Kt,F,Vt,Wt,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Sr),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(fr.now()),_r=!0),Qi&&this.pauseablePlacement.placement.setStale()),_r||Qi)for(const u of this._order){const F=this._layers[u];"symbol"===F.type&&this.placement.updateLayerOpacities(F,Sr[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(fr.now())}_releaseSymbolFadeTiles(){for(const u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()}getImages(u,F){return Vt._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(F.icons);this._updateTilesForChangedImages();const Vt=this.sourceCaches[F.source];return Vt&&Vt.setDependencies(F.tileID.key,F.type,F.icons),u}))}getGlyphs(u,F){return Vt._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(F.stacks),Vt=this.sourceCaches[F.source];return Vt&&Vt.setDependencies(F.tileID.key,F.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(u,F={}){this._checkLoaded(),u&&this._validate(Vt.x.glyphs,"glyphs",u,null,F)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=u,this.glyphManager.entries={},this.glyphManager.setURL(u))}addSprite(u,F,Wt={},Kt){this._checkLoaded();const Qi=[{id:u,url:F}],fr=[...x(this.stylesheet.sprite),...Qi];this._validate(Vt.x.sprite,"sprite",fr,null,Wt)||(this.stylesheet.sprite=fr,this._loadSprite(Qi,!0,Kt))}removeSprite(u){this._checkLoaded();const F=x(this.stylesheet.sprite);if(F.find((F=>F.id===u))){if(this._spritesImagesIds[u])for(const F of this._spritesImagesIds[u])this.imageManager.removeImage(F),this._changedImages[F]=!0;F.splice(F.findIndex((F=>F.id===u)),1),this.stylesheet.sprite=F.length>0?F:void 0,delete this._spritesImagesIds[u],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new Vt.k("data",{dataType:"style"}))}else this.fire(new Vt.j(new Error(`Sprite "${u}" doesn't exists on this map.`)))}getSprite(){return x(this.stylesheet.sprite)}setSprite(u,F={},Wt){this._checkLoaded(),u&&this._validate(Vt.x.sprite,"sprite",u,null,F)||(this.stylesheet.sprite=u,u?this._loadSprite(u,!0,Wt):(this._unloadSprite(),Wt&&Wt(null)))}}var ll=Vt.X([{name:"a_pos",type:"Int16",components:2}]),cl="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const hl={prelude:_e("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:_e("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:_e("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:_e("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:_e("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_e("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:_e("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:_e("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_e("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_e("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:_e("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:_e("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:_e("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:_e("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:_e("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:_e("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:_e("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_e("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:_e("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:_e("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:_e("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:_e("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:_e("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:_e("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:_e("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:_e("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:_e("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",cl),terrainDepth:_e("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",cl),terrainCoords:_e("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",cl)};function _e(u,F){const Vt=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,Wt=F.match(/attribute ([\w]+) ([\w]+)/g),Kt=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Qi=F.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),fr=Qi?Qi.concat(Kt):Kt,_r={};return{fragmentSource:u=u.replace(Vt,((u,F,Vt,Wt,Kt)=>(_r[Kt]=!0,"define"===F?`\n#ifndef HAS_UNIFORM_u_${Kt}\nvarying ${Vt} ${Wt} ${Kt};\n#else\nuniform ${Vt} ${Wt} u_${Kt};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Kt}\n    ${Vt} ${Wt} ${Kt} = u_${Kt};\n#endif\n`))),vertexSource:F=F.replace(Vt,((u,F,Vt,Wt,Kt)=>{const Qi="float"===Wt?"vec2":"vec4",fr=Kt.match(/color/)?"color":Qi;return _r[Kt]?"define"===F?`\n#ifndef HAS_UNIFORM_u_${Kt}\nuniform lowp float u_${Kt}_t;\nattribute ${Vt} ${Qi} a_${Kt};\nvarying ${Vt} ${Wt} ${Kt};\n#else\nuniform ${Vt} ${Wt} u_${Kt};\n#endif\n`:"vec4"===fr?`\n#ifndef HAS_UNIFORM_u_${Kt}\n    ${Kt} = a_${Kt};\n#else\n    ${Vt} ${Wt} ${Kt} = u_${Kt};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Kt}\n    ${Kt} = unpack_mix_${fr}(a_${Kt}, u_${Kt}_t);\n#else\n    ${Vt} ${Wt} ${Kt} = u_${Kt};\n#endif\n`:"define"===F?`\n#ifndef HAS_UNIFORM_u_${Kt}\nuniform lowp float u_${Kt}_t;\nattribute ${Vt} ${Qi} a_${Kt};\n#else\nuniform ${Vt} ${Wt} u_${Kt};\n#endif\n`:"vec4"===fr?`\n#ifndef HAS_UNIFORM_u_${Kt}\n    ${Vt} ${Wt} ${Kt} = a_${Kt};\n#else\n    ${Vt} ${Wt} ${Kt} = u_${Kt};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Kt}\n    ${Vt} ${Wt} ${Kt} = unpack_mix_${fr}(a_${Kt}, u_${Kt}_t);\n#else\n    ${Vt} ${Wt} ${Kt} = u_${Kt};\n#endif\n`})),staticAttributes:Wt,staticUniforms:fr}}class pe{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr){this.context=u;let Ar=this.boundPaintVertexBuffers.length!==Wt.length;for(let u=0;!Ar&&u<Wt.length;u++)this.boundPaintVertexBuffers[u]!==Wt[u]&&(Ar=!0);!this.vao||this.boundProgram!==F||this.boundLayoutVertexBuffer!==Vt||Ar||this.boundIndexBuffer!==Kt||this.boundVertexOffset!==Qi||this.boundDynamicVertexBuffer!==fr||this.boundDynamicVertexBuffer2!==_r||this.boundDynamicVertexBuffer3!==Sr?this.freshBind(F,Vt,Wt,Kt,Qi,fr,_r,Sr):(u.bindVertexArray.set(this.vao),fr&&fr.bind(),Kt&&Kt.dynamicDraw&&Kt.bind(),_r&&_r.bind(),Sr&&Sr.bind())}freshBind(u,F,Vt,Wt,Kt,Qi,fr,_r){const Sr=u.numAttributes,Ar=this.context,Jr=Ar.gl;this.vao&&this.destroy(),this.vao=Ar.createVertexArray(),Ar.bindVertexArray.set(this.vao),this.boundProgram=u,this.boundLayoutVertexBuffer=F,this.boundPaintVertexBuffers=Vt,this.boundIndexBuffer=Wt,this.boundVertexOffset=Kt,this.boundDynamicVertexBuffer=Qi,this.boundDynamicVertexBuffer2=fr,this.boundDynamicVertexBuffer3=_r,F.enableAttributes(Jr,u);for(const F of Vt)F.enableAttributes(Jr,u);Qi&&Qi.enableAttributes(Jr,u),fr&&fr.enableAttributes(Jr,u),_r&&_r.enableAttributes(Jr,u),F.bind(),F.setVertexAttribPointers(Jr,u,Kt);for(const F of Vt)F.bind(),F.setVertexAttribPointers(Jr,u,Kt);Qi&&(Qi.bind(),Qi.setVertexAttribPointers(Jr,u,Kt)),Wt&&Wt.bind(),fr&&(fr.bind(),fr.setVertexAttribPointers(Jr,u,Kt)),_r&&(_r.bind(),_r.setVertexAttribPointers(Jr,u,Kt)),Ar.currentNumAttributes=Sr}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function me(u){const F=[];for(let Vt=0;Vt<u.length;Vt++){if(null===u[Vt])continue;const Wt=u[Vt].split(" ");F.push(Wt.pop())}return F}class fe{constructor(u,F,Wt,Kt,Qi,fr){const _r=u.gl;this.program=_r.createProgram();const Sr=me(F.staticAttributes),Ar=Wt?Wt.getBinderAttributes():[],Jr=Sr.concat(Ar),zn=hl.prelude.staticUniforms?me(hl.prelude.staticUniforms):[],Qs=F.staticUniforms?me(F.staticUniforms):[],ta=Wt?Wt.getBinderUniforms():[],ia=zn.concat(Qs).concat(ta),aa=[];for(const u of ia)aa.indexOf(u)<0&&aa.push(u);const va=Wt?Wt.defines():[];Qi&&va.push("#define OVERDRAW_INSPECTOR;"),fr&&va.push("#define TERRAIN3D;");const Ba=va.concat(hl.prelude.fragmentSource,F.fragmentSource).join("\n"),Ya=va.concat(hl.prelude.vertexSource,F.vertexSource).join("\n"),to=_r.createShader(_r.FRAGMENT_SHADER);if(_r.isContextLost())return void(this.failedToCreate=!0);if(_r.shaderSource(to,Ba),_r.compileShader(to),!_r.getShaderParameter(to,_r.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_r.getShaderInfoLog(to)}`);_r.attachShader(this.program,to);const eo=_r.createShader(_r.VERTEX_SHADER);if(_r.isContextLost())return void(this.failedToCreate=!0);if(_r.shaderSource(eo,Ya),_r.compileShader(eo),!_r.getShaderParameter(eo,_r.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_r.getShaderInfoLog(eo)}`);_r.attachShader(this.program,eo),this.attributes={};const io={};this.numAttributes=Jr.length;for(let u=0;u<this.numAttributes;u++)Jr[u]&&(_r.bindAttribLocation(this.program,u,Jr[u]),this.attributes[Jr[u]]=u);if(_r.linkProgram(this.program),!_r.getProgramParameter(this.program,_r.LINK_STATUS))throw new Error(`Program failed to link: ${_r.getProgramInfoLog(this.program)}`);_r.deleteShader(eo),_r.deleteShader(to);for(let u=0;u<aa.length;u++){const F=aa[u];if(F&&!io[F]){const u=_r.getUniformLocation(this.program,F);u&&(io[F]=u)}}this.fixedUniforms=Kt(u,io),this.terrainUniforms=((u,F)=>({u_depth:new Vt.aH(u,F.u_depth),u_terrain:new Vt.aH(u,F.u_terrain),u_terrain_dim:new Vt.aI(u,F.u_terrain_dim),u_terrain_matrix:new Vt.aJ(u,F.u_terrain_matrix),u_terrain_unpack:new Vt.aK(u,F.u_terrain_unpack),u_terrain_exaggeration:new Vt.aI(u,F.u_terrain_exaggeration)}))(u,io),this.binderUniforms=Wt?Wt.getUniforms(u,io):[]}draw(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa,va,Ba){const Ya=u.gl;if(this.failedToCreate)return;if(u.program.set(this.program),u.setDepthMode(Vt),u.setStencilMode(Wt),u.setColorMode(Kt),u.setCullFace(Qi),_r){u.activeTexture.set(Ya.TEXTURE2),Ya.bindTexture(Ya.TEXTURE_2D,_r.depthTexture),u.activeTexture.set(Ya.TEXTURE3),Ya.bindTexture(Ya.TEXTURE_2D,_r.texture);for(const u in this.terrainUniforms)this.terrainUniforms[u].set(_r[u])}for(const u in this.fixedUniforms)this.fixedUniforms[u].set(fr[u]);ia&&ia.setUniforms(u,this.binderUniforms,Qs,{zoom:ta});let to=0;switch(F){case Ya.LINES:to=2;break;case Ya.TRIANGLES:to=3;break;case Ya.LINE_STRIP:to=1}for(const Vt of zn.get()){const Wt=Vt.vaos||(Vt.vaos={});(Wt[Sr]||(Wt[Sr]=new pe)).bind(u,this,Ar,ia?ia.getPaintVertexBuffers():[],Jr,Vt.vertexOffset,aa,va,Ba),Ya.drawElements(F,Vt.primitiveLength*to,Ya.UNSIGNED_SHORT,Vt.primitiveOffset*to*2)}}}function ge(u,F,Vt){const Wt=1/Lt(Vt,1,F.transform.tileZoom),Kt=Math.pow(2,Vt.tileID.overscaledZ),Qi=Vt.tileSize*Math.pow(2,F.transform.tileZoom)/Kt,fr=Qi*(Vt.tileID.canonical.x+Vt.tileID.wrap*Kt),_r=Qi*Vt.tileID.canonical.y;return{u_image:0,u_texsize:Vt.imageAtlasTexture.size,u_scale:[Wt,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[fr>>16,_r>>16],u_pixel_coord_lower:[65535&fr,65535&_r]}}const ve=(u,F,Wt,Kt)=>{const Qi=F.style.light,fr=Qi.properties.get("position"),_r=[fr.x,fr.y,fr.z],Sr=function(){var u=new Vt.A(9);return Vt.A!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}();"viewport"===Qi.properties.get("anchor")&&function(u,F){var Vt=Math.sin(F),Wt=Math.cos(F);u[0]=Wt,u[1]=Vt,u[2]=0,u[3]=-Vt,u[4]=Wt,u[5]=0,u[6]=0,u[7]=0,u[8]=1}(Sr,-F.transform.angle),function(u,F,Vt){var Wt=F[0],Kt=F[1],Qi=F[2];u[0]=Wt*Vt[0]+Kt*Vt[3]+Qi*Vt[6],u[1]=Wt*Vt[1]+Kt*Vt[4]+Qi*Vt[7],u[2]=Wt*Vt[2]+Kt*Vt[5]+Qi*Vt[8]}(_r,_r,Sr);const Ar=Qi.properties.get("color");return{u_matrix:u,u_lightpos:_r,u_lightintensity:Qi.properties.get("intensity"),u_lightcolor:[Ar.r,Ar.g,Ar.b],u_vertical_gradient:+Wt,u_opacity:Kt}},xe=(u,F,Wt,Kt,Qi,fr,_r)=>Vt.e(ve(u,F,Wt,Kt),ge(fr,F,_r),{u_height_factor:-Math.pow(2,Qi.overscaledZ)/_r.tileSize/8}),ye=u=>({u_matrix:u}),be=(u,F,Wt,Kt)=>Vt.e(ye(u),ge(Wt,F,Kt)),we=(u,F)=>({u_matrix:u,u_world:F}),Te=(u,F,Wt,Kt,Qi)=>Vt.e(be(u,F,Wt,Kt),{u_world:Qi}),Ie=(u,F,Vt,Wt)=>{const Kt=u.transform;let Qi,fr;if("map"===Wt.paint.get("circle-pitch-alignment")){const u=Lt(Vt,1,Kt.zoom);Qi=!0,fr=[u,u]}else Qi=!1,fr=Kt.pixelsToGLUnits;return{u_camera_to_center_distance:Kt.cameraToCenterDistance,u_scale_with_map:+("map"===Wt.paint.get("circle-pitch-scale")),u_matrix:u.translatePosMatrix(F.posMatrix,Vt,Wt.paint.get("circle-translate"),Wt.paint.get("circle-translate-anchor")),u_pitch_with_map:+Qi,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:fr}},Ee=(u,F,Vt)=>({u_matrix:u,u_inv_matrix:F,u_camera_to_center_distance:Vt.cameraToCenterDistance,u_viewport_size:[Vt.width,Vt.height]}),Pe=(u,F,Vt=1)=>({u_matrix:u,u_color:F,u_overlay:0,u_overlay_scale:Vt}),Ce=u=>({u_matrix:u}),Se=(u,F,Vt,Wt)=>({u_matrix:u,u_extrude_scale:Lt(F,1,Vt),u_intensity:Wt});function De(u,F){const Wt=Math.pow(2,F.canonical.z),Kt=F.canonical.y;return[new Vt.Y(0,Kt/Wt).toLngLat().lat,new Vt.Y(0,(Kt+1)/Wt).toLngLat().lat]}const Me=(u,F,Vt,Wt)=>{const Kt=u.transform;return{u_matrix:ke(u,F,Vt,Wt),u_ratio:1/Lt(F,1,Kt.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/Kt.pixelsToGLUnits[0],1/Kt.pixelsToGLUnits[1]]}},ze=(u,F,Wt,Kt,Qi)=>Vt.e(Me(u,F,Wt,Qi),{u_image:0,u_image_height:Kt}),Ae=(u,F,Vt,Wt,Kt)=>{const Qi=u.transform,fr=Le(F,Qi);return{u_matrix:ke(u,F,Vt,Kt),u_texsize:F.imageAtlasTexture.size,u_ratio:1/Lt(F,1,Qi.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[fr,Wt.fromScale,Wt.toScale],u_fade:Wt.t,u_units_to_pixels:[1/Qi.pixelsToGLUnits[0],1/Qi.pixelsToGLUnits[1]]}},Re=(u,F,Wt,Kt,Qi,fr)=>{const _r=u.lineAtlas,Sr=Le(F,u.transform),Ar="round"===Wt.layout.get("line-cap"),Jr=_r.getDash(Kt.from,Ar),zn=_r.getDash(Kt.to,Ar),Qs=Jr.width*Qi.fromScale,ta=zn.width*Qi.toScale;return Vt.e(Me(u,F,Wt,fr),{u_patternscale_a:[Sr/Qs,-Jr.height/2],u_patternscale_b:[Sr/ta,-zn.height/2],u_sdfgamma:_r.width/(256*Math.min(Qs,ta)*u.pixelRatio)/2,u_image:0,u_tex_y_a:Jr.y,u_tex_y_b:zn.y,u_mix:Qi.t})};function Le(u,F){return 1/Lt(u,1,F.tileZoom)}function ke(u,F,Vt,Wt){return u.translatePosMatrix(Wt?Wt.posMatrix:F.tileID.posMatrix,F,Vt.paint.get("line-translate"),Vt.paint.get("line-translate-anchor"))}const Fe=(u,F,Vt,Wt,Kt)=>{return{u_matrix:u,u_tl_parent:F,u_scale_parent:Vt,u_buffer_scale:1,u_fade_t:Wt.mix,u_opacity:Wt.opacity*Kt.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Kt.paint.get("raster-brightness-min"),u_brightness_high:Kt.paint.get("raster-brightness-max"),u_saturation_factor:(fr=Kt.paint.get("raster-saturation"),fr>0?1-1/(1.001-fr):-fr),u_contrast_factor:(Qi=Kt.paint.get("raster-contrast"),Qi>0?1/(1-Qi):1+Qi),u_spin_weights:Be(Kt.paint.get("raster-hue-rotate"))};var Qi,fr};function Be(u){u*=Math.PI/180;const F=Math.sin(u),Vt=Math.cos(u);return[(2*Vt+1)/3,(-Math.sqrt(3)*F-Vt+1)/3,(Math.sqrt(3)*F-Vt+1)/3]}const Oe=(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta)=>{const ia=fr.transform;return{u_is_size_zoom_constant:+("constant"===u||"source"===u),u_is_size_feature_constant:+("constant"===u||"camera"===u),u_size_t:F?F.uSizeT:0,u_size:F?F.uSize:0,u_camera_to_center_distance:ia.cameraToCenterDistance,u_pitch:ia.pitch/360*2*Math.PI,u_rotate_symbol:+Vt,u_aspect_ratio:ia.width/ia.height,u_fade_change:fr.options.fadeDuration?fr.symbolFadeChange:1,u_matrix:_r,u_label_plane_matrix:Sr,u_coord_matrix:Ar,u_is_text:+zn,u_pitch_with_map:+Wt,u_is_along_line:Kt,u_is_variable_anchor:Qi,u_texsize:Qs,u_texture:0,u_translation:Jr,u_pitched_scale:ta}},Ne=(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia,aa)=>{const va=_r.transform;return Vt.e(Oe(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,aa),{u_gamma_scale:Kt?Math.cos(va._pitch)*va.cameraToCenterDistance:1,u_device_pixel_ratio:_r.pixelRatio,u_is_halo:+ia})},je=(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia)=>Vt.e(Ne(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,!0,Qs,!0,ia),{u_texsize_icon:ta,u_texture_icon:1}),Ue=(u,F,Vt)=>({u_matrix:u,u_opacity:F,u_color:Vt}),Ze=(u,F,Wt,Kt,Qi,fr)=>Vt.e(function(u,F,Vt,Wt){const Kt=Vt.imageManager.getPattern(u.from.toString()),Qi=Vt.imageManager.getPattern(u.to.toString()),{width:fr,height:_r}=Vt.imageManager.getPixelSize(),Sr=Math.pow(2,Wt.tileID.overscaledZ),Ar=Wt.tileSize*Math.pow(2,Vt.transform.tileZoom)/Sr,Jr=Ar*(Wt.tileID.canonical.x+Wt.tileID.wrap*Sr),zn=Ar*Wt.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Kt.tl,u_pattern_br_a:Kt.br,u_pattern_tl_b:Qi.tl,u_pattern_br_b:Qi.br,u_texsize:[fr,_r],u_mix:F.t,u_pattern_size_a:Kt.displaySize,u_pattern_size_b:Qi.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/Lt(Wt,1,Vt.transform.tileZoom),u_pixel_coord_upper:[Jr>>16,zn>>16],u_pixel_coord_lower:[65535&Jr,65535&zn]}}(Kt,fr,Wt,Qi),{u_matrix:u,u_opacity:F}),ul={fillExtrusion:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_lightpos:new Vt.aL(u,F.u_lightpos),u_lightintensity:new Vt.aI(u,F.u_lightintensity),u_lightcolor:new Vt.aL(u,F.u_lightcolor),u_vertical_gradient:new Vt.aI(u,F.u_vertical_gradient),u_opacity:new Vt.aI(u,F.u_opacity)}),fillExtrusionPattern:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_lightpos:new Vt.aL(u,F.u_lightpos),u_lightintensity:new Vt.aI(u,F.u_lightintensity),u_lightcolor:new Vt.aL(u,F.u_lightcolor),u_vertical_gradient:new Vt.aI(u,F.u_vertical_gradient),u_height_factor:new Vt.aI(u,F.u_height_factor),u_image:new Vt.aH(u,F.u_image),u_texsize:new Vt.aM(u,F.u_texsize),u_pixel_coord_upper:new Vt.aM(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Vt.aM(u,F.u_pixel_coord_lower),u_scale:new Vt.aL(u,F.u_scale),u_fade:new Vt.aI(u,F.u_fade),u_opacity:new Vt.aI(u,F.u_opacity)}),fill:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix)}),fillPattern:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_image:new Vt.aH(u,F.u_image),u_texsize:new Vt.aM(u,F.u_texsize),u_pixel_coord_upper:new Vt.aM(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Vt.aM(u,F.u_pixel_coord_lower),u_scale:new Vt.aL(u,F.u_scale),u_fade:new Vt.aI(u,F.u_fade)}),fillOutline:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_world:new Vt.aM(u,F.u_world)}),fillOutlinePattern:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_world:new Vt.aM(u,F.u_world),u_image:new Vt.aH(u,F.u_image),u_texsize:new Vt.aM(u,F.u_texsize),u_pixel_coord_upper:new Vt.aM(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Vt.aM(u,F.u_pixel_coord_lower),u_scale:new Vt.aL(u,F.u_scale),u_fade:new Vt.aI(u,F.u_fade)}),circle:(u,F)=>({u_camera_to_center_distance:new Vt.aI(u,F.u_camera_to_center_distance),u_scale_with_map:new Vt.aH(u,F.u_scale_with_map),u_pitch_with_map:new Vt.aH(u,F.u_pitch_with_map),u_extrude_scale:new Vt.aM(u,F.u_extrude_scale),u_device_pixel_ratio:new Vt.aI(u,F.u_device_pixel_ratio),u_matrix:new Vt.aJ(u,F.u_matrix)}),collisionBox:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_pixel_extrude_scale:new Vt.aM(u,F.u_pixel_extrude_scale)}),collisionCircle:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_inv_matrix:new Vt.aJ(u,F.u_inv_matrix),u_camera_to_center_distance:new Vt.aI(u,F.u_camera_to_center_distance),u_viewport_size:new Vt.aM(u,F.u_viewport_size)}),debug:(u,F)=>({u_color:new Vt.aN(u,F.u_color),u_matrix:new Vt.aJ(u,F.u_matrix),u_overlay:new Vt.aH(u,F.u_overlay),u_overlay_scale:new Vt.aI(u,F.u_overlay_scale)}),clippingMask:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix)}),heatmap:(u,F)=>({u_extrude_scale:new Vt.aI(u,F.u_extrude_scale),u_intensity:new Vt.aI(u,F.u_intensity),u_matrix:new Vt.aJ(u,F.u_matrix)}),heatmapTexture:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_world:new Vt.aM(u,F.u_world),u_image:new Vt.aH(u,F.u_image),u_color_ramp:new Vt.aH(u,F.u_color_ramp),u_opacity:new Vt.aI(u,F.u_opacity)}),hillshade:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_image:new Vt.aH(u,F.u_image),u_latrange:new Vt.aM(u,F.u_latrange),u_light:new Vt.aM(u,F.u_light),u_shadow:new Vt.aN(u,F.u_shadow),u_highlight:new Vt.aN(u,F.u_highlight),u_accent:new Vt.aN(u,F.u_accent)}),hillshadePrepare:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_image:new Vt.aH(u,F.u_image),u_dimension:new Vt.aM(u,F.u_dimension),u_zoom:new Vt.aI(u,F.u_zoom),u_unpack:new Vt.aK(u,F.u_unpack)}),line:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_ratio:new Vt.aI(u,F.u_ratio),u_device_pixel_ratio:new Vt.aI(u,F.u_device_pixel_ratio),u_units_to_pixels:new Vt.aM(u,F.u_units_to_pixels)}),lineGradient:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_ratio:new Vt.aI(u,F.u_ratio),u_device_pixel_ratio:new Vt.aI(u,F.u_device_pixel_ratio),u_units_to_pixels:new Vt.aM(u,F.u_units_to_pixels),u_image:new Vt.aH(u,F.u_image),u_image_height:new Vt.aI(u,F.u_image_height)}),linePattern:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_texsize:new Vt.aM(u,F.u_texsize),u_ratio:new Vt.aI(u,F.u_ratio),u_device_pixel_ratio:new Vt.aI(u,F.u_device_pixel_ratio),u_image:new Vt.aH(u,F.u_image),u_units_to_pixels:new Vt.aM(u,F.u_units_to_pixels),u_scale:new Vt.aL(u,F.u_scale),u_fade:new Vt.aI(u,F.u_fade)}),lineSDF:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_ratio:new Vt.aI(u,F.u_ratio),u_device_pixel_ratio:new Vt.aI(u,F.u_device_pixel_ratio),u_units_to_pixels:new Vt.aM(u,F.u_units_to_pixels),u_patternscale_a:new Vt.aM(u,F.u_patternscale_a),u_patternscale_b:new Vt.aM(u,F.u_patternscale_b),u_sdfgamma:new Vt.aI(u,F.u_sdfgamma),u_image:new Vt.aH(u,F.u_image),u_tex_y_a:new Vt.aI(u,F.u_tex_y_a),u_tex_y_b:new Vt.aI(u,F.u_tex_y_b),u_mix:new Vt.aI(u,F.u_mix)}),raster:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_tl_parent:new Vt.aM(u,F.u_tl_parent),u_scale_parent:new Vt.aI(u,F.u_scale_parent),u_buffer_scale:new Vt.aI(u,F.u_buffer_scale),u_fade_t:new Vt.aI(u,F.u_fade_t),u_opacity:new Vt.aI(u,F.u_opacity),u_image0:new Vt.aH(u,F.u_image0),u_image1:new Vt.aH(u,F.u_image1),u_brightness_low:new Vt.aI(u,F.u_brightness_low),u_brightness_high:new Vt.aI(u,F.u_brightness_high),u_saturation_factor:new Vt.aI(u,F.u_saturation_factor),u_contrast_factor:new Vt.aI(u,F.u_contrast_factor),u_spin_weights:new Vt.aL(u,F.u_spin_weights)}),symbolIcon:(u,F)=>({u_is_size_zoom_constant:new Vt.aH(u,F.u_is_size_zoom_constant),u_is_size_feature_constant:new Vt.aH(u,F.u_is_size_feature_constant),u_size_t:new Vt.aI(u,F.u_size_t),u_size:new Vt.aI(u,F.u_size),u_camera_to_center_distance:new Vt.aI(u,F.u_camera_to_center_distance),u_pitch:new Vt.aI(u,F.u_pitch),u_rotate_symbol:new Vt.aH(u,F.u_rotate_symbol),u_aspect_ratio:new Vt.aI(u,F.u_aspect_ratio),u_fade_change:new Vt.aI(u,F.u_fade_change),u_matrix:new Vt.aJ(u,F.u_matrix),u_label_plane_matrix:new Vt.aJ(u,F.u_label_plane_matrix),u_coord_matrix:new Vt.aJ(u,F.u_coord_matrix),u_is_text:new Vt.aH(u,F.u_is_text),u_pitch_with_map:new Vt.aH(u,F.u_pitch_with_map),u_is_along_line:new Vt.aH(u,F.u_is_along_line),u_is_variable_anchor:new Vt.aH(u,F.u_is_variable_anchor),u_texsize:new Vt.aM(u,F.u_texsize),u_texture:new Vt.aH(u,F.u_texture),u_translation:new Vt.aM(u,F.u_translation),u_pitched_scale:new Vt.aI(u,F.u_pitched_scale)}),symbolSDF:(u,F)=>({u_is_size_zoom_constant:new Vt.aH(u,F.u_is_size_zoom_constant),u_is_size_feature_constant:new Vt.aH(u,F.u_is_size_feature_constant),u_size_t:new Vt.aI(u,F.u_size_t),u_size:new Vt.aI(u,F.u_size),u_camera_to_center_distance:new Vt.aI(u,F.u_camera_to_center_distance),u_pitch:new Vt.aI(u,F.u_pitch),u_rotate_symbol:new Vt.aH(u,F.u_rotate_symbol),u_aspect_ratio:new Vt.aI(u,F.u_aspect_ratio),u_fade_change:new Vt.aI(u,F.u_fade_change),u_matrix:new Vt.aJ(u,F.u_matrix),u_label_plane_matrix:new Vt.aJ(u,F.u_label_plane_matrix),u_coord_matrix:new Vt.aJ(u,F.u_coord_matrix),u_is_text:new Vt.aH(u,F.u_is_text),u_pitch_with_map:new Vt.aH(u,F.u_pitch_with_map),u_is_along_line:new Vt.aH(u,F.u_is_along_line),u_is_variable_anchor:new Vt.aH(u,F.u_is_variable_anchor),u_texsize:new Vt.aM(u,F.u_texsize),u_texture:new Vt.aH(u,F.u_texture),u_gamma_scale:new Vt.aI(u,F.u_gamma_scale),u_device_pixel_ratio:new Vt.aI(u,F.u_device_pixel_ratio),u_is_halo:new Vt.aH(u,F.u_is_halo),u_translation:new Vt.aM(u,F.u_translation),u_pitched_scale:new Vt.aI(u,F.u_pitched_scale)}),symbolTextAndIcon:(u,F)=>({u_is_size_zoom_constant:new Vt.aH(u,F.u_is_size_zoom_constant),u_is_size_feature_constant:new Vt.aH(u,F.u_is_size_feature_constant),u_size_t:new Vt.aI(u,F.u_size_t),u_size:new Vt.aI(u,F.u_size),u_camera_to_center_distance:new Vt.aI(u,F.u_camera_to_center_distance),u_pitch:new Vt.aI(u,F.u_pitch),u_rotate_symbol:new Vt.aH(u,F.u_rotate_symbol),u_aspect_ratio:new Vt.aI(u,F.u_aspect_ratio),u_fade_change:new Vt.aI(u,F.u_fade_change),u_matrix:new Vt.aJ(u,F.u_matrix),u_label_plane_matrix:new Vt.aJ(u,F.u_label_plane_matrix),u_coord_matrix:new Vt.aJ(u,F.u_coord_matrix),u_is_text:new Vt.aH(u,F.u_is_text),u_pitch_with_map:new Vt.aH(u,F.u_pitch_with_map),u_is_along_line:new Vt.aH(u,F.u_is_along_line),u_is_variable_anchor:new Vt.aH(u,F.u_is_variable_anchor),u_texsize:new Vt.aM(u,F.u_texsize),u_texsize_icon:new Vt.aM(u,F.u_texsize_icon),u_texture:new Vt.aH(u,F.u_texture),u_texture_icon:new Vt.aH(u,F.u_texture_icon),u_gamma_scale:new Vt.aI(u,F.u_gamma_scale),u_device_pixel_ratio:new Vt.aI(u,F.u_device_pixel_ratio),u_is_halo:new Vt.aH(u,F.u_is_halo),u_translation:new Vt.aM(u,F.u_translation),u_pitched_scale:new Vt.aI(u,F.u_pitched_scale)}),background:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_opacity:new Vt.aI(u,F.u_opacity),u_color:new Vt.aN(u,F.u_color)}),backgroundPattern:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_opacity:new Vt.aI(u,F.u_opacity),u_image:new Vt.aH(u,F.u_image),u_pattern_tl_a:new Vt.aM(u,F.u_pattern_tl_a),u_pattern_br_a:new Vt.aM(u,F.u_pattern_br_a),u_pattern_tl_b:new Vt.aM(u,F.u_pattern_tl_b),u_pattern_br_b:new Vt.aM(u,F.u_pattern_br_b),u_texsize:new Vt.aM(u,F.u_texsize),u_mix:new Vt.aI(u,F.u_mix),u_pattern_size_a:new Vt.aM(u,F.u_pattern_size_a),u_pattern_size_b:new Vt.aM(u,F.u_pattern_size_b),u_scale_a:new Vt.aI(u,F.u_scale_a),u_scale_b:new Vt.aI(u,F.u_scale_b),u_pixel_coord_upper:new Vt.aM(u,F.u_pixel_coord_upper),u_pixel_coord_lower:new Vt.aM(u,F.u_pixel_coord_lower),u_tile_units_to_pixels:new Vt.aI(u,F.u_tile_units_to_pixels)}),terrain:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_texture:new Vt.aH(u,F.u_texture),u_ele_delta:new Vt.aI(u,F.u_ele_delta)}),terrainDepth:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_ele_delta:new Vt.aI(u,F.u_ele_delta)}),terrainCoords:(u,F)=>({u_matrix:new Vt.aJ(u,F.u_matrix),u_texture:new Vt.aH(u,F.u_texture),u_terrain_coords_id:new Vt.aI(u,F.u_terrain_coords_id),u_ele_delta:new Vt.aI(u,F.u_ele_delta)})};class We{constructor(u,F,Vt){this.context=u;const Wt=u.gl;this.buffer=Wt.createBuffer(),this.dynamicDraw=Boolean(Vt),this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),Wt.bufferData(Wt.ELEMENT_ARRAY_BUFFER,F.arrayBuffer,this.dynamicDraw?Wt.DYNAMIC_DRAW:Wt.STATIC_DRAW),this.dynamicDraw||delete F.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const F=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),F.bufferSubData(F.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ml={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ve{constructor(u,F,Vt,Wt){this.length=F.length,this.attributes=Vt,this.itemSize=F.bytesPerElement,this.dynamicDraw=Wt,this.context=u;const Kt=u.gl;this.buffer=Kt.createBuffer(),u.bindVertexBuffer.set(this.buffer),Kt.bufferData(Kt.ARRAY_BUFFER,F.arrayBuffer,this.dynamicDraw?Kt.DYNAMIC_DRAW:Kt.STATIC_DRAW),this.dynamicDraw||delete F.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){if(u.length!==this.length)throw new Error(`Length of new data is ${u.length}, which doesn't match current length of ${this.length}`);const F=this.context.gl;this.bind(),F.bufferSubData(F.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,F){for(let Vt=0;Vt<this.attributes.length;Vt++){const Wt=F.attributes[this.attributes[Vt].name];void 0!==Wt&&u.enableVertexAttribArray(Wt)}}setVertexAttribPointers(u,F,Vt){for(let Wt=0;Wt<this.attributes.length;Wt++){const Kt=this.attributes[Wt],Qi=F.attributes[Kt.name];void 0!==Qi&&u.vertexAttribPointer(Qi,Kt.components,u[ml[Kt.type]],!1,this.itemSize,Kt.offset+this.itemSize*(Vt||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _l=new WeakMap;function $e(u){var F;if(_l.has(u))return _l.get(u);{const Vt=null===(F=u.getParameter(u.VERSION))||void 0===F?void 0:F.startsWith("WebGL 2.0");return _l.set(u,Vt),Vt}}class Xe{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ke extends Xe{getDefault(){return Vt.aP.transparent}set(u){const F=this.current;(u.r!==F.r||u.g!==F.g||u.b!==F.b||u.a!==F.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Je extends Xe{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class Ye extends Xe{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class Qe extends Xe{getDefault(){return[!0,!0,!0,!0]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||u[2]!==F[2]||u[3]!==F[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class ti extends Xe{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class ei extends Xe{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class ii extends Xe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const F=this.current;(u.func!==F.func||u.ref!==F.ref||u.mask!==F.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class ai extends Xe{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||u[2]!==F[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class si extends Xe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.STENCIL_TEST):F.disable(F.STENCIL_TEST),this.current=u,this.dirty=!1}}class oi extends Xe{getDefault(){return[0,1]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class ri extends Xe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.DEPTH_TEST):F.disable(F.DEPTH_TEST),this.current=u,this.dirty=!1}}class ni extends Xe{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class li extends Xe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.BLEND):F.disable(F.BLEND),this.current=u,this.dirty=!1}}class hi extends Xe{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class ci extends Xe{getDefault(){return Vt.aP.transparent}set(u){const F=this.current;(u.r!==F.r||u.g!==F.g||u.b!==F.b||u.a!==F.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class ui extends Xe{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class di extends Xe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;u?F.enable(F.CULL_FACE):F.disable(F.CULL_FACE),this.current=u,this.dirty=!1}}class _i extends Xe{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class pi extends Xe{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}class mi extends Xe{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}}class fi extends Xe{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class gi extends Xe{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const F=this.current;(u[0]!==F[0]||u[1]!==F[1]||u[2]!==F[2]||u[3]!==F[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class vi extends Xe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindFramebuffer(F.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class xi extends Xe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindRenderbuffer(F.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class yi extends Xe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindTexture(F.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class bi extends Xe{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.bindBuffer(F.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class wi extends Xe{getDefault(){return null}set(u){const F=this.gl;F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Ti extends Xe{getDefault(){return null}set(u){var F;if(u===this.current&&!this.dirty)return;const Vt=this.gl;$e(Vt)?Vt.bindVertexArray(u):null===(F=Vt.getExtension("OES_vertex_array_object"))||void 0===F||F.bindVertexArrayOES(u),this.current=u,this.dirty=!1}}class Ii extends Xe{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.pixelStorei(F.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class Ei extends Xe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class Pi extends Xe{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const F=this.gl;F.pixelStorei(F.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Ci extends Xe{constructor(u,F){super(u),this.context=u,this.parent=F}getDefault(){return null}}class Si extends Ci{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const F=this.gl;F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Di extends Ci{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const F=this.gl;F.framebufferRenderbuffer(F.FRAMEBUFFER,F.DEPTH_ATTACHMENT,F.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Mi extends Ci{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const F=this.gl;F.framebufferRenderbuffer(F.FRAMEBUFFER,F.DEPTH_STENCIL_ATTACHMENT,F.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class zi{constructor(u,F,Vt,Wt,Kt){this.context=u,this.width=F,this.height=Vt;const Qi=u.gl,fr=this.framebuffer=Qi.createFramebuffer();if(this.colorAttachment=new Si(u,fr),Wt)this.depthAttachment=Kt?new Mi(u,fr):new Di(u,fr);else if(Kt)throw new Error("Stencil cannot be set without depth");if(Qi.checkFramebufferStatus(Qi.FRAMEBUFFER)!==Qi.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const u=this.context.gl,F=this.colorAttachment.get();if(F&&u.deleteTexture(F),this.depthAttachment){const F=this.depthAttachment.get();F&&u.deleteRenderbuffer(F)}u.deleteFramebuffer(this.framebuffer)}}class Ai{constructor(u,F,Vt){this.blendFunction=u,this.blendColor=F,this.mask=Vt}}Ai.Replace=[1,0],Ai.disabled=new Ai(Ai.Replace,Vt.aP.transparent,[!1,!1,!1,!1]),Ai.unblended=new Ai(Ai.Replace,Vt.aP.transparent,[!0,!0,!0,!0]),Ai.alphaBlended=new Ai([1,771],Vt.aP.transparent,[!0,!0,!0,!0]);class Ri{constructor(u){var F,Vt;if(this.gl=u,this.clearColor=new Ke(this),this.clearDepth=new Je(this),this.clearStencil=new Ye(this),this.colorMask=new Qe(this),this.depthMask=new ti(this),this.stencilMask=new ei(this),this.stencilFunc=new ii(this),this.stencilOp=new ai(this),this.stencilTest=new si(this),this.depthRange=new oi(this),this.depthTest=new ri(this),this.depthFunc=new ni(this),this.blend=new li(this),this.blendFunc=new hi(this),this.blendColor=new ci(this),this.blendEquation=new ui(this),this.cullFace=new di(this),this.cullFaceSide=new _i(this),this.frontFace=new pi(this),this.program=new mi(this),this.activeTexture=new fi(this),this.viewport=new gi(this),this.bindFramebuffer=new vi(this),this.bindRenderbuffer=new xi(this),this.bindTexture=new yi(this),this.bindVertexBuffer=new bi(this),this.bindElementBuffer=new wi(this),this.bindVertexArray=new Ti(this),this.pixelStoreUnpack=new Ii(this),this.pixelStoreUnpackPremultiplyAlpha=new Ei(this),this.pixelStoreUnpackFlipY=new Pi(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),$e(u)){this.HALF_FLOAT=u.HALF_FLOAT;const Wt=u.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(F=u.RGBA16F)&&void 0!==F?F:null==Wt?void 0:Wt.RGBA16F_EXT,this.RGB16F=null!==(Vt=u.RGB16F)&&void 0!==Vt?Vt:null==Wt?void 0:Wt.RGB16F_EXT,u.getExtension("EXT_color_buffer_float")}else{u.getExtension("EXT_color_buffer_half_float"),u.getExtension("OES_texture_half_float_linear");const F=u.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==F?void 0:F.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,F){return new We(this,u,F)}createVertexBuffer(u,F,Vt){return new Ve(this,u,F,Vt)}createRenderbuffer(u,F,Vt){const Wt=this.gl,Kt=Wt.createRenderbuffer();return this.bindRenderbuffer.set(Kt),Wt.renderbufferStorage(Wt.RENDERBUFFER,u,F,Vt),this.bindRenderbuffer.set(null),Kt}createFramebuffer(u,F,Vt,Wt){return new zi(this,u,F,Vt,Wt)}clear({color:u,depth:F,stencil:Vt}){const Wt=this.gl;let Kt=0;u&&(Kt|=Wt.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),void 0!==F&&(Kt|=Wt.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(F),this.depthMask.set(!0)),void 0!==Vt&&(Kt|=Wt.STENCIL_BUFFER_BIT,this.clearStencil.set(Vt),this.stencilMask.set(255)),Wt.clear(Kt)}setCullFace(u){!1===u.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){Vt.aE(u.blendFunction,Ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}createVertexArray(){var u;return $e(this.gl)?this.gl.createVertexArray():null===(u=this.gl.getExtension("OES_vertex_array_object"))||void 0===u?void 0:u.createVertexArrayOES()}deleteVertexArray(u){var F;return $e(this.gl)?this.gl.deleteVertexArray(u):null===(F=this.gl.getExtension("OES_vertex_array_object"))||void 0===F?void 0:F.deleteVertexArrayOES(u)}unbindVAO(){this.bindVertexArray.set(null)}}class Li{constructor(u,F,Vt){this.func=u,this.mask=F,this.range=Vt}}Li.ReadOnly=!1,Li.ReadWrite=!0,Li.disabled=new Li(519,Li.ReadOnly,[0,1]);const yl=7680;class Fi{constructor(u,F,Vt,Wt,Kt,Qi){this.test=u,this.ref=F,this.mask=Vt,this.fail=Wt,this.depthFail=Kt,this.pass=Qi}}Fi.disabled=new Fi({func:519,mask:0},0,0,yl,yl,yl);class Bi{constructor(u,F,Vt){this.enable=u,this.mode=F,this.frontFace=Vt}}let vl;function Ni(u,F,Wt,Kt,Qi){const fr=u.context,_r=fr.gl,Sr=u.useProgram("collisionBox"),Ar=[];let Jr=0,zn=0;for(let ta=0;ta<Kt.length;ta++){const ia=Kt[ta],aa=F.getTile(ia).getBucket(Wt);if(!aa)continue;const va=Qi?aa.textCollisionBox:aa.iconCollisionBox,Ba=aa.collisionCircleArray;if(Ba.length>0){const F=Vt.F();Vt.aQ(F,aa.placementInvProjMatrix,u.transform.glCoordMatrix),Vt.aQ(F,F,aa.placementViewportMatrix),Ar.push({circleArray:Ba,circleOffset:zn,transform:ia.posMatrix,invTransform:F,coord:ia}),Jr+=Ba.length/4,zn=Jr}va&&Sr.draw(fr,_r.LINES,Li.disabled,Fi.disabled,u.colorModeForRenderPass(),Bi.disabled,{u_matrix:ia.posMatrix,u_pixel_extrude_scale:[1/(Qs=u.transform).width,1/Qs.height]},u.style.map.terrain&&u.style.map.terrain.getTerrainData(ia),Wt.id,va.layoutVertexBuffer,va.indexBuffer,va.segments,null,u.transform.zoom,null,null,va.collisionVertexBuffer)}var Qs;if(!Qi||!Ar.length)return;const ta=u.useProgram("collisionCircle"),ia=new Vt.aR;ia.resize(4*Jr),ia._trim();let aa=0;for(const u of Ar)for(let F=0;F<u.circleArray.length/4;F++){const Vt=4*F,Wt=u.circleArray[Vt+0],Kt=u.circleArray[Vt+1],Qi=u.circleArray[Vt+2],fr=u.circleArray[Vt+3];ia.emplace(aa++,Wt,Kt,Qi,fr,0),ia.emplace(aa++,Wt,Kt,Qi,fr,1),ia.emplace(aa++,Wt,Kt,Qi,fr,2),ia.emplace(aa++,Wt,Kt,Qi,fr,3)}(!vl||vl.length<2*Jr)&&(vl=function(u){const F=2*u,Wt=new Vt.aT;Wt.resize(F),Wt._trim();for(let u=0;u<F;u++){const F=6*u;Wt.uint16[F+0]=4*u+0,Wt.uint16[F+1]=4*u+1,Wt.uint16[F+2]=4*u+2,Wt.uint16[F+3]=4*u+2,Wt.uint16[F+4]=4*u+3,Wt.uint16[F+5]=4*u+0}return Wt}(Jr));const va=fr.createIndexBuffer(vl,!0),Ba=fr.createVertexBuffer(ia,Vt.aS.members,!0);for(const F of Ar){const Kt=Ee(F.transform,F.invTransform,u.transform);ta.draw(fr,_r.TRIANGLES,Li.disabled,Fi.disabled,u.colorModeForRenderPass(),Bi.disabled,Kt,u.style.map.terrain&&u.style.map.terrain.getTerrainData(F.coord),Wt.id,Ba,va,Vt.$.simpleSegment(0,2*F.circleOffset,F.circleArray.length,F.circleArray.length/2),null,u.transform.zoom,null,null,null)}Ba.destroy(),va.destroy()}Bi.disabled=new Bi(!1,1029,2305),Bi.backCCW=new Bi(!0,1029,2305);const wl=Vt.an(new Float32Array(16));function Ui(u,F,Wt,Kt,Qi,fr){const{horizontalAlign:_r,verticalAlign:Sr}=Vt.au(u);return new Vt.P((-(_r-.5)*F/Qi+Kt[0])*fr,(-(Sr-.5)*Wt/Qi+Kt[1])*fr)}function Zi(u,F,Wt,Kt,Qi,fr){const _r=F.tileAnchorPoint.add(new Vt.P(F.translation[0],F.translation[1]));if(F.pitchWithMap){let u=Kt.mult(fr);return Wt||(u=u.rotate(-Qi)),gt(_r.add(u),F.labelPlaneMatrix,F.getElevation).point}if(Wt){const Vt=Pt(F.tileAnchorPoint.x+1,F.tileAnchorPoint.y,F).point.sub(u),Wt=Math.atan(Vt.y/Vt.x)+(Vt.x<0?Math.PI:0);return u.add(Kt.rotate(Wt))}return u.add(Kt)}function qi(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs,ta,ia){const aa=u.text.placedSymbolArray,va=u.text.dynamicLayoutVertexArray,Ba=u.icon.dynamicLayoutVertexArray,Ya={};va.clear();for(let Ba=0;Ba<aa.length;Ba++){const to=aa.get(Ba),eo=to.hidden||!to.crossTileID||u.allowVerticalPlacement&&!to.placedOrientation?null:Kt[to.crossTileID];if(eo){const Kt=new Vt.P(to.anchorX,to.anchorY),aa={getElevation:ia,width:Qi.width,height:Qi.height,labelPlaneMatrix:fr,lineVertexArray:null,pitchWithMap:Wt,projection:zn,projectionCache:null,tileAnchorPoint:Kt,translation:Qs,unwrappedTileID:ta},Ba=Wt?gt(Kt,_r,ia):Pt(Kt.x,Kt.y,aa),io=vt(Qi.cameraToCenterDistance,Ba.signedDistanceFromCamera);let so=Vt.ai(u.textSizeData,Ar,to)*io/Vt.ap;Wt&&(so*=u.tilePixelRatio/Sr);const{width:co,height:ho,anchor:bo,textOffset:wo,textBoxScale:So}=eo,Ao=Ui(bo,co,ho,wo,So,so),ko=zn.getPitchedTextCorrection(Qi,Kt.add(new Vt.P(Qs[0],Qs[1])),ta),Wo=Zi(Ba.point,aa,F,Ao,Qi.angle,ko),il=u.allowVerticalPlacement&&to.placedOrientation===Vt.ah.vertical?Math.PI/2:0;for(let u=0;u<to.numGlyphs;u++)Vt.aj(va,Wo,il);Jr&&to.associatedIconIndex>=0&&(Ya[to.associatedIconIndex]={shiftedAnchor:Wo,angle:il})}else zt(to.numGlyphs,va)}if(Jr){Ba.clear();const F=u.icon.placedSymbolArray;for(let u=0;u<F.length;u++){const Wt=F.get(u);if(Wt.hidden)zt(Wt.numGlyphs,Ba);else{const F=Ya[u];if(F)for(let u=0;u<Wt.numGlyphs;u++)Vt.aj(Ba,F.shiftedAnchor,F.angle);else zt(Wt.numGlyphs,Ba)}}u.icon.dynamicLayoutVertexBuffer.updateData(Ba)}u.text.dynamicLayoutVertexBuffer.updateData(va)}function Wi(u,F,Vt){return Vt.iconsInText&&F?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Gi(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar,Jr,zn,Qs){const ta=u.context,ia=ta.gl,aa=u.transform,va=Qt(),Ba="map"===Sr,Ya="map"===Ar,to="viewport"!==Sr&&"point"!==Wt.layout.get("symbol-placement"),eo=Ba&&!Ya&&!to,io=!Ya&&to,so=!Wt.layout.get("symbol-sort-key").isConstant();let co=!1;const ho=u.depthModeForSublayer(0,Li.ReadOnly),bo=Wt._unevaluatedLayout.hasValue("text-variable-anchor")||Wt._unevaluatedLayout.hasValue("text-variable-anchor-offset"),wo=[],So=va.getCircleRadiusCorrection(aa);for(const Sr of Kt){const Kt=F.getTile(Sr),Ar=Kt.getBucket(Wt);if(!Ar)continue;const zn=Qi?Ar.text:Ar.icon;if(!zn||!zn.segments.get().length||!zn.hasVisibleVertices)continue;const Qs=zn.programConfigurations.get(Wt.id),ta=Qi||Ar.sdfIcons,ho=Qi?Ar.textSizeData:Ar.iconSizeData,Ao=Ya||0!==aa.pitch,ko=u.useProgram(Wi(ta,Qi,Ar),Qs),Wo=Vt.ag(ho,aa.zoom),il=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Sr);let rl,nl,al,ol,ll=[0,0],cl=null;if(Qi)nl=Kt.glyphAtlasTexture,al=ia.LINEAR,rl=Kt.glyphAtlasTexture.size,Ar.iconsInText&&(ll=Kt.imageAtlasTexture.size,cl=Kt.imageAtlasTexture,ol=Ao||u.options.rotating||u.options.zooming||"composite"===ho.kind||"camera"===ho.kind?ia.LINEAR:ia.NEAREST);else{const F=1!==Wt.layout.get("icon-size").constantOr(0)||Ar.iconsNeedLinear;nl=Kt.imageAtlasTexture,al=ta||u.options.rotating||u.options.zooming||F||Ao?ia.LINEAR:ia.NEAREST,rl=Kt.imageAtlasTexture.size}const hl=Lt(Kt,1,u.transform.zoom),ul=io?Sr.posMatrix:wl,ml=mt(ul,Ya,Ba,u.transform,hl),_l=ft(ul,Ya,Ba,u.transform,hl),yl=ft(Sr.posMatrix,Ya,Ba,u.transform,hl),vl=va.translatePosition(u.transform,Kt,fr,_r),Tl=bo&&Ar.hasTextData(),Il="none"!==Wt.layout.get("icon-text-fit")&&Tl&&Ar.hasIconData();if(to){const F=u.style.map.terrain?(F,Vt)=>u.style.map.terrain.getElevation(Sr,F,Vt):null,Vt="map"===Wt.layout.get("text-rotation-alignment");yt(Ar,Sr.posMatrix,u,Qi,ml,yl,Ya,Jr,Vt,va,Sr.toUnwrapped(),aa.width,aa.height,vl,F)}const El=Sr.posMatrix,zl=Qi&&bo||Il,Dl=to||zl?wl:ml,Ll=_l,Rl=ta&&0!==Wt.paint.get(Qi?"text-halo-width":"icon-halo-width").constantOr(1);let Fl;Fl=ta?Ar.iconsInText?je(ho.kind,Wo,eo,Ya,to,zl,u,El,Dl,Ll,vl,rl,ll,So):Ne(ho.kind,Wo,eo,Ya,to,zl,u,El,Dl,Ll,vl,Qi,rl,!0,So):Oe(ho.kind,Wo,eo,Ya,to,zl,u,El,Dl,Ll,vl,Qi,rl,So);const Vl={program:ko,buffers:zn,uniformValues:Fl,atlasTexture:nl,atlasTextureIcon:cl,atlasInterpolation:al,atlasInterpolationIcon:ol,isSDF:ta,hasHalo:Rl};if(so&&Ar.canOverlap){co=!0;const u=zn.segments.get();for(const F of u)wo.push({segments:new Vt.$([F]),sortKey:F.sortKey,state:Vl,terrainData:il})}else wo.push({segments:zn.segments,sortKey:0,state:Vl,terrainData:il})}co&&wo.sort(((u,F)=>u.sortKey-F.sortKey));for(const F of wo){const Vt=F.state;if(ta.activeTexture.set(ia.TEXTURE0),Vt.atlasTexture.bind(Vt.atlasInterpolation,ia.CLAMP_TO_EDGE),Vt.atlasTextureIcon&&(ta.activeTexture.set(ia.TEXTURE1),Vt.atlasTextureIcon&&Vt.atlasTextureIcon.bind(Vt.atlasInterpolationIcon,ia.CLAMP_TO_EDGE)),Vt.isSDF){const Kt=Vt.uniformValues;Vt.hasHalo&&(Kt.u_is_halo=1,Vi(Vt.buffers,F.segments,Wt,u,Vt.program,ho,zn,Qs,Kt,F.terrainData)),Kt.u_is_halo=0}Vi(Vt.buffers,F.segments,Wt,u,Vt.program,ho,zn,Qs,Vt.uniformValues,F.terrainData)}}function Vi(u,F,Vt,Wt,Kt,Qi,fr,_r,Sr,Ar){const Jr=Wt.context;Kt.draw(Jr,Jr.gl.TRIANGLES,Qi,fr,_r,Bi.disabled,Sr,Ar,Vt.id,u.layoutVertexBuffer,u.indexBuffer,F,Vt.paint,Wt.transform.zoom,u.programConfigurations.get(Vt.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Hi(u,F,Vt,Wt,Kt){if(!Vt||!Wt||!Wt.imageAtlas)return;const Qi=Wt.imageAtlas.patternPositions;let fr=Qi[Vt.to.toString()],_r=Qi[Vt.from.toString()];if(!fr&&_r&&(fr=_r),!_r&&fr&&(_r=fr),!fr||!_r){const u=Kt.getPaintProperty(F);fr=Qi[u],_r=Qi[u]}fr&&_r&&u.setConstantPatternPositions(fr,_r)}function $i(u,F,Vt,Wt,Kt,Qi,fr){const _r=u.context.gl,Sr="fill-pattern",Ar=Vt.paint.get(Sr),Jr=Ar&&Ar.constantOr(1),zn=Vt.getCrossfadeParameters();let Qs,ta,ia,aa,va;fr?(ta=Jr&&!Vt.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Qs=_r.LINES):(ta=Jr?"fillPattern":"fill",Qs=_r.TRIANGLES);const Ba=Ar.constantOr(null);for(const Ar of Wt){const Wt=F.getTile(Ar);if(Jr&&!Wt.patternsLoaded())continue;const Ya=Wt.getBucket(Vt);if(!Ya)continue;const to=Ya.programConfigurations.get(Vt.id),eo=u.useProgram(ta,to),io=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Ar);Jr&&(u.context.activeTexture.set(_r.TEXTURE0),Wt.imageAtlasTexture.bind(_r.LINEAR,_r.CLAMP_TO_EDGE),to.updatePaintBuffers(zn)),Hi(to,Sr,Ba,Wt,Vt);const so=io?Ar:null,co=u.translatePosMatrix(so?so.posMatrix:Ar.posMatrix,Wt,Vt.paint.get("fill-translate"),Vt.paint.get("fill-translate-anchor"));if(fr){aa=Ya.indexBuffer2,va=Ya.segments2;const F=[_r.drawingBufferWidth,_r.drawingBufferHeight];ia="fillOutlinePattern"===ta&&Jr?Te(co,u,zn,Wt,F):we(co,F)}else aa=Ya.indexBuffer,va=Ya.segments,ia=Jr?be(co,u,zn,Wt):ye(co);eo.draw(u.context,Qs,Kt,u.stencilModeForClipping(Ar),Qi,Bi.disabled,ia,io,Vt.id,Ya.layoutVertexBuffer,aa,va,Vt.paint,u.transform.zoom,to)}}function Xi(u,F,Vt,Wt,Kt,Qi,fr){const _r=u.context,Sr=_r.gl,Ar="fill-extrusion-pattern",Jr=Vt.paint.get(Ar),zn=Jr.constantOr(1),Qs=Vt.getCrossfadeParameters(),ta=Vt.paint.get("fill-extrusion-opacity"),ia=Jr.constantOr(null);for(const Jr of Wt){const Wt=F.getTile(Jr),aa=Wt.getBucket(Vt);if(!aa)continue;const va=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Jr),Ba=aa.programConfigurations.get(Vt.id),Ya=u.useProgram(zn?"fillExtrusionPattern":"fillExtrusion",Ba);zn&&(u.context.activeTexture.set(Sr.TEXTURE0),Wt.imageAtlasTexture.bind(Sr.LINEAR,Sr.CLAMP_TO_EDGE),Ba.updatePaintBuffers(Qs)),Hi(Ba,Ar,ia,Wt,Vt);const to=u.translatePosMatrix(Jr.posMatrix,Wt,Vt.paint.get("fill-extrusion-translate"),Vt.paint.get("fill-extrusion-translate-anchor")),eo=Vt.paint.get("fill-extrusion-vertical-gradient"),io=zn?xe(to,u,eo,ta,Jr,Qs,Wt):ve(to,u,eo,ta);Ya.draw(_r,_r.gl.TRIANGLES,Kt,Qi,fr,Bi.backCCW,io,va,Vt.id,aa.layoutVertexBuffer,aa.indexBuffer,aa.segments,Vt.paint,u.transform.zoom,Ba,u.style.map.terrain&&aa.centroidVertexBuffer)}}function Ki(u,F,Vt,Wt,Kt,Qi,fr){const _r=u.context,Sr=_r.gl,Ar=Vt.fbo;if(!Ar)return;const Jr=u.useProgram("hillshade"),zn=u.style.map.terrain&&u.style.map.terrain.getTerrainData(F);_r.activeTexture.set(Sr.TEXTURE0),Sr.bindTexture(Sr.TEXTURE_2D,Ar.colorAttachment.get()),Jr.draw(_r,Sr.TRIANGLES,Kt,Qi,fr,Bi.disabled,((u,F,Vt,Wt)=>{const Kt=Vt.paint.get("hillshade-shadow-color"),Qi=Vt.paint.get("hillshade-highlight-color"),fr=Vt.paint.get("hillshade-accent-color");let _r=Vt.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Vt.paint.get("hillshade-illumination-anchor")&&(_r-=u.transform.angle);const Sr=!u.options.moving;return{u_matrix:Wt?Wt.posMatrix:u.transform.calculatePosMatrix(F.tileID.toUnwrapped(),Sr),u_image:0,u_latrange:De(0,F.tileID),u_light:[Vt.paint.get("hillshade-exaggeration"),_r],u_shadow:Kt,u_highlight:Qi,u_accent:fr}})(u,Vt,Wt,zn?F:null),zn,Wt.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function Ji(u,F,Wt,Kt,Qi,fr){const _r=u.context,Sr=_r.gl,Ar=F.dem;if(Ar&&Ar.data){const Jr=Ar.dim,zn=Ar.stride,Qs=Ar.getPixels();if(_r.activeTexture.set(Sr.TEXTURE1),_r.pixelStoreUnpackPremultiplyAlpha.set(!1),F.demTexture=F.demTexture||u.getTileTexture(zn),F.demTexture){const u=F.demTexture;u.update(Qs,{premultiply:!1}),u.bind(Sr.NEAREST,Sr.CLAMP_TO_EDGE)}else F.demTexture=new b(_r,Qs,Sr.RGBA,{premultiply:!1}),F.demTexture.bind(Sr.NEAREST,Sr.CLAMP_TO_EDGE);_r.activeTexture.set(Sr.TEXTURE0);let ta=F.fbo;if(!ta){const u=new b(_r,{width:Jr,height:Jr,data:null},Sr.RGBA);u.bind(Sr.LINEAR,Sr.CLAMP_TO_EDGE),ta=F.fbo=_r.createFramebuffer(Jr,Jr,!0,!1),ta.colorAttachment.set(u.texture)}_r.bindFramebuffer.set(ta.framebuffer),_r.viewport.set([0,0,Jr,Jr]),u.useProgram("hillshadePrepare").draw(_r,Sr.TRIANGLES,Kt,Qi,fr,Bi.disabled,((u,F)=>{const Wt=F.stride,Kt=Vt.F();return Vt.aO(Kt,0,Vt.W,-Vt.W,0,0,1),Vt.H(Kt,Kt,[0,-Vt.W,0]),{u_matrix:Kt,u_image:1,u_dimension:[Wt,Wt],u_zoom:u.overscaledZ,u_unpack:F.getUnpackVector()}})(F.tileID,Ar),null,Wt.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),F.needsHillshadePrepare=!1}}function Yi(u,F,Wt,Kt,Qi,_r){const Sr=Kt.paint.get("raster-fade-duration");if(!_r&&Sr>0){const Kt=fr.now(),_r=(Kt-u.timeAdded)/Sr,Ar=F?(Kt-F.timeAdded)/Sr:-1,Jr=Wt.getSource(),zn=Qi.coveringZoomLevel({tileSize:Jr.tileSize,roundZoom:Jr.roundZoom}),Qs=!F||Math.abs(F.tileID.overscaledZ-zn)>Math.abs(u.tileID.overscaledZ-zn),ta=Qs&&u.refreshedUponExpiration?1:Vt.ac(Qs?_r:1-Ar,0,1);return u.refreshedUponExpiration&&_r>=1&&(u.refreshedUponExpiration=!1),F?{opacity:1,mix:1-ta}:{opacity:ta,mix:0}}return{opacity:1,mix:0}}const Tl=new Vt.aP(1,0,0,1),Il=new Vt.aP(0,1,0,1),El=new Vt.aP(0,0,1,1),zl=new Vt.aP(1,0,1,1),Dl=new Vt.aP(0,1,1,1);function sa(u,F,Vt,Wt){ra(u,0,F+Vt/2,u.transform.width,Vt,Wt)}function oa(u,F,Vt,Wt){ra(u,F-Vt/2,0,Vt,u.transform.height,Wt)}function ra(u,F,Vt,Wt,Kt,Qi){const fr=u.context,_r=fr.gl;_r.enable(_r.SCISSOR_TEST),_r.scissor(F*u.pixelRatio,Vt*u.pixelRatio,Wt*u.pixelRatio,Kt*u.pixelRatio),fr.clear({color:Qi}),_r.disable(_r.SCISSOR_TEST)}function na(u,F,Wt){const Kt=u.context,Qi=Kt.gl,fr=Wt.posMatrix,_r=u.useProgram("debug"),Sr=Li.disabled,Ar=Fi.disabled,Jr=u.colorModeForRenderPass(),zn="$debug",Qs=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Wt);Kt.activeTexture.set(Qi.TEXTURE0);const ta=F.getTileByID(Wt.key).latestRawTileData,ia=Math.floor((ta&&ta.byteLength||0)/1024),aa=F.getTile(Wt).tileSize,va=512/Math.min(aa,512)*(Wt.overscaledZ/u.transform.zoom)*.5;let Ba=Wt.canonical.toString();Wt.overscaledZ!==Wt.canonical.z&&(Ba+=` => ${Wt.overscaledZ}`),function(u,F){u.initDebugOverlayCanvas();const Vt=u.debugOverlayCanvas,Wt=u.context.gl,Kt=u.debugOverlayCanvas.getContext("2d");Kt.clearRect(0,0,Vt.width,Vt.height),Kt.shadowColor="white",Kt.shadowBlur=2,Kt.lineWidth=1.5,Kt.strokeStyle="white",Kt.textBaseline="top",Kt.font="bold 36px Open Sans, sans-serif",Kt.fillText(F,5,5),Kt.strokeText(F,5,5),u.debugOverlayTexture.update(Vt),u.debugOverlayTexture.bind(Wt.LINEAR,Wt.CLAMP_TO_EDGE)}(u,`${Ba} ${ia}kB`),_r.draw(Kt,Qi.TRIANGLES,Sr,Ar,Ai.alphaBlended,Bi.disabled,Pe(fr,Vt.aP.transparent,va),null,zn,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),_r.draw(Kt,Qi.LINE_STRIP,Sr,Ar,Jr,Bi.disabled,Pe(fr,Vt.aP.red),Qs,zn,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function la(u,F,Vt){const Wt=u.context,Kt=Wt.gl,Qi=u.colorModeForRenderPass(),fr=new Li(Kt.LEQUAL,Li.ReadWrite,u.depthRangeFor3D),_r=u.useProgram("terrain"),Sr=F.getTerrainMesh();Wt.bindFramebuffer.set(null),Wt.viewport.set([0,0,u.width,u.height]);for(const Ar of Vt){const Vt=u.renderToTexture.getTexture(Ar),Jr=F.getTerrainData(Ar.tileID);Wt.activeTexture.set(Kt.TEXTURE0),Kt.bindTexture(Kt.TEXTURE_2D,Vt.texture);const zn={u_matrix:u.transform.calculatePosMatrix(Ar.tileID.toUnwrapped()),u_texture:0,u_ele_delta:F.getMeshFrameDelta(u.transform.zoom)};_r.draw(Wt,Kt.TRIANGLES,fr,Fi.disabled,Qi,Bi.backCCW,zn,Jr,"terrain",Sr.vertexBuffer,Sr.indexBuffer,Sr.segments)}}class ha{constructor(u,F){this.context=new Ri(u),this.transform=F,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:Vt.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ht.maxUnderzooming+ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new re}resize(u,F,Vt){if(this.width=Math.floor(u*Vt),this.height=Math.floor(F*Vt),this.pixelRatio=Vt,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const u=this.context,F=new Vt.aW;F.emplaceBack(0,0),F.emplaceBack(Vt.W,0),F.emplaceBack(0,Vt.W),F.emplaceBack(Vt.W,Vt.W),this.tileExtentBuffer=u.createVertexBuffer(F,ll.members),this.tileExtentSegments=Vt.$.simpleSegment(0,0,4,2);const Wt=new Vt.aW;Wt.emplaceBack(0,0),Wt.emplaceBack(Vt.W,0),Wt.emplaceBack(0,Vt.W),Wt.emplaceBack(Vt.W,Vt.W),this.debugBuffer=u.createVertexBuffer(Wt,ll.members),this.debugSegments=Vt.$.simpleSegment(0,0,4,5);const Kt=new Vt.Z;Kt.emplaceBack(0,0,0,0),Kt.emplaceBack(Vt.W,0,Vt.W,0),Kt.emplaceBack(0,Vt.W,0,Vt.W),Kt.emplaceBack(Vt.W,Vt.W,Vt.W,Vt.W),this.rasterBoundsBuffer=u.createVertexBuffer(Kt,eo.members),this.rasterBoundsSegments=Vt.$.simpleSegment(0,0,4,2);const Qi=new Vt.aW;Qi.emplaceBack(0,0),Qi.emplaceBack(1,0),Qi.emplaceBack(0,1),Qi.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(Qi,ll.members),this.viewportSegments=Vt.$.simpleSegment(0,0,4,2);const fr=new Vt.aX;fr.emplaceBack(0),fr.emplaceBack(1),fr.emplaceBack(3),fr.emplaceBack(2),fr.emplaceBack(0),this.tileBorderIndexBuffer=u.createIndexBuffer(fr);const _r=new Vt.aY;_r.emplaceBack(0,1,2),_r.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(_r);const Sr=this.context.gl;this.stencilClearMode=new Fi({func:Sr.ALWAYS,mask:0},0,255,Sr.ZERO,Sr.ZERO,Sr.ZERO)}clearStencil(){const u=this.context,F=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const Wt=Vt.F();Vt.aO(Wt,0,this.width,this.height,0,0,1),Vt.J(Wt,Wt,[F.drawingBufferWidth,F.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(u,F.TRIANGLES,Li.disabled,this.stencilClearMode,Ai.disabled,Bi.disabled,Ce(Wt),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(u,F){if(this.currentStencilSource===u.source||!u.isTileClipped()||!F||!F.length)return;this.currentStencilSource=u.source;const Vt=this.context,Wt=Vt.gl;this.nextStencilID+F.length>256&&this.clearStencil(),Vt.setColorMode(Ai.disabled),Vt.setDepthMode(Li.disabled);const Kt=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const u of F){const F=this._tileClippingMaskIDs[u.key]=this.nextStencilID++,Qi=this.style.map.terrain&&this.style.map.terrain.getTerrainData(u);Kt.draw(Vt,Wt.TRIANGLES,Li.disabled,new Fi({func:Wt.ALWAYS,mask:0},F,255,Wt.KEEP,Wt.KEEP,Wt.REPLACE),Ai.disabled,Bi.disabled,Ce(u.posMatrix),Qi,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,F=this.context.gl;return new Fi({func:F.NOTEQUAL,mask:255},u,255,F.KEEP,F.KEEP,F.REPLACE)}stencilModeForClipping(u){const F=this.context.gl;return new Fi({func:F.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,F.KEEP,F.KEEP,F.REPLACE)}stencilConfigForOverlap(u){const F=this.context.gl,Vt=u.sort(((u,F)=>F.overscaledZ-u.overscaledZ)),Wt=Vt[Vt.length-1].overscaledZ,Kt=Vt[0].overscaledZ-Wt+1;if(Kt>1){this.currentStencilSource=void 0,this.nextStencilID+Kt>256&&this.clearStencil();const u={};for(let Vt=0;Vt<Kt;Vt++)u[Vt+Wt]=new Fi({func:F.GEQUAL,mask:255},Vt+this.nextStencilID,255,F.KEEP,F.KEEP,F.REPLACE);return this.nextStencilID+=Kt,[u,Vt]}return[{[Wt]:Fi.disabled},Vt]}colorModeForRenderPass(){const u=this.context.gl;if(this._showOverdrawInspector){const F=1/8;return new Ai([u.CONSTANT_COLOR,u.ONE],new Vt.aP(F,F,F,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Ai.unblended:Ai.alphaBlended}depthModeForSublayer(u,F,Vt){if(!this.opaquePassEnabledForLayer())return Li.disabled;const Wt=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new Li(Vt||this.context.gl.LEQUAL,F,[Wt,Wt])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,F){this.style=u,this.options=F,this.lineAtlas=u.lineAtlas,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(fr.now()),this.imageManager.beginFrame();const Wt=this.style._order,Kt=this.style.sourceCaches,Qi={},_r={},Sr={};for(const u in Kt){const F=Kt[u];F.used&&F.prepare(this.context),Qi[u]=F.getVisibleCoordinates(),_r[u]=Qi[u].slice().reverse(),Sr[u]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let u=0;u<Wt.length;u++)if(this.style._layers[Wt[u]].is3D()){this.opaquePassCutoff=u;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const u of Wt){const F=this.style._layers[u];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const Vt=_r[F.source];("custom"===F.type||Vt.length)&&this.renderLayer(this,Kt[F.source],F,Vt)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:F.showOverdrawInspector?Vt.aP.black:Vt.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=F.showOverdrawInspector,this.depthRangeFor3D=[0,1-(u._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=Wt.length-1;this.currentLayer>=0;this.currentLayer--){const u=this.style._layers[Wt[this.currentLayer]],F=Kt[u.source],Vt=Qi[u.source];this._renderTileClippingMasks(u,Vt),this.renderLayer(this,F,u,Vt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<Wt.length;this.currentLayer++){const u=this.style._layers[Wt[this.currentLayer]],F=Kt[u.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(u))continue;const Vt=("symbol"===u.type?Sr:_r)[u.source];this._renderTileClippingMasks(u,Qi[u.source]),this.renderLayer(this,F,u,Vt)}if(this.options.showTileBoundaries){const u=function(u,F){let Vt=null;const Wt=Object.values(u._layers).flatMap((Vt=>Vt.source&&!Vt.isHidden(F)?[u.sourceCaches[Vt.source]]:[])),Kt=Wt.filter((u=>"vector"===u.getSource().type)),Qi=Wt.filter((u=>"vector"!==u.getSource().type)),r=u=>{(!Vt||Vt.getSource().maxzoom<u.getSource().maxzoom)&&(Vt=u)};return Kt.forEach((u=>r(u))),Vt||Qi.forEach((u=>r(u))),Vt}(this.style,this.transform.zoom);u&&function(u,F,Vt){for(let Wt=0;Wt<Vt.length;Wt++)na(u,F,Vt[Wt])}(this,u,u.getVisibleCoordinates())}this.options.showPadding&&function(u){const F=u.transform.padding;sa(u,u.transform.height-(F.top||0),3,Tl),sa(u,F.bottom||0,3,Il),oa(u,F.left||0,3,El),oa(u,u.transform.width-(F.right||0),3,zl);const Vt=u.transform.centerPoint;!function(u,F,Vt,Wt){ra(u,F-1,Vt-10,2,20,Wt),ra(u,F-10,Vt-1,20,2,Wt)}(u,Vt.x,u.transform.height-Vt.y,Dl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(u){if(!this.style||!this.style.map||!this.style.map.terrain)return;const F=this.terrainFacilitator.matrix,Wt=this.transform.projMatrix;let Kt=this.terrainFacilitator.dirty;Kt||(Kt=u?!Vt.aZ(F,Wt):!Vt.a_(F,Wt)),Kt||(Kt=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),Kt&&(Vt.a$(F,Wt),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(u,F){const Wt=u.context,Kt=Wt.gl,Qi=Ai.unblended,fr=new Li(Kt.LEQUAL,Li.ReadWrite,[0,1]),_r=F.getTerrainMesh(),Sr=F.sourceCache.getRenderableTiles(),Ar=u.useProgram("terrainDepth");Wt.bindFramebuffer.set(F.getFramebuffer("depth").framebuffer),Wt.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),Wt.clear({color:Vt.aP.transparent,depth:1});for(const Vt of Sr){const Sr=F.getTerrainData(Vt.tileID),Jr={u_matrix:u.transform.calculatePosMatrix(Vt.tileID.toUnwrapped()),u_ele_delta:F.getMeshFrameDelta(u.transform.zoom)};Ar.draw(Wt,Kt.TRIANGLES,fr,Fi.disabled,Qi,Bi.backCCW,Jr,Sr,"terrain",_r.vertexBuffer,_r.indexBuffer,_r.segments)}Wt.bindFramebuffer.set(null),Wt.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain),function(u,F){const Wt=u.context,Kt=Wt.gl,Qi=Ai.unblended,fr=new Li(Kt.LEQUAL,Li.ReadWrite,[0,1]),_r=F.getTerrainMesh(),Sr=F.getCoordsTexture(),Ar=F.sourceCache.getRenderableTiles(),Jr=u.useProgram("terrainCoords");Wt.bindFramebuffer.set(F.getFramebuffer("coords").framebuffer),Wt.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),Wt.clear({color:Vt.aP.transparent,depth:1}),F.coordsIndex=[];for(const Vt of Ar){const Ar=F.getTerrainData(Vt.tileID);Wt.activeTexture.set(Kt.TEXTURE0),Kt.bindTexture(Kt.TEXTURE_2D,Sr.texture);const zn={u_matrix:u.transform.calculatePosMatrix(Vt.tileID.toUnwrapped()),u_terrain_coords_id:(255-F.coordsIndex.length)/255,u_texture:0,u_ele_delta:F.getMeshFrameDelta(u.transform.zoom)};Jr.draw(Wt,Kt.TRIANGLES,fr,Fi.disabled,Qi,Bi.backCCW,zn,Ar,"terrain",_r.vertexBuffer,_r.indexBuffer,_r.segments),F.coordsIndex.push(Vt.tileID.key)}Wt.bindFramebuffer.set(null),Wt.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain))}renderLayer(u,F,Wt,Kt){if(!Wt.isHidden(this.transform.zoom)&&("background"===Wt.type||"custom"===Wt.type||(Kt||[]).length))switch(this.id=Wt.id,Wt.type){case"symbol":!function(u,F,Wt,Kt,Qi){if("translucent"!==u.renderPass)return;const fr=Fi.disabled,_r=u.colorModeForRenderPass();(Wt._unevaluatedLayout.hasValue("text-variable-anchor")||Wt._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(u,F,Wt,Kt,Qi,fr,_r,Sr,Ar){const Jr=F.transform,zn=Qt(),Qs="map"===Qi,ta="map"===fr;for(const Qi of u){const u=Kt.getTile(Qi),fr=u.getBucket(Wt);if(!fr||!fr.text||!fr.text.segments.get().length)continue;const ia=Vt.ag(fr.textSizeData,Jr.zoom),aa=Lt(u,1,F.transform.zoom),va=mt(Qi.posMatrix,ta,Qs,F.transform,aa),Ba="none"!==Wt.layout.get("icon-text-fit")&&fr.hasIconData();if(ia){const Vt=Math.pow(2,Jr.zoom-u.tileID.overscaledZ),Wt=F.style.map.terrain?(u,Vt)=>F.style.map.terrain.getElevation(Qi,u,Vt):null,Kt=zn.translatePosition(Jr,u,_r,Sr);qi(fr,Qs,ta,Ar,Jr,va,Qi.posMatrix,Vt,ia,Ba,zn,Kt,Qi.toUnwrapped(),Wt)}}}(Kt,u,Wt,F,Wt.layout.get("text-rotation-alignment"),Wt.layout.get("text-pitch-alignment"),Wt.paint.get("text-translate"),Wt.paint.get("text-translate-anchor"),Qi),0!==Wt.paint.get("icon-opacity").constantOr(1)&&Gi(u,F,Wt,Kt,!1,Wt.paint.get("icon-translate"),Wt.paint.get("icon-translate-anchor"),Wt.layout.get("icon-rotation-alignment"),Wt.layout.get("icon-pitch-alignment"),Wt.layout.get("icon-keep-upright"),fr,_r),0!==Wt.paint.get("text-opacity").constantOr(1)&&Gi(u,F,Wt,Kt,!0,Wt.paint.get("text-translate"),Wt.paint.get("text-translate-anchor"),Wt.layout.get("text-rotation-alignment"),Wt.layout.get("text-pitch-alignment"),Wt.layout.get("text-keep-upright"),fr,_r),F.map.showCollisionBoxes&&(Ni(u,F,Wt,Kt,!0),Ni(u,F,Wt,Kt,!1))}(u,F,Wt,Kt,this.style.placement.variableOffsets);break;case"circle":!function(u,F,Wt,Kt){if("translucent"!==u.renderPass)return;const Qi=Wt.paint.get("circle-opacity"),fr=Wt.paint.get("circle-stroke-width"),_r=Wt.paint.get("circle-stroke-opacity"),Sr=!Wt.layout.get("circle-sort-key").isConstant();if(0===Qi.constantOr(1)&&(0===fr.constantOr(1)||0===_r.constantOr(1)))return;const Ar=u.context,Jr=Ar.gl,zn=u.depthModeForSublayer(0,Li.ReadOnly),Qs=Fi.disabled,ta=u.colorModeForRenderPass(),ia=[];for(let Qi=0;Qi<Kt.length;Qi++){const fr=Kt[Qi],_r=F.getTile(fr),Ar=_r.getBucket(Wt);if(!Ar)continue;const Jr=Ar.programConfigurations.get(Wt.id),zn=u.useProgram("circle",Jr),Qs=Ar.layoutVertexBuffer,ta=Ar.indexBuffer,aa=u.style.map.terrain&&u.style.map.terrain.getTerrainData(fr),va={programConfiguration:Jr,program:zn,layoutVertexBuffer:Qs,indexBuffer:ta,uniformValues:Ie(u,fr,_r,Wt),terrainData:aa};if(Sr){const u=Ar.segments.get();for(const F of u)ia.push({segments:new Vt.$([F]),sortKey:F.sortKey,state:va})}else ia.push({segments:Ar.segments,sortKey:0,state:va})}Sr&&ia.sort(((u,F)=>u.sortKey-F.sortKey));for(const F of ia){const{programConfiguration:Vt,program:Kt,layoutVertexBuffer:Qi,indexBuffer:fr,uniformValues:_r,terrainData:Sr}=F.state;Kt.draw(Ar,Jr.TRIANGLES,zn,Qs,ta,Bi.disabled,_r,Sr,Wt.id,Qi,fr,F.segments,Wt.paint,u.transform.zoom,Vt)}}(u,F,Wt,Kt);break;case"heatmap":!function(u,F,Wt,Kt){if(0!==Wt.paint.get("heatmap-opacity"))if("offscreen"===u.renderPass){const Qi=u.context,fr=Qi.gl,_r=Fi.disabled,Sr=new Ai([fr.ONE,fr.ONE],Vt.aP.transparent,[!0,!0,!0,!0]);!function(u,F,Vt){const Wt=u.gl;u.activeTexture.set(Wt.TEXTURE1),u.viewport.set([0,0,F.width/4,F.height/4]);let Kt=Vt.heatmapFbo;if(Kt)Wt.bindTexture(Wt.TEXTURE_2D,Kt.colorAttachment.get()),u.bindFramebuffer.set(Kt.framebuffer);else{const Qi=Wt.createTexture();Wt.bindTexture(Wt.TEXTURE_2D,Qi),Wt.texParameteri(Wt.TEXTURE_2D,Wt.TEXTURE_WRAP_S,Wt.CLAMP_TO_EDGE),Wt.texParameteri(Wt.TEXTURE_2D,Wt.TEXTURE_WRAP_T,Wt.CLAMP_TO_EDGE),Wt.texParameteri(Wt.TEXTURE_2D,Wt.TEXTURE_MIN_FILTER,Wt.LINEAR),Wt.texParameteri(Wt.TEXTURE_2D,Wt.TEXTURE_MAG_FILTER,Wt.LINEAR),Kt=Vt.heatmapFbo=u.createFramebuffer(F.width/4,F.height/4,!1,!1),function(u,F,Vt,Wt){var Kt,Qi;const fr=u.gl,_r=null!==(Kt=u.HALF_FLOAT)&&void 0!==Kt?Kt:fr.UNSIGNED_BYTE,Sr=null!==(Qi=u.RGBA16F)&&void 0!==Qi?Qi:fr.RGBA;fr.texImage2D(fr.TEXTURE_2D,0,Sr,F.width/4,F.height/4,0,fr.RGBA,_r,null),Wt.colorAttachment.set(Vt)}(u,F,Qi,Kt)}}(Qi,u,Wt),Qi.clear({color:Vt.aP.transparent});for(let Vt=0;Vt<Kt.length;Vt++){const Ar=Kt[Vt];if(F.hasRenderableParent(Ar))continue;const Jr=F.getTile(Ar),zn=Jr.getBucket(Wt);if(!zn)continue;const Qs=zn.programConfigurations.get(Wt.id),ta=u.useProgram("heatmap",Qs),{zoom:ia}=u.transform;ta.draw(Qi,fr.TRIANGLES,Li.disabled,_r,Sr,Bi.disabled,Se(Ar.posMatrix,Jr,ia,Wt.paint.get("heatmap-intensity")),null,Wt.id,zn.layoutVertexBuffer,zn.indexBuffer,zn.segments,Wt.paint,u.transform.zoom,Qs)}Qi.viewport.set([0,0,u.width,u.height])}else"translucent"===u.renderPass&&(u.context.setColorMode(u.colorModeForRenderPass()),function(u,F){const Wt=u.context,Kt=Wt.gl,Qi=F.heatmapFbo;if(!Qi)return;Wt.activeTexture.set(Kt.TEXTURE0),Kt.bindTexture(Kt.TEXTURE_2D,Qi.colorAttachment.get()),Wt.activeTexture.set(Kt.TEXTURE1);let fr=F.colorRampTexture;fr||(fr=F.colorRampTexture=new b(Wt,F.colorRamp,Kt.RGBA)),fr.bind(Kt.LINEAR,Kt.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(Wt,Kt.TRIANGLES,Li.disabled,Fi.disabled,u.colorModeForRenderPass(),Bi.disabled,((u,F,Wt,Kt)=>{const Qi=Vt.F();Vt.aO(Qi,0,u.width,u.height,0,0,1);const fr=u.context.gl;return{u_matrix:Qi,u_world:[fr.drawingBufferWidth,fr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}})(u,F),null,F.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,F.paint,u.transform.zoom)}(u,Wt))}(u,F,Wt,Kt);break;case"line":!function(u,F,Wt,Kt){if("translucent"!==u.renderPass)return;const Qi=Wt.paint.get("line-opacity"),fr=Wt.paint.get("line-width");if(0===Qi.constantOr(1)||0===fr.constantOr(1))return;const _r=u.depthModeForSublayer(0,Li.ReadOnly),Sr=u.colorModeForRenderPass(),Ar=Wt.paint.get("line-dasharray"),Jr=Wt.paint.get("line-pattern"),zn=Jr.constantOr(1),Qs=Wt.paint.get("line-gradient"),ta=Wt.getCrossfadeParameters(),ia=zn?"linePattern":Ar?"lineSDF":Qs?"lineGradient":"line",aa=u.context,va=aa.gl;let Ba=!0;for(const Qi of Kt){const Kt=F.getTile(Qi);if(zn&&!Kt.patternsLoaded())continue;const fr=Kt.getBucket(Wt);if(!fr)continue;const Ya=fr.programConfigurations.get(Wt.id),to=u.context.program.get(),eo=u.useProgram(ia,Ya),io=Ba||eo.program!==to,so=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Qi),co=Jr.constantOr(null);if(co&&Kt.imageAtlas){const u=Kt.imageAtlas,F=u.patternPositions[co.to.toString()],Vt=u.patternPositions[co.from.toString()];F&&Vt&&Ya.setConstantPatternPositions(F,Vt)}const ho=so?Qi:null,bo=zn?Ae(u,Kt,Wt,ta,ho):Ar?Re(u,Kt,Wt,Ar,ta,ho):Qs?ze(u,Kt,Wt,fr.lineClipsArray.length,ho):Me(u,Kt,Wt,ho);if(zn)aa.activeTexture.set(va.TEXTURE0),Kt.imageAtlasTexture.bind(va.LINEAR,va.CLAMP_TO_EDGE),Ya.updatePaintBuffers(ta);else if(Ar&&(io||u.lineAtlas.dirty))aa.activeTexture.set(va.TEXTURE0),u.lineAtlas.bind(aa);else if(Qs){const Kt=fr.gradients[Wt.id];let _r=Kt.texture;if(Wt.gradientVersion!==Kt.version){let Sr=256;if(Wt.stepInterpolant){const Wt=F.getSource().maxzoom,Kt=Qi.canonical.z===Wt?Math.ceil(1<<u.transform.maxZoom-Qi.canonical.z):1;Sr=Vt.ac(Vt.aU(fr.maxLineLength/Vt.W*1024*Kt),256,aa.maxTextureSize)}Kt.gradient=Vt.aV({expression:Wt.gradientExpression(),evaluationKey:"lineProgress",resolution:Sr,image:Kt.gradient||void 0,clips:fr.lineClipsArray}),Kt.texture?Kt.texture.update(Kt.gradient):Kt.texture=new b(aa,Kt.gradient,va.RGBA),Kt.version=Wt.gradientVersion,_r=Kt.texture}aa.activeTexture.set(va.TEXTURE0),_r.bind(Wt.stepInterpolant?va.NEAREST:va.LINEAR,va.CLAMP_TO_EDGE)}eo.draw(aa,va.TRIANGLES,_r,u.stencilModeForClipping(Qi),Sr,Bi.disabled,bo,so,Wt.id,fr.layoutVertexBuffer,fr.indexBuffer,fr.segments,Wt.paint,u.transform.zoom,Ya,fr.layoutVertexBuffer2),Ba=!1}}(u,F,Wt,Kt);break;case"fill":!function(u,F,Wt,Kt){const Qi=Wt.paint.get("fill-color"),fr=Wt.paint.get("fill-opacity");if(0===fr.constantOr(1))return;const _r=u.colorModeForRenderPass(),Sr=Wt.paint.get("fill-pattern"),Ar=u.opaquePassEnabledForLayer()&&!Sr.constantOr(1)&&1===Qi.constantOr(Vt.aP.transparent).a&&1===fr.constantOr(0)?"opaque":"translucent";if(u.renderPass===Ar){const Vt=u.depthModeForSublayer(1,"opaque"===u.renderPass?Li.ReadWrite:Li.ReadOnly);$i(u,F,Wt,Kt,Vt,_r,!1)}if("translucent"===u.renderPass&&Wt.paint.get("fill-antialias")){const Vt=u.depthModeForSublayer(Wt.getPaintProperty("fill-outline-color")?2:0,Li.ReadOnly);$i(u,F,Wt,Kt,Vt,_r,!0)}}(u,F,Wt,Kt);break;case"fill-extrusion":!function(u,F,Vt,Wt){const Kt=Vt.paint.get("fill-extrusion-opacity");if(0!==Kt&&"translucent"===u.renderPass){const Qi=new Li(u.context.gl.LEQUAL,Li.ReadWrite,u.depthRangeFor3D);if(1!==Kt||Vt.paint.get("fill-extrusion-pattern").constantOr(1))Xi(u,F,Vt,Wt,Qi,Fi.disabled,Ai.disabled),Xi(u,F,Vt,Wt,Qi,u.stencilModeFor3D(),u.colorModeForRenderPass());else{const Kt=u.colorModeForRenderPass();Xi(u,F,Vt,Wt,Qi,Fi.disabled,Kt)}}}(u,F,Wt,Kt);break;case"hillshade":!function(u,F,Vt,Wt){if("offscreen"!==u.renderPass&&"translucent"!==u.renderPass)return;const Kt=u.context,Qi=u.depthModeForSublayer(0,Li.ReadOnly),fr=u.colorModeForRenderPass(),[_r,Sr]="translucent"===u.renderPass?u.stencilConfigForOverlap(Wt):[{},Wt];for(const Wt of Sr){const Kt=F.getTile(Wt);void 0!==Kt.needsHillshadePrepare&&Kt.needsHillshadePrepare&&"offscreen"===u.renderPass?Ji(u,Kt,Vt,Qi,Fi.disabled,fr):"translucent"===u.renderPass&&Ki(u,Wt,Kt,Vt,Qi,_r[Wt.overscaledZ],fr)}Kt.viewport.set([0,0,u.width,u.height])}(u,F,Wt,Kt);break;case"raster":!function(u,F,Vt,Wt){if("translucent"!==u.renderPass)return;if(0===Vt.paint.get("raster-opacity"))return;if(!Wt.length)return;const Kt=u.context,Qi=Kt.gl,fr=F.getSource(),_r=u.useProgram("raster"),Sr=u.colorModeForRenderPass(),[Ar,Jr]=fr instanceof J?[{},Wt]:u.stencilConfigForOverlap(Wt),zn=Jr[Jr.length-1].overscaledZ,Qs=!u.options.moving;for(const Wt of Jr){const Jr=u.depthModeForSublayer(Wt.overscaledZ-zn,1===Vt.paint.get("raster-opacity")?Li.ReadWrite:Li.ReadOnly,Qi.LESS),ta=F.getTile(Wt);ta.registerFadeDuration(Vt.paint.get("raster-fade-duration"));const ia=F.findLoadedParent(Wt,0),aa=F.findLoadedSibling(Wt),va=Yi(ta,ia||aa||null,F,Vt,u.transform,u.style.map.terrain);let Ba,Ya;const to="nearest"===Vt.paint.get("raster-resampling")?Qi.NEAREST:Qi.LINEAR;Kt.activeTexture.set(Qi.TEXTURE0),ta.texture.bind(to,Qi.CLAMP_TO_EDGE,Qi.LINEAR_MIPMAP_NEAREST),Kt.activeTexture.set(Qi.TEXTURE1),ia?(ia.texture.bind(to,Qi.CLAMP_TO_EDGE,Qi.LINEAR_MIPMAP_NEAREST),Ba=Math.pow(2,ia.tileID.overscaledZ-ta.tileID.overscaledZ),Ya=[ta.tileID.canonical.x*Ba%1,ta.tileID.canonical.y*Ba%1]):ta.texture.bind(to,Qi.CLAMP_TO_EDGE,Qi.LINEAR_MIPMAP_NEAREST);const eo=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Wt),io=eo?Wt:null,so=io?io.posMatrix:u.transform.calculatePosMatrix(Wt.toUnwrapped(),Qs),co=Fe(so,Ya||[0,0],Ba||1,va,Vt);fr instanceof J?_r.draw(Kt,Qi.TRIANGLES,Jr,Fi.disabled,Sr,Bi.disabled,co,eo,Vt.id,fr.boundsBuffer,u.quadTriangleIndexBuffer,fr.boundsSegments):_r.draw(Kt,Qi.TRIANGLES,Jr,Ar[Wt.overscaledZ],Sr,Bi.disabled,co,eo,Vt.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}}(u,F,Wt,Kt);break;case"background":!function(u,F,Vt,Wt){const Kt=Vt.paint.get("background-color"),Qi=Vt.paint.get("background-opacity");if(0===Qi)return;const fr=u.context,_r=fr.gl,Sr=u.transform,Ar=Sr.tileSize,Jr=Vt.paint.get("background-pattern");if(u.isPatternMissing(Jr))return;const zn=!Jr&&1===Kt.a&&1===Qi&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==zn)return;const Qs=Fi.disabled,ta=u.depthModeForSublayer(0,"opaque"===zn?Li.ReadWrite:Li.ReadOnly),ia=u.colorModeForRenderPass(),aa=u.useProgram(Jr?"backgroundPattern":"background"),va=Wt||Sr.coveringTiles({tileSize:Ar,terrain:u.style.map.terrain});Jr&&(fr.activeTexture.set(_r.TEXTURE0),u.imageManager.bind(u.context));const Ba=Vt.getCrossfadeParameters();for(const F of va){const Sr=Wt?F.posMatrix:u.transform.calculatePosMatrix(F.toUnwrapped()),zn=Jr?Ze(Sr,Qi,u,Jr,{tileID:F,tileSize:Ar},Ba):Ue(Sr,Qi,Kt),va=u.style.map.terrain&&u.style.map.terrain.getTerrainData(F);aa.draw(fr,_r.TRIANGLES,ta,Qs,ia,Bi.disabled,zn,va,Vt.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}(u,0,Wt,Kt);break;case"custom":!function(u,F,Vt){const Wt=u.context,Kt=Vt.implementation;if("offscreen"===u.renderPass){const F=Kt.prerender;F&&(u.setCustomLayerDefaults(),Wt.setColorMode(u.colorModeForRenderPass()),F.call(Kt,Wt.gl,u.transform.customLayerMatrix()),Wt.setDirty(),u.setBaseState())}else if("translucent"===u.renderPass){u.setCustomLayerDefaults(),Wt.setColorMode(u.colorModeForRenderPass()),Wt.setStencilMode(Fi.disabled);const F="3d"===Kt.renderingMode?new Li(u.context.gl.LEQUAL,Li.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Li.ReadOnly);Wt.setDepthMode(F),Kt.render(Wt.gl,u.transform.customLayerMatrix()),Wt.setDirty(),u.setBaseState(),Wt.bindFramebuffer.set(null)}}(u,0,Wt)}}translatePosMatrix(u,F,Wt,Kt,Qi){if(!Wt[0]&&!Wt[1])return u;const fr=Qi?"map"===Kt?this.transform.angle:0:"viewport"===Kt?-this.transform.angle:0;if(fr){const u=Math.sin(fr),F=Math.cos(fr);Wt=[Wt[0]*F-Wt[1]*u,Wt[0]*u+Wt[1]*F]}const _r=[Qi?Wt[0]:Lt(F,Wt[0],this.transform.zoom),Qi?Wt[1]:Lt(F,Wt[1],this.transform.zoom),0],Sr=new Float32Array(16);return Vt.H(Sr,u,_r),Sr}saveTileTexture(u){const F=this._tileTextures[u.size[0]];F?F.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const F=this._tileTextures[u];return F&&F.length>0?F.pop():null}isPatternMissing(u){if(!u)return!1;if(!u.from||!u.to)return!0;const F=this.imageManager.getPattern(u.from.toString()),Vt=this.imageManager.getPattern(u.to.toString());return!F||!Vt}useProgram(u,F){this.cache=this.cache||{};const Vt=u+(F?F.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[Vt]||(this.cache[Vt]=new fe(this.context,hl[u],F,ul[u],this._showOverdrawInspector,this.style.map.terrain)),this.cache[Vt]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new b(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:u,drawingBufferHeight:F}=this.context.gl;return this.width!==u||this.height!==F}}class ca{constructor(u,F){this.points=u,this.planes=F}static fromInvProjectionMatrix(u,F,Wt){const Kt=Math.pow(2,Wt),Qi=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((Wt=>{const Qi=1/(Wt=Vt.af([],Wt,u))[3]/F*Kt;return Vt.b0(Wt,Wt,[Qi,Qi,1/Wt[3],Qi])})),fr=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((u=>{const F=function(u,F){var Vt=F[0],Wt=F[1],Kt=F[2],Qi=Vt*Vt+Wt*Wt+Kt*Kt;return Qi>0&&(Qi=1/Math.sqrt(Qi)),u[0]=F[0]*Qi,u[1]=F[1]*Qi,u[2]=F[2]*Qi,u}([],function(u,F,Vt){var Wt=F[0],Kt=F[1],Qi=F[2],fr=Vt[0],_r=Vt[1],Sr=Vt[2];return u[0]=Kt*Sr-Qi*_r,u[1]=Qi*fr-Wt*Sr,u[2]=Wt*_r-Kt*fr,u}([],g([],Qi[u[0]],Qi[u[1]]),g([],Qi[u[2]],Qi[u[1]]))),Vt=-((Wt=F)[0]*(Kt=Qi[u[1]])[0]+Wt[1]*Kt[1]+Wt[2]*Kt[2]);var Wt,Kt;return F.concat(Vt)}));return new ca(Qi,fr)}}class ua{constructor(u,F){this.min=u,this.max=F,this.center=function(u,F,Vt){return u[0]=.5*F[0],u[1]=.5*F[1],u[2]=.5*F[2],u}([],function(u,F,Vt){return u[0]=F[0]+Vt[0],u[1]=F[1]+Vt[1],u[2]=F[2]+Vt[2],u}([],this.min,this.max))}quadrant(u){const F=[u%2==0,u<2],Vt=m(this.min),Wt=m(this.max);for(let u=0;u<F.length;u++)Vt[u]=F[u]?this.min[u]:this.center[u],Wt[u]=F[u]?this.center[u]:this.max[u];return Wt[2]=this.max[2],new ua(Vt,Wt)}distanceX(u){return Math.max(Math.min(this.max[0],u[0]),this.min[0])-u[0]}distanceY(u){return Math.max(Math.min(this.max[1],u[1]),this.min[1])-u[1]}intersects(u){const F=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let Wt=!0;for(let Kt=0;Kt<u.planes.length;Kt++){const Qi=u.planes[Kt];let fr=0;for(let u=0;u<F.length;u++)Vt.b1(Qi,F[u])>=0&&fr++;if(0===fr)return 0;fr!==F.length&&(Wt=!1)}if(Wt)return 2;for(let F=0;F<3;F++){let Vt=Number.MAX_VALUE,Wt=-Number.MAX_VALUE;for(let Kt=0;Kt<u.points.length;Kt++){const Qi=u.points[Kt][F]-this.min[F];Vt=Math.min(Vt,Qi),Wt=Math.max(Wt,Qi)}if(Wt<0||Vt>this.max[F]-this.min[F])return 0}return 1}}class da{constructor(u=0,F=0,Vt=0,Wt=0){if(isNaN(u)||u<0||isNaN(F)||F<0||isNaN(Vt)||Vt<0||isNaN(Wt)||Wt<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=F,this.left=Vt,this.right=Wt}interpolate(u,F,Wt){return null!=F.top&&null!=u.top&&(this.top=Vt.z.number(u.top,F.top,Wt)),null!=F.bottom&&null!=u.bottom&&(this.bottom=Vt.z.number(u.bottom,F.bottom,Wt)),null!=F.left&&null!=u.left&&(this.left=Vt.z.number(u.left,F.left,Wt)),null!=F.right&&null!=u.right&&(this.right=Vt.z.number(u.right,F.right,Wt)),this}getCenter(u,F){const Wt=Vt.ac((this.left+u-this.right)/2,0,u),Kt=Vt.ac((this.top+F-this.bottom)/2,0,F);return new Vt.P(Wt,Kt)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new da(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ll=85.051129;class pa{constructor(u,F,Wt,Kt,Qi){this.tileSize=512,this._renderWorldCopies=void 0===Qi||!!Qi,this._minZoom=u||0,this._maxZoom=F||22,this._minPitch=null==Wt?0:Wt,this._maxPitch=null==Kt?60:Kt,this.setMaxBounds(),this.width=0,this.height=0,this._center=new Vt.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new da,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const u=new pa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return u.apply(this),u}apply(u){this.tileSize=u.tileSize,this.latRange=u.latRange,this.width=u.width,this.height=u.height,this._center=u._center,this._elevation=u._elevation,this.minElevationForCurrentTile=u.minElevationForCurrentTile,this.zoom=u.zoom,this.angle=u.angle,this._fov=u._fov,this._pitch=u._pitch,this._unmodified=u._unmodified,this._edgeInsets=u._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(u){void 0===u?u=!0:null===u&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new Vt.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(u){const F=-Vt.b2(u,-180,180)*Math.PI/180;this.angle!==F&&(this._unmodified=!1,this.angle=F,this._calcMatrices(),this.rotationMatrix=function(){var u=new Vt.A(4);return Vt.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,F,Vt){var Wt=F[0],Kt=F[1],Qi=F[2],fr=F[3],_r=Math.sin(Vt),Sr=Math.cos(Vt);u[0]=Wt*Sr+Qi*_r,u[1]=Kt*Sr+fr*_r,u[2]=Wt*-_r+Qi*Sr,u[3]=Kt*-_r+fr*Sr}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const F=Vt.ac(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==F&&(this._unmodified=!1,this._pitch=F,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=u/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(u){const F=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==F&&(this._unmodified=!1,this._zoom=F,this.tileZoom=Math.max(0,Math.floor(F)),this.scale=this.zoomScale(F),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(u){u!==this._elevation&&(this._elevation=u,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,F,Vt){this._unmodified=!1,this._edgeInsets.interpolate(u,F,Vt),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const F=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,F)}getVisibleUnwrappedCoordinates(u){const F=[new Vt.b3(0,u)];if(this._renderWorldCopies){const Wt=this.pointCoordinate(new Vt.P(0,0)),Kt=this.pointCoordinate(new Vt.P(this.width,0)),Qi=this.pointCoordinate(new Vt.P(this.width,this.height)),fr=this.pointCoordinate(new Vt.P(0,this.height)),_r=Math.floor(Math.min(Wt.x,Kt.x,Qi.x,fr.x)),Sr=Math.floor(Math.max(Wt.x,Kt.x,Qi.x,fr.x)),Ar=1;for(let Wt=_r-Ar;Wt<=Sr+Ar;Wt++)0!==Wt&&F.push(new Vt.b3(Wt,u))}return F}coveringTiles(u){var F,Wt;let Kt=this.coveringZoomLevel(u);const Qi=Kt;if(void 0!==u.minzoom&&Kt<u.minzoom)return[];void 0!==u.maxzoom&&Kt>u.maxzoom&&(Kt=u.maxzoom);const fr=this.pointCoordinate(this.getCameraPoint()),_r=Vt.Y.fromLngLat(this.center),Sr=Math.pow(2,Kt),Ar=[Sr*fr.x,Sr*fr.y,0],Jr=[Sr*_r.x,Sr*_r.y,0],zn=ca.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,Kt);let Qs=u.minzoom||0;!u.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Qs=Kt);const ta=u.terrain?2/Math.min(this.tileSize,u.tileSize)*this.tileSize:3,p=u=>({aabb:new ua([u*Sr,0,0],[(u+1)*Sr,Sr,0]),zoom:0,x:0,y:0,wrap:u,fullyVisible:!1}),ia=[],aa=[],va=Kt,Ba=u.reparseOverscaled?Qi:Kt;if(this._renderWorldCopies)for(let u=1;u<=3;u++)ia.push(p(-u)),ia.push(p(u));for(ia.push(p(0));ia.length>0;){const Kt=ia.pop(),Qi=Kt.x,fr=Kt.y;let _r=Kt.fullyVisible;if(!_r){const u=Kt.aabb.intersects(zn);if(0===u)continue;_r=2===u}const Sr=u.terrain?Ar:Jr,Ya=Kt.aabb.distanceX(Sr),to=Kt.aabb.distanceY(Sr),eo=Math.max(Math.abs(Ya),Math.abs(to));if(Kt.zoom===va||eo>ta+(1<<va-Kt.zoom)-2&&Kt.zoom>=Qs){const u=va-Kt.zoom,F=Ar[0]-.5-(Qi<<u),Wt=Ar[1]-.5-(fr<<u);aa.push({tileID:new Vt.Q(Kt.zoom===va?Ba:Kt.zoom,Kt.wrap,Kt.zoom,Qi,fr),distanceSq:v([Jr[0]-.5-Qi,Jr[1]-.5-fr]),tileDistanceToCamera:Math.sqrt(F*F+Wt*Wt)})}else for(let Sr=0;Sr<4;Sr++){const Ar=(Qi<<1)+Sr%2,Jr=(fr<<1)+(Sr>>1),zn=Kt.zoom+1;let Qs=Kt.aabb.quadrant(Sr);if(u.terrain){const Qi=new Vt.Q(zn,Kt.wrap,zn,Ar,Jr),fr=u.terrain.getMinMaxElevation(Qi),_r=null!==(F=fr.minElevation)&&void 0!==F?F:this.elevation,Sr=null!==(Wt=fr.maxElevation)&&void 0!==Wt?Wt:this.elevation;Qs=new ua([Qs.min[0],Qs.min[1],_r],[Qs.max[0],Qs.max[1],Sr])}ia.push({aabb:Qs,zoom:zn,x:Ar,y:Jr,wrap:Kt.wrap,fullyVisible:_r})}}return aa.sort(((u,F)=>u.distanceSq-F.distanceSq)).map((u=>u.tileID))}resize(u,F){this.width=u,this.height=F,this.pixelsToGLUnits=[2/u,-2/F],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log(u)/Math.LN2}project(u){const F=Vt.ac(u.lat,-85.051129,Ll);return new Vt.P(Vt.N(u.lng)*this.worldSize,Vt.O(F)*this.worldSize)}unproject(u){return new Vt.Y(u.x/this.worldSize,u.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(u){const F=this.elevation,Wt=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,Kt=this.pointLocation(this.centerPoint,u),Qi=u.getElevationForLngLatZoom(Kt,this.tileZoom);if(!(this.elevation-Qi))return;const fr=Wt+F-Qi,_r=Math.cos(this._pitch)*this.cameraToCenterDistance/fr/Vt.b4(1,Kt.lat),Sr=this.scaleZoom(_r/this.tileSize);this._elevation=Qi,this._center=Kt,this.zoom=Sr}setLocationAtPoint(u,F){const Wt=this.pointCoordinate(F),Kt=this.pointCoordinate(this.centerPoint),Qi=this.locationCoordinate(u),fr=new Vt.Y(Qi.x-(Wt.x-Kt.x),Qi.y-(Wt.y-Kt.y));this.center=this.coordinateLocation(fr),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(u,F){return F?this.coordinatePoint(this.locationCoordinate(u),F.getElevationForLngLatZoom(u,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(u))}pointLocation(u,F){return this.coordinateLocation(this.pointCoordinate(u,F))}locationCoordinate(u){return Vt.Y.fromLngLat(u)}coordinateLocation(u){return u&&u.toLngLat()}pointCoordinate(u,F){if(F){const Vt=F.pointCoordinate(u);if(null!=Vt)return Vt}const Wt=[u.x,u.y,0,1],Kt=[u.x,u.y,1,1];Vt.af(Wt,Wt,this.pixelMatrixInverse),Vt.af(Kt,Kt,this.pixelMatrixInverse);const Qi=Wt[3],fr=Kt[3],_r=Wt[1]/Qi,Sr=Kt[1]/fr,Ar=Wt[2]/Qi,Jr=Kt[2]/fr,zn=Ar===Jr?0:(0-Ar)/(Jr-Ar);return new Vt.Y(Vt.z.number(Wt[0]/Qi,Kt[0]/fr,zn)/this.worldSize,Vt.z.number(_r,Sr,zn)/this.worldSize)}coordinatePoint(u,F=0,Wt=this.pixelMatrix){const Kt=[u.x*this.worldSize,u.y*this.worldSize,F,1];return Vt.af(Kt,Kt,Wt),new Vt.P(Kt[0]/Kt[3],Kt[1]/Kt[3])}getBounds(){const u=Math.max(0,this.height/2-this.getHorizon());return(new W).extend(this.pointLocation(new Vt.P(0,u))).extend(this.pointLocation(new Vt.P(this.width,u))).extend(this.pointLocation(new Vt.P(this.width,this.height))).extend(this.pointLocation(new Vt.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new W([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(u){u?(this.lngRange=[u.getWest(),u.getEast()],this.latRange=[u.getSouth(),u.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ll])}calculatePosMatrix(u,F=!1){const Wt=u.key,Kt=F?this._alignedPosMatrixCache:this._posMatrixCache;if(Kt[Wt])return Kt[Wt];const Qi=u.canonical,fr=this.worldSize/this.zoomScale(Qi.z),_r=Qi.x+Math.pow(2,Qi.z)*u.wrap,Sr=Vt.an(new Float64Array(16));return Vt.H(Sr,Sr,[_r*fr,Qi.y*fr,0]),Vt.J(Sr,Sr,[fr/Vt.W,fr/Vt.W,1]),Vt.K(Sr,F?this.alignedProjMatrix:this.projMatrix,Sr),Kt[Wt]=new Float32Array(Sr),Kt[Wt]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(u,F){F=Vt.ac(+F,this.minZoom,this.maxZoom);const Wt={center:new Vt.M(u.lng,u.lat),zoom:F};let Kt=this.lngRange;if(!this._renderWorldCopies&&null===Kt){const u=180-1e-10;Kt=[-u,u]}const Qi=this.tileSize*this.zoomScale(Wt.zoom);let fr=0,_r=Qi,Sr=0,Ar=Qi,Jr=0,zn=0;const{x:Qs,y:ta}=this.size;if(this.latRange){const u=this.latRange;fr=Vt.O(u[1])*Qi,_r=Vt.O(u[0])*Qi,_r-fr<ta&&(Jr=ta/(_r-fr))}Kt&&(Sr=Vt.b2(Vt.N(Kt[0])*Qi,0,Qi),Ar=Vt.b2(Vt.N(Kt[1])*Qi,0,Qi),Ar<Sr&&(Ar+=Qi),Ar-Sr<Qs&&(zn=Qs/(Ar-Sr)));const{x:ia,y:aa}=this.project.call({worldSize:Qi},u);let va,Ba;const Ya=Math.max(zn||0,Jr||0);if(Ya){const u=new Vt.P(zn?(Ar+Sr)/2:ia,Jr?(_r+fr)/2:aa);return Wt.center=this.unproject.call({worldSize:Qi},u).wrap(),Wt.zoom+=this.scaleZoom(Ya),Wt}if(this.latRange){const u=ta/2;aa-u<fr&&(Ba=fr+u),aa+u>_r&&(Ba=_r-u)}if(Kt){const u=(Sr+Ar)/2;let F=ia;this._renderWorldCopies&&(F=Vt.b2(ia,u-Qi/2,u+Qi/2));const Wt=Qs/2;F-Wt<Sr&&(va=Sr+Wt),F+Wt>Ar&&(va=Ar-Wt)}if(void 0!==va||void 0!==Ba){const u=new Vt.P(null!=va?va:ia,null!=Ba?Ba:aa);Wt.center=this.unproject.call({worldSize:Qi},u).wrap()}return Wt}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u=this._unmodified,{center:F,zoom:Vt}=this.getConstrained(this.center,this.zoom);this.center=F,this.zoom=Vt,this._unmodified=u,this._constraining=!1}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,F=this.point.x,Wt=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=Vt.b4(1,this.center.lat)*this.worldSize;let Kt=Vt.an(new Float64Array(16));Vt.J(Kt,Kt,[this.width/2,-this.height/2,1]),Vt.H(Kt,Kt,[1,-1,0]),this.labelPlaneMatrix=Kt,Kt=Vt.an(new Float64Array(16)),Vt.J(Kt,Kt,[1,-1,1]),Vt.H(Kt,Kt,[-1,-1,0]),Vt.J(Kt,Kt,[2/this.width,2/this.height,1]),this.glCoordMatrix=Kt;const Qi=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),fr=Math.min(this.elevation,this.minElevationForCurrentTile),_r=Qi-fr*this._pixelPerMeter/Math.cos(this._pitch),Sr=fr<0?_r:Qi,Ar=Math.PI/2+this._pitch,Jr=this._fov*(.5+u.y/this.height),zn=Math.sin(Jr)*Sr/Math.sin(Vt.ac(Math.PI-Ar-Jr,.01,Math.PI-.01)),Qs=this.getHorizon(),ta=2*Math.atan(Qs/this.cameraToCenterDistance)*(.5+u.y/(2*Qs)),ia=Math.sin(ta)*Sr/Math.sin(Vt.ac(Math.PI-Ar-ta,.01,Math.PI-.01)),aa=Math.min(zn,ia),va=1.01*(Math.cos(Math.PI/2-this._pitch)*aa+Sr),Ba=this.height/50;Kt=new Float64Array(16),Vt.b5(Kt,this._fov,this.width/this.height,Ba,va),Kt[8]=2*-u.x/this.width,Kt[9]=2*u.y/this.height,Vt.J(Kt,Kt,[1,-1,1]),Vt.H(Kt,Kt,[0,0,-this.cameraToCenterDistance]),Vt.b6(Kt,Kt,this._pitch),Vt.ad(Kt,Kt,this.angle),Vt.H(Kt,Kt,[-F,-Wt,0]),this.mercatorMatrix=Vt.J([],Kt,[this.worldSize,this.worldSize,this.worldSize]),Vt.J(Kt,Kt,[1,1,this._pixelPerMeter]),this.pixelMatrix=Vt.K(new Float64Array(16),this.labelPlaneMatrix,Kt),Vt.H(Kt,Kt,[0,0,-this.elevation]),this.projMatrix=Kt,this.invProjMatrix=Vt.as([],Kt),this.pixelMatrix3D=Vt.K(new Float64Array(16),this.labelPlaneMatrix,Kt);const Ya=this.width%2/2,to=this.height%2/2,eo=Math.cos(this.angle),io=Math.sin(this.angle),so=F-Math.round(F)+eo*Ya+io*to,co=Wt-Math.round(Wt)+eo*to+io*Ya,ho=new Float64Array(Kt);if(Vt.H(ho,ho,[so>.5?so-1:so,co>.5?co-1:co,0]),this.alignedProjMatrix=ho,Kt=Vt.as(new Float64Array(16),this.pixelMatrix),!Kt)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Kt,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const u=this.pointCoordinate(new Vt.P(0,0)),F=[u.x*this.worldSize,u.y*this.worldSize,0,1];return Vt.af(F,F,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Vt.P(0,u))}getCameraQueryGeometry(u){const F=this.getCameraPoint();if(1===u.length)return[u[0],F];{let Wt=F.x,Kt=F.y,Qi=F.x,fr=F.y;for(const F of u)Wt=Math.min(Wt,F.x),Kt=Math.min(Kt,F.y),Qi=Math.max(Qi,F.x),fr=Math.max(fr,F.y);return[new Vt.P(Wt,Kt),new Vt.P(Qi,Kt),new Vt.P(Qi,fr),new Vt.P(Wt,fr),new Vt.P(Wt,Kt)]}}lngLatToCameraDepth(u,F){const Wt=this.locationCoordinate(u),Kt=[Wt.x*this.worldSize,Wt.y*this.worldSize,F,1];return Vt.af(Kt,Kt,this.projMatrix),Kt[2]/Kt[3]}}function ma(F,Vt){let Wt,Kt=!1,Qi=null,fr=null;const r=()=>{Qi=null,Kt&&(F.apply(fr,Wt),Qi=setTimeout(r,Vt),Kt=!1)};return(...F)=>(Kt=!0,fr=this||u,Wt=F,Qi||r(),Qi)}class fa{constructor(u){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let F;return u.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(F=u)})),(F&&F[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some((u=>isNaN(u)))){const F=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:F,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,u)}catch(u){}},this._updateHash=ma(this._updateHashUnthrottled,300),this._hashName=u&&encodeURIComponent(u)}addTo(u){return this._map=u,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(u){const F=this._map.getCenter(),Vt=Math.round(100*this._map.getZoom())/100,Wt=Math.ceil((Vt*Math.LN2+Math.log(512/360/.5))/Math.LN10),Kt=Math.pow(10,Wt),Qi=Math.round(F.lng*Kt)/Kt,fr=Math.round(F.lat*Kt)/Kt,_r=this._map.getBearing(),Sr=this._map.getPitch();let Ar="";if(Ar+=u?`/${Qi}/${fr}/${Vt}`:`${Vt}/${fr}/${Qi}`,(_r||Sr)&&(Ar+="/"+Math.round(10*_r)/10),Sr&&(Ar+=`/${Math.round(Sr)}`),this._hashName){const u=this._hashName;let F=!1;const Vt=window.location.hash.slice(1).split("&").map((Vt=>{const Wt=Vt.split("=")[0];return Wt===u?(F=!0,`${Wt}=${Ar}`):Vt})).filter((u=>u));return F||Vt.push(`${u}=${Ar}`),`#${Vt.join("&")}`}return`#${Ar}`}}const Rl={linearity:.3,easing:Vt.b7(0,0,.3,1)},Fl=Vt.e({deceleration:2500,maxSpeed:1400},Rl),Vl=Vt.e({deceleration:20,maxSpeed:1400},Rl),Ul=Vt.e({deceleration:1e3,maxSpeed:360},Rl),Nl=Vt.e({deceleration:1e3,maxSpeed:90},Rl);class wa{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:fr.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,F=fr.now();for(;u.length>0&&F-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const F={zoom:0,bearing:0,pitch:0,pan:new Vt.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)F.zoom+=u.zoomDelta||0,F.bearing+=u.bearingDelta||0,F.pitch+=u.pitchDelta||0,u.panDelta&&F.pan._add(u.panDelta),u.around&&(F.around=u.around),u.pinchAround&&(F.pinchAround=u.pinchAround);const Wt=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,Kt={};if(F.pan.mag()){const Qi=Ia(F.pan.mag(),Wt,Vt.e({},Fl,u||{}));Kt.offset=F.pan.mult(Qi.amount/F.pan.mag()),Kt.center=this._map.transform.center,Ta(Kt,Qi)}if(F.zoom){const u=Ia(F.zoom,Wt,Vl);Kt.zoom=this._map.transform.zoom+u.amount,Ta(Kt,u)}if(F.bearing){const u=Ia(F.bearing,Wt,Ul);Kt.bearing=this._map.transform.bearing+Vt.ac(u.amount,-179,179),Ta(Kt,u)}if(F.pitch){const u=Ia(F.pitch,Wt,Nl);Kt.pitch=this._map.transform.pitch+u.amount,Ta(Kt,u)}if(Kt.zoom||Kt.bearing){const u=void 0===F.pinchAround?F.around:F.pinchAround;Kt.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),Vt.e(Kt,{noMoveStart:!0})}}function Ta(u,F){(!u.duration||u.duration<F.duration)&&(u.duration=F.duration,u.easing=F.easing)}function Ia(u,F,Wt){const{maxSpeed:Kt,linearity:Qi,deceleration:fr}=Wt,_r=Vt.ac(u*Qi/(F/1e3),-Kt,Kt),Sr=Math.abs(_r)/(fr*Qi);return{easing:Wt.easing,duration:1e3*Sr,amount:_r*(Sr/2)}}class Ea extends Vt.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,F,Wt,Kt={}){const Qi=r.mousePos(F.getCanvas(),Wt),fr=F.unproject(Qi);super(u,Vt.e({point:Qi,lngLat:fr,originalEvent:Wt},Kt)),this._defaultPrevented=!1,this.target=F}}class Pa extends Vt.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,F,Wt){const Kt="touchend"===u?Wt.changedTouches:Wt.touches,Qi=r.touchPos(F.getCanvasContainer(),Kt),fr=Qi.map((u=>F.unproject(u))),_r=Qi.reduce(((u,F,Vt,Wt)=>u.add(F.div(Wt.length))),new Vt.P(0,0));super(u,{points:Qi,point:_r,lngLats:fr,lngLat:F.unproject(_r),originalEvent:Wt}),this._defaultPrevented=!1}}class Ca extends Vt.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,F,Vt){super(u,{originalEvent:Vt}),this._defaultPrevented=!1}}class Sa{constructor(u,F){this._map=u,this._clickTolerance=F.clickTolerance}reset(){delete this._mousedownPos}wheel(u){return this._firePreventable(new Ca(u.type,this._map,u))}mousedown(u,F){return this._mousedownPos=F,this._firePreventable(new Ea(u.type,this._map,u))}mouseup(u){this._map.fire(new Ea(u.type,this._map,u))}click(u,F){this._mousedownPos&&this._mousedownPos.dist(F)>=this._clickTolerance||this._map.fire(new Ea(u.type,this._map,u))}dblclick(u){return this._firePreventable(new Ea(u.type,this._map,u))}mouseover(u){this._map.fire(new Ea(u.type,this._map,u))}mouseout(u){this._map.fire(new Ea(u.type,this._map,u))}touchstart(u){return this._firePreventable(new Pa(u.type,this._map,u))}touchmove(u){this._map.fire(new Pa(u.type,this._map,u))}touchend(u){this._map.fire(new Pa(u.type,this._map,u))}touchcancel(u){this._map.fire(new Pa(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Da{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(u){this._map.fire(new Ea(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ea("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._ignoreContextMenu||this._map.fire(new Ea(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ma{constructor(u){this._map=u}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(u){return this.transform.pointLocation(Vt.P.convert(u),this._map.terrain)}}class za{constructor(u,F){this._map=u,this._tr=new Ma(u),this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=F.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,F){this.isEnabled()&&u.shiftKey&&0===u.button&&(r.disableDrag(),this._startPos=this._lastPos=F,this._active=!0)}mousemoveWindow(u,F){if(!this._active)return;const Vt=F;if(this._lastPos.equals(Vt)||!this._box&&Vt.dist(this._startPos)<this._clickTolerance)return;const Wt=this._startPos;this._lastPos=Vt,this._box||(this._box=r.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",u));const Kt=Math.min(Wt.x,Vt.x),Qi=Math.max(Wt.x,Vt.x),fr=Math.min(Wt.y,Vt.y),_r=Math.max(Wt.y,Vt.y);r.setTransform(this._box,`translate(${Kt}px,${fr}px)`),this._box.style.width=Qi-Kt+"px",this._box.style.height=_r-fr+"px"}mouseupWindow(u,F){if(!this._active)return;if(0!==u.button)return;const Wt=this._startPos,Kt=F;if(this.reset(),r.suppressClick(),Wt.x!==Kt.x||Wt.y!==Kt.y)return this._map.fire(new Vt.k("boxzoomend",{originalEvent:u})),{cameraAnimation:u=>u.fitScreenCoordinates(Wt,Kt,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",u)}keydown(u){this._active&&27===u.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",u))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(u,F){return this._map.fire(new Vt.k(u,{originalEvent:F}))}}function Aa(u,F){if(u.length!==F.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${F.length}`);const Vt={};for(let Wt=0;Wt<u.length;Wt++)Vt[u[Wt].identifier]=F[Wt];return Vt}class Ra{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(u,F,Wt){(this.centroid||Wt.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=u.timeStamp),Wt.length===this.numTouches&&(this.centroid=function(u){const F=new Vt.P(0,0);for(const Vt of u)F._add(Vt);return F.div(u.length)}(F),this.touches=Aa(Wt,F)))}touchmove(u,F,Vt){if(this.aborted||!this.centroid)return;const Wt=Aa(Vt,F);for(const u in this.touches){const F=Wt[u];(!F||F.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(u,F,Vt){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),0===Vt.length){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class La{constructor(u){this.singleTap=new Ra(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(u,F,Vt){this.singleTap.touchstart(u,F,Vt)}touchmove(u,F,Vt){this.singleTap.touchmove(u,F,Vt)}touchend(u,F,Vt){const Wt=this.singleTap.touchend(u,F,Vt);if(Wt){const F=u.timeStamp-this.lastTime<500,Vt=!this.lastTap||this.lastTap.dist(Wt)<30;if(F&&Vt||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=Wt,this.count===this.numTaps)return this.reset(),Wt}}}class ka{constructor(u){this._tr=new Ma(u),this._zoomIn=new La({numTouches:1,numTaps:2}),this._zoomOut=new La({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,F,Vt){this._zoomIn.touchstart(u,F,Vt),this._zoomOut.touchstart(u,F,Vt)}touchmove(u,F,Vt){this._zoomIn.touchmove(u,F,Vt),this._zoomOut.touchmove(u,F,Vt)}touchend(u,F,Vt){const Wt=this._zoomIn.touchend(u,F,Vt),Kt=this._zoomOut.touchend(u,F,Vt),Qi=this._tr;return Wt?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:Qi.zoom+1,around:Qi.unproject(Wt)},{originalEvent:u})}):Kt?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:Qi.zoom-1,around:Qi.unproject(Kt)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fa{constructor(u){this._enabled=!!u.enable,this._moveStateManager=u.moveStateManager,this._clickTolerance=u.clickTolerance||1,this._moveFunction=u.move,this._activateOnStart=!!u.activateOnStart,u.assignEvents(this),this.reset()}reset(u){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(u)}_move(...u){const F=this._moveFunction(...u);if(F.bearingDelta||F.pitchDelta||F.around||F.panDelta)return this._active=!0,F}dragStart(u,F){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(u)&&(this._moveStateManager.startMove(u),this._lastPoint=F.length?F[0]:F,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(u,F){if(!this.isEnabled())return;const Vt=this._lastPoint;if(!Vt)return;if(u.preventDefault(),!this._moveStateManager.isValidMoveEvent(u))return void this.reset(u);const Wt=F.length?F[0]:F;return!this._moved&&Wt.dist(Vt)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=Wt,this._move(Vt,Wt))}dragEnd(u){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(u)&&(this._moved&&r.suppressClick(),this.reset(u))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const jl={0:1,2:2};class Oa{constructor(u){this._correctEvent=u.checkCorrectEvent}startMove(u){const F=r.mouseButton(u);this._eventButton=F}endMove(u){delete this._eventButton}isValidStartEvent(u){return this._correctEvent(u)}isValidMoveEvent(u){return!function(u,F){const Vt=jl[F];return void 0===u.buttons||(u.buttons&Vt)!==Vt}(u,this._eventButton)}isValidEndEvent(u){return r.mouseButton(u)===this._eventButton}}class Na{constructor(){this._firstTouch=void 0}_isOneFingerTouch(u){return 1===u.targetTouches.length}_isSameTouchEvent(u){return u.targetTouches[0].identifier===this._firstTouch}startMove(u){this._firstTouch=u.targetTouches[0].identifier}endMove(u){delete this._firstTouch}isValidStartEvent(u){return this._isOneFingerTouch(u)}isValidMoveEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}isValidEndEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}}const ja=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=u=>{u.preventDefault()}},Ua=({enable:u,clickTolerance:F,bearingDegreesPerPixelMoved:Vt=.8})=>{const Wt=new Oa({checkCorrectEvent:u=>0===r.mouseButton(u)&&u.ctrlKey||2===r.mouseButton(u)});return new Fa({clickTolerance:F,move:(u,F)=>({bearingDelta:(F.x-u.x)*Vt}),moveStateManager:Wt,enable:u,assignEvents:ja})},Za=({enable:u,clickTolerance:F,pitchDegreesPerPixelMoved:Vt=-.5})=>{const Wt=new Oa({checkCorrectEvent:u=>0===r.mouseButton(u)&&u.ctrlKey||2===r.mouseButton(u)});return new Fa({clickTolerance:F,move:(u,F)=>({pitchDelta:(F.y-u.y)*Vt}),moveStateManager:Wt,enable:u,assignEvents:ja})};class qa{constructor(u,F){this._clickTolerance=u.clickTolerance||1,this._map=F,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new Vt.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(u,F,Vt){return this._calculateTransform(u,F,Vt)}touchmove(u,F,Vt){if(this._active&&!(Vt.length<this.minTouchs()))return u.preventDefault(),this._calculateTransform(u,F,Vt)}touchend(u,F,Vt){this._calculateTransform(u,F,Vt),this._active&&Vt.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,F,Wt){Wt.length>0&&(this._active=!0);const Kt=Aa(Wt,F),Qi=new Vt.P(0,0),fr=new Vt.P(0,0);let _r=0;for(const u in Kt){const F=Kt[u],Vt=this._touches[u];Vt&&(Qi._add(F),fr._add(F.sub(Vt)),_r++,Kt[u]=F)}if(this._touches=Kt,_r<this.minTouchs()||!fr.mag())return;const Sr=fr.div(_r);return this._sum._add(Sr),this._sum.mag()<this._clickTolerance?void 0:{around:Qi.div(_r),panDelta:Sr}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(u,F,Vt){this._firstTwoTouches||Vt.length<2||(this._firstTwoTouches=[Vt[0].identifier,Vt[1].identifier],this._start([F[0],F[1]]))}touchmove(u,F,Vt){if(!this._firstTwoTouches)return;u.preventDefault();const[Wt,Kt]=this._firstTwoTouches,Qi=Ga(Vt,F,Wt),fr=Ga(Vt,F,Kt);if(!Qi||!fr)return;const _r=this._aroundCenter?null:Qi.add(fr).div(2);return this._move([Qi,fr],_r,u)}touchend(u,F,Vt){if(!this._firstTwoTouches)return;const[Wt,Kt]=this._firstTwoTouches,Qi=Ga(Vt,F,Wt),fr=Ga(Vt,F,Kt);Qi&&fr||(this._active&&r.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&"center"===u.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ga(u,F,Vt){for(let Wt=0;Wt<u.length;Wt++)if(u[Wt].identifier===Vt)return F[Wt]}function Va(u,F){return Math.log(u/F)/Math.LN2}class Ha extends Wa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,F){const Vt=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(Va(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Va(this._distance,Vt),pinchAround:F}}}function $a(u,F){return 180*u.angleWith(F)/Math.PI}class Xa extends Wa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,F,Vt){const Wt=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$a(this._vector,Wt),pinchAround:F}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const F=25/(Math.PI*this._minDiameter)*360,Vt=$a(u,this._startVector);return Math.abs(Vt)<F}}function Ka(u){return Math.abs(u.y)>Math.abs(u.x)}class Ja extends Wa{constructor(u){super(),this._currentTouchCount=0,this._map=u}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(u,F,Vt){super.touchstart(u,F,Vt),this._currentTouchCount=Vt.length}_start(u){this._lastPoints=u,Ka(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,F,Vt){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const Wt=u[0].sub(this._lastPoints[0]),Kt=u[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(Wt,Kt,Vt.timeStamp),this._valid?(this._lastPoints=u,this._active=!0,{pitchDelta:(Wt.y+Kt.y)/2*-.5}):void 0}gestureBeginsVertically(u,F,Vt){if(void 0!==this._valid)return this._valid;const Wt=u.mag()>=2,Kt=F.mag()>=2;if(!Wt&&!Kt)return;if(!Wt||!Kt)return void 0===this._firstMove&&(this._firstMove=Vt),Vt-this._firstMove<100&&void 0;const Qi=u.y>0==F.y>0;return Ka(u)&&Ka(F)&&Qi}}const $l={panStep:100,bearingStep:15,pitchStep:10};class Qa{constructor(u){this._tr=new Ma(u);const F=$l;this._panStep=F.panStep,this._bearingStep=F.bearingStep,this._pitchStep=F.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let F=0,Vt=0,Wt=0,Kt=0,Qi=0;switch(u.keyCode){case 61:case 107:case 171:case 187:F=1;break;case 189:case 109:case 173:F=-1;break;case 37:u.shiftKey?Vt=-1:(u.preventDefault(),Kt=-1);break;case 39:u.shiftKey?Vt=1:(u.preventDefault(),Kt=1);break;case 38:u.shiftKey?Wt=1:(u.preventDefault(),Qi=-1);break;case 40:u.shiftKey?Wt=-1:(u.preventDefault(),Qi=1);break;default:return}return this._rotationDisabled&&(Vt=0,Wt=0),{cameraAnimation:fr=>{const _r=this._tr;fr.easeTo({duration:300,easeId:"keyboardHandler",easing:ts,zoom:F?Math.round(_r.zoom)+F*(u.shiftKey?2:1):_r.zoom,bearing:_r.bearing+Vt*this._bearingStep,pitch:_r.pitch+Wt*this._pitchStep,offset:[-Kt*this._panStep,-Qi*this._panStep],center:_r.center},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ts(u){return u*(2-u)}const Gl=4.000244140625;class is{constructor(u,F){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=u,this._tr=new Ma(u),this._triggerRenderFrame=F,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&"center"===u.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(u){if(!this.isEnabled())return;if(this._map.cooperativeGestures.isEnabled()&&!u[this._map.cooperativeGestures._bypassKey])return;let F=u.deltaMode===WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const Vt=fr.now(),Wt=Vt-(this._lastWheelEventTime||0);this._lastWheelEventTime=Vt,0!==F&&F%Gl==0?this._type="wheel":0!==F&&Math.abs(F)<4?this._type="trackpad":Wt>400?(this._type=null,this._lastValue=F,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(Wt*F)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,F+=this._lastValue)),u.shiftKey&&F&&(F/=4),this._type&&(this._lastWheelEvent=u,this._delta-=F,this._active||this._start(u)),u.preventDefault()}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const F=r.mousePos(this._map.getCanvas(),u),Wt=this._tr;this._around=F.y>Wt.transform.height/2-Wt.transform.getHorizon()?Vt.M.convert(this._aroundCenter?Wt.center:Wt.unproject(F)):Vt.M.convert(Wt.center),this._aroundPoint=Wt.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const u=this._tr.transform;if(0!==this._delta){const F="wheel"===this._type&&Math.abs(this._delta)>Gl?this._wheelZoomRate:this._defaultZoomRate;let Vt=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&0!==Vt&&(Vt=1/Vt);const Wt="number"==typeof this._targetZoom?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(Wt*Vt))),"wheel"===this._type&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const F="number"==typeof this._targetZoom?this._targetZoom:u.zoom,Wt=this._startZoom,Kt=this._easing;let Qi,_r=!1;if("wheel"===this._type&&Wt&&Kt){const u=Math.min((fr.now()-this._lastWheelEventTime)/200,1),Sr=Kt(u);Qi=Vt.z.number(Wt,F,Sr),u<1?this._frameId||(this._frameId=!0):_r=!0}else Qi=F,_r=!0;return this._active=!0,_r&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!_r,zoomDelta:Qi-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let F=Vt.b8;if(this._prevEase){const u=this._prevEase,Wt=(fr.now()-u.start)/u.duration,Kt=u.easing(Wt+.01)-u.easing(Wt),Qi=.27/Math.sqrt(Kt*Kt+1e-4)*.01,_r=Math.sqrt(.0729-Qi*Qi);F=Vt.b7(Qi,_r,.25,1)}return this._prevEase={start:fr.now(),duration:u,easing:F},F}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class as{constructor(u,F){this._clickZoom=u,this._tapZoom=F}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ss{constructor(u){this._tr=new Ma(u),this.reset()}reset(){this._active=!1}dblclick(u,F){return u.preventDefault(),{cameraAnimation:Vt=>{Vt.easeTo({duration:300,zoom:this._tr.zoom+(u.shiftKey?-1:1),around:this._tr.unproject(F)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class os{constructor(){this._tap=new La({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(u,F,Vt){if(!this._swipePoint)if(this._tapTime){const Wt=F[0],Kt=u.timeStamp-this._tapTime<500,Qi=this._tapPoint.dist(Wt)<30;Kt&&Qi?Vt.length>0&&(this._swipePoint=Wt,this._swipeTouch=Vt[0].identifier):this.reset()}else this._tap.touchstart(u,F,Vt)}touchmove(u,F,Vt){if(this._tapTime){if(this._swipePoint){if(Vt[0].identifier!==this._swipeTouch)return;const Wt=F[0],Kt=Wt.y-this._swipePoint.y;return this._swipePoint=Wt,u.preventDefault(),this._active=!0,{zoomDelta:Kt/128}}}else this._tap.touchmove(u,F,Vt)}touchend(u,F,Vt){if(this._tapTime)this._swipePoint&&0===Vt.length&&this.reset();else{const Wt=this._tap.touchend(u,F,Vt);Wt&&(this._tapTime=u.timeStamp,this._tapPoint=Wt)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rs{constructor(u,F,Vt){this._el=u,this._mousePan=F,this._touchPan=Vt}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ns{constructor(u,F,Vt){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=F,this._mousePitch=Vt}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ls{constructor(u,F,Vt,Wt){this._el=u,this._touchZoom=F,this._touchRotate=Vt,this._tapDragZoom=Wt,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class hs{constructor(u,F){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=u,this._options=F,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const u=this._map.getCanvasContainer();u.classList.add("maplibregl-cooperative-gestures"),this._container=r.create("div","maplibregl-cooperative-gesture-screen",u);let F=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(F=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const Vt=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),Wt=document.createElement("div");Wt.className="maplibregl-desktop-message",Wt.textContent=F,this._container.appendChild(Wt);const Kt=document.createElement("div");Kt.className="maplibregl-mobile-message",Kt.textContent=Vt,this._container.appendChild(Kt),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(r.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(u){this._onCooperativeGesture(1===u.touches.length)}wheel(u){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!u[this._bypassKey])}_onCooperativeGesture(u){this._enabled&&u&&(this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const cs=u=>u.zoom||u.drag||u.pitch||u.rotate;class us extends Vt.k{}function ds(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class _s{constructor(u,F){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,F)=>{if("blur"===u.type)return void this.stop(!0);this._updatingCamera=!0;const Vt="renderFrame"===u.type?void 0:u,Wt={needsRenderFrame:!1},Kt={},Qi={},fr=u.touches,_r=fr?this._getMapTouches(fr):void 0,Sr=_r?r.touchPos(this._map.getCanvas(),_r):r.mousePos(this._map.getCanvas(),u);for(const{handlerName:fr,handler:Ar,allowed:Jr}of this._handlers){if(!Ar.isEnabled())continue;let zn;this._blockedByActive(Qi,Jr,fr)?Ar.reset():Ar[F||u.type]&&(zn=Ar[F||u.type](u,Sr,_r),this.mergeHandlerResult(Wt,Kt,zn,fr,Vt),zn&&zn.needsRenderFrame&&this._triggerRenderFrame()),(zn||Ar.isActive())&&(Qi[fr]=Ar)}const Ar={};for(const u in this._previousActiveHandlers)Qi[u]||(Ar[u]=Vt);this._previousActiveHandlers=Qi,(Object.keys(Ar).length||ds(Wt))&&(this._changes.push([Wt,Kt,Ar]),this._triggerRenderFrame()),(Object.keys(Qi).length||ds(Wt))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Jr}=Wt;Jr&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Jr(this._map))},this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wa(u),this._bearingSnap=F.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(F);const Vt=this._el;this._listeners=[[Vt,"touchstart",{passive:!0}],[Vt,"touchmove",{passive:!1}],[Vt,"touchend",void 0],[Vt,"touchcancel",void 0],[Vt,"mousedown",void 0],[Vt,"mousemove",void 0],[Vt,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[Vt,"mouseover",void 0],[Vt,"mouseout",void 0],[Vt,"dblclick",void 0],[Vt,"click",void 0],[Vt,"keydown",{capture:!1}],[Vt,"keyup",void 0],[Vt,"wheel",{passive:!1}],[Vt,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,F,Vt]of this._listeners)r.addEventListener(u,F,u===document?this.handleWindowEvent:this.handleEvent,Vt)}destroy(){for(const[u,F,Vt]of this._listeners)r.removeEventListener(u,F,u===document?this.handleWindowEvent:this.handleEvent,Vt)}_addDefaultHandlers(u){const F=this._map,Vt=F.getCanvasContainer();this._add("mapEvent",new Sa(F,u));const Wt=F.boxZoom=new za(F,u);this._add("boxZoom",Wt),u.interactive&&u.boxZoom&&Wt.enable();const Kt=F.cooperativeGestures=new hs(F,u.cooperativeGestures);this._add("cooperativeGestures",Kt),u.cooperativeGestures&&Kt.enable();const Qi=new ka(F),fr=new ss(F);F.doubleClickZoom=new as(fr,Qi),this._add("tapZoom",Qi),this._add("clickZoom",fr),u.interactive&&u.doubleClickZoom&&F.doubleClickZoom.enable();const _r=new os;this._add("tapDragZoom",_r);const Sr=F.touchPitch=new Ja(F);this._add("touchPitch",Sr),u.interactive&&u.touchPitch&&F.touchPitch.enable(u.touchPitch);const Ar=Ua(u),Jr=Za(u);F.dragRotate=new ns(u,Ar,Jr),this._add("mouseRotate",Ar,["mousePitch"]),this._add("mousePitch",Jr,["mouseRotate"]),u.interactive&&u.dragRotate&&F.dragRotate.enable();const zn=(({enable:u,clickTolerance:F})=>{const Vt=new Oa({checkCorrectEvent:u=>0===r.mouseButton(u)&&!u.ctrlKey});return new Fa({clickTolerance:F,move:(u,F)=>({around:F,panDelta:F.sub(u)}),activateOnStart:!0,moveStateManager:Vt,enable:u,assignEvents:ja})})(u),Qs=new qa(u,F);F.dragPan=new rs(Vt,zn,Qs),this._add("mousePan",zn),this._add("touchPan",Qs,["touchZoom","touchRotate"]),u.interactive&&u.dragPan&&F.dragPan.enable(u.dragPan);const ta=new Xa,ia=new Ha;F.touchZoomRotate=new ls(Vt,ia,ta,_r),this._add("touchRotate",ta,["touchPan","touchZoom"]),this._add("touchZoom",ia,["touchPan","touchRotate"]),u.interactive&&u.touchZoomRotate&&F.touchZoomRotate.enable(u.touchZoomRotate);const aa=F.scrollZoom=new is(F,(()=>this._triggerRenderFrame()));this._add("scrollZoom",aa,["mousePan"]),u.interactive&&u.scrollZoom&&F.scrollZoom.enable(u.scrollZoom);const va=F.keyboard=new Qa(F);this._add("keyboard",va),u.interactive&&u.keyboard&&F.keyboard.enable(),this._add("blockableMapEvent",new Da(F))}_add(u,F,Vt){this._handlers.push({handlerName:u,handler:F,allowed:Vt}),this._handlersById[u]=F}stop(u){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(cs(this._eventsInProgress))||this.isZooming()}_blockedByActive(u,F,Vt){for(const Wt in u)if(Wt!==Vt&&(!F||F.indexOf(Wt)<0))return!0;return!1}_getMapTouches(u){const F=[];for(const Vt of u)this._el.contains(Vt.target)&&F.push(Vt);return F}mergeHandlerResult(u,F,Wt,Kt,Qi){if(!Wt)return;Vt.e(u,Wt);const fr={handlerName:Kt,originalEvent:Wt.originalEvent||Qi};void 0!==Wt.zoomDelta&&(F.zoom=fr),void 0!==Wt.panDelta&&(F.drag=fr),void 0!==Wt.pitchDelta&&(F.pitch=fr),void 0!==Wt.bearingDelta&&(F.rotate=fr)}_applyChanges(){const u={},F={},Wt={};for(const[Kt,Qi,fr]of this._changes)Kt.panDelta&&(u.panDelta=(u.panDelta||new Vt.P(0,0))._add(Kt.panDelta)),Kt.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+Kt.zoomDelta),Kt.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+Kt.bearingDelta),Kt.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+Kt.pitchDelta),void 0!==Kt.around&&(u.around=Kt.around),void 0!==Kt.pinchAround&&(u.pinchAround=Kt.pinchAround),Kt.noInertia&&(u.noInertia=Kt.noInertia),Vt.e(F,Qi),Vt.e(Wt,fr);this._updateMapTransform(u,F,Wt),this._changes=[]}_updateMapTransform(u,F,Vt){const Wt=this._map,Kt=Wt._getTransformForUpdate(),Qi=Wt.terrain;if(!(ds(u)||Qi&&this._terrainMovement))return this._fireEvents(F,Vt,!0);let{panDelta:fr,zoomDelta:_r,bearingDelta:Sr,pitchDelta:Ar,around:Jr,pinchAround:zn}=u;void 0!==zn&&(Jr=zn),Wt._stop(!0),Jr=Jr||Wt.transform.centerPoint;const Qs=Kt.pointLocation(fr?Jr.sub(fr):Jr);Sr&&(Kt.bearing+=Sr),Ar&&(Kt.pitch+=Ar),_r&&(Kt.zoom+=_r),Qi?this._terrainMovement||!F.drag&&!F.zoom?F.drag&&this._terrainMovement?Kt.center=Kt.pointLocation(Kt.centerPoint.sub(fr)):Kt.setLocationAtPoint(Qs,Jr):(this._terrainMovement=!0,this._map._elevationFreeze=!0,Kt.setLocationAtPoint(Qs,Jr)):Kt.setLocationAtPoint(Qs,Jr),Wt._applyUpdatedTransform(Kt),this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(F,Vt,!0)}_fireEvents(u,F,Wt){const Kt=cs(this._eventsInProgress),Qi=cs(u),_r={};for(const F in u){const{originalEvent:Vt}=u[F];this._eventsInProgress[F]||(_r[`${F}start`]=Vt),this._eventsInProgress[F]=u[F]}!Kt&&Qi&&this._fireEvent("movestart",Qi.originalEvent);for(const u in _r)this._fireEvent(u,_r[u]);Qi&&this._fireEvent("move",Qi.originalEvent);for(const F in u){const{originalEvent:Vt}=u[F];this._fireEvent(F,Vt)}const Sr={};let Ar;for(const u in this._eventsInProgress){const{handlerName:Vt,originalEvent:Wt}=this._eventsInProgress[u];this._handlersById[Vt].isActive()||(delete this._eventsInProgress[u],Ar=F[Vt]||Wt,Sr[`${u}end`]=Ar)}for(const u in Sr)this._fireEvent(u,Sr[u]);const Jr=cs(this._eventsInProgress),zn=(Kt||Qi)&&!Jr;if(zn&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),Wt&&zn){this._updatingCamera=!0;const u=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=u=>0!==u&&-this._bearingSnap<u&&u<this._bearingSnap;!u||!u.essential&&fr.prefersReducedMotion?(this._map.fire(new Vt.k("moveend",{originalEvent:Ar})),i(this._map.getBearing())&&this._map.resetNorth()):(i(u.bearing||this._map.getBearing())&&(u.bearing=0),u.freezeElevation=!0,this._map.easeTo(u,{originalEvent:Ar})),this._updatingCamera=!1}}_fireEvent(u,F){this._map.fire(new Vt.k(u,F?{originalEvent:F}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((u=>{delete this._frameId,this.handleEvent(new us("renderFrame",{timeStamp:u})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class ps extends Vt.E{constructor(u,F){super(),this._renderFrameCallback=()=>{const u=Math.min((fr.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=F.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new Vt.M(this.transform.center.lng,this.transform.center.lat)}setCenter(u,F){return this.jumpTo({center:u},F)}panBy(u,F,Wt){return u=Vt.P.convert(u).mult(-1),this.panTo(this.transform.center,Vt.e({offset:u},F),Wt)}panTo(u,F,Wt){return this.easeTo(Vt.e({center:u},F),Wt)}getZoom(){return this.transform.zoom}setZoom(u,F){return this.jumpTo({zoom:u},F),this}zoomTo(u,F,Wt){return this.easeTo(Vt.e({zoom:u},F),Wt)}zoomIn(u,F){return this.zoomTo(this.getZoom()+1,u,F),this}zoomOut(u,F){return this.zoomTo(this.getZoom()-1,u,F),this}getBearing(){return this.transform.bearing}setBearing(u,F){return this.jumpTo({bearing:u},F),this}getPadding(){return this.transform.padding}setPadding(u,F){return this.jumpTo({padding:u},F),this}rotateTo(u,F,Wt){return this.easeTo(Vt.e({bearing:u},F),Wt)}resetNorth(u,F){return this.rotateTo(0,Vt.e({duration:1e3},u),F),this}resetNorthPitch(u,F){return this.easeTo(Vt.e({bearing:0,pitch:0,duration:1e3},u),F),this}snapToNorth(u,F){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,F):this}getPitch(){return this.transform.pitch}setPitch(u,F){return this.jumpTo({pitch:u},F),this}cameraForBounds(u,F){u=W.convert(u);const Vt=F&&F.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),Vt,F)}_cameraForBoxAndBearing(u,F,Wt,Kt){const Qi={top:0,bottom:0,right:0,left:0};if("number"==typeof(Kt=Vt.e({padding:Qi,offset:[0,0],maxZoom:this.transform.maxZoom},Kt)).padding){const u=Kt.padding;Kt.padding={top:u,bottom:u,right:u,left:u}}Kt.padding=Vt.e(Qi,Kt.padding);const fr=this.transform,_r=fr.padding,Sr=new W(u,F),Ar=fr.project(Sr.getNorthWest()),Jr=fr.project(Sr.getNorthEast()),zn=fr.project(Sr.getSouthEast()),Qs=fr.project(Sr.getSouthWest()),ta=Vt.b9(-Wt),ia=Ar.rotate(ta),aa=Jr.rotate(ta),va=zn.rotate(ta),Ba=Qs.rotate(ta),Ya=new Vt.P(Math.max(ia.x,aa.x,Ba.x,va.x),Math.max(ia.y,aa.y,Ba.y,va.y)),to=new Vt.P(Math.min(ia.x,aa.x,Ba.x,va.x),Math.min(ia.y,aa.y,Ba.y,va.y)),eo=Ya.sub(to),io=(fr.width-(_r.left+_r.right+Kt.padding.left+Kt.padding.right))/eo.x,so=(fr.height-(_r.top+_r.bottom+Kt.padding.top+Kt.padding.bottom))/eo.y;if(so<0||io<0)return void Vt.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const co=Math.min(fr.scaleZoom(fr.scale*Math.min(io,so)),Kt.maxZoom),ho=Vt.P.convert(Kt.offset),bo=new Vt.P((Kt.padding.left-Kt.padding.right)/2,(Kt.padding.top-Kt.padding.bottom)/2).rotate(Vt.b9(Wt)),wo=ho.add(bo).mult(fr.scale/fr.zoomScale(co));return{center:fr.unproject(Ar.add(zn).div(2).sub(wo)),zoom:co,bearing:Wt}}fitBounds(u,F,Vt){return this._fitInternal(this.cameraForBounds(u,F),F,Vt)}fitScreenCoordinates(u,F,Wt,Kt,Qi){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(Vt.P.convert(u)),this.transform.pointLocation(Vt.P.convert(F)),Wt,Kt),Kt,Qi)}_fitInternal(u,F,Wt){return u?(delete(F=Vt.e(u,F)).padding,F.linear?this.easeTo(F,Wt):this.flyTo(F,Wt)):this}jumpTo(u,F){this.stop();const Wt=this._getTransformForUpdate();let Kt=!1,Qi=!1,fr=!1;return"zoom"in u&&Wt.zoom!==+u.zoom&&(Kt=!0,Wt.zoom=+u.zoom),void 0!==u.center&&(Wt.center=Vt.M.convert(u.center)),"bearing"in u&&Wt.bearing!==+u.bearing&&(Qi=!0,Wt.bearing=+u.bearing),"pitch"in u&&Wt.pitch!==+u.pitch&&(fr=!0,Wt.pitch=+u.pitch),null==u.padding||Wt.isPaddingEqual(u.padding)||(Wt.padding=u.padding),this._applyUpdatedTransform(Wt),this.fire(new Vt.k("movestart",F)).fire(new Vt.k("move",F)),Kt&&this.fire(new Vt.k("zoomstart",F)).fire(new Vt.k("zoom",F)).fire(new Vt.k("zoomend",F)),Qi&&this.fire(new Vt.k("rotatestart",F)).fire(new Vt.k("rotate",F)).fire(new Vt.k("rotateend",F)),fr&&this.fire(new Vt.k("pitchstart",F)).fire(new Vt.k("pitch",F)).fire(new Vt.k("pitchend",F)),this.fire(new Vt.k("moveend",F))}calculateCameraOptionsFromTo(u,F,Wt,Kt=0){const Qi=Vt.Y.fromLngLat(u,F),fr=Vt.Y.fromLngLat(Wt,Kt),_r=fr.x-Qi.x,Sr=fr.y-Qi.y,Ar=fr.z-Qi.z,Jr=Math.hypot(_r,Sr,Ar);if(0===Jr)throw new Error("Can't calculate camera options with same From and To");const zn=Math.hypot(_r,Sr),Qs=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Jr/this.transform.tileSize),ta=180*Math.atan2(_r,-Sr)/Math.PI;let ia=180*Math.acos(zn/Jr)/Math.PI;return ia=Ar<0?90-ia:90+ia,{center:fr.toLngLat(),zoom:Qs,pitch:ia,bearing:ta}}easeTo(u,F){var Wt;this._stop(!1,u.easeId),(!1===(u=Vt.e({offset:[0,0],duration:500,easing:Vt.b8},u)).animate||!u.essential&&fr.prefersReducedMotion)&&(u.duration=0);const Kt=this._getTransformForUpdate(),Qi=this.getZoom(),_r=this.getBearing(),Sr=this.getPitch(),Ar=this.getPadding(),Jr="bearing"in u?this._normalizeBearing(u.bearing,_r):_r,zn="pitch"in u?+u.pitch:Sr,Qs="padding"in u?u.padding:Kt.padding,ta=Vt.P.convert(u.offset);let ia=Kt.centerPoint.add(ta);const aa=Kt.pointLocation(ia),{center:va,zoom:Ba}=Kt.getConstrained(Vt.M.convert(u.center||aa),null!==(Wt=u.zoom)&&void 0!==Wt?Wt:Qi);this._normalizeCenter(va);const Ya=Kt.project(aa),to=Kt.project(va).sub(Ya),eo=Kt.zoomScale(Ba-Qi);let io,so;u.around&&(io=Vt.M.convert(u.around),so=Kt.locationPoint(io));const co={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ba!==Qi,this._rotating=this._rotating||_r!==Jr,this._pitching=this._pitching||zn!==Sr,this._padding=!Kt.isPaddingEqual(Qs),this._easeId=u.easeId,this._prepareEase(F,u.noMoveStart,co),this.terrain&&this._prepareElevation(va),this._ease((Wt=>{if(this._zooming&&(Kt.zoom=Vt.z.number(Qi,Ba,Wt)),this._rotating&&(Kt.bearing=Vt.z.number(_r,Jr,Wt)),this._pitching&&(Kt.pitch=Vt.z.number(Sr,zn,Wt)),this._padding&&(Kt.interpolatePadding(Ar,Qs,Wt),ia=Kt.centerPoint.add(ta)),this.terrain&&!u.freezeElevation&&this._updateElevation(Wt),io)Kt.setLocationAtPoint(io,so);else{const u=Kt.zoomScale(Kt.zoom-Qi),F=Ba>Qi?Math.min(2,eo):Math.max(.5,eo),Vt=Math.pow(F,1-Wt),fr=Kt.unproject(Ya.add(to.mult(Wt*Vt)).mult(u));Kt.setLocationAtPoint(Kt.renderWorldCopies?fr.wrap():fr,ia)}this._applyUpdatedTransform(Kt),this._fireMoveEvents(F)}),(Vt=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(F,Vt)}),u),this}_prepareEase(u,F,Wt={}){this._moving=!0,F||Wt.moving||this.fire(new Vt.k("movestart",u)),this._zooming&&!Wt.zooming&&this.fire(new Vt.k("zoomstart",u)),this._rotating&&!Wt.rotating&&this.fire(new Vt.k("rotatestart",u)),this._pitching&&!Wt.pitching&&this.fire(new Vt.k("pitchstart",u))}_prepareElevation(u){this._elevationCenter=u,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(u){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const F=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(u<1&&F!==this._elevationTarget){const Vt=this._elevationTarget-this._elevationStart;this._elevationStart+=u*(Vt-(F-(Vt*u+this._elevationStart))/(1-u)),this._elevationTarget=F}this.transform.elevation=Vt.z.number(this._elevationStart,this._elevationTarget,u)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(u){if(!this.transformCameraUpdate)return;const F=u.clone(),{center:Vt,zoom:Wt,pitch:Kt,bearing:Qi,elevation:fr}=this.transformCameraUpdate(F);Vt&&(F.center=Vt),void 0!==Wt&&(F.zoom=Wt),void 0!==Kt&&(F.pitch=Kt),void 0!==Qi&&(F.bearing=Qi),void 0!==fr&&(F.elevation=fr),this.transform.apply(F)}_fireMoveEvents(u){this.fire(new Vt.k("move",u)),this._zooming&&this.fire(new Vt.k("zoom",u)),this._rotating&&this.fire(new Vt.k("rotate",u)),this._pitching&&this.fire(new Vt.k("pitch",u))}_afterEase(u,F){if(this._easeId&&F&&this._easeId===F)return;delete this._easeId;const Wt=this._zooming,Kt=this._rotating,Qi=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,Wt&&this.fire(new Vt.k("zoomend",u)),Kt&&this.fire(new Vt.k("rotateend",u)),Qi&&this.fire(new Vt.k("pitchend",u)),this.fire(new Vt.k("moveend",u))}flyTo(u,F){var Wt;if(!u.essential&&fr.prefersReducedMotion){const Wt=Vt.L(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Wt,F)}this.stop(),u=Vt.e({offset:[0,0],speed:1.2,curve:1.42,easing:Vt.b8},u);const Kt=this._getTransformForUpdate(),Qi=this.getZoom(),_r=this.getBearing(),Sr=this.getPitch(),Ar=this.getPadding(),Jr="bearing"in u?this._normalizeBearing(u.bearing,_r):_r,zn="pitch"in u?+u.pitch:Sr,Qs="padding"in u?u.padding:Kt.padding,ta=Vt.P.convert(u.offset);let ia=Kt.centerPoint.add(ta);const aa=Kt.pointLocation(ia),{center:va,zoom:Ba}=Kt.getConstrained(Vt.M.convert(u.center||aa),null!==(Wt=u.zoom)&&void 0!==Wt?Wt:Qi);this._normalizeCenter(va);const Ya=Kt.zoomScale(Ba-Qi),to=Kt.project(aa),eo=Kt.project(va).sub(to);let io=u.curve;const so=Math.max(Kt.width,Kt.height),co=so/Ya,ho=eo.mag();if("minZoom"in u){const F=Vt.ac(Math.min(u.minZoom,Qi,Ba),Kt.minZoom,Kt.maxZoom),Wt=so/Kt.zoomScale(F-Qi);io=Math.sqrt(Wt/ho*2)}const bo=io*io;function P(u){const F=(co*co-so*so+(u?-1:1)*bo*bo*ho*ho)/(2*(u?co:so)*bo*ho);return Math.log(Math.sqrt(F*F+1)-F)}function C(u){return(Math.exp(u)-Math.exp(-u))/2}function S(u){return(Math.exp(u)+Math.exp(-u))/2}const wo=P(!1);let M=function(u){return S(wo)/S(wo+io*u)},z=function(u){return so*((S(wo)*(C(F=wo+io*u)/S(F))-C(wo))/bo)/ho;var F},So=(P(!0)-wo)/io;if(Math.abs(ho)<1e-6||!isFinite(So)){if(Math.abs(so-co)<1e-6)return this.easeTo(u,F);const Vt=co<so?-1:1;So=Math.abs(Math.log(co/so))/io,z=()=>0,M=u=>Math.exp(Vt*io*u)}return u.duration="duration"in u?+u.duration:1e3*So/("screenSpeed"in u?+u.screenSpeed/io:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=_r!==Jr,this._pitching=zn!==Sr,this._padding=!Kt.isPaddingEqual(Qs),this._prepareEase(F,!1),this.terrain&&this._prepareElevation(va),this._ease((Wt=>{const fr=Wt*So,aa=1/M(fr);Kt.zoom=1===Wt?Ba:Qi+Kt.scaleZoom(aa),this._rotating&&(Kt.bearing=Vt.z.number(_r,Jr,Wt)),this._pitching&&(Kt.pitch=Vt.z.number(Sr,zn,Wt)),this._padding&&(Kt.interpolatePadding(Ar,Qs,Wt),ia=Kt.centerPoint.add(ta)),this.terrain&&!u.freezeElevation&&this._updateElevation(Wt);const Ya=1===Wt?va:Kt.unproject(to.add(eo.mult(z(fr))).mult(aa));Kt.setLocationAtPoint(Kt.renderWorldCopies?Ya.wrap():Ya,ia),this._applyUpdatedTransform(Kt),this._fireMoveEvents(F)}),(()=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(F)}),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,F){var Vt;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,F)}return u||null===(Vt=this.handlers)||void 0===Vt||Vt.stop(!1),this}_ease(u,F,Vt){!1===Vt.animate||0===Vt.duration?(u(1),F()):(this._easeStart=fr.now(),this._easeOptions=Vt,this._onEaseFrame=u,this._onEaseEnd=F,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(u,F){u=Vt.b2(u,-180,180);const Wt=Math.abs(u-F);return Math.abs(u-360-F)<Wt&&(u-=360),Math.abs(u+360-F)<Wt&&(u+=360),u}_normalizeCenter(u){const F=this.transform;if(!F.renderWorldCopies||F.lngRange)return;const Vt=u.lng-F.center.lng;u.lng+=Vt>180?-360:Vt<-180?360:0}queryTerrainElevation(u){return this.terrain?this.terrain.getElevationForLngLatZoom(Vt.M.convert(u),this.transform.tileZoom)-this.transform.elevation:null}}const Hl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class fs{constructor(u=Hl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||"metadata"!==u.sourceDataType&&"visibility"!==u.sourceDataType&&"style"!==u.dataType&&"terrain"!==u.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=u}getDefaultPosition(){return"bottom-right"}onAdd(u){return this._map=u,this._compact=this.options.compact,this._container=r.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=r.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=r.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(u,F){const Vt=this._map._getUIString(`AttributionControl.${F}`);u.title=Vt,u.setAttribute("aria-label",Vt)}_updateAttributions(){if(!this._map.style)return;let u=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=u.concat(this.options.customAttribution.map((u=>"string"!=typeof u?"":u))):"string"==typeof this.options.customAttribution&&u.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const F=this._map.style.sourceCaches;for(const Vt in F){const Wt=F[Vt];if(Wt.used||Wt.usedForTerrain){const F=Wt.getSource();F.attribution&&u.indexOf(F.attribution)<0&&u.push(F.attribution)}}u=u.filter((u=>String(u).trim())),u.sort(((u,F)=>u.length-F.length)),u=u.filter(((F,Vt)=>{for(let Wt=Vt+1;Wt<u.length;Wt++)if(u[Wt].indexOf(F)>=0)return!1;return!0}));const Vt=u.join(" | ");Vt!==this._attribHTML&&(this._attribHTML=Vt,u.length?(this._innerContainer.innerHTML=Vt,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class gs{constructor(u={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const F=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&F.classList.add("maplibregl-compact"):F.classList.remove("maplibregl-compact")}},this.options=u}getDefaultPosition(){return"bottom-left"}onAdd(u){this._map=u,this._compact=this.options&&this.options.compact,this._container=r.create("div","maplibregl-ctrl");const F=r.create("a","maplibregl-ctrl-logo");return F.target="_blank",F.rel="noopener nofollow",F.href="https://maplibre.org/",F.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),F.setAttribute("rel","noopener nofollow"),this._container.appendChild(F),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){r.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const F=++this._id;return this._queue.push({callback:u,id:F,cancelled:!1}),F}remove(u){const F=this._currentlyRunning,Vt=F?this._queue.concat(F):this._queue;for(const F of Vt)if(F.id===u)return void(F.cancelled=!0)}run(u=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const F=this._currentlyRunning=this._queue;this._queue=[];for(const Vt of F)if(!Vt.cancelled&&(Vt.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xl=Vt.X([{name:"a_pos3d",type:"Int16",components:3}]);class ys extends Vt.E{constructor(u){super(),this.sourceCache=u,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,u.usedForTerrain=!0,u.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(u,F){this.sourceCache.update(u,F),this._renderableTilesKeys=[];const Wt={};for(const Kt of u.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:F}))Wt[Kt.key]=!0,this._renderableTilesKeys.push(Kt.key),this._tiles[Kt.key]||(Kt.posMatrix=new Float64Array(16),Vt.aO(Kt.posMatrix,0,Vt.W,0,Vt.W,0,1),this._tiles[Kt.key]=new rt(Kt,this.tileSize));for(const u in this._tiles)Wt[u]||delete this._tiles[u]}freeRtt(u){for(const F in this._tiles){const Vt=this._tiles[F];(!u||Vt.tileID.equals(u)||Vt.tileID.isChildOf(u)||u.isChildOf(Vt.tileID))&&(Vt.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((u=>this.getTileByID(u)))}getTileByID(u){return this._tiles[u]}getTerrainCoords(u){const F={};for(const Wt of this._renderableTilesKeys){const Kt=this._tiles[Wt].tileID;if(Kt.canonical.equals(u.canonical)){const Kt=u.clone();Kt.posMatrix=new Float64Array(16),Vt.aO(Kt.posMatrix,0,Vt.W,0,Vt.W,0,1),F[Wt]=Kt}else if(Kt.canonical.isChildOf(u.canonical)){const Qi=u.clone();Qi.posMatrix=new Float64Array(16);const fr=Kt.canonical.z-u.canonical.z,_r=Kt.canonical.x-(Kt.canonical.x>>fr<<fr),Sr=Kt.canonical.y-(Kt.canonical.y>>fr<<fr),Ar=Vt.W>>fr;Vt.aO(Qi.posMatrix,0,Ar,0,Ar,0,1),Vt.H(Qi.posMatrix,Qi.posMatrix,[-_r*Ar,-Sr*Ar,0]),F[Wt]=Qi}else if(u.canonical.isChildOf(Kt.canonical)){const Qi=u.clone();Qi.posMatrix=new Float64Array(16);const fr=u.canonical.z-Kt.canonical.z,_r=u.canonical.x-(u.canonical.x>>fr<<fr),Sr=u.canonical.y-(u.canonical.y>>fr<<fr),Ar=Vt.W>>fr;Vt.aO(Qi.posMatrix,0,Vt.W,0,Vt.W,0,1),Vt.H(Qi.posMatrix,Qi.posMatrix,[_r*Ar,Sr*Ar,0]),Vt.J(Qi.posMatrix,Qi.posMatrix,[1/2**fr,1/2**fr,0]),F[Wt]=Qi}}return F}getSourceTile(u,F){const Vt=this.sourceCache._source;let Wt=u.overscaledZ-this.deltaZoom;if(Wt>Vt.maxzoom&&(Wt=Vt.maxzoom),Wt<Vt.minzoom)return null;this._sourceTileCache[u.key]||(this._sourceTileCache[u.key]=u.scaledTo(Wt).key);let Kt=this.sourceCache.getTileByID(this._sourceTileCache[u.key]);if((!Kt||!Kt.dem)&&F)for(;Wt>=Vt.minzoom&&(!Kt||!Kt.dem);)Kt=this.sourceCache.getTileByID(u.scaledTo(Wt--).key);return Kt}tilesAfterTime(u=Date.now()){return Object.values(this._tiles).filter((F=>F.timeAdded>=u))}}class bs{constructor(u,F,Vt){this.painter=u,this.sourceCache=new ys(F),this.options=Vt,this.exaggeration="number"==typeof Vt.exaggeration?Vt.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(u,F,Wt,Kt=Vt.W){var Qi;if(!(F>=0&&F<Kt&&Wt>=0&&Wt<Kt))return 0;const fr=this.getTerrainData(u),_r=null===(Qi=fr.tile)||void 0===Qi?void 0:Qi.dem;if(!_r)return 0;const Sr=function(u,F,Vt){var Wt=F[0],Kt=F[1];return u[0]=Vt[0]*Wt+Vt[4]*Kt+Vt[12],u[1]=Vt[1]*Wt+Vt[5]*Kt+Vt[13],u}([],[F/Kt*Vt.W,Wt/Kt*Vt.W],fr.u_terrain_matrix),Ar=[Sr[0]*_r.dim,Sr[1]*_r.dim],Jr=Math.floor(Ar[0]),zn=Math.floor(Ar[1]),Qs=Ar[0]-Jr,ta=Ar[1]-zn;return _r.get(Jr,zn)*(1-Qs)*(1-ta)+_r.get(Jr+1,zn)*Qs*(1-ta)+_r.get(Jr,zn+1)*(1-Qs)*ta+_r.get(Jr+1,zn+1)*Qs*ta}getElevationForLngLatZoom(u,F){const{tileID:Wt,mercatorX:Kt,mercatorY:Qi}=this._getOverscaledTileIDFromLngLatZoom(u,F);return this.getElevation(Wt,Kt%Vt.W,Qi%Vt.W,Vt.W)}getElevation(u,F,Wt,Kt=Vt.W){return this.getDEMElevation(u,F,Wt,Kt)*this.exaggeration}getTerrainData(u){if(!this._emptyDemTexture){const u=this.painter.context,F=new Vt.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new b(u,F,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new b(u,new Vt.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=Vt.an([])}const F=this.sourceCache.getSourceTile(u,!0);if(F&&F.dem&&(!F.demTexture||F.needsTerrainPrepare)){const u=this.painter.context;F.demTexture=this.painter.getTileTexture(F.dem.stride),F.demTexture?F.demTexture.update(F.dem.getPixels(),{premultiply:!1}):F.demTexture=new b(u,F.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),F.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),F.needsTerrainPrepare=!1}const Wt=F&&F+F.tileID.key+u.key;if(Wt&&!this._demMatrixCache[Wt]){const Wt=this.sourceCache.sourceCache._source.maxzoom;let Kt=u.canonical.z-F.tileID.canonical.z;u.overscaledZ>u.canonical.z&&(u.canonical.z>=Wt?Kt=u.canonical.z-Wt:Vt.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const Qi=u.canonical.x-(u.canonical.x>>Kt<<Kt),fr=u.canonical.y-(u.canonical.y>>Kt<<Kt),_r=Vt.ba(new Float64Array(16),[1/(Vt.W<<Kt),1/(Vt.W<<Kt),0]);Vt.H(_r,_r,[Qi*Vt.W,fr*Vt.W,0]),this._demMatrixCache[u.key]={matrix:_r,coord:u}}return{u_depth:2,u_terrain:3,u_terrain_dim:F&&F.dem&&F.dem.dim||1,u_terrain_matrix:Wt?this._demMatrixCache[u.key].matrix:this._emptyDemMatrix,u_terrain_unpack:F&&F.dem&&F.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(F&&F.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:F}}getFramebuffer(u){const F=this.painter,Vt=F.width/devicePixelRatio,Wt=F.height/devicePixelRatio;return!this._fbo||this._fbo.width===Vt&&this._fbo.height===Wt||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new b(F.context,{width:Vt,height:Wt,data:null},F.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(F.context.gl.NEAREST,F.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new b(F.context,{width:Vt,height:Wt,data:null},F.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(F.context.gl.NEAREST,F.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=F.context.createFramebuffer(Vt,Wt,!0,!1),this._fbo.depthAttachment.set(F.context.createRenderbuffer(F.context.gl.DEPTH_COMPONENT16,Vt,Wt))),this._fbo.colorAttachment.set("coords"===u?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const u=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const F=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let u=0,Vt=0;u<this._coordsTextureSize;u++)for(let Wt=0;Wt<this._coordsTextureSize;Wt++,Vt+=4)F[Vt+0]=255&Wt,F[Vt+1]=255&u,F[Vt+2]=Wt>>8<<4|u>>8,F[Vt+3]=0;const Wt=new Vt.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(F.buffer)),Kt=new b(u,Wt,u.gl.RGBA,{premultiply:!1});return Kt.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._coordsTexture=Kt,Kt}pointCoordinate(u){this.painter.maybeDrawDepthAndCoords(!0);const F=new Uint8Array(4),Wt=this.painter.context,Kt=Wt.gl,Qi=Math.round(u.x*this.painter.pixelRatio/devicePixelRatio),fr=Math.round(u.y*this.painter.pixelRatio/devicePixelRatio),_r=Math.round(this.painter.height/devicePixelRatio);Wt.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),Kt.readPixels(Qi,_r-fr-1,1,1,Kt.RGBA,Kt.UNSIGNED_BYTE,F),Wt.bindFramebuffer.set(null);const Sr=F[0]+(F[2]>>4<<8),Ar=F[1]+((15&F[2])<<8),Jr=this.coordsIndex[255-F[3]],zn=Jr&&this.sourceCache.getTileByID(Jr);if(!zn)return null;const Qs=this._coordsTextureSize,ta=(1<<zn.tileID.canonical.z)*Qs;return new Vt.Y((zn.tileID.canonical.x*Qs+Sr)/ta+zn.tileID.wrap,(zn.tileID.canonical.y*Qs+Ar)/ta,this.getElevation(zn.tileID,Sr,Ar,Qs))}depthAtPoint(u){const F=new Uint8Array(4),Vt=this.painter.context,Wt=Vt.gl;return Vt.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),Wt.readPixels(u.x,this.painter.height/devicePixelRatio-u.y-1,1,1,Wt.RGBA,Wt.UNSIGNED_BYTE,F),Vt.bindFramebuffer.set(null),(F[0]/16777216+F[1]/65536+F[2]/256+F[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const u=this.painter.context,F=new Vt.bb,Wt=new Vt.aY,Kt=this.meshSize,Qi=Vt.W/Kt,fr=Kt*Kt;for(let u=0;u<=Kt;u++)for(let Vt=0;Vt<=Kt;Vt++)F.emplaceBack(Vt*Qi,u*Qi,0);for(let u=0;u<fr;u+=Kt+1)for(let F=0;F<Kt;F++)Wt.emplaceBack(F+u,Kt+F+u+1,Kt+F+u+2),Wt.emplaceBack(F+u,Kt+F+u+2,F+u+1);const _r=F.length,Sr=_r+2*(Kt+1);for(const u of[0,1])for(let Wt=0;Wt<=Kt;Wt++)for(const Kt of[0,1])F.emplaceBack(Wt*Qi,u*Vt.W,Kt);for(let u=0;u<2*Kt;u+=2)Wt.emplaceBack(Sr+u,Sr+u+1,Sr+u+3),Wt.emplaceBack(Sr+u,Sr+u+3,Sr+u+2),Wt.emplaceBack(_r+u,_r+u+3,_r+u+1),Wt.emplaceBack(_r+u,_r+u+2,_r+u+3);const Ar=F.length,Jr=Ar+2*(Kt+1);for(const u of[0,1])for(let Wt=0;Wt<=Kt;Wt++)for(const Kt of[0,1])F.emplaceBack(u*Vt.W,Wt*Qi,Kt);for(let u=0;u<2*Kt;u+=2)Wt.emplaceBack(Ar+u,Ar+u+1,Ar+u+3),Wt.emplaceBack(Ar+u,Ar+u+3,Ar+u+2),Wt.emplaceBack(Jr+u,Jr+u+3,Jr+u+1),Wt.emplaceBack(Jr+u,Jr+u+2,Jr+u+3);return this._mesh={indexBuffer:u.createIndexBuffer(Wt),vertexBuffer:u.createVertexBuffer(F,Xl.members),segments:Vt.$.simpleSegment(0,0,F.length,Wt.length)},this._mesh}getMeshFrameDelta(u){return 2*Math.PI*Vt.bc/Math.pow(2,u)/5}getMinTileElevationForLngLatZoom(u,F){var Vt;const{tileID:Wt}=this._getOverscaledTileIDFromLngLatZoom(u,F);return null!==(Vt=this.getMinMaxElevation(Wt).minElevation)&&void 0!==Vt?Vt:0}getMinMaxElevation(u){const F=this.getTerrainData(u).tile,Vt={minElevation:null,maxElevation:null};return F&&F.dem&&(Vt.minElevation=F.dem.min*this.exaggeration,Vt.maxElevation=F.dem.max*this.exaggeration),Vt}_getOverscaledTileIDFromLngLatZoom(u,F){const Wt=Vt.Y.fromLngLat(u.wrap()),Kt=(1<<F)*Vt.W,Qi=Wt.x*Kt,fr=Wt.y*Kt,_r=Math.floor(Qi/Vt.W),Sr=Math.floor(fr/Vt.W);return{tileID:new Vt.Q(F,0,F,_r,Sr),mercatorX:Qi,mercatorY:fr}}}class ws{constructor(u,F,Vt){this._context=u,this._size=F,this._tileSize=Vt,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const u of this._objects)u.texture.destroy(),u.fbo.destroy()}_createObject(u){const F=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),Vt=new b(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return Vt.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),F.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),F.colorAttachment.set(Vt.texture),{id:u,fbo:F,texture:Vt,stamp:-1,inUse:!1}}getObjectForId(u){return this._objects[u]}useObject(u){u.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((F=>u.id!==F)),this._recentlyUsed.push(u.id)}stampObject(u){u.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const u=this._createObject(this._objects.length);return this._objects.push(u),u}freeObject(u){u.inUse=!1}freeAllObjects(){for(const u of this._objects)this.freeObject(u)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((u=>!u.inUse))}}const Jl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Is{constructor(u,F){this.painter=u,this.terrain=F,this.pool=new ws(u.context,30,F.sourceCache.tileSize*F.qualityFactor)}destruct(){this.pool.destruct()}getTexture(u){return this.pool.getObjectForId(u.rtt[this._stacks.length-1].id).texture}prepareForRender(u,F){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=u._order.filter((Vt=>!u._layers[Vt].isHidden(F))),this._coordsDescendingInv={};for(const F in u.sourceCaches){this._coordsDescendingInv[F]={};const Vt=u.sourceCaches[F].getVisibleCoordinates();for(const u of Vt){const Vt=this.terrain.sourceCache.getTerrainCoords(u);for(const u in Vt)this._coordsDescendingInv[F][u]||(this._coordsDescendingInv[F][u]=[]),this._coordsDescendingInv[F][u].push(Vt[u])}}this._coordsDescendingInvStr={};for(const F of u._order){const Vt=u._layers[F],Wt=Vt.source;if(Jl[Vt.type]&&!this._coordsDescendingInvStr[Wt]){this._coordsDescendingInvStr[Wt]={};for(const u in this._coordsDescendingInv[Wt])this._coordsDescendingInvStr[Wt][u]=this._coordsDescendingInv[Wt][u].map((u=>u.key)).sort().join()}}for(const u of this._renderableTiles)for(const F in this._coordsDescendingInvStr){const Vt=this._coordsDescendingInvStr[F][u.tileID.key];Vt&&Vt!==u.rttCoords[F]&&(u.rtt=[])}}renderLayer(u){if(u.isHidden(this.painter.transform.zoom))return!1;const F=u.type,Wt=this.painter,Kt=this._renderableLayerIds[this._renderableLayerIds.length-1]===u.id;if(Jl[F]&&(this._prevType&&Jl[this._prevType]||this._stacks.push([]),this._prevType=F,this._stacks[this._stacks.length-1].push(u.id),!Kt))return!0;if(Jl[this._prevType]||Jl[F]&&Kt){this._prevType=F;const u=this._stacks.length-1,Kt=this._stacks[u]||[];for(const F of this._renderableTiles){if(this.pool.isFull()&&(la(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(F),F.rtt[u]){const Vt=this.pool.getObjectForId(F.rtt[u].id);if(Vt.stamp===F.rtt[u].stamp){this.pool.useObject(Vt);continue}}const Qi=this.pool.getOrCreateFreeObject();this.pool.useObject(Qi),this.pool.stampObject(Qi),F.rtt[u]={id:Qi.id,stamp:Qi.stamp},Wt.context.bindFramebuffer.set(Qi.fbo.framebuffer),Wt.context.clear({color:Vt.aP.transparent,stencil:0}),Wt.currentStencilSource=void 0;for(let u=0;u<Kt.length;u++){const Vt=Wt.style._layers[Kt[u]],fr=Vt.source?this._coordsDescendingInv[Vt.source][F.tileID.key]:[F.tileID];Wt.context.viewport.set([0,0,Qi.fbo.width,Qi.fbo.height]),Wt._renderTileClippingMasks(Vt,fr),Wt.renderLayer(Wt,Wt.style.sourceCaches[Vt.source],Vt,fr),Vt.source&&(F.rttCoords[Vt.source]=this._coordsDescendingInvStr[Vt.source][F.tileID.key])}}return la(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Jl[F]}return!1}}const Yl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ql=Wt,rc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Hl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:Vt.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Ss=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ms{constructor(u,F,Wt=!1){this.mousedown=u=>{this.startMouse(Vt.e({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),r.mousePos(this.element,u)),r.addEventListener(window,"mousemove",this.mousemove),r.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=u=>{this.moveMouse(u,r.mousePos(this.element,u))},this.mouseup=u=>{this.mouseRotate.dragEnd(u),this.mousePitch&&this.mousePitch.dragEnd(u),this.offTemp()},this.touchstart=u=>{1!==u.targetTouches.length?this.reset():(this._startPos=this._lastPos=r.touchPos(this.element,u.targetTouches)[0],this.startTouch(u,this._startPos),r.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),r.addEventListener(window,"touchend",this.touchend))},this.touchmove=u=>{1!==u.targetTouches.length?this.reset():(this._lastPos=r.touchPos(this.element,u.targetTouches)[0],this.moveTouch(u,this._lastPos))},this.touchend=u=>{0===u.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const Kt=u.dragRotate._mouseRotate.getClickTolerance(),Qi=u.dragRotate._mousePitch.getClickTolerance();this.element=F,this.mouseRotate=Ua({clickTolerance:Kt,enable:!0}),this.touchRotate=(({enable:u,clickTolerance:F,bearingDegreesPerPixelMoved:Vt=.8})=>{const Wt=new Na;return new Fa({clickTolerance:F,move:(u,F)=>({bearingDelta:(F.x-u.x)*Vt}),moveStateManager:Wt,enable:u,assignEvents:Ss})})({clickTolerance:Kt,enable:!0}),this.map=u,Wt&&(this.mousePitch=Za({clickTolerance:Qi,enable:!0}),this.touchPitch=(({enable:u,clickTolerance:F,pitchDegreesPerPixelMoved:Vt=-.5})=>{const Wt=new Na;return new Fa({clickTolerance:F,move:(u,F)=>({pitchDelta:(F.y-u.y)*Vt}),moveStateManager:Wt,enable:u,assignEvents:Ss})})({clickTolerance:Qi,enable:!0})),r.addEventListener(F,"mousedown",this.mousedown),r.addEventListener(F,"touchstart",this.touchstart,{passive:!1}),r.addEventListener(F,"touchcancel",this.reset)}startMouse(u,F){this.mouseRotate.dragStart(u,F),this.mousePitch&&this.mousePitch.dragStart(u,F),r.disableDrag()}startTouch(u,F){this.touchRotate.dragStart(u,F),this.touchPitch&&this.touchPitch.dragStart(u,F),r.disableDrag()}moveMouse(u,F){const Vt=this.map,{bearingDelta:Wt}=this.mouseRotate.dragMove(u,F)||{};if(Wt&&Vt.setBearing(Vt.getBearing()+Wt),this.mousePitch){const{pitchDelta:Wt}=this.mousePitch.dragMove(u,F)||{};Wt&&Vt.setPitch(Vt.getPitch()+Wt)}}moveTouch(u,F){const Vt=this.map,{bearingDelta:Wt}=this.touchRotate.dragMove(u,F)||{};if(Wt&&Vt.setBearing(Vt.getBearing()+Wt),this.touchPitch){const{pitchDelta:Wt}=this.touchPitch.dragMove(u,F)||{};Wt&&Vt.setPitch(Vt.getPitch()+Wt)}}off(){const u=this.element;r.removeEventListener(u,"mousedown",this.mousedown),r.removeEventListener(u,"touchstart",this.touchstart,{passive:!1}),r.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),r.removeEventListener(window,"touchend",this.touchend),r.removeEventListener(u,"touchcancel",this.reset),this.offTemp()}offTemp(){r.enableDrag(),r.removeEventListener(window,"mousemove",this.mousemove),r.removeEventListener(window,"mouseup",this.mouseup),r.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),r.removeEventListener(window,"touchend",this.touchend)}}let cc;function As(u,F,Wt){const Kt=new Vt.M(u.lng,u.lat);if(u=new Vt.M(u.lng,u.lat),F){const Kt=new Vt.M(u.lng-360,u.lat),Qi=new Vt.M(u.lng+360,u.lat),fr=Wt.locationPoint(u).distSqr(F);Wt.locationPoint(Kt).distSqr(F)<fr?u=Kt:Wt.locationPoint(Qi).distSqr(F)<fr&&(u=Qi)}for(;Math.abs(u.lng-Wt.center.lng)>180;){const F=Wt.locationPoint(u);if(F.x>=0&&F.y>=0&&F.x<=Wt.width&&F.y<=Wt.height)break;u.lng>Wt.center.lng?u.lng-=360:u.lng+=360}return u.lng!==Kt.lng&&Wt.locationPoint(u).y>Wt.height/2-Wt.getHorizon()?u:Kt}const hc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ls(u,F,Vt){const Wt=u.classList;for(const u in hc)Wt.remove(`maplibregl-${Vt}-anchor-${u}`);Wt.add(`maplibregl-${Vt}-anchor-${F}`)}class ks extends Vt.E{constructor(u){if(super(),this._onKeyPress=u=>{const F=u.code,Vt=u.charCode||u.keyCode;"Space"!==F&&"Enter"!==F&&32!==Vt&&13!==Vt||this.togglePopup()},this._onMapClick=u=>{const F=u.originalEvent.target,Vt=this._element;this._popup&&(F===Vt||Vt.contains(F))&&this.togglePopup()},this._update=u=>{var F;if(!this._map)return;const Vt=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==u?void 0:u.type)||"render"===(null==u?void 0:u.type)&&!Vt)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?As(this._lngLat,this._flatPos,this._map.transform):null===(F=this._lngLat)||void 0===F?void 0:F.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let Wt="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?Wt=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(Wt=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let Kt="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?Kt="rotateX(0deg)":"map"===this._pitchAlignment&&(Kt=`rotateX(${this._map.getPitch()}deg)`),u&&"moveend"!==u.type||(this._pos=this._pos.round()),r.setTransform(this._element,`${hc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${Kt} ${Wt}`),fr.frameAsync(new AbortController).then((()=>{this._updateOpacity(u&&"moveend"===u.type)})).catch((()=>{}))},this._onMove=u=>{if(!this._isDragging){const F=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=F}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Vt.k("dragstart"))),this.fire(new Vt.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new Vt.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&"auto"!==u.pitchAlignment?u.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(null==u?void 0:u.opacity,null==u?void 0:u.opacityWhenCovered),u&&u.element)this._element=u.element,this._offset=Vt.P.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div"),this._element.setAttribute("aria-label","Map marker");const F=r.createNS("http://www.w3.org/2000/svg","svg"),Wt=41,Kt=27;F.setAttributeNS(null,"display","block"),F.setAttributeNS(null,"height",`${Wt}px`),F.setAttributeNS(null,"width",`${Kt}px`),F.setAttributeNS(null,"viewBox",`0 0 ${Kt} ${Wt}`);const Qi=r.createNS("http://www.w3.org/2000/svg","g");Qi.setAttributeNS(null,"stroke","none"),Qi.setAttributeNS(null,"stroke-width","1"),Qi.setAttributeNS(null,"fill","none"),Qi.setAttributeNS(null,"fill-rule","evenodd");const fr=r.createNS("http://www.w3.org/2000/svg","g");fr.setAttributeNS(null,"fill-rule","nonzero");const _r=r.createNS("http://www.w3.org/2000/svg","g");_r.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_r.setAttributeNS(null,"fill","#000000");const Sr=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const u of Sr){const F=r.createNS("http://www.w3.org/2000/svg","ellipse");F.setAttributeNS(null,"opacity","0.04"),F.setAttributeNS(null,"cx","10.5"),F.setAttributeNS(null,"cy","5.80029008"),F.setAttributeNS(null,"rx",u.rx),F.setAttributeNS(null,"ry",u.ry),_r.appendChild(F)}const Ar=r.createNS("http://www.w3.org/2000/svg","g");Ar.setAttributeNS(null,"fill",this._color);const Jr=r.createNS("http://www.w3.org/2000/svg","path");Jr.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ar.appendChild(Jr);const zn=r.createNS("http://www.w3.org/2000/svg","g");zn.setAttributeNS(null,"opacity","0.25"),zn.setAttributeNS(null,"fill","#000000");const Qs=r.createNS("http://www.w3.org/2000/svg","path");Qs.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),zn.appendChild(Qs);const ta=r.createNS("http://www.w3.org/2000/svg","g");ta.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ta.setAttributeNS(null,"fill","#FFFFFF");const ia=r.createNS("http://www.w3.org/2000/svg","g");ia.setAttributeNS(null,"transform","translate(8.0, 8.0)");const aa=r.createNS("http://www.w3.org/2000/svg","circle");aa.setAttributeNS(null,"fill","#000000"),aa.setAttributeNS(null,"opacity","0.25"),aa.setAttributeNS(null,"cx","5.5"),aa.setAttributeNS(null,"cy","5.5"),aa.setAttributeNS(null,"r","5.4999962");const va=r.createNS("http://www.w3.org/2000/svg","circle");va.setAttributeNS(null,"fill","#FFFFFF"),va.setAttributeNS(null,"cx","5.5"),va.setAttributeNS(null,"cy","5.5"),va.setAttributeNS(null,"r","5.4999962"),ia.appendChild(aa),ia.appendChild(va),fr.appendChild(_r),fr.appendChild(Ar),fr.appendChild(zn),fr.appendChild(ta),fr.appendChild(ia),F.appendChild(fr),F.setAttributeNS(null,"height",Wt*this._scale+"px"),F.setAttributeNS(null,"width",Kt*this._scale+"px"),this._element.appendChild(F),this._offset=Vt.P.convert(u&&u.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(u=>{u.preventDefault()})),this._element.addEventListener("mousedown",(u=>{u.preventDefault()})),Ls(this._element,this._anchor,"marker"),u&&u.className)for(const F of u.className.split(" "))this._element.classList.add(F);this._popup=null}addTo(u){return this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),u.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=Vt.M.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const F=38.1,Vt=13.5,Wt=Math.abs(Vt)/Math.SQRT2;u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-F],"bottom-left":[Wt,-1*(F-Vt+Wt)],"bottom-right":[-Wt,-1*(F-Vt+Wt)],left:[Vt,-1*(F-Vt)],right:[-Vt,-1*(F-Vt)]}:this._offset}this._popup=u,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const u=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:u?(u.isOpen()?u.remove():(u.setLngLat(this._lngLat),u.addTo(this._map)),this):this}_updateOpacity(u=!1){var F,Wt;if(!(null===(F=this._map)||void 0===F?void 0:F.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(u)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const Kt=this._map,Qi=Kt.terrain.depthAtPoint(this._pos),fr=Kt.terrain.getElevationForLngLatZoom(this._lngLat,Kt.transform.tileZoom);if(Kt.transform.lngLatToCameraDepth(this._lngLat,fr)-Qi<.006)return void(this._element.style.opacity=this._opacity);const _r=-this._offset.y/Kt.transform._pixelPerMeter,Sr=Math.sin(Kt.getPitch()*Math.PI/180)*_r,Ar=Kt.terrain.depthAtPoint(new Vt.P(this._pos.x,this._pos.y-this._offset.y)),Jr=Kt.transform.lngLatToCameraDepth(this._lngLat,fr+Sr)-Ar>.006;(null===(Wt=this._popup)||void 0===Wt?void 0:Wt.isOpen())&&Jr&&this._popup.remove(),this._element.style.opacity=Jr?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(u){return this._offset=Vt.P.convert(u),this._update(),this}addClassName(u){this._element.classList.add(u)}removeClassName(u){this._element.classList.remove(u)}toggleClassName(u){return this._element.classList.toggle(u)}setDraggable(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u&&"auto"!==u?u:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(u,F){return void 0===u&&void 0===F&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==u&&(this._opacity=u),void 0!==F&&(this._opacityWhenCovered=F),this._map&&this._updateOpacity(!0),this}}const pc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mc=0,yc=!1;const xc={maxWidth:100,unit:"metric"};function js(u,F,Vt){const Wt=Vt&&Vt.maxWidth||100,Kt=u._container.clientHeight/2,Qi=u.unproject([0,Kt]),fr=u.unproject([Wt,Kt]),_r=Qi.distanceTo(fr);if(Vt&&"imperial"===Vt.unit){const Vt=3.2808*_r;Vt>5280?Us(F,Wt,Vt/5280,u._getUIString("ScaleControl.Miles")):Us(F,Wt,Vt,u._getUIString("ScaleControl.Feet"))}else Vt&&"nautical"===Vt.unit?Us(F,Wt,_r/1852,u._getUIString("ScaleControl.NauticalMiles")):_r>=1e3?Us(F,Wt,_r/1e3,u._getUIString("ScaleControl.Kilometers")):Us(F,Wt,_r,u._getUIString("ScaleControl.Meters"))}function Us(u,F,Vt,Wt){const Kt=function(u){const F=Math.pow(10,`${Math.floor(u)}`.length-1);let Vt=u/F;return Vt=Vt>=10?10:Vt>=5?5:Vt>=3?3:Vt>=2?2:Vt>=1?1:function(u){const F=Math.pow(10,Math.ceil(-Math.log(u)/Math.LN10));return Math.round(u*F)/F}(Vt),F*Vt}(Vt);u.style.width=F*(Kt/Vt)+"px",u.innerHTML=`${Kt}&nbsp;${Wt}`}const vc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Ac=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ws(u){if(u){if("number"==typeof u){const F=Math.round(Math.abs(u)/Math.SQRT2);return{center:new Vt.P(0,0),top:new Vt.P(0,u),"top-left":new Vt.P(F,F),"top-right":new Vt.P(-F,F),bottom:new Vt.P(0,-u),"bottom-left":new Vt.P(F,-F),"bottom-right":new Vt.P(-F,-F),left:new Vt.P(u,0),right:new Vt.P(-u,0)}}if(u instanceof Vt.P||Array.isArray(u)){const F=Vt.P.convert(u);return{center:F,top:F,"top-left":F,"top-right":F,bottom:F,"bottom-left":F,"bottom-right":F,left:F,right:F}}return{center:Vt.P.convert(u.center||[0,0]),top:Vt.P.convert(u.top||[0,0]),"top-left":Vt.P.convert(u["top-left"]||[0,0]),"top-right":Vt.P.convert(u["top-right"]||[0,0]),bottom:Vt.P.convert(u.bottom||[0,0]),"bottom-left":Vt.P.convert(u["bottom-left"]||[0,0]),"bottom-right":Vt.P.convert(u["bottom-right"]||[0,0]),left:Vt.P.convert(u.left||[0,0]),right:Vt.P.convert(u.right||[0,0])}}return Ws(new Vt.P(0,0))}const kc=Wt;F.AJAXError=Vt.bf,F.Evented=Vt.E,F.LngLat=Vt.M,F.MercatorCoordinate=Vt.Y,F.Point=Vt.P,F.addProtocol=Vt.bg,F.config=Vt.a,F.removeProtocol=Vt.bh,F.AttributionControl=fs,F.BoxZoomHandler=za,F.CanvasSource=Q,F.CooperativeGesturesHandler=hs,F.DoubleClickZoomHandler=as,F.DragPanHandler=rs,F.DragRotateHandler=ns,F.EdgeInsets=da,F.FullscreenControl=class extends Vt.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var u;let F=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(u=null==F?void 0:F.shadowRoot)||void 0===u?void 0:u.fullscreenElement;)F=F.shadowRoot.fullscreenElement;F===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:Vt.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){r.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=r.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);r.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new Vt.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new Vt.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},F.GeoJSONSource=X,F.GeolocateControl=class extends Vt.E{constructor(u){super(),this._onSuccess=u=>{if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new Vt.k("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(u),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new Vt.k("geolocate",u)),this._finish()}},this._updateCamera=u=>{const F=new Vt.M(u.coords.longitude,u.coords.latitude),Wt=u.coords.accuracy,Kt=this._map.getBearing(),Qi=Vt.e({bearing:Kt},this.options.fitBoundsOptions),fr=W.fromLngLat(F,Wt);this._map.fitBounds(fr,Qi,{geolocateSource:!0})},this._updateMarker=u=>{if(u){const F=new Vt.M(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(F).addTo(this._map),this._userLocationDotMarker.setLngLat(F).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=u=>{if(this._map){if(this.options.trackUserLocation)if(1===u.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===u.code&&yc)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new Vt.k("error",u)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=u=>{if(this._map){if(this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this._geolocateButton=r.create("button","maplibregl-ctrl-geolocate",this._container),r.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===u){Vt.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ks({element:this._dotElement}),this._circleElement=r.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ks({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(u=>{u.geolocateSource||"ACTIVE_LOCK"!==this._watchState||u.originalEvent&&"resize"===u.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Vt.k("trackuserlocationend")))}))}},this.options=Vt.e({},pc,u)}onAdd(u){return this._map=u,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return Vt._(this,arguments,void 0,(function*(u=!1){if(void 0!==cc&&!u)return cc;if(void 0===window.navigator.permissions)return cc=!!window.navigator.geolocation,cc;try{const u=yield window.navigator.permissions.query({name:"geolocation"});cc="denied"!==u.state}catch(u){cc=!!window.navigator.geolocation}return cc}))}().then((u=>this._setupUI(u))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),r.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,mc=0,yc=!1}_isOutOfMapMaxBounds(u){const F=this._map.getMaxBounds(),Vt=u.coords;return F&&(Vt.longitude<F.getWest()||Vt.longitude>F.getEast()||Vt.latitude<F.getSouth()||Vt.latitude>F.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),F=u.getSouthEast(),Vt=u.getNorthEast(),Wt=F.distanceTo(Vt),Kt=Math.ceil(this._accuracy/(Wt/this._map._container.clientHeight)*2);this._circleElement.style.width=`${Kt}px`,this._circleElement.style.height=`${Kt}px`}trigger(){if(!this._setup)return Vt.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Vt.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mc--,yc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new Vt.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Vt.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),mc++,mc>1?(u={maximumAge:6e5,timeout:0},yc=!0):(u=this.options.positionOptions,yc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},F.Hash=fa,F.ImageSource=J,F.KeyboardHandler=Qa,F.LngLatBounds=W,F.LogoControl=gs,F.Map=class extends ps{constructor(u){if(Vt.bd.mark(Vt.be.create),null!=(u=Vt.e({},rc,u)).minZoom&&null!=u.maxZoom&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=u.minPitch&&null!=u.maxPitch&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=u.minPitch&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=u.maxPitch&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pa(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),{bearingSnap:u.bearingSnap}),this._contextLost=u=>{u.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new Vt.k("webglcontextlost",{originalEvent:u}))},this._contextRestored=u=>{this._setupPainter(),this.resize(),this._update(),this.fire(new Vt.k("webglcontextrestored",{originalEvent:u}))},this._onMapScroll=u=>{if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new vs,this._controls=[],this._mapId=Vt.a3(),this._locale=Vt.e({},Yl,u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=Qs.addThrottleControl((()=>this.isMoving())),this._requestManager=new p(u.transformRequest),"string"==typeof u.container){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let u=!1;const F=ma((u=>{this._trackResize&&!this._removed&&this.resize(u)._update()}),50);this._resizeObserver=new ResizeObserver((Vt=>{u?F(Vt):u=!0})),this._resizeObserver.observe(this._container)}this.handlers=new _s(this,u),this._hash=u.hash&&new fa("string"==typeof u.hash&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,Vt.e({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new fs("boolean"==typeof u.attributionControl?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new gs,u.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(u=>{this._update("style"===u.dataType),this.fire(new Vt.k(`${u.dataType}data`,u))})),this.on("dataloading",(u=>{this.fire(new Vt.k(`${u.dataType}dataloading`,u))})),this.on("dataabort",(u=>{this.fire(new Vt.k("sourcedataabort",u))}))}_getMapId(){return this._mapId}addControl(u,F){if(void 0===F&&(F=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new Vt.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const Wt=u.onAdd(this);this._controls.push(u);const Kt=this._controlPositions[F];return-1!==F.indexOf("bottom")?Kt.insertBefore(Wt,Kt.firstChild):Kt.appendChild(Wt),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new Vt.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const F=this._controls.indexOf(u);return F>-1&&this._controls.splice(F,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,F,Vt,Wt){return null==Wt&&this.terrain&&(Wt=this.terrain.getElevationForLngLatZoom(Vt,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,F,Vt,Wt)}resize(u){var F;const Wt=this._containerDimensions(),Kt=Wt[0],Qi=Wt[1],fr=this._getClampedPixelRatio(Kt,Qi);if(this._resizeCanvas(Kt,Qi,fr),this.painter.resize(Kt,Qi,fr),this.painter.overLimit()){const u=this.painter.context.gl;this._maxCanvasSize=[u.drawingBufferWidth,u.drawingBufferHeight];const F=this._getClampedPixelRatio(Kt,Qi);this._resizeCanvas(Kt,Qi,F),this.painter.resize(Kt,Qi,F)}this.transform.resize(Kt,Qi),null===(F=this._requestedCameraState)||void 0===F||F.resize(Kt,Qi);const _r=!this._moving;return _r&&(this.stop(),this.fire(new Vt.k("movestart",u)).fire(new Vt.k("move",u))),this.fire(new Vt.k("resize",u)),_r&&this.fire(new Vt.k("moveend",u)),this}_getClampedPixelRatio(u,F){const{0:Vt,1:Wt}=this._maxCanvasSize,Kt=this.getPixelRatio(),Qi=u*Kt,fr=F*Kt;return Math.min(Qi>Vt?Vt/Qi:1,fr>Wt?Wt/fr:1)*Kt}getPixelRatio(){var u;return null!==(u=this._overridePixelRatio)&&void 0!==u?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(W.convert(u)),this._update()}setMinZoom(u){if((u=null==u?-2:u)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=null==u?22:u)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=null==u?0:u)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=null==u?60:u)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(Vt.M.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(Vt.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||(null===(u=this.handlers)||void 0===u?void 0:u.isMoving())}isZooming(){var u;return this._zooming||(null===(u=this.handlers)||void 0===u?void 0:u.isZooming())}isRotating(){var u;return this._rotating||(null===(u=this.handlers)||void 0===u?void 0:u.isRotating())}_createDelegatedListener(u,F,Vt){if("mouseenter"===u||"mouseover"===u){let Wt=!1;const s=Kt=>{const Qi=this.getLayer(F)?this.queryRenderedFeatures(Kt.point,{layers:[F]}):[];Qi.length?Wt||(Wt=!0,Vt.call(this,new Ea(u,this,Kt.originalEvent,{features:Qi}))):Wt=!1};return{layer:F,listener:Vt,delegates:{mousemove:s,mouseout:()=>{Wt=!1}}}}if("mouseleave"===u||"mouseout"===u){let Wt=!1;const s=Kt=>{(this.getLayer(F)?this.queryRenderedFeatures(Kt.point,{layers:[F]}):[]).length?Wt=!0:Wt&&(Wt=!1,Vt.call(this,new Ea(u,this,Kt.originalEvent)))},o=F=>{Wt&&(Wt=!1,Vt.call(this,new Ea(u,this,F.originalEvent)))};return{layer:F,listener:Vt,delegates:{mousemove:s,mouseout:o}}}{const a=u=>{const Wt=this.getLayer(F)?this.queryRenderedFeatures(u.point,{layers:[F]}):[];Wt.length&&(u.features=Wt,Vt.call(this,u),delete u.features)};return{layer:F,listener:Vt,delegates:{[u]:a}}}}on(u,F,Vt){if(void 0===Vt)return super.on(u,F);const Wt=this._createDelegatedListener(u,F,Vt);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(Wt);for(const u in Wt.delegates)this.on(u,Wt.delegates[u]);return this}once(u,F,Vt){if(void 0===Vt)return super.once(u,F);const Wt=this._createDelegatedListener(u,F,Vt);for(const u in Wt.delegates)this.once(u,Wt.delegates[u]);return this}off(u,F,Vt){return void 0===Vt?super.off(u,F):(this._delegatedListeners&&this._delegatedListeners[u]&&(Wt=>{const Kt=this._delegatedListeners[u];for(let u=0;u<Kt.length;u++){const Wt=Kt[u];if(Wt.layer===F&&Wt.listener===Vt){for(const u in Wt.delegates)this.off(u,Wt.delegates[u]);return Kt.splice(u,1),this}}})(),this)}queryRenderedFeatures(u,F){if(!this.style)return[];let Wt;const Kt=u instanceof Vt.P||Array.isArray(u),Qi=Kt?u:[[0,0],[this.transform.width,this.transform.height]];if(F=F||(Kt?{}:u)||{},Qi instanceof Vt.P||"number"==typeof Qi[0])Wt=[Vt.P.convert(Qi)];else{const u=Vt.P.convert(Qi[0]),F=Vt.P.convert(Qi[1]);Wt=[u,new Vt.P(F.x,u.y),F,new Vt.P(u.x,F.y),u]}return this.style.queryRenderedFeatures(Wt,F,this.transform)}querySourceFeatures(u,F){return this.style.querySourceFeatures(u,F)}setStyle(u,F){return!1!==(F=Vt.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},F)).diff&&F.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,F),this):(this._localIdeographFontFamily=F.localIdeographFontFamily,this._updateStyle(u,F))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const F=this._locale[u];if(null==F)throw new Error(`Missing UI string '${u}'`);return F}_updateStyle(u,F){if(F.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(u,F)));const Vt=this.style&&F.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new he(this,F||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof u?this.style.loadURL(u,F,Vt):this.style.loadJSON(u,F,Vt),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new he(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,F){if("string"==typeof u){const Wt=this._requestManager.transformRequest(u,"Style");Vt.h(Wt,new AbortController).then((u=>{this._updateDiff(u.data,F)})).catch((u=>{u&&this.fire(new Vt.j(u))}))}else"object"==typeof u&&this._updateDiff(u,F)}_updateDiff(u,F){try{this.style.setState(u,F)&&this._update(!0)}catch(Wt){Vt.w(`Unable to perform style diff: ${Wt.message||Wt.error||Wt}.  Rebuilding the style from scratch.`),this._updateStyle(u,F)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():Vt.w("There is no style added to the map.")}addSource(u,F){return this._lazyInitEmptyStyle(),this.style.addSource(u,F),this._update(!0)}isSourceLoaded(u){const F=this.style&&this.style.sourceCaches[u];if(void 0!==F)return F.loaded();this.fire(new Vt.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const F=this.style.sourceCaches[u.source];if(!F)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);null===this.terrain&&F.reload();for(const F in this.style._layers){const Wt=this.style._layers[F];"hillshade"===Wt.type&&Wt.source===u.source&&Vt.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new bs(this.painter,F,u),this.painter.renderToTexture=new Is(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=F=>{"style"===F.dataType?this.terrain.sourceCache.freeRtt():"source"===F.dataType&&F.tile&&(F.sourceId!==u.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(F.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new Vt.k("terrain",{terrain:u})),this}getTerrain(){var u,F;return null!==(F=null===(u=this.terrain)||void 0===u?void 0:u.options)&&void 0!==F?F:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const F in u){const Vt=u[F]._tiles;for(const u in Vt){const F=Vt[u];if("loaded"!==F.state&&"errored"!==F.state)return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,F,Wt={}){const{pixelRatio:Kt=1,sdf:Qi=!1,stretchX:_r,stretchY:Sr,content:Ar,textFitWidth:Jr,textFitHeight:zn}=Wt;if(this._lazyInitEmptyStyle(),!(F instanceof HTMLImageElement||Vt.b(F))){if(void 0===F.width||void 0===F.height)return this.fire(new Vt.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Wt,height:fr,data:Qs}=F,ta=F;return this.style.addImage(u,{data:new Vt.R({width:Wt,height:fr},new Uint8Array(Qs)),pixelRatio:Kt,stretchX:_r,stretchY:Sr,content:Ar,textFitWidth:Jr,textFitHeight:zn,sdf:Qi,version:0,userImage:ta}),ta.onAdd&&ta.onAdd(this,u),this}}{const{width:Wt,height:Qs,data:ta}=fr.getImageData(F);this.style.addImage(u,{data:new Vt.R({width:Wt,height:Qs},ta),pixelRatio:Kt,stretchX:_r,stretchY:Sr,content:Ar,textFitWidth:Jr,textFitHeight:zn,sdf:Qi,version:0})}}updateImage(u,F){const Wt=this.style.getImage(u);if(!Wt)return this.fire(new Vt.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const Kt=F instanceof HTMLImageElement||Vt.b(F)?fr.getImageData(F):F,{width:Qi,height:_r,data:Sr}=Kt;if(void 0===Qi||void 0===_r)return this.fire(new Vt.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(Qi!==Wt.data.width||_r!==Wt.data.height)return this.fire(new Vt.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const Ar=!(F instanceof HTMLImageElement||Vt.b(F));return Wt.data.replace(Sr,Ar),this.style.updateImage(u,Wt),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new Vt.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return Qs.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,F){return this._lazyInitEmptyStyle(),this.style.addLayer(u,F),this._update(!0)}moveLayer(u,F){return this.style.moveLayer(u,F),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,F,Vt){return this.style.setLayerZoomRange(u,F,Vt),this._update(!0)}setFilter(u,F,Vt={}){return this.style.setFilter(u,F,Vt),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,F,Vt,Wt={}){return this.style.setPaintProperty(u,F,Vt,Wt),this._update(!0)}getPaintProperty(u,F){return this.style.getPaintProperty(u,F)}setLayoutProperty(u,F,Vt,Wt={}){return this.style.setLayoutProperty(u,F,Vt,Wt),this._update(!0)}getLayoutProperty(u,F){return this.style.getLayoutProperty(u,F)}setGlyphs(u,F={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,F),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,F,Vt={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,F,Vt,(u=>{u||this._update(!0)})),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,F={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,F,(u=>{u||this._update(!0)})),this}setLight(u,F={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,F),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(u,F){return this.style.setFeatureState(u,F),this._update()}removeFeatureState(u,F){return this.style.removeFeatureState(u,F),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,F=0;return this._container&&(u=this._container.clientWidth||400,F=this._container.clientHeight||300),[u,F]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const F=this._canvasContainer=r.create("div","maplibregl-canvas-container",u);this._interactive&&F.classList.add("maplibregl-interactive"),this._canvas=r.create("canvas","maplibregl-canvas",F),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const Vt=this._containerDimensions(),Wt=this._getClampedPixelRatio(Vt[0],Vt[1]);this._resizeCanvas(Vt[0],Vt[1],Wt);const Kt=this._controlContainer=r.create("div","maplibregl-control-container",u),Qi=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((u=>{Qi[u]=r.create("div",`maplibregl-ctrl-${u} `,Kt)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,F,Vt){this._canvas.width=Math.floor(Vt*u),this._canvas.height=Math.floor(Vt*F),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${F}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let F=null;this._canvas.addEventListener("webglcontextcreationerror",(Vt=>{F={requestedAttributes:u},Vt&&(F.statusMessage=Vt.statusMessage,F.type=Vt.type)}),{once:!0});const Vt=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!Vt){const u="Failed to initialize WebGL";throw F?(F.message=u,new Error(JSON.stringify(F))):new Error(u)}this.painter=new ha(Vt,this.transform),_r.testSupport(Vt)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const F=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let Wt=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,Kt=fr.now();this.style.zoomHistory.update(u,Kt);const Qi=new Vt.a8(u,{now:Kt,fadeDuration:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_r=Qi.crossFadingFactor();1===_r&&_r===this._crossFadingFactor||(Wt=!0,this._crossFadingFactor=_r),this.style.update(Qi)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,F,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:F,showPadding:this.showPadding}),this.fire(new Vt.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Vt.bd.mark(Vt.be.load),this.fire(new Vt.k("load"))),this.style&&(this.style.hasTransitions()||Wt)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const Kt=this._sourcesDirty||this._styleDirty||this._placementDirty;return Kt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new Vt.k("idle")),!this._loaded||this._fullyLoaded||Kt||(this._fullyLoaded=!0,Vt.bd.mark(Vt.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),Qs.removeThrottleControl(this._imageQueueHandle),null===(u=this._resizeObserver)||void 0===u||u.disconnect();const F=this.painter.context.gl.getExtension("WEBGL_lose_context");F&&F.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),r.remove(this._canvasContainer),r.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),Vt.bd.clearMetrics(),this._removed=!0,this.fire(new Vt.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,fr.frameAsync(this._frameRequest).then((u=>{Vt.bd.frame(u),this._frameRequest=null,this._render(u)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return Ql}getCameraTargetElevation(){return this.transform.elevation}},F.MapMouseEvent=Ea,F.MapTouchEvent=Pa,F.MapWheelEvent=Ca,F.Marker=ks,F.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const u=this._map.getZoom(),F=u===this._map.getMaxZoom(),Vt=u===this._map.getMinZoom();this._zoomInButton.disabled=F,this._zoomOutButton.disabled=Vt,this._zoomInButton.setAttribute("aria-disabled",F.toString()),this._zoomOutButton.setAttribute("aria-disabled",Vt.toString())},this._rotateCompassArrow=()=>{const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=u},this._setButtonTitle=(u,F)=>{const Vt=this._map._getUIString(`NavigationControl.${F}`);u.title=Vt,u.setAttribute("aria-label",Vt)},this.options=Vt.e({},nc,u),this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(u=>this._map.zoomIn({},{originalEvent:u}))),r.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(u=>this._map.zoomOut({},{originalEvent:u}))),r.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(u=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:u}):this._map.resetNorth({},{originalEvent:u})})),this._compassIcon=r.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ms(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,F){const Vt=r.create("button",u,this._container);return Vt.type="button",Vt.addEventListener("click",F),Vt}},F.Popup=class extends Vt.E{constructor(u){super(),this.remove=()=>(this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new Vt.k("close"))),this),this._onMouseUp=u=>{this._update(u.point)},this._onMouseMove=u=>{this._update(u.point)},this._onDrag=u=>{this._update(u.point)},this._update=u=>{var F;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=r.create("div","maplibregl-popup",this._map.getContainer()),this._tip=r.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const u of this.options.className.split(" "))this._container.classList.add(u);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?As(this._lngLat,this._flatPos,this._map.transform):null===(F=this._lngLat)||void 0===F?void 0:F.wrap(),this._trackPointer&&!u)return;const Vt=this._flatPos=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&u?u:this._map.transform.locationPoint(this._lngLat));let Wt=this.options.anchor;const Kt=Ws(this.options.offset);if(!Wt){const u=this._container.offsetWidth,F=this._container.offsetHeight;let Qi;Qi=Vt.y+Kt.bottom.y<F?["top"]:Vt.y>this._map.transform.height-F?["bottom"]:[],Vt.x<u/2?Qi.push("left"):Vt.x>this._map.transform.width-u/2&&Qi.push("right"),Wt=0===Qi.length?"bottom":Qi.join("-")}let Qi=Vt.add(Kt[Wt]);this.options.subpixelPositioning||(Qi=Qi.round()),r.setTransform(this._container,`${hc[Wt]} translate(${Qi.x}px,${Qi.y}px)`),Ls(this._container,Wt,"popup")},this._onClose=()=>{this.remove()},this.options=Vt.e(Object.create(vc),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new Vt.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=Vt.M.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const F=document.createDocumentFragment(),Vt=document.createElement("body");let Wt;for(Vt.innerHTML=u;Wt=Vt.firstChild,Wt;)F.appendChild(Wt);return this.setDOMContent(F)}getMaxWidth(){var u;return null===(u=this._container)||void 0===u?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=r.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=r.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Ac);u&&u.focus()}},F.RasterDEMTileSource=$,F.RasterTileSource=H,F.ScaleControl=class{constructor(u){this._onMove=()=>{js(this._map,this._container,this.options)},this.setUnit=u=>{this.options.unit=u,js(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xc),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},F.ScrollZoomHandler=is,F.Style=he,F.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=r.create("button","maplibregl-ctrl-terrain",this._container),r.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){r.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},F.TwoFingersTouchPitchHandler=Ja,F.TwoFingersTouchRotateHandler=Xa,F.TwoFingersTouchZoomHandler=Ha,F.TwoFingersTouchZoomRotateHandler=ls,F.VectorTileSource=V,F.VideoSource=Y,F.addSourceType=(u,F)=>Vt._(void 0,void 0,void 0,(function*(){if(et(u))throw new Error(`A source type called "${u}" already exists.`);((u,F)=>{io[u]=F})(u,F)})),F.clearPrewarmedResources=function(){const u=Ya;u&&(u.isPreloaded()&&1===u.numActive()?(u.release(va),Ya=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},F.getMaxParallelImageRequests=function(){return Vt.a.MAX_PARALLEL_IMAGE_REQUESTS},F.getRTLTextPluginStatus=function(){return ot().getRTLTextPluginStatus()},F.getVersion=function(){return kc},F.getWorkerCount=function(){return R.workerCount},F.getWorkerUrl=function(){return Vt.a.WORKER_URL},F.importScriptInWorkers=function(u){return N().broadcast("IS",u)},F.prewarm=function(){B().acquire(va)},F.setMaxParallelImageRequests=function(u){Vt.a.MAX_PARALLEL_IMAGE_REQUESTS=u},F.setRTLTextPlugin=function(u,F){return ot().setRTLTextPlugin(u,F)},F.setWorkerCount=function(u){R.workerCount=u},F.setWorkerUrl=function(u){Vt.a.WORKER_URL=u}}));var Wt=F;return Wt}));var Vt=F;export{Vt as default};

